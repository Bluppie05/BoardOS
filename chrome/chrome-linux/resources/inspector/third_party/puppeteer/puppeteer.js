const e=(e,t)=>{if(!e)throw new Error(t)},t=!("undefined"==typeof process||!process.versions||!process.versions.node),i=e=>t?require("debug")(e):(...t)=>{const i=globalThis.__PUPPETEER_DEBUG;if(!i)return;("*"===i||(i.endsWith("*")?e.startsWith(i):e===i))&&console.log(e+":",...t)};class s{constructor(){var e;this.eventsMap=new Map,this.emitter={all:e=(e=this.eventsMap)||new Map,on(t,i){const s=e.get(t);s&&s.push(i)||e.set(t,[i])},off(t,i){const s=e.get(t);s&&s.splice(s.indexOf(i)>>>0,1)},emit(t,i){(e.get(t)||[]).slice().map(e=>{e(i)}),(e.get("*")||[]).slice().map(e=>{e(t,i)})}}}on(e,t){return this.emitter.on(e,t),this}off(e,t){return this.emitter.off(e,t),this}removeListener(e,t){return this.off(e,t),this}addListener(e,t){return this.on(e,t),this}emit(e,t){return this.emitter.emit(e,t),this.eventListenersCount(e)>0}once(e,t){const i=s=>{t(s),this.off(e,i)};return this.on(e,i)}listenerCount(e){return this.eventListenersCount(e)}removeAllListeners(e){return e?this.eventsMap.delete(e):this.eventsMap.clear(),this}eventListenersCount(e){return this.eventsMap.has(e)?this.eventsMap.get(e).length:0}}const n=i("puppeteer:protocol:SEND ►"),o=i("puppeteer:protocol:RECV ◀"),a={Disconnected:Symbol("Connection.Disconnected")};class r extends s{constructor(e,t,i=0){super(),this._lastId=0,this._sessions=new Map,this._closed=!1,this._callbacks=new Map,this._url=e,this._delay=i,this._transport=t,this._transport.onmessage=this._onMessage.bind(this),this._transport.onclose=this._onClose.bind(this)}static fromSession(e){return e._connection}session(e){return this._sessions.get(e)||null}url(){return this._url}send(e,...t){const i=t.length?t[0]:void 0,s=this._rawSend({method:e,params:i});return new Promise((t,i)=>{this._callbacks.set(s,{resolve:t,reject:i,error:new Error,method:e})})}_rawSend(e){const t=++this._lastId,i=JSON.stringify(Object.assign({},e,{id:t}));return n(i),this._transport.send(i),t}async _onMessage(e){this._delay&&await new Promise(e=>setTimeout(e,this._delay)),o(e);const t=JSON.parse(e);if("Target.attachedToTarget"===t.method){const e=t.params.sessionId,i=new d(this,t.params.targetInfo.type,e);this._sessions.set(e,i)}else if("Target.detachedFromTarget"===t.method){const e=this._sessions.get(t.params.sessionId);e&&(e._onClosed(),this._sessions.delete(t.params.sessionId))}if(t.sessionId){const e=this._sessions.get(t.sessionId);e&&e._onMessage(t)}else if(t.id){const e=this._callbacks.get(t.id);e&&(this._callbacks.delete(t.id),t.error?e.reject(l(e.error,e.method,t)):e.resolve(t.result))}else this.emit(t.method,t.params)}_onClose(){if(!this._closed){this._closed=!0,this._transport.onmessage=null,this._transport.onclose=null;for(const e of this._callbacks.values())e.reject(h(e.error,`Protocol error (${e.method}): Target closed.`));this._callbacks.clear();for(const e of this._sessions.values())e._onClosed();this._sessions.clear(),this.emit(a.Disconnected)}}dispose(){this._onClose(),this._transport.close()}async createSession(e){const{sessionId:t}=await this.send("Target.attachToTarget",{targetId:e.targetId,flatten:!0});return this._sessions.get(t)}}const c={Disconnected:Symbol("CDPSession.Disconnected")};class d extends s{constructor(e,t,i){super(),this._callbacks=new Map,this._connection=e,this._targetType=t,this._sessionId=i}send(e,...t){if(!this._connection)return Promise.reject(new Error(`Protocol error (${e}): Session closed. Most likely the ${this._targetType} has been closed.`));const i=t.length?t[0]:void 0,s=this._connection._rawSend({sessionId:this._sessionId,method:e,params:i||{}});return new Promise((t,i)=>{this._callbacks.set(s,{resolve:t,reject:i,error:new Error,method:e})})}_onMessage(t){if(t.id&&this._callbacks.has(t.id)){const e=this._callbacks.get(t.id);this._callbacks.delete(t.id),t.error?e.reject(l(e.error,e.method,t)):e.resolve(t.result)}else e(!t.id),this.emit(t.method,t.params)}async detach(){if(!this._connection)throw new Error(`Session already detached. Most likely the ${this._targetType} has been closed.`);await this._connection.send("Target.detachFromTarget",{sessionId:this._sessionId})}_onClosed(){for(const e of this._callbacks.values())e.reject(h(e.error,`Protocol error (${e.method}): Target closed.`));this._callbacks.clear(),this._connection=null,this.emit(c.Disconnected)}}function l(e,t,i){let s=`Protocol error (${t}): ${i.error.message}`;return"data"in i.error&&(s+=" "+i.error.data),h(e,s)}function h(e,t){return e.message=t,e}class u extends Error{constructor(e){super(e),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}}class y extends u{}const m=i("puppeteer:error");function _(e,t,i){return e.on(t,i),{emitter:e,eventName:t,handler:i}}function p(e){for(const t of e)t.emitter.removeListener(t.eventName,t.handler);e.length=0}function f(e){return"string"==typeof e||e instanceof String}function g(t,...i){if(f(t))return e(0===i.length,"Cannot evaluate a string with arguments"),t;return`(${t})(${i.map((function(e){return Object.is(e,void 0)?"undefined":JSON.stringify(e)})).join(",")})`}async function w(){if(!t)throw new Error("Cannot load the fs module API outside of Node.");const e=await import("fs");return e.promises?e:e.default}const k={evaluationString:g,pageBindingInitString:function(e,t){return g((function(e,t){const i=window,s=i[t];i[t]=(...i)=>{const n=window[t];let o=n.callbacks;o||(o=new Map,n.callbacks=o);const a=(n.lastSeq||0)+1;n.lastSeq=a;const r=new Promise((e,t)=>o.set(a,{resolve:e,reject:t}));return s(JSON.stringify({type:e,name:t,seq:a,args:i})),r}}),e,t)},pageBindingDeliverResultString:function(e,t,i){return g((function(e,t,i){window[e].callbacks.get(t).resolve(i),window[e].callbacks.delete(t)}),e,t,i)},pageBindingDeliverErrorString:function(e,t,i,s){return g((function(e,t,i,s){const n=new Error(i);n.stack=s,window[e].callbacks.get(t).reject(n),window[e].callbacks.delete(t)}),e,t,i,s)},pageBindingDeliverErrorValueString:function(e,t,i){return g((function(e,t,i){window[e].callbacks.get(t).reject(i),window[e].callbacks.delete(t)}),e,t,i)},makePredicateString:function(e,t){return`\n    (() => {\n      ${t?`const predicateQueryHandler = ${t};`:""}\n      const checkWaitForOptions = ${function(e,t,i){if(!e)return i;if(!t&&!i)return e;const s=e.nodeType===Node.TEXT_NODE?e.parentElement:e,n=window.getComputedStyle(s),o=n&&"hidden"!==n.visibility&&function(){const e=s.getBoundingClientRect();return!!(e.top||e.bottom||e.width||e.height)}();return t===o||i===!o?e:null}};\n      return (${e})(...args)\n    })() `},readProtocolStream:async function(e,i,s){if(!t&&s)throw new Error("Cannot write to a path outside of Node.js environment.");const n=t?await w():null;let o,a=!1;s&&n&&(o=await n.promises.open(s,"w"));const r=[];for(;!a;){const t=await e.send("IO.read",{handle:i});a=t.eof;const c=Buffer.from(t.data,t.base64Encoded?"base64":void 0);r.push(c),s&&n&&await n.promises.writeFile(o,c)}s&&await o.close(),await e.send("IO.close",{handle:i});let c=null;try{c=Buffer.concat(r)}finally{return c}},waitWithTimeout:async function(e,t,i){let s;const n=new y(`waiting for ${t} failed: timeout ${i}ms exceeded`),o=new Promise((e,t)=>s=t);let a=null;i&&(a=setTimeout(()=>s(n),i));try{return await Promise.race([e,o])}finally{a&&clearTimeout(a)}},waitForEvent:async function(e,t,i,s,n){let o,a,r;const c=new Promise((e,t)=>{a=e,r=t}),d=_(e,t,e=>{i(e)&&a(e)});function l(){p([d]),clearTimeout(o)}s&&(o=setTimeout(()=>{r(new y("Timeout exceeded while waiting for event"))},s));const h=await Promise.race([c,n]).then(e=>(l(),e),e=>{throw l(),e});if(h instanceof Error)throw h;return h},isString:f,isNumber:function(e){return"number"==typeof e||e instanceof Number},importFSModule:w,addEventListener:_,removeEventListeners:p,valueFromRemoteObject:function(t){if(e(!t.objectId,"Cannot extract value when objectId is given"),t.unserializableValue){if("bigint"===t.type&&"undefined"!=typeof BigInt)return BigInt(t.unserializableValue.replace("n",""));switch(t.unserializableValue){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error("Unsupported unserializable value: "+t.unserializableValue)}}return t.value},getExceptionMessage:function(e){if(e.exception)return e.exception.description||e.exception.value;let t=e.text;if(e.stackTrace)for(const i of e.stackTrace.callFrames){const e=i.url+":"+i.lineNumber+":"+i.columnNumber;t+=`\n    at ${i.functionName||"<anonymous>"} (${e})`}return t},releaseObject:async function(e,t){t.objectId&&await e.send("Runtime.releaseObject",{objectId:t.objectId}).catch(e=>{m(e)})}};class C{constructor(e){this._client=e}async snapshot(e={}){const{interestingOnly:t=!0,root:i=null}=e,{nodes:s}=await this._client.send("Accessibility.getFullAXTree");let n=null;if(i){const{node:e}=await this._client.send("DOM.describeNode",{objectId:i._remoteObject.objectId});n=e.backendNodeId}const o=b.createTree(s);let a=o;if(n&&(a=o.find(e=>e.payload.backendDOMNodeId===n),!a))return null;if(!t)return this.serializeTree(a)[0];const r=new Set;return this.collectInterestingNodes(r,o,!1),r.has(a)?this.serializeTree(a,r)[0]:null}serializeTree(e,t){const i=[];for(const s of e.children)i.push(...this.serializeTree(s,t));if(t&&!t.has(e))return i;const s=e.serialize();return i.length&&(s.children=i),[s]}collectInterestingNodes(e,t,i){if(t.isInteresting(i)&&e.add(t),!t.isLeafNode()){i=i||t.isControl();for(const s of t.children)this.collectInterestingNodes(e,s,i)}}}class b{constructor(e){this.children=[],this._richlyEditable=!1,this._editable=!1,this._focusable=!1,this._hidden=!1,this.payload=e,this._name=this.payload.name?this.payload.name.value:"",this._role=this.payload.role?this.payload.role.value:"Unknown",this._ignored=this.payload.ignored;for(const e of this.payload.properties||[])"editable"===e.name&&(this._richlyEditable="richtext"===e.value.value,this._editable=!0),"focusable"===e.name&&(this._focusable=e.value.value),"hidden"===e.name&&(this._hidden=e.value.value)}_isPlainTextField(){return!this._richlyEditable&&(!!this._editable||("textbox"===this._role||"searchbox"===this._role))}_isTextOnlyObject(){const e=this._role;return"LineBreak"===e||"text"===e||"InlineTextBox"===e}_hasFocusableChild(){if(void 0===this._cachedHasFocusableChild){this._cachedHasFocusableChild=!1;for(const e of this.children)if(e._focusable||e._hasFocusableChild()){this._cachedHasFocusableChild=!0;break}}return this._cachedHasFocusableChild}find(e){if(e(this))return this;for(const t of this.children){const i=t.find(e);if(i)return i}return null}isLeafNode(){if(!this.children.length)return!0;if(this._isPlainTextField()||this._isTextOnlyObject())return!0;switch(this._role){case"doc-cover":case"graphics-symbol":case"img":case"Meter":case"scrollbar":case"slider":case"separator":case"progressbar":return!0}return!this._hasFocusableChild()&&(!(!this._focusable||!this._name)||!("heading"!==this._role||!this._name))}isControl(){switch(this._role){case"button":case"checkbox":case"ColorWell":case"combobox":case"DisclosureTriangle":case"listbox":case"menu":case"menubar":case"menuitem":case"menuitemcheckbox":case"menuitemradio":case"radio":case"scrollbar":case"searchbox":case"slider":case"spinbutton":case"switch":case"tab":case"textbox":case"tree":case"treeitem":return!0;default:return!1}}isInteresting(e){return"Ignored"!==this._role&&!this._hidden&&!this._ignored&&(!(!this._focusable&&!this._richlyEditable)||(!!this.isControl()||!e&&(this.isLeafNode()&&!!this._name)))}serialize(){const e=new Map;for(const t of this.payload.properties||[])e.set(t.name.toLowerCase(),t.value.value);this.payload.name&&e.set("name",this.payload.name.value),this.payload.value&&e.set("value",this.payload.value.value),this.payload.description&&e.set("description",this.payload.description.value);const t={role:this._role},i=["name","value","description","keyshortcuts","roledescription","valuetext"];for(const n of i)e.has(n)&&(t[n]=(s=n,e.get(s)));var s;const n=["disabled","expanded","focused","modal","multiline","multiselectable","readonly","required","selected"],o=t=>e.get(t);for(const e of n){if("focused"===e&&"WebArea"===this._role)continue;o(e)&&(t[e]=o(e))}const a=["checked","pressed"];for(const i of a){if(!e.has(i))continue;const s=e.get(i);t[i]="mixed"===s?"mixed":"true"===s}const r=["level","valuemax","valuemin"],c=t=>e.get(t);for(const i of r)e.has(i)&&(t[i]=c(i));const d=["autocomplete","haspopup","invalid","orientation"],l=t=>e.get(t);for(const e of d){const i=l(e);i&&"false"!==i&&(t[e]=l(e))}return t}static createTree(e){const t=new Map;for(const i of e)t.set(i.nodeId,new b(i));for(const e of t.values())for(const i of e.payload.childIds||[])e.children.push(t.get(i));return t.values().next().value}}class v{constructor(e,t,i,s){this._type=e,this._text=t,this._args=i,this._stackTraceLocations=s}type(){return this._type}text(){return this._text}args(){return this._args}location(){return this._stackTraceLocations.length?this._stackTraceLocations[0]:{}}stackTrace(){return this._stackTraceLocations}}async function x(e,t,i,s){const{nodes:n}=await e.send("Accessibility.queryAXTree",{objectId:t._remoteObject.objectId,accessibleName:i,role:s});return n.filter(e=>"text"!==e.role.value)}function I(e){const t=e=>e.replace(/ +/g," ").trim(),i=new Set(["name","role"]),s={},n=e.replace(/\[\s*(?<attribute>\w+)\s*=\s*"(?<value>\\.|[^"\\]*)"\s*\]/,(e,n,o)=>{if(n=n.trim(),!i.has(n))throw new Error('Unkown aria attribute "${groups.attribute}" in selector');return s[n]=t(o),""});return n&&!s.name&&(s.name=t(n)),s}const F=async(e,t)=>{const i=e.executionContext(),{name:s,role:n}=I(t),o=await x(i._client,e,s,n);return o.length<1?null:i._adoptBackendNodeId(o[0].backendDOMNodeId)},P=async(e,t)=>{const i=e.executionContext(),{name:s,role:n}=I(t),o=await x(i._client,e,s,n);return Promise.all(o.map(e=>i._adoptBackendNodeId(e.backendDOMNodeId)))};const S={queryOne:F,waitFor:async(e,t,i)=>(await async function(e){await e.addBinding("ariaQuerySelector",async t=>{const i=await e._document();return await F(i,t)})}(e),e.waitForSelectorInPage((e,t)=>globalThis.ariaQuerySelector(t),t,i)),queryAll:P,queryAllArray:async(e,t)=>{const i=await P(e,t);return e.executionContext().evaluateHandle((...e)=>e,...i)}};function E(e){const t={};return e.queryOne&&(t.queryOne=async(t,i)=>{const s=await t.evaluateHandle(e.queryOne,i),n=s.asElement();return n||(await s.dispose(),null)},t.waitFor=(t,i,s)=>t.waitForSelectorInPage(e.queryOne,i,s)),e.queryAll&&(t.queryAll=async(t,i)=>{const s=await t.evaluateHandle(e.queryAll,i),n=await s.getProperties();await s.dispose();const o=[];for(const e of n.values()){const t=e.asElement();t&&o.push(t)}return o},t.queryAllArray=async(t,i)=>{const s=await t.evaluateHandle(e.queryAll,i);return await s.evaluateHandle(e=>Array.from(e))}),t}const T=E({queryOne:(e,t)=>e.querySelector(t),queryAll:(e,t)=>e.querySelectorAll(t)}),N=E({queryOne:(e,t)=>{let i=null;const s=e=>{const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);do{const e=n.currentNode;e.shadowRoot&&s(e.shadowRoot),e instanceof ShadowRoot||!i&&e.matches(t)&&(i=e)}while(!i&&n.nextNode())};return e instanceof Document&&(e=e.documentElement),s(e),i},queryAll:(e,t)=>{const i=[],s=e=>{const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);do{const e=n.currentNode;e.shadowRoot&&s(e.shadowRoot),e instanceof ShadowRoot||e.matches(t)&&i.push(e)}while(n.nextNode())};return e instanceof Document&&(e=e.documentElement),s(e),i}}),M=new Map([["aria",S],["pierce",N]]),R=new Map(M);function D(e){if(!/^[a-zA-Z]+\//.test(e))return{updatedSelector:e,queryHandler:T};const t=e.indexOf("/"),i=e.slice(0,t),s=e.slice(t+1),n=R.get(i);if(!n)throw new Error(`Query set to use "${i}", but no query handler of that name was found`);return{updatedSelector:s,queryHandler:n}}function q(e,t){const i=e.frame();if("node"===t.subtype&&i){const s=i._frameManager;return new O(e,e._client,t,s.page(),s)}return new K(e,e._client,t)}class K{constructor(e,t,i){this._disposed=!1,this._context=e,this._client=t,this._remoteObject=i}executionContext(){return this._context}async evaluate(e,...t){return await this.executionContext().evaluate(e,this,...t)}async evaluateHandle(e,...t){return await this.executionContext().evaluateHandle(e,this,...t)}async getProperty(e){const t=await this.evaluateHandle((e,t)=>{const i={__proto__:null};return i[t]=e[t],i},e),i=(await t.getProperties()).get(e)||null;return await t.dispose(),i}async getProperties(){const e=await this._client.send("Runtime.getProperties",{objectId:this._remoteObject.objectId,ownProperties:!0}),t=new Map;for(const i of e.result)i.enumerable&&t.set(i.name,q(this._context,i.value));return t}async jsonValue(){if(this._remoteObject.objectId){const e=await this._client.send("Runtime.callFunctionOn",{functionDeclaration:"function() { return this; }",objectId:this._remoteObject.objectId,returnByValue:!0,awaitPromise:!0});return k.valueFromRemoteObject(e.result)}return k.valueFromRemoteObject(this._remoteObject)}asElement(){return null}async dispose(){this._disposed||(this._disposed=!0,await k.releaseObject(this._client,this._remoteObject))}toString(){if(this._remoteObject.objectId){return"JSHandle@"+(this._remoteObject.subtype||this._remoteObject.type)}return"JSHandle:"+k.valueFromRemoteObject(this._remoteObject)}}class O extends K{constructor(e,t,i,s,n){super(e,t,i),this._client=t,this._remoteObject=i,this._page=s,this._frameManager=n}asElement(){return this}async contentFrame(){const e=await this._client.send("DOM.describeNode",{objectId:this._remoteObject.objectId});return"string"!=typeof e.node.frameId?null:this._frameManager.frame(e.node.frameId)}async _scrollIntoViewIfNeeded(){const e=await this.evaluate(async(e,t)=>{if(!e.isConnected)return"Node is detached from document";if(e.nodeType!==Node.ELEMENT_NODE)return"Node is not of type HTMLElement";if(!t)return e.scrollIntoView({block:"center",inline:"center",behavior:"instant"}),!1;return 1!==await new Promise(t=>{const i=new IntersectionObserver(e=>{t(e[0].intersectionRatio),i.disconnect()});i.observe(e)})&&e.scrollIntoView({block:"center",inline:"center",behavior:"instant"}),!1},this._page.isJavaScriptEnabled());if(e)throw new Error(e)}async _clickablePoint(){const[e,t]=await Promise.all([this._client.send("DOM.getContentQuads",{objectId:this._remoteObject.objectId}).catch(m),this._client.send("Page.getLayoutMetrics")]);if(!e||!e.quads.length)throw new Error("Node is either not visible or not an HTMLElement");const{clientWidth:i,clientHeight:s}=t.layoutViewport,n=e.quads.map(e=>this._fromProtocolQuad(e)).map(e=>this._intersectQuadWithViewport(e,i,s)).filter(e=>function(e){let t=0;for(let i=0;i<e.length;++i){const s=e[i],n=e[(i+1)%e.length];t+=(s.x*n.y-n.x*s.y)/2}return Math.abs(t)}(e)>1);if(!n.length)throw new Error("Node is either not visible or not an HTMLElement");const o=n[0];let a=0,r=0;for(const e of o)a+=e.x,r+=e.y;return{x:a/4,y:r/4}}_getBoxModel(){const e={objectId:this._remoteObject.objectId};return this._client.send("DOM.getBoxModel",e).catch(e=>m(e))}_fromProtocolQuad(e){return[{x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},{x:e[6],y:e[7]}]}_intersectQuadWithViewport(e,t,i){return e.map(e=>({x:Math.min(Math.max(e.x,0),t),y:Math.min(Math.max(e.y,0),i)}))}async hover(){await this._scrollIntoViewIfNeeded();const{x:e,y:t}=await this._clickablePoint();await this._page.mouse.move(e,t)}async click(e={}){await this._scrollIntoViewIfNeeded();const{x:t,y:i}=await this._clickablePoint();await this._page.mouse.click(t,i,e)}async select(...t){for(const i of t)e(k.isString(i),'Values must be strings. Found value "'+i+'" of type "'+typeof i+'"');return this.evaluate((e,t)=>{if("select"!==e.nodeName.toLowerCase())throw new Error("Element is not a <select> element.");const i=Array.from(e.options);e.value=void 0;for(const s of i)if(s.selected=t.includes(s.value),s.selected&&!e.multiple)break;return e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),i.filter(e=>e.selected).map(e=>e.value)},t)}async uploadFile(...i){const s=await this.evaluate(e=>e.multiple);if(e(i.length<=1||s,"Multiple file uploads only work with <input type=file multiple>"),!t)throw new Error("JSHandle#uploadFile can only be used in Node environments.");const n=await import("path"),o=await k.importFSModule(),a=await Promise.all(i.map(async e=>{const t=n.resolve(e);try{await o.promises.access(t,o.constants.R_OK)}catch(t){if("ENOENT"===t.code)throw new Error(e+" does not exist or is not readable")}return t})),{objectId:r}=this._remoteObject,{node:c}=await this._client.send("DOM.describeNode",{objectId:r}),{backendNodeId:d}=c;0===a.length?await this.evaluate(e=>{e.files=(new DataTransfer).files,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))}):await this._client.send("DOM.setFileInputFiles",{objectId:r,files:a,backendNodeId:d})}async tap(){await this._scrollIntoViewIfNeeded();const{x:e,y:t}=await this._clickablePoint();await this._page.touchscreen.tap(e,t)}async focus(){await this.evaluate(e=>e.focus())}async type(e,t){await this.focus(),await this._page.keyboard.type(e,t)}async press(e,t){await this.focus(),await this._page.keyboard.press(e,t)}async boundingBox(){const e=await this._getBoxModel();if(!e)return null;const t=e.model.border,i=Math.min(t[0],t[2],t[4],t[6]),s=Math.min(t[1],t[3],t[5],t[7]);return{x:i,y:s,width:Math.max(t[0],t[2],t[4],t[6])-i,height:Math.max(t[1],t[3],t[5],t[7])-s}}async boxModel(){const e=await this._getBoxModel();if(!e)return null;const{content:t,padding:i,border:s,margin:n,width:o,height:a}=e.model;return{content:this._fromProtocolQuad(t),padding:this._fromProtocolQuad(i),border:this._fromProtocolQuad(s),margin:this._fromProtocolQuad(n),width:o,height:a}}async screenshot(t={}){let i=!1,s=await this.boundingBox();e(s,"Node is either not visible or not an HTMLElement");const n=this._page.viewport();if(n&&(s.width>n.width||s.height>n.height)){const e={width:Math.max(n.width,Math.ceil(s.width)),height:Math.max(n.height,Math.ceil(s.height))};await this._page.setViewport(Object.assign({},n,e)),i=!0}await this._scrollIntoViewIfNeeded(),s=await this.boundingBox(),e(s,"Node is either not visible or not an HTMLElement"),e(0!==s.width,"Node has 0 width."),e(0!==s.height,"Node has 0 height.");const{layoutViewport:{pageX:o,pageY:a}}=await this._client.send("Page.getLayoutMetrics"),r=Object.assign({},s);r.x+=o,r.y+=a;const c=await this._page.screenshot(Object.assign({},{clip:r},t));return i&&await this._page.setViewport(n),c}async $(e){const{updatedSelector:t,queryHandler:i}=D(e);return i.queryOne(this,t)}async $$(e){const{updatedSelector:t,queryHandler:i}=D(e);return i.queryAll(this,t)}async $eval(e,t,...i){const s=await this.$(e);if(!s)throw new Error(`Error: failed to find element matching selector "${e}"`);const n=await s.evaluate(t,...i);return await s.dispose(),n}async $$eval(e,t,...i){const{updatedSelector:s,queryHandler:n}=D(e),o=await n.queryAllArray(this,s),a=await o.evaluate(t,...i);return await o.dispose(),a}async $x(e){const t=await this.evaluateHandle((e,t)=>{const i=(e.ownerDocument||e).evaluate(t,e,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE),s=[];let n;for(;n=i.iterateNext();)s.push(n);return s},e),i=await t.getProperties();await t.dispose();const s=[];for(const e of i.values()){const t=e.asElement();t&&s.push(t)}return s}async isIntersectingViewport(){return await this.evaluate(async e=>await new Promise(t=>{const i=new IntersectionObserver(e=>{t(e[0].intersectionRatio),i.disconnect()});i.observe(e)})>0)}}const L=/^[\040\t]*\/\/[@#] sourceURL=\s*(\S*?)\s*$/m;class A{constructor(e,t,i){this._client=e,this._world=i,this._contextId=t.id}frame(){return this._world?this._world.frame():null}async evaluate(e,...t){return await this._evaluateInternal(!0,e,...t)}async evaluateHandle(e,...t){return this._evaluateInternal(!1,e,...t)}async _evaluateInternal(e,t,...i){const s="//# sourceURL=__puppeteer_evaluation_script__";if(k.isString(t)){const i=this._contextId,n=t,o=L.test(n)?n:n+"\n"+s,{exceptionDetails:a,result:r}=await this._client.send("Runtime.evaluate",{expression:o,contextId:i,returnByValue:e,awaitPromise:!0,userGesture:!0}).catch(c);if(a)throw new Error("Evaluation failed: "+k.getExceptionMessage(a));return e?k.valueFromRemoteObject(r):q(this,r)}if("function"!=typeof t)throw new Error(`Expected to get |string| or |function| as the first argument, but got "${t}" instead.`);let n,o=t.toString();try{new Function("("+o+")")}catch(e){o=o.startsWith("async ")?"async function "+o.substring("async ".length):"function "+o;try{new Function("("+o+")")}catch(e){throw new Error("Passed function is not well-serializable!")}}try{n=this._client.send("Runtime.callFunctionOn",{functionDeclaration:o+"\n"+s+"\n",executionContextId:this._contextId,arguments:i.map(function(e){if("bigint"==typeof e)return{unserializableValue:e.toString()+"n"};if(Object.is(e,-0))return{unserializableValue:"-0"};if(Object.is(e,1/0))return{unserializableValue:"Infinity"};if(Object.is(e,-1/0))return{unserializableValue:"-Infinity"};if(Object.is(e,NaN))return{unserializableValue:"NaN"};const t=e&&e instanceof K?e:null;if(t){if(t._context!==this)throw new Error("JSHandles can be evaluated only in the context they were created!");if(t._disposed)throw new Error("JSHandle is disposed!");return t._remoteObject.unserializableValue?{unserializableValue:t._remoteObject.unserializableValue}:t._remoteObject.objectId?{objectId:t._remoteObject.objectId}:{value:t._remoteObject.value}}return{value:e}}.bind(this)),returnByValue:e,awaitPromise:!0,userGesture:!0})}catch(e){throw e instanceof TypeError&&e.message.startsWith("Converting circular structure to JSON")&&(e.message+=" Are you passing a nested JSHandle?"),e}const{exceptionDetails:a,result:r}=await n.catch(c);if(a)throw new Error("Evaluation failed: "+k.getExceptionMessage(a));return e?k.valueFromRemoteObject(r):q(this,r);function c(e){if(e.message.includes("Object reference chain is too long"))return{result:{type:"undefined"}};if(e.message.includes("Object couldn't be returned by value"))return{result:{type:"undefined"}};if(e.message.endsWith("Cannot find context with specified id")||e.message.endsWith("Inspected target navigated or closed"))throw new Error("Execution context was destroyed, most likely because of a navigation.");throw e}}async queryObjects(t){e(!t._disposed,"Prototype JSHandle is disposed!"),e(t._remoteObject.objectId,"Prototype JSHandle must not be referencing primitive value");return q(this,(await this._client.send("Runtime.queryObjects",{prototypeObjectId:t._remoteObject.objectId})).objects)}async _adoptBackendNodeId(e){const{object:t}=await this._client.send("DOM.resolveNode",{backendNodeId:e,executionContextId:this._contextId});return q(this,t)}async _adoptElementHandle(t){e(t.executionContext()!==this,"Cannot adopt handle that already belongs to this execution context"),e(this._world,"Cannot adopt handle without DOMWorld");const i=await this._client.send("DOM.describeNode",{objectId:t._remoteObject.objectId});return this._adoptBackendNodeId(i.node.backendNodeId)}}class j{constructor(e){this._jsCoverage=new B(e),this._cssCoverage=new H(e)}async startJSCoverage(e={}){return await this._jsCoverage.start(e)}async stopJSCoverage(){return await this._jsCoverage.stop()}async startCSSCoverage(e={}){return await this._cssCoverage.start(e)}async stopCSSCoverage(){return await this._cssCoverage.stop()}}class B{constructor(e){this._enabled=!1,this._scriptURLs=new Map,this._scriptSources=new Map,this._eventListeners=[],this._resetOnNavigation=!1,this._reportAnonymousScripts=!1,this._client=e}async start(t={}){e(!this._enabled,"JSCoverage is already enabled");const{resetOnNavigation:i=!0,reportAnonymousScripts:s=!1}=t;this._resetOnNavigation=i,this._reportAnonymousScripts=s,this._enabled=!0,this._scriptURLs.clear(),this._scriptSources.clear(),this._eventListeners=[k.addEventListener(this._client,"Debugger.scriptParsed",this._onScriptParsed.bind(this)),k.addEventListener(this._client,"Runtime.executionContextsCleared",this._onExecutionContextsCleared.bind(this))],await Promise.all([this._client.send("Profiler.enable"),this._client.send("Profiler.startPreciseCoverage",{callCount:!1,detailed:!0}),this._client.send("Debugger.enable"),this._client.send("Debugger.setSkipAllPauses",{skip:!0})])}_onExecutionContextsCleared(){this._resetOnNavigation&&(this._scriptURLs.clear(),this._scriptSources.clear())}async _onScriptParsed(e){if("__puppeteer_evaluation_script__"!==e.url&&(e.url||this._reportAnonymousScripts))try{const t=await this._client.send("Debugger.getScriptSource",{scriptId:e.scriptId});this._scriptURLs.set(e.scriptId,e.url),this._scriptSources.set(e.scriptId,t.scriptSource)}catch(e){m(e)}}async stop(){e(this._enabled,"JSCoverage is not enabled"),this._enabled=!1;const t=await Promise.all([this._client.send("Profiler.takePreciseCoverage"),this._client.send("Profiler.stopPreciseCoverage"),this._client.send("Profiler.disable"),this._client.send("Debugger.disable")]);k.removeEventListeners(this._eventListeners);const i=[],s=t[0];for(const e of s.result){let t=this._scriptURLs.get(e.scriptId);!t&&this._reportAnonymousScripts&&(t="debugger://VM"+e.scriptId);const s=this._scriptSources.get(e.scriptId);if(void 0===s||void 0===t)continue;const n=[];for(const t of e.functions)n.push(...t.ranges);const o=$(n);i.push({url:t,ranges:o,text:s})}return i}}class H{constructor(e){this._enabled=!1,this._stylesheetURLs=new Map,this._stylesheetSources=new Map,this._eventListeners=[],this._resetOnNavigation=!1,this._reportAnonymousScripts=!1,this._client=e}async start(t={}){e(!this._enabled,"CSSCoverage is already enabled");const{resetOnNavigation:i=!0}=t;this._resetOnNavigation=i,this._enabled=!0,this._stylesheetURLs.clear(),this._stylesheetSources.clear(),this._eventListeners=[k.addEventListener(this._client,"CSS.styleSheetAdded",this._onStyleSheet.bind(this)),k.addEventListener(this._client,"Runtime.executionContextsCleared",this._onExecutionContextsCleared.bind(this))],await Promise.all([this._client.send("DOM.enable"),this._client.send("CSS.enable"),this._client.send("CSS.startRuleUsageTracking")])}_onExecutionContextsCleared(){this._resetOnNavigation&&(this._stylesheetURLs.clear(),this._stylesheetSources.clear())}async _onStyleSheet(e){const t=e.header;if(t.sourceURL)try{const e=await this._client.send("CSS.getStyleSheetText",{styleSheetId:t.styleSheetId});this._stylesheetURLs.set(t.styleSheetId,t.sourceURL),this._stylesheetSources.set(t.styleSheetId,e.text)}catch(e){m(e)}}async stop(){e(this._enabled,"CSSCoverage is not enabled"),this._enabled=!1;const t=await this._client.send("CSS.stopRuleUsageTracking");await Promise.all([this._client.send("CSS.disable"),this._client.send("DOM.disable")]),k.removeEventListeners(this._eventListeners);const i=new Map;for(const e of t.ruleUsage){let t=i.get(e.styleSheetId);t||(t=[],i.set(e.styleSheetId,t)),t.push({startOffset:e.startOffset,endOffset:e.endOffset,count:e.used?1:0})}const s=[];for(const e of this._stylesheetURLs.keys()){const t=this._stylesheetURLs.get(e),n=this._stylesheetSources.get(e),o=$(i.get(e)||[]);s.push({url:t,ranges:o,text:n})}return s}}function $(e){const t=[];for(const i of e)t.push({offset:i.startOffset,type:0,range:i}),t.push({offset:i.endOffset,type:1,range:i});t.sort((e,t)=>{if(e.offset!==t.offset)return e.offset-t.offset;if(e.type!==t.type)return t.type-e.type;const i=e.range.endOffset-e.range.startOffset,s=t.range.endOffset-t.range.startOffset;return 0===e.type?s-i:i-s});const i=[],s=[];let n=0;for(const e of t){if(i.length&&n<e.offset&&i[i.length-1]>0){const t=s.length?s[s.length-1]:null;t&&t.end===n?t.end=e.offset:s.push({start:n,end:e.offset})}n=e.offset,0===e.type?i.push(e.range.count):i.pop()}return s.filter(e=>e.end-e.start>1)}class W{constructor(e,t,i,s=""){this._handled=!1,this._client=e,this._type=t,this._message=i,this._defaultValue=s}type(){return this._type}message(){return this._message}defaultValue(){return this._defaultValue}async accept(t){e(!this._handled,"Cannot accept dialog which is already handled!"),this._handled=!0,await this._client.send("Page.handleJavaScriptDialog",{accept:!0,promptText:t})}async dismiss(){e(!this._handled,"Cannot dismiss dialog which is already handled!"),this._handled=!0,await this._client.send("Page.handleJavaScriptDialog",{accept:!1})}}class U{constructor(e){this._emulatingMobile=!1,this._hasTouch=!1,this._client=e}async emulateViewport(e){const t=e.isMobile||!1,i=e.width,s=e.height,n=e.deviceScaleFactor||1,o=e.isLandscape?{angle:90,type:"landscapePrimary"}:{angle:0,type:"portraitPrimary"},a=e.hasTouch||!1;await Promise.all([this._client.send("Emulation.setDeviceMetricsOverride",{mobile:t,width:i,height:s,deviceScaleFactor:n,screenOrientation:o}),this._client.send("Emulation.setTouchEmulationEnabled",{enabled:a})]);const r=this._emulatingMobile!==t||this._hasTouch!==a;return this._emulatingMobile=t,this._hasTouch=a,r}}class V{constructor(e,t){this._handled=!1,this._element=e,this._multiple="selectSingle"!==t.mode}isMultiple(){return this._multiple}async accept(t){e(!this._handled,"Cannot accept FileChooser which is already handled!"),this._handled=!0,await this._element.uploadFile(...t)}async cancel(){e(!this._handled,"Cannot cancel FileChooser which is already handled!"),this._handled=!0}}class z{constructor(e,t,i,s,n,o){this._failureText=null,this._response=null,this._fromMemoryCache=!1,this._interceptionHandled=!1,this._headers={},this._client=e,this._requestId=n.requestId,this._isNavigationRequest=n.requestId===n.loaderId&&"Document"===n.type,this._interceptionId=i,this._allowInterception=s,this._url=n.request.url,this._resourceType=n.type.toLowerCase(),this._method=n.request.method,this._postData=n.request.postData,this._frame=t,this._redirectChain=o;for(const e of Object.keys(n.request.headers))this._headers[e.toLowerCase()]=n.request.headers[e]}url(){return this._url}resourceType(){return this._resourceType}method(){return this._method}postData(){return this._postData}headers(){return this._headers}response(){return this._response}frame(){return this._frame}isNavigationRequest(){return this._isNavigationRequest}redirectChain(){return this._redirectChain.slice()}failure(){return this._failureText?{errorText:this._failureText}:null}async continue(t={}){if(this._url.startsWith("data:"))return;e(this._allowInterception,"Request Interception is not enabled!"),e(!this._interceptionHandled,"Request is already handled!");const{url:i,method:s,postData:n,headers:o}=t;this._interceptionHandled=!0;const a=n?Buffer.from(n).toString("base64"):void 0;await this._client.send("Fetch.continueRequest",{requestId:this._interceptionId,url:i,method:s,postData:a,headers:o?Q(o):void 0}).catch(e=>{m(e)})}async respond(t){if(this._url.startsWith("data:"))return;e(this._allowInterception,"Request Interception is not enabled!"),e(!this._interceptionHandled,"Request is already handled!"),this._interceptionHandled=!0;const i=t.body&&k.isString(t.body)?Buffer.from(t.body):t.body||null,s={};if(t.headers)for(const e of Object.keys(t.headers))s[e.toLowerCase()]=t.headers[e];t.contentType&&(s["content-type"]=t.contentType),i&&!("content-length"in s)&&(s["content-length"]=String(Buffer.byteLength(i))),await this._client.send("Fetch.fulfillRequest",{requestId:this._interceptionId,responseCode:t.status||200,responsePhrase:X[t.status||200],responseHeaders:Q(s),body:i?i.toString("base64"):void 0}).catch(e=>{m(e)})}async abort(t="failed"){if(this._url.startsWith("data:"))return;const i=J[t];e(i,"Unknown error code: "+t),e(this._allowInterception,"Request Interception is not enabled!"),e(!this._interceptionHandled,"Request is already handled!"),this._interceptionHandled=!0,await this._client.send("Fetch.failRequest",{requestId:this._interceptionId,errorReason:i}).catch(e=>{m(e)})}}const J={aborted:"Aborted",accessdenied:"AccessDenied",addressunreachable:"AddressUnreachable",blockedbyclient:"BlockedByClient",blockedbyresponse:"BlockedByResponse",connectionaborted:"ConnectionAborted",connectionclosed:"ConnectionClosed",connectionfailed:"ConnectionFailed",connectionrefused:"ConnectionRefused",connectionreset:"ConnectionReset",internetdisconnected:"InternetDisconnected",namenotresolved:"NameNotResolved",timedout:"TimedOut",failed:"Failed"};function Q(e){const t=[];for(const i in e)Object.is(e[i],void 0)||t.push({name:i,value:e[i]+""});return t}const X={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};class G{constructor(e){this._subjectName=e.subjectName,this._issuer=e.issuer,this._validFrom=e.validFrom,this._validTo=e.validTo,this._protocol=e.protocol,this._sanList=e.sanList}issuer(){return this._issuer}validFrom(){return this._validFrom}validTo(){return this._validTo}protocol(){return this._protocol}subjectName(){return this._subjectName}subjectAlternativeNames(){return this._sanList}}class Y{constructor(e,t,i){this._contentPromise=null,this._headers={},this._client=e,this._request=t,this._bodyLoadedPromise=new Promise(e=>{this._bodyLoadedPromiseFulfill=e}),this._remoteAddress={ip:i.remoteIPAddress,port:i.remotePort},this._status=i.status,this._statusText=i.statusText,this._url=t.url(),this._fromDiskCache=!!i.fromDiskCache,this._fromServiceWorker=!!i.fromServiceWorker;for(const e of Object.keys(i.headers))this._headers[e.toLowerCase()]=i.headers[e];this._securityDetails=i.securityDetails?new G(i.securityDetails):null}_resolveBody(e){return this._bodyLoadedPromiseFulfill(e)}remoteAddress(){return this._remoteAddress}url(){return this._url}ok(){return 0===this._status||this._status>=200&&this._status<=299}status(){return this._status}statusText(){return this._statusText}headers(){return this._headers}securityDetails(){return this._securityDetails}buffer(){return this._contentPromise||(this._contentPromise=this._bodyLoadedPromise.then(async e=>{if(e)throw e;const t=await this._client.send("Network.getResponseBody",{requestId:this._request._requestId});return Buffer.from(t.body,t.base64Encoded?"base64":"utf8")})),this._contentPromise}async text(){return(await this.buffer()).toString("utf8")}async json(){const e=await this.text();return JSON.parse(e)}request(){return this._request}fromCache(){return this._fromDiskCache||this._request._fromMemoryCache}fromServiceWorker(){return this._fromServiceWorker}frame(){return this._request.frame()}}const Z={Request:Symbol("NetworkManager.Request"),Response:Symbol("NetworkManager.Response"),RequestFailed:Symbol("NetworkManager.RequestFailed"),RequestFinished:Symbol("NetworkManager.RequestFinished")};class ee extends s{constructor(e,t,i){super(),this._requestIdToRequest=new Map,this._requestIdToRequestWillBeSentEvent=new Map,this._extraHTTPHeaders={},this._offline=!1,this._credentials=null,this._attemptedAuthentications=new Set,this._userRequestInterceptionEnabled=!1,this._protocolRequestInterceptionEnabled=!1,this._userCacheDisabled=!1,this._requestIdToInterceptionId=new Map,this._client=e,this._ignoreHTTPSErrors=t,this._frameManager=i,this._client.on("Fetch.requestPaused",this._onRequestPaused.bind(this)),this._client.on("Fetch.authRequired",this._onAuthRequired.bind(this)),this._client.on("Network.requestWillBeSent",this._onRequestWillBeSent.bind(this)),this._client.on("Network.requestServedFromCache",this._onRequestServedFromCache.bind(this)),this._client.on("Network.responseReceived",this._onResponseReceived.bind(this)),this._client.on("Network.loadingFinished",this._onLoadingFinished.bind(this)),this._client.on("Network.loadingFailed",this._onLoadingFailed.bind(this))}async initialize(){await this._client.send("Network.enable"),this._ignoreHTTPSErrors&&await this._client.send("Security.setIgnoreCertificateErrors",{ignore:!0})}async authenticate(e){this._credentials=e,await this._updateProtocolRequestInterception()}async setExtraHTTPHeaders(t){this._extraHTTPHeaders={};for(const i of Object.keys(t)){const s=t[i];e(k.isString(s),`Expected value of header "${i}" to be String, but "${typeof s}" is found.`),this._extraHTTPHeaders[i.toLowerCase()]=s}await this._client.send("Network.setExtraHTTPHeaders",{headers:this._extraHTTPHeaders})}extraHTTPHeaders(){return Object.assign({},this._extraHTTPHeaders)}async setOfflineMode(e){this._offline!==e&&(this._offline=e,await this._client.send("Network.emulateNetworkConditions",{offline:this._offline,latency:0,downloadThroughput:-1,uploadThroughput:-1}))}async setUserAgent(e){await this._client.send("Network.setUserAgentOverride",{userAgent:e})}async setCacheEnabled(e){this._userCacheDisabled=!e,await this._updateProtocolCacheDisabled()}async setRequestInterception(e){this._userRequestInterceptionEnabled=e,await this._updateProtocolRequestInterception()}async _updateProtocolRequestInterception(){const e=this._userRequestInterceptionEnabled||!!this._credentials;e!==this._protocolRequestInterceptionEnabled&&(this._protocolRequestInterceptionEnabled=e,e?await Promise.all([this._updateProtocolCacheDisabled(),this._client.send("Fetch.enable",{handleAuthRequests:!0,patterns:[{urlPattern:"*"}]})]):await Promise.all([this._updateProtocolCacheDisabled(),this._client.send("Fetch.disable")]))}async _updateProtocolCacheDisabled(){await this._client.send("Network.setCacheDisabled",{cacheDisabled:this._userCacheDisabled||this._protocolRequestInterceptionEnabled})}_onRequestWillBeSent(e){if(!this._protocolRequestInterceptionEnabled||e.request.url.startsWith("data:"))this._onRequest(e,null);else{const t=e.requestId,i=this._requestIdToInterceptionId.get(t);i?(this._onRequest(e,i),this._requestIdToInterceptionId.delete(t)):this._requestIdToRequestWillBeSentEvent.set(e.requestId,e)}}_onAuthRequired(e){let t="Default";this._attemptedAuthentications.has(e.requestId)?t="CancelAuth":this._credentials&&(t="ProvideCredentials",this._attemptedAuthentications.add(e.requestId));const{username:i,password:s}=this._credentials||{username:void 0,password:void 0};this._client.send("Fetch.continueWithAuth",{requestId:e.requestId,authChallengeResponse:{response:t,username:i,password:s}}).catch(m)}_onRequestPaused(e){!this._userRequestInterceptionEnabled&&this._protocolRequestInterceptionEnabled&&this._client.send("Fetch.continueRequest",{requestId:e.requestId}).catch(m);const t=e.networkId,i=e.requestId;if(t&&this._requestIdToRequestWillBeSentEvent.has(t)){const e=this._requestIdToRequestWillBeSentEvent.get(t);this._onRequest(e,i),this._requestIdToRequestWillBeSentEvent.delete(t)}else this._requestIdToInterceptionId.set(t,i)}_onRequest(e,t){let i=[];if(e.redirectResponse){const t=this._requestIdToRequest.get(e.requestId);t&&(this._handleRequestRedirect(t,e.redirectResponse),i=t._redirectChain)}const s=e.frameId?this._frameManager.frame(e.frameId):null,n=new z(this._client,s,t,this._userRequestInterceptionEnabled,e,i);this._requestIdToRequest.set(e.requestId,n),this.emit(Z.Request,n)}_onRequestServedFromCache(e){const t=this._requestIdToRequest.get(e.requestId);t&&(t._fromMemoryCache=!0)}_handleRequestRedirect(e,t){const i=new Y(this._client,e,t);e._response=i,e._redirectChain.push(e),i._resolveBody(new Error("Response body is unavailable for redirect responses")),this._requestIdToRequest.delete(e._requestId),this._attemptedAuthentications.delete(e._interceptionId),this.emit(Z.Response,i),this.emit(Z.RequestFinished,e)}_onResponseReceived(e){const t=this._requestIdToRequest.get(e.requestId);if(!t)return;const i=new Y(this._client,t,e.response);t._response=i,this.emit(Z.Response,i)}_onLoadingFinished(e){const t=this._requestIdToRequest.get(e.requestId);t&&(t.response()&&t.response()._resolveBody(null),this._requestIdToRequest.delete(t._requestId),this._attemptedAuthentications.delete(t._interceptionId),this.emit(Z.RequestFinished,t))}_onLoadingFailed(e){const t=this._requestIdToRequest.get(e.requestId);if(!t)return;t._failureText=e.errorText;const i=t.response();i&&i._resolveBody(null),this._requestIdToRequest.delete(t._requestId),this._attemptedAuthentications.delete(t._interceptionId),this.emit(Z.RequestFailed,t)}}const te=new Map([["load","load"],["domcontentloaded","DOMContentLoaded"],["networkidle0","networkIdle"],["networkidle2","networkAlmostIdle"]]);class ie{constructor(t,i,s,n){Array.isArray(s)?s=s.slice():"string"==typeof s&&(s=[s]),this._expectedLifecycle=s.map(t=>{const i=te.get(t);return e(i,"Unknown value for options.waitUntil: "+t),i}),this._frameManager=t,this._frame=i,this._initialLoaderId=i._loaderId,this._timeout=n,this._navigationRequest=null,this._eventListeners=[k.addEventListener(t._client,c.Disconnected,()=>this._terminate(new Error("Navigation failed because browser has disconnected!"))),k.addEventListener(this._frameManager,ae.LifecycleEvent,this._checkLifecycleComplete.bind(this)),k.addEventListener(this._frameManager,ae.FrameNavigatedWithinDocument,this._navigatedWithinDocument.bind(this)),k.addEventListener(this._frameManager,ae.FrameDetached,this._onFrameDetached.bind(this)),k.addEventListener(this._frameManager.networkManager(),Z.Request,this._onRequest.bind(this))],this._sameDocumentNavigationPromise=new Promise(e=>{this._sameDocumentNavigationCompleteCallback=e}),this._lifecyclePromise=new Promise(e=>{this._lifecycleCallback=e}),this._newDocumentNavigationPromise=new Promise(e=>{this._newDocumentNavigationCompleteCallback=e}),this._timeoutPromise=this._createTimeoutPromise(),this._terminationPromise=new Promise(e=>{this._terminationCallback=e}),this._checkLifecycleComplete()}_onRequest(e){e.frame()===this._frame&&e.isNavigationRequest()&&(this._navigationRequest=e)}_onFrameDetached(e){this._frame!==e?this._checkLifecycleComplete():this._terminationCallback.call(null,new Error("Navigating frame was detached"))}navigationResponse(){return this._navigationRequest?this._navigationRequest.response():null}_terminate(e){this._terminationCallback.call(null,e)}sameDocumentNavigationPromise(){return this._sameDocumentNavigationPromise}newDocumentNavigationPromise(){return this._newDocumentNavigationPromise}lifecyclePromise(){return this._lifecyclePromise}timeoutOrTerminationPromise(){return Promise.race([this._timeoutPromise,this._terminationPromise])}_createTimeoutPromise(){if(!this._timeout)return new Promise(()=>{});const e="Navigation timeout of "+this._timeout+" ms exceeded";return new Promise(e=>this._maximumTimer=setTimeout(e,this._timeout)).then(()=>new y(e))}_navigatedWithinDocument(e){e===this._frame&&(this._hasSameDocumentNavigation=!0,this._checkLifecycleComplete())}_checkLifecycleComplete(){(function e(t,i){for(const e of i)if(!t._lifecycleEvents.has(e))return!1;for(const s of t.childFrames())if(!e(s,i))return!1;return!0})(this._frame,this._expectedLifecycle)&&(this._lifecycleCallback(),(this._frame._loaderId!==this._initialLoaderId||this._hasSameDocumentNavigation)&&(this._hasSameDocumentNavigation&&this._sameDocumentNavigationCompleteCallback(),this._frame._loaderId!==this._initialLoaderId&&this._newDocumentNavigationCompleteCallback()))}dispose(){k.removeEventListeners(this._eventListeners),clearTimeout(this._maximumTimer)}}class se{constructor(e,t,i){this._documentPromise=null,this._contextPromise=null,this._contextResolveCallback=null,this._detached=!1,this._waitTasks=new Set,this._boundFunctions=new Map,this._ctxBindings=new Set,this._settingUpBinding=null,this._frameManager=e,this._frame=t,this._timeoutSettings=i,this._setContext(null),e._client.on("Runtime.bindingCalled",e=>this._onBindingCalled(e))}frame(){return this._frame}async _setContext(e){if(e){this._contextResolveCallback.call(null,e),this._contextResolveCallback=null,this._ctxBindings.clear();for(const e of this._boundFunctions.keys())await this.addBindingToContext(e);for(const e of this._waitTasks)e.rerun()}else this._documentPromise=null,this._contextPromise=new Promise(e=>{this._contextResolveCallback=e})}_hasContext(){return!this._contextResolveCallback}_detach(){this._detached=!0;for(const e of this._waitTasks)e.terminate(new Error("waitForFunction failed: frame got detached."))}executionContext(){if(this._detached)throw new Error(`Execution context is not available in detached frame "${this._frame.url()}" (are you trying to evaluate?)`);return this._contextPromise}async evaluateHandle(e,...t){return(await this.executionContext()).evaluateHandle(e,...t)}async evaluate(e,...t){return(await this.executionContext()).evaluate(e,...t)}async $(e){const t=await this._document();return await t.$(e)}async _document(){return this._documentPromise||(this._documentPromise=this.executionContext().then(async e=>(await e.evaluateHandle("document")).asElement())),this._documentPromise}async $x(e){const t=await this._document();return await t.$x(e)}async $eval(e,t,...i){return(await this._document()).$eval(e,t,...i)}async $$eval(e,t,...i){const s=await this._document();return await s.$$eval(e,t,...i)}async $$(e){const t=await this._document();return await t.$$(e)}async content(){return await this.evaluate(()=>{let e="";return document.doctype&&(e=(new XMLSerializer).serializeToString(document.doctype)),document.documentElement&&(e+=document.documentElement.outerHTML),e})}async setContent(e,t={}){const{waitUntil:i=["load"],timeout:s=this._timeoutSettings.navigationTimeout()}=t;await this.evaluate(e=>{document.open(),document.write(e),document.close()},e);const n=new ie(this._frameManager,this._frame,i,s),o=await Promise.race([n.timeoutOrTerminationPromise(),n.lifecyclePromise()]);if(n.dispose(),o)throw o}async addScriptTag(e){const{url:i=null,path:s=null,content:n=null,type:o=""}=e;if(null!==i)try{const e=await this.executionContext();return(await e.evaluateHandle((async function(e,t){const i=document.createElement("script");i.src=e,t&&(i.type=t);const s=new Promise((e,t)=>{i.onload=e,i.onerror=t});return document.head.appendChild(i),await s,i}),i,o)).asElement()}catch(e){throw new Error(`Loading script from ${i} failed`)}if(null!==s){if(!t)throw new Error("Cannot pass a filepath to addScriptTag in the browser environment.");const e=await k.importFSModule();let i=await e.promises.readFile(s,"utf8");i+="//# sourceURL="+s.replace(/\n/g,"");const n=await this.executionContext();return(await n.evaluateHandle(a,i,o)).asElement()}if(null!==n){const e=await this.executionContext();return(await e.evaluateHandle(a,n,o)).asElement()}throw new Error("Provide an object with a `url`, `path` or `content` property");function a(e,t="text/javascript"){const i=document.createElement("script");i.type=t,i.text=e;let s=null;if(i.onerror=e=>s=e,document.head.appendChild(i),s)throw s;return i}}async addStyleTag(e){const{url:i=null,path:s=null,content:n=null}=e;if(null!==i)try{const e=await this.executionContext();return(await e.evaluateHandle((async function(e){const t=document.createElement("link");t.rel="stylesheet",t.href=e;const i=new Promise((e,i)=>{t.onload=e,t.onerror=i});return document.head.appendChild(t),await i,t}),i)).asElement()}catch(e){throw new Error(`Loading style from ${i} failed`)}if(null!==s){if(!t)throw new Error("Cannot pass a filepath to addStyleTag in the browser environment.");const e=await k.importFSModule();let i=await e.promises.readFile(s,"utf8");i+="/*# sourceURL="+s.replace(/\n/g,"")+"*/";const n=await this.executionContext();return(await n.evaluateHandle(o,i)).asElement()}if(null!==n){const e=await this.executionContext();return(await e.evaluateHandle(o,n)).asElement()}throw new Error("Provide an object with a `url`, `path` or `content` property");async function o(e){const t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e));const i=new Promise((e,i)=>{t.onload=e,t.onerror=i});return document.head.appendChild(t),await i,t}}async click(t,i){const s=await this.$(t);e(s,"No node found for selector: "+t),await s.click(i),await s.dispose()}async focus(t){const i=await this.$(t);e(i,"No node found for selector: "+t),await i.focus(),await i.dispose()}async hover(t){const i=await this.$(t);e(i,"No node found for selector: "+t),await i.hover(),await i.dispose()}async select(t,...i){const s=await this.$(t);e(s,"No node found for selector: "+t);const n=await s.select(...i);return await s.dispose(),n}async tap(e){const t=await this.$(e);await t.tap(),await t.dispose()}async type(t,i,s){const n=await this.$(t);e(n,"No node found for selector: "+t),await n.type(i,s),await n.dispose()}async waitForSelector(e,t){const{updatedSelector:i,queryHandler:s}=D(e);return s.waitFor(this,i,t)}async addBindingToContext(e){if(this._ctxBindings.has(e))return;if(this._settingUpBinding)return await this._settingUpBinding,this.addBindingToContext(e);const t=async e=>{const i=k.pageBindingInitString("internal",e);try{const t=await this.executionContext();await t._client.send("Runtime.addBinding",{name:e,executionContextId:t._contextId}),await t.evaluate(i)}catch(i){const s=i.message.includes("Execution context was destroyed"),n=i.message.includes("Cannot find context with specified id");if(!s&&!n)return void m(i);await t(e)}this._ctxBindings.add(e)};this._settingUpBinding=t(e),await this._settingUpBinding,this._settingUpBinding=null}async addBinding(e,t){this._boundFunctions.set(e,t),await this.addBindingToContext(e)}async _onBindingCalled(e){let t;try{t=JSON.parse(e.payload)}catch{return}const{type:i,name:s,seq:n,args:o}=t;if("internal"!==i||!this._ctxBindings.has(s))return;if(!this._hasContext())return;const a=await this.executionContext();if(a._contextId===e.executionContextId)try{const e=await this._boundFunctions.get(s)(...o);await a.evaluate((function(e,t,i){globalThis[e].callbacks.get(t).resolve(i),globalThis[e].callbacks.delete(t)}),s,n,e)}catch(e){if(e.message.includes("Protocol error"))return;m(e)}}async waitForSelectorInPage(e,t,i){const{visible:s=!1,hidden:n=!1,timeout:o=this._timeoutSettings.timeout()}=i,a=s||n?"raf":"mutation",r=`selector \`${t}\`${n?" to be hidden":""}`;const c=new ne(this,k.makePredicateString((async function(e,t,i){const s=predicateQueryHandler?await predicateQueryHandler(document,e):document.querySelector(e);return checkWaitForOptions(s,t,i)}),e),r,a,o,t,s,n),d=await c.promise,l=d.asElement();return l||(await d.dispose(),null)}async waitForXPath(e,t){const{visible:i=!1,hidden:s=!1,timeout:n=this._timeoutSettings.timeout()}=t,o=i||s?"raf":"mutation",a=`XPath \`${e}\`${s?" to be hidden":""}`;const r=new ne(this,k.makePredicateString((function(e,t,i){const s=document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return checkWaitForOptions(s,t,i)})),a,o,n,e,i,s),c=await r.promise,d=c.asElement();return d||(await c.dispose(),null)}waitForFunction(e,t={},...i){const{polling:s="raf",timeout:n=this._timeoutSettings.timeout()}=t;return new ne(this,e,"function",s,n,...i).promise}async title(){return this.evaluate(()=>document.title)}}class ne{constructor(t,i,s,n,o,...a){if(this._runCount=0,this._terminated=!1,k.isString(n))e("raf"===n||"mutation"===n,"Unknown polling option: "+n);else{if(!k.isNumber(n))throw new Error("Unknown polling options: "+n);e(n>0,"Cannot poll with non-positive interval: "+n)}if(this._domWorld=t,this._polling=n,this._timeout=o,this._predicateBody=function(e){return k.isString(e)?`return (${e});`:`return (${e})(...args);`}(i),this._args=a,this._runCount=0,t._waitTasks.add(this),this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),o){const e=new y(`waiting for ${s} failed: timeout ${o}ms exceeded`);this._timeoutTimer=setTimeout(()=>this.terminate(e),o)}this.rerun()}terminate(e){this._terminated=!0,this._reject(e),this._cleanup()}async rerun(){const e=++this._runCount;let t=null,i=null;try{t=await(await this._domWorld.executionContext()).evaluateHandle(oe,this._predicateBody,this._polling,this._timeout,...this._args)}catch(e){i=e}if(this._terminated||e!==this._runCount)t&&await t.dispose();else if(i||!await this._domWorld.evaluate(e=>!e,t).catch(()=>!0)){if(i){if(i.message.includes("Execution context is not available in detached frame"))return void this.terminate(new Error("waitForFunction failed: frame got detached."));if(i.message.includes("Execution context was destroyed"))return;if(i.message.includes("Cannot find context with specified id"))return;this._reject(i)}else this._resolve(t);this._cleanup()}else await t.dispose()}_cleanup(){clearTimeout(this._timeoutTimer),this._domWorld._waitTasks.delete(this)}}async function oe(e,t,i,...s){const n=new Function("...args",e);let o=!1;if(i&&setTimeout(()=>o=!0,i),"raf"===t)return await async function(){let e;const t=new Promise(t=>e=t);return await async function t(){if(o)return void e();const i=await n(...s);i?e(i):requestAnimationFrame(t)}(),t}();if("mutation"===t)return await async function(){const e=await n(...s);if(e)return Promise.resolve(e);let t;const i=new Promise(e=>t=e),a=new MutationObserver(async()=>{o&&(a.disconnect(),t());const e=await n(...s);e&&(a.disconnect(),t(e))});return a.observe(document,{childList:!0,subtree:!0,attributes:!0}),i}();if("number"==typeof t)return await async function(e){let t;const i=new Promise(e=>t=e);return await a(),i;async function a(){if(o)return void t();const i=await n(...s);i?t(i):setTimeout(a,e)}}(t)}const ae={FrameAttached:Symbol("FrameManager.FrameAttached"),FrameNavigated:Symbol("FrameManager.FrameNavigated"),FrameDetached:Symbol("FrameManager.FrameDetached"),LifecycleEvent:Symbol("FrameManager.LifecycleEvent"),FrameNavigatedWithinDocument:Symbol("FrameManager.FrameNavigatedWithinDocument"),ExecutionContextCreated:Symbol("FrameManager.ExecutionContextCreated"),ExecutionContextDestroyed:Symbol("FrameManager.ExecutionContextDestroyed")};class re extends s{constructor(e,t,i,s){super(),this._frames=new Map,this._contextIdToContext=new Map,this._isolatedWorlds=new Set,this._client=e,this._page=t,this._networkManager=new ee(e,i,this),this._timeoutSettings=s,this._client.on("Page.frameAttached",e=>this._onFrameAttached(e.frameId,e.parentFrameId)),this._client.on("Page.frameNavigated",e=>this._onFrameNavigated(e.frame)),this._client.on("Page.navigatedWithinDocument",e=>this._onFrameNavigatedWithinDocument(e.frameId,e.url)),this._client.on("Page.frameDetached",e=>this._onFrameDetached(e.frameId)),this._client.on("Page.frameStoppedLoading",e=>this._onFrameStoppedLoading(e.frameId)),this._client.on("Runtime.executionContextCreated",e=>this._onExecutionContextCreated(e.context)),this._client.on("Runtime.executionContextDestroyed",e=>this._onExecutionContextDestroyed(e.executionContextId)),this._client.on("Runtime.executionContextsCleared",()=>this._onExecutionContextsCleared()),this._client.on("Page.lifecycleEvent",e=>this._onLifecycleEvent(e)),this._client.on("Target.attachedToTarget",async e=>this._onFrameMoved(e))}async initialize(){const e=await Promise.all([this._client.send("Page.enable"),this._client.send("Page.getFrameTree")]),{frameTree:t}=e[1];this._handleFrameTree(t),await Promise.all([this._client.send("Page.setLifecycleEventsEnabled",{enabled:!0}),this._client.send("Runtime.enable").then(()=>this._ensureIsolatedWorld("__puppeteer_utility_world__")),this._networkManager.initialize()])}networkManager(){return this._networkManager}async navigateFrame(e,t,i={}){de(i);const{referer:s=this._networkManager.extraHTTPHeaders().referer,waitUntil:n=["load"],timeout:o=this._timeoutSettings.navigationTimeout()}=i,a=new ie(this,e,n,o);let r=!1,c=await Promise.race([async function(e,t,i,s){try{const n=await e.send("Page.navigate",{url:t,referrer:i,frameId:s});return r=!!n.loaderId,n.errorText?new Error(`${n.errorText} at ${t}`):null}catch(e){return e}}(this._client,t,s,e._id),a.timeoutOrTerminationPromise()]);if(c||(c=await Promise.race([a.timeoutOrTerminationPromise(),r?a.newDocumentNavigationPromise():a.sameDocumentNavigationPromise()])),a.dispose(),c)throw c;return a.navigationResponse()}async waitForFrameNavigation(e,t={}){de(t);const{waitUntil:i=["load"],timeout:s=this._timeoutSettings.navigationTimeout()}=t,n=new ie(this,e,i,s),o=await Promise.race([n.timeoutOrTerminationPromise(),n.sameDocumentNavigationPromise(),n.newDocumentNavigationPromise()]);if(n.dispose(),o)throw o;return n.navigationResponse()}async _onFrameMoved(e){"iframe"===e.targetInfo.type&&i("puppeteer:frame")(`The frame '${e.targetInfo.targetId}' moved to another session. Out-of-process iframes (OOPIF) are not supported by Puppeteer yet. https://github.com/puppeteer/puppeteer/issues/2548`)}_onLifecycleEvent(e){const t=this._frames.get(e.frameId);t&&(t._onLifecycleEvent(e.loaderId,e.name),this.emit(ae.LifecycleEvent,t))}_onFrameStoppedLoading(e){const t=this._frames.get(e);t&&(t._onLoadingStopped(),this.emit(ae.LifecycleEvent,t))}_handleFrameTree(e){if(e.frame.parentId&&this._onFrameAttached(e.frame.id,e.frame.parentId),this._onFrameNavigated(e.frame),e.childFrames)for(const t of e.childFrames)this._handleFrameTree(t)}page(){return this._page}mainFrame(){return this._mainFrame}frames(){return Array.from(this._frames.values())}frame(e){return this._frames.get(e)||null}_onFrameAttached(t,i){if(this._frames.has(t))return;e(i);const s=this._frames.get(i),n=new ce(this,s,t);this._frames.set(n._id,n),this.emit(ae.FrameAttached,n)}_onFrameNavigated(t){const i=!t.parentId;let s=i?this._mainFrame:this._frames.get(t.id);if(e(i||s,"We either navigate top level or have old version of the navigated frame"),s)for(const e of s.childFrames())this._removeFramesRecursively(e);i&&(s?(this._frames.delete(s._id),s._id=t.id):s=new ce(this,null,t.id),this._frames.set(t.id,s),this._mainFrame=s),s._navigated(t),this.emit(ae.FrameNavigated,s)}async _ensureIsolatedWorld(e){this._isolatedWorlds.has(e)||(this._isolatedWorlds.add(e),await this._client.send("Page.addScriptToEvaluateOnNewDocument",{source:"//# sourceURL=__puppeteer_evaluation_script__",worldName:e}),await Promise.all(this.frames().map(t=>this._client.send("Page.createIsolatedWorld",{frameId:t._id,grantUniveralAccess:!0,worldName:e}).catch(m))))}_onFrameNavigatedWithinDocument(e,t){const i=this._frames.get(e);i&&(i._navigatedWithinDocument(t),this.emit(ae.FrameNavigatedWithinDocument,i),this.emit(ae.FrameNavigated,i))}_onFrameDetached(e){const t=this._frames.get(e);t&&this._removeFramesRecursively(t)}_onExecutionContextCreated(e){const t=e.auxData,i=t?t.frameId:null,s=this._frames.get(i)||null;let n=null;s&&(e.auxData&&e.auxData.isDefault?n=s._mainWorld:"__puppeteer_utility_world__"!==e.name||s._secondaryWorld._hasContext()||(n=s._secondaryWorld)),e.auxData&&"isolated"===e.auxData.type&&this._isolatedWorlds.add(e.name);const o=new A(this._client,e,n);n&&n._setContext(o),this._contextIdToContext.set(e.id,o)}_onExecutionContextDestroyed(e){const t=this._contextIdToContext.get(e);t&&(this._contextIdToContext.delete(e),t._world&&t._world._setContext(null))}_onExecutionContextsCleared(){for(const e of this._contextIdToContext.values())e._world&&e._world._setContext(null);this._contextIdToContext.clear()}executionContextById(t){const i=this._contextIdToContext.get(t);return e(i,"INTERNAL ERROR: missing context with id = "+t),i}_removeFramesRecursively(e){for(const t of e.childFrames())this._removeFramesRecursively(t);e._detach(),this._frames.delete(e._id),this.emit(ae.FrameDetached,e)}}class ce{constructor(e,t,i){this._url="",this._detached=!1,this._loaderId="",this._lifecycleEvents=new Set,this._frameManager=e,this._parentFrame=t,this._url="",this._id=i,this._detached=!1,this._loaderId="",this._mainWorld=new se(e,this,e._timeoutSettings),this._secondaryWorld=new se(e,this,e._timeoutSettings),this._childFrames=new Set,this._parentFrame&&this._parentFrame._childFrames.add(this)}async goto(e,t={}){return await this._frameManager.navigateFrame(this,e,t)}async waitForNavigation(e={}){return await this._frameManager.waitForFrameNavigation(this,e)}executionContext(){return this._mainWorld.executionContext()}async evaluateHandle(e,...t){return this._mainWorld.evaluateHandle(e,...t)}async evaluate(e,...t){return this._mainWorld.evaluate(e,...t)}async $(e){return this._mainWorld.$(e)}async $x(e){return this._mainWorld.$x(e)}async $eval(e,t,...i){return this._mainWorld.$eval(e,t,...i)}async $$eval(e,t,...i){return this._mainWorld.$$eval(e,t,...i)}async $$(e){return this._mainWorld.$$(e)}async content(){return this._secondaryWorld.content()}async setContent(e,t={}){return this._secondaryWorld.setContent(e,t)}name(){return this._name||""}url(){return this._url}parentFrame(){return this._parentFrame}childFrames(){return Array.from(this._childFrames)}isDetached(){return this._detached}async addScriptTag(e){return this._mainWorld.addScriptTag(e)}async addStyleTag(e){return this._mainWorld.addStyleTag(e)}async click(e,t={}){return this._secondaryWorld.click(e,t)}async focus(e){return this._secondaryWorld.focus(e)}async hover(e){return this._secondaryWorld.hover(e)}select(e,...t){return this._secondaryWorld.select(e,...t)}async tap(e){return this._secondaryWorld.tap(e)}async type(e,t,i){return this._mainWorld.type(e,t,i)}waitFor(e,t={},...i){if(console.warn("waitFor is deprecated and will be removed in a future release. See https://github.com/puppeteer/puppeteer/issues/6214 for details and how to migrate your code."),k.isString(e)){const i=e;return i.startsWith("//")?this.waitForXPath(i,t):this.waitForSelector(i,t)}return k.isNumber(e)?new Promise(t=>setTimeout(t,e)):"function"==typeof e?this.waitForFunction(e,t,...i):Promise.reject(new Error("Unsupported target type: "+typeof e))}waitForTimeout(e){return new Promise(t=>{setTimeout(t,e)})}async waitForSelector(e,t={}){const i=await this._secondaryWorld.waitForSelector(e,t);if(!i)return null;const s=await this._mainWorld.executionContext(),n=await s._adoptElementHandle(i);return await i.dispose(),n}async waitForXPath(e,t={}){const i=await this._secondaryWorld.waitForXPath(e,t);if(!i)return null;const s=await this._mainWorld.executionContext(),n=await s._adoptElementHandle(i);return await i.dispose(),n}waitForFunction(e,t={},...i){return this._mainWorld.waitForFunction(e,t,...i)}async title(){return this._secondaryWorld.title()}_navigated(e){this._name=e.name,this._url=`${e.url}${e.urlFragment||""}`}_navigatedWithinDocument(e){this._url=e}_onLifecycleEvent(e,t){"init"===t&&(this._loaderId=e,this._lifecycleEvents.clear()),this._lifecycleEvents.add(t)}_onLoadingStopped(){this._lifecycleEvents.add("DOMContentLoaded"),this._lifecycleEvents.add("load")}_detach(){this._detached=!0,this._mainWorld._detach(),this._secondaryWorld._detach(),this._parentFrame&&this._parentFrame._childFrames.delete(this),this._parentFrame=null}}function de(t){e(void 0===t.networkIdleTimeout,"ERROR: networkIdleTimeout option is no longer supported."),e(void 0===t.networkIdleInflight,"ERROR: networkIdleInflight option is no longer supported."),e("networkidle"!==t.waitUntil,'ERROR: "networkidle" option is no longer supported. Use "networkidle2" instead')}const le={0:{keyCode:48,key:"0",code:"Digit0"},1:{keyCode:49,key:"1",code:"Digit1"},2:{keyCode:50,key:"2",code:"Digit2"},3:{keyCode:51,key:"3",code:"Digit3"},4:{keyCode:52,key:"4",code:"Digit4"},5:{keyCode:53,key:"5",code:"Digit5"},6:{keyCode:54,key:"6",code:"Digit6"},7:{keyCode:55,key:"7",code:"Digit7"},8:{keyCode:56,key:"8",code:"Digit8"},9:{keyCode:57,key:"9",code:"Digit9"},Power:{key:"Power",code:"Power"},Eject:{key:"Eject",code:"Eject"},Abort:{keyCode:3,code:"Abort",key:"Cancel"},Help:{keyCode:6,code:"Help",key:"Help"},Backspace:{keyCode:8,code:"Backspace",key:"Backspace"},Tab:{keyCode:9,code:"Tab",key:"Tab"},Numpad5:{keyCode:12,shiftKeyCode:101,key:"Clear",code:"Numpad5",shiftKey:"5",location:3},NumpadEnter:{keyCode:13,code:"NumpadEnter",key:"Enter",text:"\r",location:3},Enter:{keyCode:13,code:"Enter",key:"Enter",text:"\r"},"\r":{keyCode:13,code:"Enter",key:"Enter",text:"\r"},"\n":{keyCode:13,code:"Enter",key:"Enter",text:"\r"},ShiftLeft:{keyCode:16,code:"ShiftLeft",key:"Shift",location:1},ShiftRight:{keyCode:16,code:"ShiftRight",key:"Shift",location:2},ControlLeft:{keyCode:17,code:"ControlLeft",key:"Control",location:1},ControlRight:{keyCode:17,code:"ControlRight",key:"Control",location:2},AltLeft:{keyCode:18,code:"AltLeft",key:"Alt",location:1},AltRight:{keyCode:18,code:"AltRight",key:"Alt",location:2},Pause:{keyCode:19,code:"Pause",key:"Pause"},CapsLock:{keyCode:20,code:"CapsLock",key:"CapsLock"},Escape:{keyCode:27,code:"Escape",key:"Escape"},Convert:{keyCode:28,code:"Convert",key:"Convert"},NonConvert:{keyCode:29,code:"NonConvert",key:"NonConvert"},Space:{keyCode:32,code:"Space",key:" "},Numpad9:{keyCode:33,shiftKeyCode:105,key:"PageUp",code:"Numpad9",shiftKey:"9",location:3},PageUp:{keyCode:33,code:"PageUp",key:"PageUp"},Numpad3:{keyCode:34,shiftKeyCode:99,key:"PageDown",code:"Numpad3",shiftKey:"3",location:3},PageDown:{keyCode:34,code:"PageDown",key:"PageDown"},End:{keyCode:35,code:"End",key:"End"},Numpad1:{keyCode:35,shiftKeyCode:97,key:"End",code:"Numpad1",shiftKey:"1",location:3},Home:{keyCode:36,code:"Home",key:"Home"},Numpad7:{keyCode:36,shiftKeyCode:103,key:"Home",code:"Numpad7",shiftKey:"7",location:3},ArrowLeft:{keyCode:37,code:"ArrowLeft",key:"ArrowLeft"},Numpad4:{keyCode:37,shiftKeyCode:100,key:"ArrowLeft",code:"Numpad4",shiftKey:"4",location:3},Numpad8:{keyCode:38,shiftKeyCode:104,key:"ArrowUp",code:"Numpad8",shiftKey:"8",location:3},ArrowUp:{keyCode:38,code:"ArrowUp",key:"ArrowUp"},ArrowRight:{keyCode:39,code:"ArrowRight",key:"ArrowRight"},Numpad6:{keyCode:39,shiftKeyCode:102,key:"ArrowRight",code:"Numpad6",shiftKey:"6",location:3},Numpad2:{keyCode:40,shiftKeyCode:98,key:"ArrowDown",code:"Numpad2",shiftKey:"2",location:3},ArrowDown:{keyCode:40,code:"ArrowDown",key:"ArrowDown"},Select:{keyCode:41,code:"Select",key:"Select"},Open:{keyCode:43,code:"Open",key:"Execute"},PrintScreen:{keyCode:44,code:"PrintScreen",key:"PrintScreen"},Insert:{keyCode:45,code:"Insert",key:"Insert"},Numpad0:{keyCode:45,shiftKeyCode:96,key:"Insert",code:"Numpad0",shiftKey:"0",location:3},Delete:{keyCode:46,code:"Delete",key:"Delete"},NumpadDecimal:{keyCode:46,shiftKeyCode:110,code:"NumpadDecimal",key:"\0",shiftKey:".",location:3},Digit0:{keyCode:48,code:"Digit0",shiftKey:")",key:"0"},Digit1:{keyCode:49,code:"Digit1",shiftKey:"!",key:"1"},Digit2:{keyCode:50,code:"Digit2",shiftKey:"@",key:"2"},Digit3:{keyCode:51,code:"Digit3",shiftKey:"#",key:"3"},Digit4:{keyCode:52,code:"Digit4",shiftKey:"$",key:"4"},Digit5:{keyCode:53,code:"Digit5",shiftKey:"%",key:"5"},Digit6:{keyCode:54,code:"Digit6",shiftKey:"^",key:"6"},Digit7:{keyCode:55,code:"Digit7",shiftKey:"&",key:"7"},Digit8:{keyCode:56,code:"Digit8",shiftKey:"*",key:"8"},Digit9:{keyCode:57,code:"Digit9",shiftKey:"(",key:"9"},KeyA:{keyCode:65,code:"KeyA",shiftKey:"A",key:"a"},KeyB:{keyCode:66,code:"KeyB",shiftKey:"B",key:"b"},KeyC:{keyCode:67,code:"KeyC",shiftKey:"C",key:"c"},KeyD:{keyCode:68,code:"KeyD",shiftKey:"D",key:"d"},KeyE:{keyCode:69,code:"KeyE",shiftKey:"E",key:"e"},KeyF:{keyCode:70,code:"KeyF",shiftKey:"F",key:"f"},KeyG:{keyCode:71,code:"KeyG",shiftKey:"G",key:"g"},KeyH:{keyCode:72,code:"KeyH",shiftKey:"H",key:"h"},KeyI:{keyCode:73,code:"KeyI",shiftKey:"I",key:"i"},KeyJ:{keyCode:74,code:"KeyJ",shiftKey:"J",key:"j"},KeyK:{keyCode:75,code:"KeyK",shiftKey:"K",key:"k"},KeyL:{keyCode:76,code:"KeyL",shiftKey:"L",key:"l"},KeyM:{keyCode:77,code:"KeyM",shiftKey:"M",key:"m"},KeyN:{keyCode:78,code:"KeyN",shiftKey:"N",key:"n"},KeyO:{keyCode:79,code:"KeyO",shiftKey:"O",key:"o"},KeyP:{keyCode:80,code:"KeyP",shiftKey:"P",key:"p"},KeyQ:{keyCode:81,code:"KeyQ",shiftKey:"Q",key:"q"},KeyR:{keyCode:82,code:"KeyR",shiftKey:"R",key:"r"},KeyS:{keyCode:83,code:"KeyS",shiftKey:"S",key:"s"},KeyT:{keyCode:84,code:"KeyT",shiftKey:"T",key:"t"},KeyU:{keyCode:85,code:"KeyU",shiftKey:"U",key:"u"},KeyV:{keyCode:86,code:"KeyV",shiftKey:"V",key:"v"},KeyW:{keyCode:87,code:"KeyW",shiftKey:"W",key:"w"},KeyX:{keyCode:88,code:"KeyX",shiftKey:"X",key:"x"},KeyY:{keyCode:89,code:"KeyY",shiftKey:"Y",key:"y"},KeyZ:{keyCode:90,code:"KeyZ",shiftKey:"Z",key:"z"},MetaLeft:{keyCode:91,code:"MetaLeft",key:"Meta",location:1},MetaRight:{keyCode:92,code:"MetaRight",key:"Meta",location:2},ContextMenu:{keyCode:93,code:"ContextMenu",key:"ContextMenu"},NumpadMultiply:{keyCode:106,code:"NumpadMultiply",key:"*",location:3},NumpadAdd:{keyCode:107,code:"NumpadAdd",key:"+",location:3},NumpadSubtract:{keyCode:109,code:"NumpadSubtract",key:"-",location:3},NumpadDivide:{keyCode:111,code:"NumpadDivide",key:"/",location:3},F1:{keyCode:112,code:"F1",key:"F1"},F2:{keyCode:113,code:"F2",key:"F2"},F3:{keyCode:114,code:"F3",key:"F3"},F4:{keyCode:115,code:"F4",key:"F4"},F5:{keyCode:116,code:"F5",key:"F5"},F6:{keyCode:117,code:"F6",key:"F6"},F7:{keyCode:118,code:"F7",key:"F7"},F8:{keyCode:119,code:"F8",key:"F8"},F9:{keyCode:120,code:"F9",key:"F9"},F10:{keyCode:121,code:"F10",key:"F10"},F11:{keyCode:122,code:"F11",key:"F11"},F12:{keyCode:123,code:"F12",key:"F12"},F13:{keyCode:124,code:"F13",key:"F13"},F14:{keyCode:125,code:"F14",key:"F14"},F15:{keyCode:126,code:"F15",key:"F15"},F16:{keyCode:127,code:"F16",key:"F16"},F17:{keyCode:128,code:"F17",key:"F17"},F18:{keyCode:129,code:"F18",key:"F18"},F19:{keyCode:130,code:"F19",key:"F19"},F20:{keyCode:131,code:"F20",key:"F20"},F21:{keyCode:132,code:"F21",key:"F21"},F22:{keyCode:133,code:"F22",key:"F22"},F23:{keyCode:134,code:"F23",key:"F23"},F24:{keyCode:135,code:"F24",key:"F24"},NumLock:{keyCode:144,code:"NumLock",key:"NumLock"},ScrollLock:{keyCode:145,code:"ScrollLock",key:"ScrollLock"},AudioVolumeMute:{keyCode:173,code:"AudioVolumeMute",key:"AudioVolumeMute"},AudioVolumeDown:{keyCode:174,code:"AudioVolumeDown",key:"AudioVolumeDown"},AudioVolumeUp:{keyCode:175,code:"AudioVolumeUp",key:"AudioVolumeUp"},MediaTrackNext:{keyCode:176,code:"MediaTrackNext",key:"MediaTrackNext"},MediaTrackPrevious:{keyCode:177,code:"MediaTrackPrevious",key:"MediaTrackPrevious"},MediaStop:{keyCode:178,code:"MediaStop",key:"MediaStop"},MediaPlayPause:{keyCode:179,code:"MediaPlayPause",key:"MediaPlayPause"},Semicolon:{keyCode:186,code:"Semicolon",shiftKey:":",key:";"},Equal:{keyCode:187,code:"Equal",shiftKey:"+",key:"="},NumpadEqual:{keyCode:187,code:"NumpadEqual",key:"=",location:3},Comma:{keyCode:188,code:"Comma",shiftKey:"<",key:","},Minus:{keyCode:189,code:"Minus",shiftKey:"_",key:"-"},Period:{keyCode:190,code:"Period",shiftKey:">",key:"."},Slash:{keyCode:191,code:"Slash",shiftKey:"?",key:"/"},Backquote:{keyCode:192,code:"Backquote",shiftKey:"~",key:"`"},BracketLeft:{keyCode:219,code:"BracketLeft",shiftKey:"{",key:"["},Backslash:{keyCode:220,code:"Backslash",shiftKey:"|",key:"\\"},BracketRight:{keyCode:221,code:"BracketRight",shiftKey:"}",key:"]"},Quote:{keyCode:222,code:"Quote",shiftKey:'"',key:"'"},AltGraph:{keyCode:225,code:"AltGraph",key:"AltGraph"},Props:{keyCode:247,code:"Props",key:"CrSel"},Cancel:{keyCode:3,key:"Cancel",code:"Abort"},Clear:{keyCode:12,key:"Clear",code:"Numpad5",location:3},Shift:{keyCode:16,key:"Shift",code:"ShiftLeft",location:1},Control:{keyCode:17,key:"Control",code:"ControlLeft",location:1},Alt:{keyCode:18,key:"Alt",code:"AltLeft",location:1},Accept:{keyCode:30,key:"Accept"},ModeChange:{keyCode:31,key:"ModeChange"}," ":{keyCode:32,key:" ",code:"Space"},Print:{keyCode:42,key:"Print"},Execute:{keyCode:43,key:"Execute",code:"Open"},"\0":{keyCode:46,key:"\0",code:"NumpadDecimal",location:3},a:{keyCode:65,key:"a",code:"KeyA"},b:{keyCode:66,key:"b",code:"KeyB"},c:{keyCode:67,key:"c",code:"KeyC"},d:{keyCode:68,key:"d",code:"KeyD"},e:{keyCode:69,key:"e",code:"KeyE"},f:{keyCode:70,key:"f",code:"KeyF"},g:{keyCode:71,key:"g",code:"KeyG"},h:{keyCode:72,key:"h",code:"KeyH"},i:{keyCode:73,key:"i",code:"KeyI"},j:{keyCode:74,key:"j",code:"KeyJ"},k:{keyCode:75,key:"k",code:"KeyK"},l:{keyCode:76,key:"l",code:"KeyL"},m:{keyCode:77,key:"m",code:"KeyM"},n:{keyCode:78,key:"n",code:"KeyN"},o:{keyCode:79,key:"o",code:"KeyO"},p:{keyCode:80,key:"p",code:"KeyP"},q:{keyCode:81,key:"q",code:"KeyQ"},r:{keyCode:82,key:"r",code:"KeyR"},s:{keyCode:83,key:"s",code:"KeyS"},t:{keyCode:84,key:"t",code:"KeyT"},u:{keyCode:85,key:"u",code:"KeyU"},v:{keyCode:86,key:"v",code:"KeyV"},w:{keyCode:87,key:"w",code:"KeyW"},x:{keyCode:88,key:"x",code:"KeyX"},y:{keyCode:89,key:"y",code:"KeyY"},z:{keyCode:90,key:"z",code:"KeyZ"},Meta:{keyCode:91,key:"Meta",code:"MetaLeft",location:1},"*":{keyCode:106,key:"*",code:"NumpadMultiply",location:3},"+":{keyCode:107,key:"+",code:"NumpadAdd",location:3},"-":{keyCode:109,key:"-",code:"NumpadSubtract",location:3},"/":{keyCode:111,key:"/",code:"NumpadDivide",location:3},";":{keyCode:186,key:";",code:"Semicolon"},"=":{keyCode:187,key:"=",code:"Equal"},",":{keyCode:188,key:",",code:"Comma"},".":{keyCode:190,key:".",code:"Period"},"`":{keyCode:192,key:"`",code:"Backquote"},"[":{keyCode:219,key:"[",code:"BracketLeft"},"\\":{keyCode:220,key:"\\",code:"Backslash"},"]":{keyCode:221,key:"]",code:"BracketRight"},"'":{keyCode:222,key:"'",code:"Quote"},Attn:{keyCode:246,key:"Attn"},CrSel:{keyCode:247,key:"CrSel",code:"Props"},ExSel:{keyCode:248,key:"ExSel"},EraseEof:{keyCode:249,key:"EraseEof"},Play:{keyCode:250,key:"Play"},ZoomOut:{keyCode:251,key:"ZoomOut"},")":{keyCode:48,key:")",code:"Digit0"},"!":{keyCode:49,key:"!",code:"Digit1"},"@":{keyCode:50,key:"@",code:"Digit2"},"#":{keyCode:51,key:"#",code:"Digit3"},$:{keyCode:52,key:"$",code:"Digit4"},"%":{keyCode:53,key:"%",code:"Digit5"},"^":{keyCode:54,key:"^",code:"Digit6"},"&":{keyCode:55,key:"&",code:"Digit7"},"(":{keyCode:57,key:"(",code:"Digit9"},A:{keyCode:65,key:"A",code:"KeyA"},B:{keyCode:66,key:"B",code:"KeyB"},C:{keyCode:67,key:"C",code:"KeyC"},D:{keyCode:68,key:"D",code:"KeyD"},E:{keyCode:69,key:"E",code:"KeyE"},F:{keyCode:70,key:"F",code:"KeyF"},G:{keyCode:71,key:"G",code:"KeyG"},H:{keyCode:72,key:"H",code:"KeyH"},I:{keyCode:73,key:"I",code:"KeyI"},J:{keyCode:74,key:"J",code:"KeyJ"},K:{keyCode:75,key:"K",code:"KeyK"},L:{keyCode:76,key:"L",code:"KeyL"},M:{keyCode:77,key:"M",code:"KeyM"},N:{keyCode:78,key:"N",code:"KeyN"},O:{keyCode:79,key:"O",code:"KeyO"},P:{keyCode:80,key:"P",code:"KeyP"},Q:{keyCode:81,key:"Q",code:"KeyQ"},R:{keyCode:82,key:"R",code:"KeyR"},S:{keyCode:83,key:"S",code:"KeyS"},T:{keyCode:84,key:"T",code:"KeyT"},U:{keyCode:85,key:"U",code:"KeyU"},V:{keyCode:86,key:"V",code:"KeyV"},W:{keyCode:87,key:"W",code:"KeyW"},X:{keyCode:88,key:"X",code:"KeyX"},Y:{keyCode:89,key:"Y",code:"KeyY"},Z:{keyCode:90,key:"Z",code:"KeyZ"},":":{keyCode:186,key:":",code:"Semicolon"},"<":{keyCode:188,key:"<",code:"Comma"},_:{keyCode:189,key:"_",code:"Minus"},">":{keyCode:190,key:">",code:"Period"},"?":{keyCode:191,key:"?",code:"Slash"},"~":{keyCode:192,key:"~",code:"Backquote"},"{":{keyCode:219,key:"{",code:"BracketLeft"},"|":{keyCode:220,key:"|",code:"Backslash"},"}":{keyCode:221,key:"}",code:"BracketRight"},'"':{keyCode:222,key:'"',code:"Quote"},SoftLeft:{key:"SoftLeft",code:"SoftLeft",location:4},SoftRight:{key:"SoftRight",code:"SoftRight",location:4},Camera:{keyCode:44,key:"Camera",code:"Camera",location:4},Call:{key:"Call",code:"Call",location:4},EndCall:{keyCode:95,key:"EndCall",code:"EndCall",location:4},VolumeDown:{keyCode:182,key:"VolumeDown",code:"VolumeDown",location:4},VolumeUp:{keyCode:183,key:"VolumeUp",code:"VolumeUp",location:4}};class he{constructor(e){this._modifiers=0,this._pressedKeys=new Set,this._client=e}async down(e,t={text:void 0}){const i=this._keyDescriptionForString(e),s=this._pressedKeys.has(i.code);this._pressedKeys.add(i.code),this._modifiers|=this._modifierBit(i.key);const n=void 0===t.text?i.text:t.text;await this._client.send("Input.dispatchKeyEvent",{type:n?"keyDown":"rawKeyDown",modifiers:this._modifiers,windowsVirtualKeyCode:i.keyCode,code:i.code,key:i.key,text:n,unmodifiedText:n,autoRepeat:s,location:i.location,isKeypad:3===i.location})}_modifierBit(e){return"Alt"===e?1:"Control"===e?2:"Meta"===e?4:"Shift"===e?8:0}_keyDescriptionForString(t){const i=8&this._modifiers,s={key:"",keyCode:0,code:"",text:"",location:0},n=le[t];return e(n,`Unknown key: "${t}"`),n.key&&(s.key=n.key),i&&n.shiftKey&&(s.key=n.shiftKey),n.keyCode&&(s.keyCode=n.keyCode),i&&n.shiftKeyCode&&(s.keyCode=n.shiftKeyCode),n.code&&(s.code=n.code),n.location&&(s.location=n.location),1===s.key.length&&(s.text=s.key),n.text&&(s.text=n.text),i&&n.shiftText&&(s.text=n.shiftText),-9&this._modifiers&&(s.text=""),s}async up(e){const t=this._keyDescriptionForString(e);this._modifiers&=~this._modifierBit(t.key),this._pressedKeys.delete(t.code),await this._client.send("Input.dispatchKeyEvent",{type:"keyUp",modifiers:this._modifiers,key:t.key,windowsVirtualKeyCode:t.keyCode,code:t.code,location:t.location})}async sendCharacter(e){await this._client.send("Input.insertText",{text:e})}charIsKey(e){return!!le[e]}async type(e,t={}){const i=t.delay||null;for(const t of e)this.charIsKey(t)?await this.press(t,{delay:i}):(i&&await new Promise(e=>setTimeout(e,i)),await this.sendCharacter(t))}async press(e,t={}){const{delay:i=null}=t;await this.down(e,t),i&&await new Promise(e=>setTimeout(e,t.delay)),await this.up(e)}}class ue{constructor(e,t){this._x=0,this._y=0,this._button="none",this._client=e,this._keyboard=t}async move(e,t,i={}){const{steps:s=1}=i,n=this._x,o=this._y;this._x=e,this._y=t;for(let e=1;e<=s;e++)await this._client.send("Input.dispatchMouseEvent",{type:"mouseMoved",button:this._button,x:n+(this._x-n)*(e/s),y:o+(this._y-o)*(e/s),modifiers:this._keyboard._modifiers})}async click(e,t,i={}){const{delay:s=null}=i;null!==s?(await Promise.all([this.move(e,t),this.down(i)]),await new Promise(e=>setTimeout(e,s)),await this.up(i)):await Promise.all([this.move(e,t),this.down(i),this.up(i)])}async down(e={}){const{button:t="left",clickCount:i=1}=e;this._button=t,await this._client.send("Input.dispatchMouseEvent",{type:"mousePressed",button:t,x:this._x,y:this._y,modifiers:this._keyboard._modifiers,clickCount:i})}async up(e={}){const{button:t="left",clickCount:i=1}=e;this._button="none",await this._client.send("Input.dispatchMouseEvent",{type:"mouseReleased",button:t,x:this._x,y:this._y,modifiers:this._keyboard._modifiers,clickCount:i})}async wheel(e={}){const{deltaX:t=0,deltaY:i=0}=e;await this._client.send("Input.dispatchMouseEvent",{type:"mouseWheel",x:this._x,y:this._y,deltaX:t,deltaY:i,modifiers:this._keyboard._modifiers,pointerType:"mouse"})}}class ye{constructor(e,t){this._client=e,this._keyboard=t}async tap(e,t){await this._client.send("Runtime.evaluate",{expression:"new Promise(x => requestAnimationFrame(() => requestAnimationFrame(x)))",awaitPromise:!0});const i=[{x:Math.round(e),y:Math.round(t)}];await this._client.send("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:i,modifiers:this._keyboard._modifiers}),await this._client.send("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[],modifiers:this._keyboard._modifiers})}}const me={letter:{width:8.5,height:11},legal:{width:8.5,height:14},tabloid:{width:11,height:17},ledger:{width:17,height:11},a0:{width:33.1,height:46.8},a1:{width:23.4,height:33.1},a2:{width:16.54,height:23.4},a3:{width:11.7,height:16.54},a4:{width:8.27,height:11.7},a5:{width:5.83,height:8.27},a6:{width:4.13,height:5.83}};class _e{constructor(){this._defaultTimeout=null,this._defaultNavigationTimeout=null}setDefaultTimeout(e){this._defaultTimeout=e}setDefaultNavigationTimeout(e){this._defaultNavigationTimeout=e}navigationTimeout(){return null!==this._defaultNavigationTimeout?this._defaultNavigationTimeout:null!==this._defaultTimeout?this._defaultTimeout:3e4}timeout(){return null!==this._defaultTimeout?this._defaultTimeout:3e4}}class pe{constructor(e){this._recording=!1,this._path="",this._client=e}async start(t={}){e(!this._recording,"Cannot start recording trace while already recording trace.");const i=["-*","devtools.timeline","v8.execute","disabled-by-default-devtools.timeline","disabled-by-default-devtools.timeline.frame","toplevel","blink.console","blink.user_timing","latencyInfo","disabled-by-default-devtools.timeline.stack","disabled-by-default-v8.cpu_profiler","disabled-by-default-v8.cpu_profiler.hires"],{path:s=null,screenshots:n=!1,categories:o=i}=t;n&&o.push("disabled-by-default-devtools.screenshot"),this._path=s,this._recording=!0,await this._client.send("Tracing.start",{transferMode:"ReturnAsStream",categories:o.join(",")})}async stop(){let e,t;const i=new Promise((i,s)=>{e=i,t=s});return this._client.once("Tracing.tracingComplete",i=>{k.readProtocolStream(this._client,i.stream,this._path).then(e,t)}),await this._client.send("Tracing.end"),this._recording=!1,i}}class fe extends s{constructor(e,t,i,s){let n;super(),this._client=e,this._url=t,this._executionContextPromise=new Promise(e=>this._executionContextCallback=e),this._client.once("Runtime.executionContextCreated",async t=>{n=t=>new K(i,e,t);const i=new A(e,t.context,null);this._executionContextCallback(i)}),this._client.send("Runtime.enable").catch(m),this._client.on("Runtime.consoleAPICalled",e=>i(e.type,e.args.map(n),e.stackTrace)),this._client.on("Runtime.exceptionThrown",e=>s(e.exceptionDetails))}url(){return this._url}async executionContext(){return this._executionContextPromise}async evaluate(e,...t){return(await this._executionContextPromise).evaluate(e,...t)}async evaluateHandle(e,...t){return(await this._executionContextPromise).evaluateHandle(e,...t)}}class ge{constructor(){this._chain=Promise.resolve(void 0)}postTask(e){const t=this._chain.then(e);return this._chain=t.catch(()=>{}),t}}class we extends s{constructor(e,t,i){super(),this._closed=!1,this._timeoutSettings=new _e,this._pageBindings=new Map,this._javascriptEnabled=!0,this._workers=new Map,this._fileChooserInterceptors=new Set,this._client=e,this._target=t,this._keyboard=new he(e),this._mouse=new ue(e,this._keyboard),this._touchscreen=new ye(e,this._keyboard),this._accessibility=new C(e),this._frameManager=new re(e,this,i,this._timeoutSettings),this._emulationManager=new U(e),this._tracing=new pe(e),this._coverage=new j(e),this._screenshotTaskQueue=new ge,this._viewport=null,e.on("Target.attachedToTarget",t=>{if("worker"!==t.targetInfo.type)return void e.send("Target.detachFromTarget",{sessionId:t.sessionId}).catch(m);const i=r.fromSession(e).session(t.sessionId),s=new fe(i,t.targetInfo.url,this._addConsoleMessage.bind(this),this._handleException.bind(this));this._workers.set(t.sessionId,s),this.emit("workercreated",s)}),e.on("Target.detachedFromTarget",e=>{const t=this._workers.get(e.sessionId);t&&(this.emit("workerdestroyed",t),this._workers.delete(e.sessionId))}),this._frameManager.on(ae.FrameAttached,e=>this.emit("frameattached",e)),this._frameManager.on(ae.FrameDetached,e=>this.emit("framedetached",e)),this._frameManager.on(ae.FrameNavigated,e=>this.emit("framenavigated",e));const s=this._frameManager.networkManager();s.on(Z.Request,e=>this.emit("request",e)),s.on(Z.Response,e=>this.emit("response",e)),s.on(Z.RequestFailed,e=>this.emit("requestfailed",e)),s.on(Z.RequestFinished,e=>this.emit("requestfinished",e)),this._fileChooserInterceptors=new Set,e.on("Page.domContentEventFired",()=>this.emit("domcontentloaded")),e.on("Page.loadEventFired",()=>this.emit("load")),e.on("Runtime.consoleAPICalled",e=>this._onConsoleAPI(e)),e.on("Runtime.bindingCalled",e=>this._onBindingCalled(e)),e.on("Page.javascriptDialogOpening",e=>this._onDialog(e)),e.on("Runtime.exceptionThrown",e=>this._handleException(e.exceptionDetails)),e.on("Inspector.targetCrashed",()=>this._onTargetCrashed()),e.on("Performance.metrics",e=>this._emitMetrics(e)),e.on("Log.entryAdded",e=>this._onLogEntryAdded(e)),e.on("Page.fileChooserOpened",e=>this._onFileChooser(e)),this._target._isClosedPromise.then(()=>{this.emit("close"),this._closed=!0})}static async create(e,t,i,s){const n=new we(e,t,i);return await n._initialize(),s&&await n.setViewport(s),n}async _initialize(){await Promise.all([this._frameManager.initialize(),this._client.send("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!1,flatten:!0}),this._client.send("Performance.enable"),this._client.send("Log.enable")])}async _onFileChooser(e){if(!this._fileChooserInterceptors.size)return;const t=this._frameManager.frame(e.frameId),i=await t.executionContext(),s=await i._adoptBackendNodeId(e.backendNodeId),n=Array.from(this._fileChooserInterceptors);this._fileChooserInterceptors.clear();const o=new V(s,e);for(const e of n)e.call(null,o)}isJavaScriptEnabled(){return this._javascriptEnabled}async waitForFileChooser(e={}){this._fileChooserInterceptors.size||await this._client.send("Page.setInterceptFileChooserDialog",{enabled:!0});const{timeout:t=this._timeoutSettings.timeout()}=e;let i;const s=new Promise(e=>i=e);return this._fileChooserInterceptors.add(i),k.waitWithTimeout(s,"waiting for file chooser",t).catch(e=>{throw this._fileChooserInterceptors.delete(i),e})}async setGeolocation(e){const{longitude:t,latitude:i,accuracy:s=0}=e;if(t<-180||t>180)throw new Error(`Invalid longitude "${t}": precondition -180 <= LONGITUDE <= 180 failed.`);if(i<-90||i>90)throw new Error(`Invalid latitude "${i}": precondition -90 <= LATITUDE <= 90 failed.`);if(s<0)throw new Error(`Invalid accuracy "${s}": precondition 0 <= ACCURACY failed.`);await this._client.send("Emulation.setGeolocationOverride",{longitude:t,latitude:i,accuracy:s})}target(){return this._target}browser(){return this._target.browser()}browserContext(){return this._target.browserContext()}_onTargetCrashed(){this.emit("error",new Error("Page crashed!"))}_onLogEntryAdded(e){const{level:t,text:i,args:s,source:n,url:o,lineNumber:a}=e.entry;s&&s.map(e=>k.releaseObject(this._client,e)),"worker"!==n&&this.emit("console",new v(t,i,[],[{url:o,lineNumber:a}]))}mainFrame(){return this._frameManager.mainFrame()}get keyboard(){return this._keyboard}get touchscreen(){return this._touchscreen}get coverage(){return this._coverage}get tracing(){return this._tracing}get accessibility(){return this._accessibility}frames(){return this._frameManager.frames()}workers(){return Array.from(this._workers.values())}async setRequestInterception(e){return this._frameManager.networkManager().setRequestInterception(e)}setOfflineMode(e){return this._frameManager.networkManager().setOfflineMode(e)}setDefaultNavigationTimeout(e){this._timeoutSettings.setDefaultNavigationTimeout(e)}setDefaultTimeout(e){this._timeoutSettings.setDefaultTimeout(e)}async $(e){return this.mainFrame().$(e)}async evaluateHandle(e,...t){return(await this.mainFrame().executionContext()).evaluateHandle(e,...t)}async queryObjects(e){return(await this.mainFrame().executionContext()).queryObjects(e)}async $eval(e,t,...i){return this.mainFrame().$eval(e,t,...i)}async $$eval(e,t,...i){return this.mainFrame().$$eval(e,t,...i)}async $$(e){return this.mainFrame().$$(e)}async $x(e){return this.mainFrame().$x(e)}async cookies(...e){const t=(await this._client.send("Network.getCookies",{urls:e.length?e:[this.url()]})).cookies,i=["priority"];return t.map(e=>{for(const t of i)delete e[t];return e})}async deleteCookie(...e){const t=this.url();for(const i of e){const e=Object.assign({},i);!i.url&&t.startsWith("http")&&(e.url=t),await this._client.send("Network.deleteCookies",e)}}async setCookie(...t){const i=this.url(),s=i.startsWith("http"),n=t.map(t=>{const n=Object.assign({},t);return!n.url&&s&&(n.url=i),e("about:blank"!==n.url,`Blank page can not have cookie "${n.name}"`),e(!String.prototype.startsWith.call(n.url||"","data:"),`Data URL page can not have cookie "${n.name}"`),n});await this.deleteCookie(...n),n.length&&await this._client.send("Network.setCookies",{cookies:n})}async addScriptTag(e){return this.mainFrame().addScriptTag(e)}async addStyleTag(e){return this.mainFrame().addStyleTag(e)}async exposeFunction(e,t){if(this._pageBindings.has(e))throw new Error(`Failed to add page binding with name ${e}: window['${e}'] already exists!`);this._pageBindings.set(e,t);const i=k.pageBindingInitString("exposedFun",e);await this._client.send("Runtime.addBinding",{name:e}),await this._client.send("Page.addScriptToEvaluateOnNewDocument",{source:i}),await Promise.all(this.frames().map(e=>e.evaluate(i).catch(m)))}async authenticate(e){return this._frameManager.networkManager().authenticate(e)}async setExtraHTTPHeaders(e){return this._frameManager.networkManager().setExtraHTTPHeaders(e)}async setUserAgent(e){return this._frameManager.networkManager().setUserAgent(e)}async metrics(){const e=await this._client.send("Performance.getMetrics");return this._buildMetricsObject(e.metrics)}_emitMetrics(e){this.emit("metrics",{title:e.title,metrics:this._buildMetricsObject(e.metrics)})}_buildMetricsObject(e){const t={};for(const i of e||[])ke.has(i.name)&&(t[i.name]=i.value);return t}_handleException(e){const t=k.getExceptionMessage(e),i=new Error(t);i.stack="",this.emit("pageerror",i)}async _onConsoleAPI(e){if(0===e.executionContextId)return;const t=this._frameManager.executionContextById(e.executionContextId),i=e.args.map(e=>q(t,e));this._addConsoleMessage(e.type,i,e.stackTrace)}async _onBindingCalled(e){let t;try{t=JSON.parse(e.payload)}catch{return}const{type:i,name:s,seq:n,args:o}=t;if("exposedFun"!==i||!this._pageBindings.has(s))return;let a=null;try{const e=await this._pageBindings.get(s)(...o);a=k.pageBindingDeliverResultString(s,n,e)}catch(e){a=e instanceof Error?k.pageBindingDeliverErrorString(s,n,e.message,e.stack):k.pageBindingDeliverErrorValueString(s,n,e)}this._client.send("Runtime.evaluate",{expression:a,contextId:e.executionContextId}).catch(m)}_addConsoleMessage(e,t,i){if(!this.listenerCount("console"))return void t.forEach(e=>e.dispose());const s=[];for(const e of t){const t=e._remoteObject;t.objectId?s.push(e.toString()):s.push(k.valueFromRemoteObject(t))}const n=[];if(i)for(const e of i.callFrames)n.push({url:e.url,lineNumber:e.lineNumber,columnNumber:e.columnNumber});const o=new v(e,s.join(" "),t,n);this.emit("console",o)}_onDialog(t){let i=null;new Set(["alert","confirm","prompt","beforeunload"]).has(t.type)&&(i=t.type),e(i,"Unknown javascript dialog type: "+t.type);const s=new W(this._client,i,t.message,t.defaultPrompt);this.emit("dialog",s)}url(){return this.mainFrame().url()}async content(){return await this._frameManager.mainFrame().content()}async setContent(e,t={}){await this._frameManager.mainFrame().setContent(e,t)}async goto(e,t={}){return await this._frameManager.mainFrame().goto(e,t)}async reload(e){return(await Promise.all([this.waitForNavigation(e),this._client.send("Page.reload")]))[0]}async waitForNavigation(e={}){return await this._frameManager.mainFrame().waitForNavigation(e)}_sessionClosePromise(){return this._disconnectPromise||(this._disconnectPromise=new Promise(e=>this._client.once(c.Disconnected,()=>e(new Error("Target closed"))))),this._disconnectPromise}async waitForRequest(e,t={}){const{timeout:i=this._timeoutSettings.timeout()}=t;return k.waitForEvent(this._frameManager.networkManager(),Z.Request,t=>k.isString(e)?e===t.url():"function"==typeof e&&!!e(t),i,this._sessionClosePromise())}async waitForResponse(e,t={}){const{timeout:i=this._timeoutSettings.timeout()}=t;return k.waitForEvent(this._frameManager.networkManager(),Z.Response,t=>k.isString(e)?e===t.url():"function"==typeof e&&!!e(t),i,this._sessionClosePromise())}async goBack(e={}){return this._go(-1,e)}async goForward(e={}){return this._go(1,e)}async _go(e,t){const i=await this._client.send("Page.getNavigationHistory"),s=i.entries[i.currentIndex+e];if(!s)return null;return(await Promise.all([this.waitForNavigation(t),this._client.send("Page.navigateToHistoryEntry",{entryId:s.id})]))[0]}async bringToFront(){await this._client.send("Page.bringToFront")}async emulate(e){await Promise.all([this.setViewport(e.viewport),this.setUserAgent(e.userAgent)])}async setJavaScriptEnabled(e){this._javascriptEnabled!==e&&(this._javascriptEnabled=e,await this._client.send("Emulation.setScriptExecutionDisabled",{value:!e}))}async setBypassCSP(e){await this._client.send("Page.setBypassCSP",{enabled:e})}async emulateMediaType(t){e("screen"===t||"print"===t||null===t,"Unsupported media type: "+t),await this._client.send("Emulation.setEmulatedMedia",{media:t||""})}async emulateMediaFeatures(t){null===t&&await this._client.send("Emulation.setEmulatedMedia",{features:null}),Array.isArray(t)&&(t.every(t=>{const i=t.name;return e(/^prefers-(?:color-scheme|reduced-motion)$/.test(i),"Unsupported media feature: "+i),!0}),await this._client.send("Emulation.setEmulatedMedia",{features:t}))}async emulateTimezone(e){try{await this._client.send("Emulation.setTimezoneOverride",{timezoneId:e||""})}catch(t){if(t.message.includes("Invalid timezone"))throw new Error("Invalid timezone ID: "+e);throw t}}async emulateIdleState(e){e?await this._client.send("Emulation.setIdleOverride",{isUserActive:e.isUserActive,isScreenUnlocked:e.isScreenUnlocked}):await this._client.send("Emulation.clearIdleOverride")}async emulateVisionDeficiency(t){const i=new Set(["none","achromatopsia","blurredVision","deuteranopia","protanopia","tritanopia"]);try{e(!t||i.has(t),"Unsupported vision deficiency: "+t),await this._client.send("Emulation.setEmulatedVisionDeficiency",{type:t||"none"})}catch(e){throw e}}async setViewport(e){const t=await this._emulationManager.emulateViewport(e);this._viewport=e,t&&await this.reload()}viewport(){return this._viewport}async evaluate(e,...t){return this._frameManager.mainFrame().evaluate(e,...t)}async evaluateOnNewDocument(e,...t){const i=k.evaluationString(e,...t);await this._client.send("Page.addScriptToEvaluateOnNewDocument",{source:i})}async setCacheEnabled(e=!0){await this._frameManager.networkManager().setCacheEnabled(e)}async screenshot(t={}){let i=null;if(t.type)e("png"===t.type||"jpeg"===t.type,"Unknown options.type value: "+t.type),i=t.type;else if(t.path){const s=t.path,n=s.slice(s.lastIndexOf(".")+1).toLowerCase();"png"===n?i="png":"jpg"!==n&&"jpeg"!==n||(i="jpeg"),e(i,`Unsupported screenshot type for extension \`.${n}\``)}return i||(i="png"),t.quality&&(e("jpeg"===i,"options.quality is unsupported for the "+i+" screenshots"),e("number"==typeof t.quality,"Expected options.quality to be a number but found "+typeof t.quality),e(Number.isInteger(t.quality),"Expected options.quality to be an integer"),e(t.quality>=0&&t.quality<=100,"Expected options.quality to be between 0 and 100 (inclusive), got "+t.quality)),e(!t.clip||!t.fullPage,"options.clip and options.fullPage are exclusive"),t.clip&&(e("number"==typeof t.clip.x,"Expected options.clip.x to be a number but found "+typeof t.clip.x),e("number"==typeof t.clip.y,"Expected options.clip.y to be a number but found "+typeof t.clip.y),e("number"==typeof t.clip.width,"Expected options.clip.width to be a number but found "+typeof t.clip.width),e("number"==typeof t.clip.height,"Expected options.clip.height to be a number but found "+typeof t.clip.height),e(0!==t.clip.width,"Expected options.clip.width not to be 0."),e(0!==t.clip.height,"Expected options.clip.height not to be 0.")),this._screenshotTaskQueue.postTask(()=>this._screenshotTask(i,t))}async _screenshotTask(e,i){await this._client.send("Target.activateTarget",{targetId:this._target._targetId});let s=i.clip?function(e){const t=Math.round(e.x),i=Math.round(e.y),s=Math.round(e.width+e.x-t),n=Math.round(e.height+e.y-i);return{x:t,y:i,width:s,height:n,scale:1}}(i.clip):void 0;if(i.fullPage){const e=await this._client.send("Page.getLayoutMetrics"),t=Math.ceil(e.contentSize.width),i=Math.ceil(e.contentSize.height);s={x:0,y:0,width:t,height:i,scale:1};const{isMobile:n=!1,deviceScaleFactor:o=1,isLandscape:a=!1}=this._viewport||{},r=a?{angle:90,type:"landscapePrimary"}:{angle:0,type:"portraitPrimary"};await this._client.send("Emulation.setDeviceMetricsOverride",{mobile:n,width:t,height:i,deviceScaleFactor:o,screenOrientation:r})}const n=i.omitBackground&&"png"===e;n&&await this._client.send("Emulation.setDefaultBackgroundColorOverride",{color:{r:0,g:0,b:0,a:0}});const o=await this._client.send("Page.captureScreenshot",{format:e,quality:i.quality,clip:s});n&&await this._client.send("Emulation.setDefaultBackgroundColorOverride"),i.fullPage&&this._viewport&&await this.setViewport(this._viewport);const a="base64"===i.encoding?o.data:Buffer.from(o.data,"base64");if(!t&&i.path)throw new Error("Screenshots can only be written to a file path in a Node environment.");const r=await k.importFSModule();return i.path&&await r.promises.writeFile(i.path,a),a}async pdf(t={}){const{scale:i=1,displayHeaderFooter:s=!1,headerTemplate:n="",footerTemplate:o="",printBackground:a=!1,landscape:r=!1,pageRanges:c="",preferCSSPageSize:d=!1,margin:l={},path:h=null}=t;let u=8.5,y=11;if(t.format){const i=me[t.format.toLowerCase()];e(i,"Unknown paper format: "+t.format),u=i.width,y=i.height}else u=be(t.width)||u,y=be(t.height)||y;const m=be(l.top)||0,_=be(l.left)||0,p=be(l.bottom)||0,f=be(l.right)||0,g=await this._client.send("Page.printToPDF",{transferMode:"ReturnAsStream",landscape:r,displayHeaderFooter:s,headerTemplate:n,footerTemplate:o,printBackground:a,scale:i,paperWidth:u,paperHeight:y,marginTop:m,marginBottom:p,marginLeft:_,marginRight:f,pageRanges:c,preferCSSPageSize:d});return await k.readProtocolStream(this._client,g.stream,h)}async title(){return this.mainFrame().title()}async close(t={runBeforeUnload:void 0}){e(!!this._client._connection,"Protocol error: Connection closed. Most likely the page has been closed.");!!t.runBeforeUnload?await this._client.send("Page.close"):(await this._client._connection.send("Target.closeTarget",{targetId:this._target._targetId}),await this._target._isClosedPromise)}isClosed(){return this._closed}get mouse(){return this._mouse}click(e,t={}){return this.mainFrame().click(e,t)}focus(e){return this.mainFrame().focus(e)}hover(e){return this.mainFrame().hover(e)}select(e,...t){return this.mainFrame().select(e,...t)}tap(e){return this.mainFrame().tap(e)}type(e,t,i){return this.mainFrame().type(e,t,i)}waitFor(e,t={},...i){return this.mainFrame().waitFor(e,t,...i)}waitForTimeout(e){return this.mainFrame().waitForTimeout(e)}waitForSelector(e,t={}){return this.mainFrame().waitForSelector(e,t)}waitForXPath(e,t={}){return this.mainFrame().waitForXPath(e,t)}waitForFunction(e,t={},...i){return this.mainFrame().waitForFunction(e,t,...i)}}const ke=new Set(["Timestamp","Documents","Frames","JSEventListeners","Nodes","LayoutCount","RecalcStyleCount","LayoutDuration","RecalcStyleDuration","ScriptDuration","TaskDuration","JSHeapUsedSize","JSHeapTotalSize"]),Ce={px:1,in:96,cm:37.8,mm:3.78};function be(t){if(void 0===t)return;let i;if(k.isNumber(t))i=t;else{if(!k.isString(t))throw new Error("page.pdf() Cannot handle parameter type: "+typeof t);{const s=t;let n=s.substring(s.length-2).toLowerCase(),o="";Ce.hasOwnProperty(n)?o=s.substring(0,s.length-2):(n="px",o=s);const a=Number(o);e(!isNaN(a),"Failed to parse parameter value: "+s),i=a*Ce[n]}}return i/96}class ve{constructor(e,t,i,s,n){this._targetInfo=e,this._browserContext=t,this._targetId=e.targetId,this._sessionFactory=i,this._ignoreHTTPSErrors=s,this._defaultViewport=n,this._pagePromise=null,this._workerPromise=null,this._initializedPromise=new Promise(e=>this._initializedCallback=e).then(async e=>{if(!e)return!1;const t=this.opener();if(!t||!t._pagePromise||"page"!==this.type())return!0;const i=await t._pagePromise;if(!i.listenerCount("popup"))return!0;const s=await this.page();return i.emit("popup",s),!0}),this._isClosedPromise=new Promise(e=>this._closedCallback=e),this._isInitialized="page"!==this._targetInfo.type||""!==this._targetInfo.url,this._isInitialized&&this._initializedCallback(!0)}createCDPSession(){return this._sessionFactory()}async page(){return"page"!==this._targetInfo.type&&"background_page"!==this._targetInfo.type&&"webview"!==this._targetInfo.type||this._pagePromise||(this._pagePromise=this._sessionFactory().then(e=>we.create(e,this,this._ignoreHTTPSErrors,this._defaultViewport))),this._pagePromise}async worker(){return"service_worker"!==this._targetInfo.type&&"shared_worker"!==this._targetInfo.type?null:(this._workerPromise||(this._workerPromise=this._sessionFactory().then(e=>new fe(e,this._targetInfo.url,()=>{},()=>{}))),this._workerPromise)}url(){return this._targetInfo.url}type(){const e=this._targetInfo.type;return"page"===e||"background_page"===e||"service_worker"===e||"shared_worker"===e||"browser"===e||"webview"===e?e:"other"}browser(){return this._browserContext.browser()}browserContext(){return this._browserContext}opener(){const{openerId:e}=this._targetInfo;return e?this.browser()._targets.get(e):null}_targetInfoChanged(e){if(this._targetInfo=e,!this._isInitialized&&("page"!==this._targetInfo.type||""!==this._targetInfo.url))return this._isInitialized=!0,void this._initializedCallback(!0)}}class xe extends s{constructor(e,t,i,s,n,o){super(),this._ignoreHTTPSErrors=i,this._defaultViewport=s,this._process=n,this._connection=e,this._closeCallback=o||function(){},this._defaultContext=new Ie(this._connection,this,null),this._contexts=new Map;for(const e of t)this._contexts.set(e,new Ie(this._connection,this,e));this._targets=new Map,this._connection.on(a.Disconnected,()=>this.emit("disconnected")),this._connection.on("Target.targetCreated",this._targetCreated.bind(this)),this._connection.on("Target.targetDestroyed",this._targetDestroyed.bind(this)),this._connection.on("Target.targetInfoChanged",this._targetInfoChanged.bind(this))}static async create(e,t,i,s,n,o){const a=new xe(e,t,i,s,n,o);return await e.send("Target.setDiscoverTargets",{discover:!0}),a}process(){return this._process}async createIncognitoBrowserContext(){const{browserContextId:e}=await this._connection.send("Target.createBrowserContext"),t=new Ie(this._connection,this,e);return this._contexts.set(e,t),t}browserContexts(){return[this._defaultContext,...Array.from(this._contexts.values())]}defaultBrowserContext(){return this._defaultContext}async _disposeContext(e){await this._connection.send("Target.disposeBrowserContext",{browserContextId:e||void 0}),this._contexts.delete(e)}async _targetCreated(t){const i=t.targetInfo,{browserContextId:s}=i,n=s&&this._contexts.has(s)?this._contexts.get(s):this._defaultContext,o=new ve(i,n,()=>this._connection.createSession(i),this._ignoreHTTPSErrors,this._defaultViewport);e(!this._targets.has(t.targetInfo.targetId),"Target should not exist before targetCreated"),this._targets.set(t.targetInfo.targetId,o),await o._initializedPromise&&(this.emit("targetcreated",o),n.emit("targetcreated",o))}async _targetDestroyed(e){const t=this._targets.get(e.targetId);t._initializedCallback(!1),this._targets.delete(e.targetId),t._closedCallback(),await t._initializedPromise&&(this.emit("targetdestroyed",t),t.browserContext().emit("targetdestroyed",t))}_targetInfoChanged(t){const i=this._targets.get(t.targetInfo.targetId);e(i,"target should exist before targetInfoChanged");const s=i.url(),n=i._isInitialized;i._targetInfoChanged(t.targetInfo),n&&s!==i.url()&&(this.emit("targetchanged",i),i.browserContext().emit("targetchanged",i))}wsEndpoint(){return this._connection.url()}async newPage(){return this._defaultContext.newPage()}async _createPageInContext(t){const{targetId:i}=await this._connection.send("Target.createTarget",{url:"about:blank",browserContextId:t||void 0}),s=await this._targets.get(i);e(await s._initializedPromise,"Failed to create target for page");return await s.page()}targets(){return Array.from(this._targets.values()).filter(e=>e._isInitialized)}target(){return this.targets().find(e=>"browser"===e.type())}async waitForTarget(e,t={}){const{timeout:i=3e4}=t,s=this.targets().find(e);if(s)return s;let n;const o=new Promise(e=>n=e);this.on("targetcreated",a),this.on("targetchanged",a);try{return i?await k.waitWithTimeout(o,"target",i):await o}finally{this.removeListener("targetcreated",a),this.removeListener("targetchanged",a)}function a(t){e(t)&&n(t)}}async pages(){return(await Promise.all(this.browserContexts().map(e=>e.pages()))).reduce((e,t)=>e.concat(t),[])}async version(){return(await this._getVersion()).product}async userAgent(){return(await this._getVersion()).userAgent}async close(){await this._closeCallback.call(null),this.disconnect()}disconnect(){this._connection.dispose()}isConnected(){return!this._connection._closed}_getVersion(){return this._connection.send("Browser.getVersion")}}class Ie extends s{constructor(e,t,i){super(),this._connection=e,this._browser=t,this._id=i}targets(){return this._browser.targets().filter(e=>e.browserContext()===this)}waitForTarget(e,t={}){return this._browser.waitForTarget(t=>t.browserContext()===this&&e(t),t)}async pages(){return(await Promise.all(this.targets().filter(e=>"page"===e.type()).map(e=>e.page()))).filter(e=>!!e)}isIncognito(){return!!this._id}async overridePermissions(e,t){const i=new Map([["geolocation","geolocation"],["midi","midi"],["notifications","notifications"],["camera","videoCapture"],["microphone","audioCapture"],["background-sync","backgroundSync"],["ambient-light-sensor","sensors"],["accelerometer","sensors"],["gyroscope","sensors"],["magnetometer","sensors"],["accessibility-events","accessibilityEvents"],["clipboard-read","clipboardReadWrite"],["clipboard-write","clipboardReadWrite"],["payment-handler","paymentHandler"],["idle-detection","idleDetection"],["midi-sysex","midiSysex"]]),s=t.map(e=>{const t=i.get(e);if(!t)throw new Error("Unknown permission: "+e);return t});await this._connection.send("Browser.grantPermissions",{origin:e,browserContextId:this._id||void 0,permissions:s})}async clearPermissionOverrides(){await this._connection.send("Browser.resetPermissions",{browserContextId:this._id||void 0})}newPage(){return this._browser._createPageInContext(this._id)}browser(){return this._browser}async close(){e(this._id,"Non-incognito profiles cannot be closed!"),await this._browser._disposeContext(this._id)}}export{xe as Browser,r as Connection};
