import{Settings as e,UIString as t,Throttler as i,Progress as s,ResourceType as r,ObjectWrapper as o,Color as n,ParsedURL as a,StringOutputStream as l,Console as d}from"../common/common.js";import{InspectorFrontendHost as c,userMetrics as h,UserMetrics as u,Platform as m}from"../host/host.js";import{BinaryResourceViewFactory as _,ResourceSourceFrame as p,JSONView as g,PreviewFactory as w}from"../source_frame/source_frame.js";import{Widget as C,Toolbar as S,ListWidget as f,UIUtils as v,ARIAUtils as b,SettingsUI as k,EmptyWidget as T,Icon as y,TreeOutline as R,ContextMenu as I,XLink as q,View as L,Utils as x,SplitWidget as F,TabbedPane as E,PopoverHelper as P,Dialog as M,GlassPane as H,FilterBar as U,FilterSuggestionBuilder as B,DropTarget as N,ShortcutRegistry as V,ViewManager as A,ProgressIndicator as W,Panel as O,ActionRegistry as D,Context as G,InspectorView as z}from"../ui/ui.js";import{NetworkManager as K,SDKModel as j,NetworkRequest as $,HARLog as X,CookieParser as Q,Issue as J,RemoteObject as Z,NetworkLog as Y,ResourceTreeModel as ee,Resource as te,FilmStripModel as ie,TracingManager as se,TracingModel as re}from"../sdk/sdk.js";import{SortableDataGrid as oe,DataGrid as ne,ViewportDataGrid as ae}from"../data_grid/data_grid.js";import{StringUtilities as le,NumberUtilities as de}from"../platform/platform.js";import{ThrottlingManager as ce}from"../mobile_throttling/mobile_throttling.js";import{ResourceUtils as he,FileUtils as ue,TempFile as me}from"../bindings/bindings.js";import{Linkifier as _e,JSPresentationUtils as pe}from"../components/components.js";import{NetworkPriorities as ge,TimelineGrid as we,TimelineOverviewPane as Ce,FilmStripView as Se}from"../perf_ui/perf_ui.js";import{Workspace as fe,UISourceCode as ve}from"../workspace/workspace.js";import{CookiesTable as be}from"../cookie_table/cookie_table.js";import{RelatedIssue as ke}from"../browser_sdk/browser_sdk.js";import{parseClientVariations as Te,formatClientVariations as ye}from"../client_variations/client_variations.js";import{ObjectPropertiesSection as Re}from"../object_ui/object_ui.js";import{ContentProvider as Ie,StaticContentProvider as qe,TextUtils as Le}from"../text_utils/text_utils.js";import{HARFormat as xe,HARImporter as Fe}from"../har_importer/har_importer.js";import{ThemeSupport as Ee}from"../theme_support/theme_support.js";import{SearchView as Pe}from"../search/search.js";class Me extends C.VBox{constructor(t,i,s){super(),this.registerRequiredCSS("network/binaryResourceView.css",{enableLegacyPatching:!0}),this._binaryResourceViewFactory=new _.BinaryResourceViewFactory(t,i,s),this._toolbar=new S.Toolbar("binary-view-toolbar",this.element),this._binaryViewObjects=[new He("base64",ls`Base64`,ls`Copied as Base64`,this._binaryResourceViewFactory.createBase64View.bind(this._binaryResourceViewFactory),this._binaryResourceViewFactory.base64.bind(this._binaryResourceViewFactory)),new He("hex",ls`Hex Viewer`,ls`Copied as Hex`,this._binaryResourceViewFactory.createHexView.bind(this._binaryResourceViewFactory),this._binaryResourceViewFactory.hex.bind(this._binaryResourceViewFactory)),new He("utf8",ls`UTF-8`,ls`Copied as UTF-8`,this._binaryResourceViewFactory.createUtf8View.bind(this._binaryResourceViewFactory),this._binaryResourceViewFactory.utf8.bind(this._binaryResourceViewFactory))],this._binaryViewTypeSetting=e.Settings.instance().createSetting("binaryViewType","hex"),this._binaryViewTypeCombobox=new S.ToolbarComboBox(this._binaryViewTypeChanged.bind(this),ls`Binary view type`);for(const e of this._binaryViewObjects)this._binaryViewTypeCombobox.addOption(this._binaryViewTypeCombobox.createOption(e.label,e.type));this._toolbar.appendToolbarItem(this._binaryViewTypeCombobox);const r=new S.ToolbarButton(ls`Copy to clipboard`,"largeicon-copy");r.addEventListener(S.ToolbarButton.Events.Click,e=>{this._copySelectedViewToClipboard()},this),this._toolbar.appendToolbarItem(r),this._copiedText=new S.ToolbarText,this._copiedText.element.classList.add("binary-view-copied-text"),this._toolbar.element.appendChild(this._copiedText.element),this._addFadeoutSettimeoutId=null,this._lastView=null,this._updateView()}_getCurrentViewObject(){const e=this._binaryViewObjects.find(e=>e.type===this._binaryViewTypeSetting.get());return console.assert(!!e,"No binary view found for binary view type found in setting 'binaryViewType': "+this._binaryViewTypeSetting.get()),e||null}async _copySelectedViewToClipboard(){const e=this._getCurrentViewObject();e&&(c.InspectorFrontendHostInstance.copyText((await e.content()).content),this._copiedText.setText(e.copiedMessage),this._copiedText.element.classList.remove("fadeout"),this._addFadeoutSettimeoutId&&(clearTimeout(this._addFadeoutSettimeoutId),this._addFadeoutSettimeoutId=null),this._addFadeoutSettimeoutId=window.setTimeout(function(){this._copiedText.element.classList.add("fadeout")}.bind(this),2e3))}wasShown(){this._updateView()}_updateView(){const e=this._getCurrentViewObject();if(!e)return;const t=e.getView();t!==this._lastView&&(this._lastView&&this._lastView.detach(),this._lastView=t,t.show(this.element,this._toolbar.element),this._binaryViewTypeCombobox.selectElement().value=this._binaryViewTypeSetting.get())}_binaryViewTypeChanged(){const e=this._binaryViewTypeCombobox.selectedOption();if(!e)return;const t=e.value;this._binaryViewTypeSetting.get()!==t&&(this._binaryViewTypeSetting.set(t),this._updateView())}addCopyToContextMenu(e,t){const i=e.clipboardSection().appendSubMenuItem(t).footerSection();i.appendItem(ls`Copy as Base64`,async()=>{const e=await this._binaryResourceViewFactory.base64();c.InspectorFrontendHostInstance.copyText(e.content)}),i.appendItem(ls`Copy as Hex`,async()=>{const e=await this._binaryResourceViewFactory.hex();c.InspectorFrontendHostInstance.copyText(e.content)}),i.appendItem(ls`Copy as UTF-8`,async()=>{const e=await this._binaryResourceViewFactory.utf8();c.InspectorFrontendHostInstance.copyText(e.content)})}}class He{constructor(e,t,i,s,r){this.type=e,this.label=t,this.copiedMessage=i,this.content=r,this._createViewFn=s,this._view=null}getView(){return this._view||(this._view=this._createViewFn()),this._view}}var Ue=Object.freeze({__proto__:null,BinaryResourceView:Me,BinaryViewObject:He});let Be=null;class Ne extends C.VBox{constructor(){super(!0),this.registerRequiredCSS("network/blockedURLsPane.css",{enableLegacyPatching:!0}),Be=this,this._manager=K.MultitargetNetworkManager.instance(),this._manager.addEventListener(K.MultitargetNetworkManager.Events.BlockedPatternsChanged,()=>{this._update()},this),this._toolbar=new S.Toolbar("",this.contentElement),this._enabledCheckbox=new S.ToolbarCheckbox(t.UIString("Enable network request blocking"),void 0,this._toggleEnabled.bind(this)),this._toolbar.appendToolbarItem(this._enabledCheckbox),this._toolbar.appendSeparator();const e=new S.ToolbarButton(t.UIString("Add pattern"),"largeicon-add");e.addEventListener(S.ToolbarButton.Events.Click,this._addButtonClicked,this),this._toolbar.appendToolbarItem(e);const s=new S.ToolbarButton(t.UIString("Remove all patterns"),"largeicon-clear");s.addEventListener(S.ToolbarButton.Events.Click,this._removeAll,this),this._toolbar.appendToolbarItem(s),this._list=new f.ListWidget(this),this._list.element.classList.add("blocked-urls"),this._list.registerRequiredCSS("network/blockedURLsPane.css",{enableLegacyPatching:!0}),this._list.setEmptyPlaceholder(this._createEmptyPlaceholder()),this._list.show(this.contentElement),this._editor=null,this._blockedCountForUrl=new Map,j.TargetManager.instance().addModelListener(K.NetworkManager,K.Events.RequestFinished,this._onRequestFinished,this),this._updateThrottler=new i.Throttler(200),this._update()}_createEmptyPlaceholder(){const e=this.contentElement.createChild("div","no-blocked-urls"),t=v.createTextButton(ls`Add pattern`,this._addButtonClicked.bind(this),"add-button");return b.setAccessibleName(t,ls`Add network request blocking pattern`),e.appendChild(v.formatLocalized("Network requests are not blocked. %s",[t])),e}static reset(){Be&&Be.reset()}_addButtonClicked(){this._manager.setBlockingEnabled(!0),this._list.addNewItem(0,{url:"",enabled:!0})}renderItem(e,i){const s=this._blockedRequestsCount(e.url),r=document.createElement("div");r.classList.add("blocked-url");const o=r.createChild("input","blocked-url-checkbox");return o.type="checkbox",o.checked=e.enabled,o.disabled=!this._manager.blockingEnabled(),r.createChild("div","blocked-url-label").textContent=e.url,r.createChild("div","blocked-url-count").textContent=t.UIString("%d blocked",s),r.addEventListener("click",t=>this._togglePattern(e,t),!1),o.addEventListener("click",t=>this._togglePattern(e,t),!1),r}_togglePattern(e,t){t.consume(!0);const i=this._manager.blockedPatterns();i.splice(i.indexOf(e),1,{enabled:!e.enabled,url:e.url}),this._manager.setBlockedPatterns(i)}_toggleEnabled(){this._manager.setBlockingEnabled(!this._manager.blockingEnabled()),this._update()}removeItemRequested(e,t){const i=this._manager.blockedPatterns();i.splice(t,1),this._manager.setBlockedPatterns(i)}beginEdit(e){return this._editor=this._createEditor(),this._editor.control("url").value=e.url,this._editor}commitEdit(e,t,i){const s=t.control("url").value,r=this._manager.blockedPatterns();i?r.push({enabled:!0,url:s}):r.splice(r.indexOf(e),1,{enabled:!0,url:s}),this._manager.setBlockedPatterns(r)}_createEditor(){if(this._editor)return this._editor;const e=new f.Editor,i=e.contentElement();i.createChild("div","blocked-url-edit-row").createChild("div").textContent=t.UIString("Text pattern to block matching requests; use * for wildcard");const s=i.createChild("div","blocked-url-edit-row"),r=e.createInput("url","text","",(e,t,i)=>{let s,r=!0;return i.value?this._manager.blockedPatterns().find(e=>e.url===i.value)&&(s=ls`Pattern already exists.`,r=!1):(s=ls`Pattern input cannot be empty.`,r=!1),{valid:r,errorMessage:s}});return s.createChild("div","blocked-url-edit-value").appendChild(r),e}_removeAll(){this._manager.setBlockedPatterns([])}_update(){const e=this._manager.blockingEnabled();this._list.element.classList.toggle("blocking-disabled",!e&&!!this._manager.blockedPatterns().length),this._enabledCheckbox.setChecked(e),this._list.clear();for(const e of this._manager.blockedPatterns())this._list.appendItem(e,!0);return Promise.resolve()}_blockedRequestsCount(e){if(!e)return 0;let t=0;for(const i of this._blockedCountForUrl.keys())this._matches(e,i)&&(t+=this._blockedCountForUrl.get(i));return t}_matches(e,t){let i=0;const s=e.split("*");for(let e=0;e<s.length;e++){const r=s[e];if(r.length){if(i=t.indexOf(r,i),-1===i)return!1;i+=r.length}}return!0}reset(){this._blockedCountForUrl.clear(),this._updateThrottler.schedule(this._update.bind(this))}_onRequestFinished(e){const t=e.data;if(t.wasBlocked()){const e=this._blockedCountForUrl.get(t.url())||0;this._blockedCountForUrl.set(t.url(),e+1),this._updateThrottler.schedule(this._update.bind(this))}}}var Ve=Object.freeze({__proto__:null,get _instance(){return Be},BlockedURLsPane:Ne});class Ae extends C.VBox{constructor(e){super(),this.registerRequiredCSS("network/eventSourceMessagesView.css",{enableLegacyPatching:!0}),this.element.classList.add("event-source-messages-view"),this._request=e;const i=[{id:"id",title:t.UIString("Id"),sortable:!0,weight:8},{id:"type",title:t.UIString("Type"),sortable:!0,weight:8},{id:"data",title:t.UIString("Data"),sortable:!1,weight:88},{id:"time",title:t.UIString("Time"),sortable:!0,weight:8}];this._dataGrid=new oe.SortableDataGrid({displayName:ls`Event Source`,columns:i,editCallback:void 0,deleteCallback:void 0,refreshCallback:void 0}),this._dataGrid.setStriped(!0),this._dataGrid.setStickToBottom(!0),this._dataGrid.setRowContextMenuCallback(this._onRowContextMenu.bind(this)),this._dataGrid.markColumnAsSortedBy("time",ne.Order.Ascending),this._sortItems(),this._dataGrid.addEventListener(ne.Events.SortingChanged,this._sortItems,this),this._dataGrid.setName("EventSourceMessagesView"),this._dataGrid.asWidget().show(this.element)}wasShown(){this._dataGrid.rootNode().removeChildren();const e=this._request.eventSourceMessages();for(let t=0;t<e.length;++t)this._dataGrid.insertChild(new We(e[t]));this._request.addEventListener($.Events.EventSourceMessageAdded,this._messageAdded,this)}willHide(){this._request.removeEventListener($.Events.EventSourceMessageAdded,this._messageAdded,this)}_messageAdded(e){const t=e.data;this._dataGrid.insertChild(new We(t))}_sortItems(){const e=this._dataGrid.sortColumnId();if(!e)return;const t=De[e];t&&this._dataGrid.sortNodes(t,!this._dataGrid.isSortOrderAscending())}_onRowContextMenu(e,i){e.clipboardSection().appendItem(t.UIString("Copy message"),c.InspectorFrontendHostInstance.copyText.bind(c.InspectorFrontendHostInstance,i.data.data))}}class We extends oe.SortableDataGridNode{constructor(e){const t=new Date(1e3*e.time),i=("0"+t.getHours()).substr(-2)+":"+("0"+t.getMinutes()).substr(-2)+":"+("0"+t.getSeconds()).substr(-2)+"."+("00"+t.getMilliseconds()).substr(-3),s=document.createElement("div");v.createTextChild(s,i),s.title=t.toLocaleString(),super({id:e.eventId,type:e.eventName,data:e.data,time:s}),this._message=e}}function Oe(e,t,i){const s=e(t._message),r=e(i._message);return s<r?-1:s>r?1:0}const De={id:Oe.bind(null,e=>e.eventId),type:Oe.bind(null,e=>e.eventName),time:Oe.bind(null,e=>e.time)};var Ge=Object.freeze({__proto__:null,EventSourceMessagesView:Ae,EventSourceMessageNode:We,EventSourceMessageNodeComparator:Oe,Comparators:De});class ze{static async write(e,t,i){const r=new s.CompositeProgress(i),o=await ze._harStringForRequests(t,r);i.isCanceled()||await ze._writeToStream(e,r,o)}static async _harStringForRequests(e,i){const s=i.createSubProgress();s.setTitle(t.UIString("Collecting content…")),s.setTotalWork(e.length);const r=await X.HARLog.build(e),o=[];for(let t=0;t<e.length;t++){const i=e[t].contentData();o.push(i.then(n.bind(null,r.entries[t])))}return await Promise.all(o),s.done(),s.isCanceled()?"":JSON.stringify({log:r},null,Ke);function n(e,t){s.worked();let i=t.encoded;if(null!==t.content){let s=t.content;s&&!i&&function(e){for(let i=0;i<e.length;i++)if(!((t=e.charCodeAt(i))<55296||t>=57344&&t<64976||t>65007&&t<=1114111&&65534!=(65534&t)))return!0;var t;return!1}(s)&&(s=le.toBase64(s),i=!0),e.response.content.text=s}i&&(e.response.content.encoding="base64")}}static async _writeToStream(e,i,s){const r=i.createSubProgress();r.setTitle(t.UIString("Writing file…")),r.setTotalWork(s.length);for(let t=0;t<s.length&&!r.isCanceled();t+=je){const i=s.substr(t,je);await e.write(i),r.worked(i.length)}r.done()}}const Ke=2,je=1e5;var $e=Object.freeze({__proto__:null,HARWriter:ze,_jsonIndent:Ke,_chunkSize:je});class Xe extends C.VBox{constructor(){super(!0),this.registerRequiredCSS("network/networkConfigView.css",{enableLegacyPatching:!0}),this.contentElement.classList.add("network-config"),this._createCacheSection(),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._createNetworkThrottlingSection(),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._createUserAgentSection()}static createUserAgentSelectAndInput(i){const s=e.Settings.instance().createSetting("customUserAgent",""),r=document.createElement("select");b.setAccessibleName(r,i);const o={title:t.UIString("Custom..."),value:"custom"};r.appendChild(new Option(o.title,o.value));for(const e of Qe){const t=r.createChild("optgroup");t.label=e.title;for(const i of e.values){const e=K.MultitargetNetworkManager.patchUserAgentWithChromeVersion(i.value);t.appendChild(new Option(i.title,e))}}r.selectedIndex=0;const n=v.createInput("","text");n.value=s.get(),n.title=s.get(),n.placeholder=t.UIString("Enter a custom user agent"),n.required=!0,b.setAccessibleName(n,n.placeholder);const a=document.createElement("div");function l(){const e=s.get(),t=r.options;let i=!1;for(let s=0;s<t.length;++s)if(t[s].value===e){r.selectedIndex=s,i=!0;break}i||(r.selectedIndex=0)}return a.classList.add("network-config-input-validation-error"),b.markAsAlert(a),n.value||(a.textContent=ls`Custom user agent field is required`),l(),r.addEventListener("change",(function(){const e=r.options[r.selectedIndex].value;e!==o.value?(s.set(e),n.value=e,n.title=e):n.select();a.textContent=""}),!1),n.addEventListener("input",(function(){s.get()!==n.value&&(n.value?a.textContent="":a.textContent=ls`Custom user agent field is required`,s.set(n.value),n.title=n.value,l())}),!1),{select:r,input:n,error:a}}_createSection(e,t){const i=this.contentElement.createChild("section","network-config-group");return t&&i.classList.add(t),i.createChild("div","network-config-title").textContent=e,i.createChild("div","network-config-fields")}_createCacheSection(){this._createSection(t.UIString("Caching"),"network-config-disable-cache").appendChild(k.createSettingCheckbox(t.UIString("Disable cache"),e.Settings.instance().moduleSetting("cacheDisabled"),!0))}_createNetworkThrottlingSection(){const e=ls`Network throttling`,t=this._createSection(e,"network-config-throttling").createChild("select","chrome-select");ce.throttlingManager().decorateSelectWithNetworkThrottling(t),b.setAccessibleName(t,e)}_createUserAgentSection(){const i=ls`User agent`,s=this._createSection(i,"network-config-ua"),r=v.CheckboxLabel.create(t.UIString("Select automatically"),!0);s.appendChild(r);const o=r.checkboxElement,n=e.Settings.instance().createSetting("customUserAgent","");n.addChangeListener(()=>{o.checked||K.MultitargetNetworkManager.instance().setCustomUserAgentOverride(n.get())});const a=s.createChild("div","network-config-ua-custom");o.addEventListener("change",d);const l=Xe.createUserAgentSelectAndInput(i);function d(){const e=!o.checked;a.classList.toggle("checked",e),l.select.disabled=!e,l.input.disabled=!e,l.error.hidden=!e;const t=e?n.get():"";K.MultitargetNetworkManager.instance().setCustomUserAgentOverride(t)}l.select.classList.add("chrome-select"),a.appendChild(l.select),a.appendChild(l.input),a.appendChild(l.error),d()}}const Qe=[{title:ls`Android`,values:[{title:ls`Android (4.0.2) Browser \u2014 Galaxy Nexus`,value:"Mozilla/5.0 (Linux; U; Android 4.0.2; en-us; Galaxy Nexus Build/ICL53F) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30"},{title:ls`Android (2.3) Browser \u2014 Nexus S`,value:"Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1"}]},{title:ls`BlackBerry`,values:[{title:ls`BlackBerry \u2014 BB10`,value:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.1+ (KHTML, like Gecko) Version/10.0.0.1337 Mobile Safari/537.1+"},{title:ls`BlackBerry \u2014 PlayBook 2.1`,value:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML, like Gecko) Version/7.2.1.0 Safari/536.2+"},{title:ls`BlackBerry \u2014 9900`,value:"Mozilla/5.0 (BlackBerry; U; BlackBerry 9900; en-US) AppleWebKit/534.11+ (KHTML, like Gecko) Version/7.0.0.187 Mobile Safari/534.11+"}]},{title:ls`Chrome`,values:[{title:ls`Chrome \u2014 Android Mobile`,value:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Mobile Safari/537.36"},{title:ls`Chrome \u2014 Android Mobile (high-end)`,value:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Mobile Safari/537.36"},{title:ls`Chrome \u2014 Android Tablet`,value:"Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Safari/537.36"},{title:ls`Chrome \u2014 iPhone`,value:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/%s Mobile/15E148 Safari/604.1"},{title:ls`Chrome \u2014 iPad`,value:"Mozilla/5.0 (iPad; CPU OS 13_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/%s Mobile/15E148 Safari/604.1"},{title:ls`Chrome \u2014 Chrome OS`,value:"Mozilla/5.0 (X11; CrOS x86_64 10066.0.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Safari/537.36"},{title:ls`Chrome \u2014 Mac`,value:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Safari/537.36"},{title:ls`Chrome \u2014 Windows`,value:"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Safari/537.36"}]},{title:ls`Firefox`,values:[{title:ls`Firefox \u2014 Android Mobile`,value:"Mozilla/5.0 (Android 4.4; Mobile; rv:70.0) Gecko/70.0 Firefox/70.0"},{title:ls`Firefox \u2014 Android Tablet`,value:"Mozilla/5.0 (Android 4.4; Tablet; rv:70.0) Gecko/70.0 Firefox/70.0"},{title:ls`Firefox \u2014 iPhone`,value:"Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) FxiOS/1.0 Mobile/12F69 Safari/600.1.4"},{title:ls`Firefox \u2014 iPad`,value:"Mozilla/5.0 (iPad; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) FxiOS/1.0 Mobile/12F69 Safari/600.1.4"},{title:ls`Firefox \u2014 Mac`,value:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:70.0) Gecko/20100101 Firefox/70.0"},{title:ls`Firefox \u2014 Windows`,value:"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:70.0) Gecko/20100101 Firefox/70.0"}]},{title:ls`Googlebot`,values:[{title:ls`Googlebot`,value:"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"},{title:ls`Googlebot Desktop`,value:"Mozilla/5.0 AppleWebKit/537.36 (KHTML, like Gecko; compatible; Googlebot/2.1; +http://www.google.com/bot.html) Chrome/%s Safari/537.36"},{title:ls`Googlebot Smartphone`,value:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"}]},{title:ls`Internet Explorer`,values:[{title:ls`Internet Explorer 11`,value:"Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"},{title:ls`Internet Explorer 10`,value:"Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)"},{title:ls`Internet Explorer 9`,value:"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)"},{title:ls`Internet Explorer 8`,value:"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"},{title:ls`Internet Explorer 7`,value:"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)"}]},{title:ls`Microsoft Edge`,values:[{title:ls`Microsoft Edge (Chromium) \u2014 Windows`,value:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Safari/537.36 Edg/%s"},{title:ls`Microsoft Edge (Chromium) \u2014 Mac`,value:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Chrome/%s Safari/604.1 Edg/%s"},{title:ls`Microsoft Edge \u2014 iPhone`,value:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 EdgiOS/44.5.0.10 Mobile/15E148 Safari/604.1"},{title:ls`Microsoft Edge \u2014 iPad`,value:"Mozilla/5.0 (iPad; CPU OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 EdgiOS/44.5.2 Mobile/15E148 Safari/605.1.15"},{title:ls`Microsoft Edge \u2014 Android Mobile`,value:"Mozilla/5.0 (Linux; Android 8.1.0; Pixel Build/OPM4.171019.021.D1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.109 Mobile Safari/537.36 EdgA/42.0.0.2057"},{title:ls`Microsoft Edge \u2014 Android Tablet`,value:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.109 Safari/537.36 EdgA/42.0.0.2057"},{title:ls`Microsoft Edge (EdgeHTML) \u2014 Windows`,value:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36 Edge/18.18362"},{title:ls`Microsoft Edge (EdgeHTML) \u2014 XBox`,value:"Mozilla/5.0 (Windows NT 10.0; Win64; x64; Xbox; Xbox One) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36 Edge/18.18362"}]},{title:ls`Opera`,values:[{title:ls`Opera \u2014 Mac`,value:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.97 Safari/537.36 OPR/65.0.3467.48"},{title:ls`Opera \u2014 Windows`,value:"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.97 Safari/537.36 OPR/65.0.3467.48"},{title:ls`Opera (Presto) \u2014 Mac`,value:"Opera/9.80 (Macintosh; Intel Mac OS X 10.9.1) Presto/2.12.388 Version/12.16"},{title:ls`Opera (Presto) \u2014 Windows`,value:"Opera/9.80 (Windows NT 6.1) Presto/2.12.388 Version/12.16"},{title:ls`Opera Mobile \u2014 Android Mobile`,value:"Opera/12.02 (Android 4.1; Linux; Opera Mobi/ADR-1111101157; U; en-US) Presto/2.9.201 Version/12.02"},{title:ls`Opera Mini \u2014 iOS`,value:"Opera/9.80 (iPhone; Opera Mini/8.0.0/34.2336; U; en) Presto/2.8.119 Version/11.10"}]},{title:ls`Safari`,values:[{title:ls`Safari \u2014 iPad iOS 13.2`,value:"Mozilla/5.0 (iPad; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1"},{title:ls`Safari \u2014 iPhone iOS 13.2`,value:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1"},{title:ls`Safari \u2014 Mac`,value:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Safari/605.1.15"}]},{title:ls`UC Browser`,values:[{title:ls`UC Browser \u2014 Android Mobile`,value:"Mozilla/5.0 (Linux; U; Android 8.1.0; en-US; Nexus 6P Build/OPM7.181205.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.108 UCBrowser/12.11.1.1197 Mobile Safari/537.36"},{title:ls`UC Browser \u2014 iOS`,value:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/16B92 UCBrowser/12.1.7.1109 Mobile AliApp(TUnionSDK/0.1.20.3)"},{title:ls`UC Browser \u2014 Windows Phone`,value:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 920) UCBrowser/10.1.0.563 Mobile"}]}];var Je=Object.freeze({__proto__:null,NetworkConfigView:Xe,userAgentGroups:Qe});class Ze extends C.Widget{constructor(i){super(),this.registerRequiredCSS("network/requestCookiesView.css",{enableLegacyPatching:!0}),this.element.classList.add("request-cookies-view"),this._request=i,this._showFilteredOutCookiesSetting=e.Settings.instance().createSetting("show-filtered-out-request-cookies",!1),this._emptyWidget=new T.EmptyWidget(t.UIString("This request has no cookies.")),this._emptyWidget.show(this.element),this._requestCookiesTitle=this.element.createChild("div");const s=this._requestCookiesTitle.createChild("span","request-cookies-title");s.textContent=ls`Request Cookies`,s.title=ls`Cookies that were sent to the server in the 'cookie' header of the request`;const r=k.createSettingCheckbox(ls`show filtered out request cookies`,this._showFilteredOutCookiesSetting,!0);r.checkboxElement.addEventListener("change",()=>{this._refreshRequestCookiesView()}),this._requestCookiesTitle.appendChild(r),this._requestCookiesEmpty=this.element.createChild("div","cookies-panel-item"),this._requestCookiesEmpty.textContent=ls`No request cookies were sent.`,this._requestCookiesTable=new be.CookiesTable(!0),this._requestCookiesTable.contentElement.classList.add("cookie-table","cookies-panel-item"),this._requestCookiesTable.show(this.element),this._responseCookiesTitle=this.element.createChild("div","request-cookies-title"),this._responseCookiesTitle.textContent=ls`Response Cookies`,this._responseCookiesTitle.title=ls`Cookies that were received from the server in the 'set-cookie' header of the response`,this._responseCookiesTable=new be.CookiesTable(!0),this._responseCookiesTable.contentElement.classList.add("cookie-table","cookies-panel-item"),this._responseCookiesTable.show(this.element),this._malformedResponseCookiesTitle=this.element.createChild("div","request-cookies-title"),this._malformedResponseCookiesTitle.textContent=ls`Malformed Response Cookies`,this._malformedResponseCookiesTitle.title=ls`Cookies that were received from the server in the 'set-cookie' header of the response but were malformed`,this._malformedResponseCookiesList=this.element.createChild("div")}_getRequestCookies(){const e=new Map,t=this._request.includedRequestCookies().slice();if(this._showFilteredOutCookiesSetting.get())for(const i of this._request.blockedRequestCookies())e.set(i.cookie,i.blockedReasons.map(e=>({attribute:$.cookieBlockedReasonToAttribute(e),uiString:$.cookieBlockedReasonToUiString(e)}))),t.push(i.cookie);return{requestCookies:t,requestCookieToBlockedReasons:e}}_getResponseCookies(){let e=[];const t=new Map,i=[];if(this._request.responseCookies.length){const s=this._request.blockedResponseCookies().map(e=>e.cookieLine);e=this._request.responseCookies.filter(e=>{const t=s.indexOf(e.getCookieLine());return-1===t||(s[t]=null,!1)});for(const s of this._request.blockedResponseCookies()){const r=Q.CookieParser.parseSetCookie(s.cookieLine);if(r&&!r.length||s.blockedReasons.includes(Protocol.Network.SetCookieBlockedReason.SyntaxError)){i.push(s);continue}let o=s.cookie;!o&&r&&(o=r[0]),o&&(t.set(o,s.blockedReasons.map(e=>({attribute:$.setCookieBlockedReasonToAttribute(e),uiString:$.setCookieBlockedReasonToUiString(e)}))),e.push(o))}}return{responseCookies:e,responseCookieToBlockedReasons:t,malformedResponseCookies:i}}_refreshRequestCookiesView(){if(!this.isShowing())return;this._request.hasRequestCookies()||this._request.responseCookies.length?this._emptyWidget.hideWidget():this._emptyWidget.showWidget();const{requestCookies:e,requestCookieToBlockedReasons:t}=this._getRequestCookies(),{responseCookies:i,responseCookieToBlockedReasons:s,malformedResponseCookies:r}=this._getResponseCookies();if(e.length?(this._requestCookiesTitle.classList.remove("hidden"),this._requestCookiesEmpty.classList.add("hidden"),this._requestCookiesTable.showWidget(),this._requestCookiesTable.setCookies(e,t)):this._request.blockedRequestCookies().length?(this._requestCookiesTitle.classList.remove("hidden"),this._requestCookiesEmpty.classList.remove("hidden"),this._requestCookiesTable.hideWidget()):(this._requestCookiesTitle.classList.add("hidden"),this._requestCookiesEmpty.classList.add("hidden"),this._requestCookiesTable.hideWidget()),i.length?(this._responseCookiesTitle.classList.remove("hidden"),this._responseCookiesTable.showWidget(),this._responseCookiesTable.setCookies(i,s)):(this._responseCookiesTitle.classList.add("hidden"),this._responseCookiesTable.hideWidget()),r.length){this._malformedResponseCookiesTitle.classList.remove("hidden"),this._malformedResponseCookiesList.classList.remove("hidden"),this._malformedResponseCookiesList.removeChildren();for(const e of r){const t=this._malformedResponseCookiesList.createChild("span","cookie-line source-code"),i=y.Icon.create("smallicon-error","cookie-warning-icon");t.appendChild(i),v.createTextChild(t,e.cookieLine),t.title=$.setCookieBlockedReasonToUiString(Protocol.Network.SetCookieBlockedReason.SyntaxError)}}else this._malformedResponseCookiesTitle.classList.add("hidden"),this._malformedResponseCookiesList.classList.add("hidden")}wasShown(){this._request.addEventListener($.Events.RequestHeadersChanged,this._refreshRequestCookiesView,this),this._request.addEventListener($.Events.ResponseHeadersChanged,this._refreshRequestCookiesView,this),this._refreshRequestCookiesView()}willHide(){this._request.removeEventListener($.Events.RequestHeadersChanged,this._refreshRequestCookiesView,this),this._request.removeEventListener($.Events.ResponseHeadersChanged,this._refreshRequestCookiesView,this)}}var Ye=Object.freeze({__proto__:null,RequestCookiesView:Ze});class et extends C.VBox{constructor(e){super(),this.registerRequiredCSS("network/requestHeadersView.css",{enableLegacyPatching:!0}),this.element.classList.add("request-headers-view"),this._request=e,this._decodeRequestParameters=!0,this._showRequestHeadersText=!1,this._showResponseHeadersText=!1;const i=e.requestContentType();i&&(this._decodeRequestParameters=!!i.match(/^application\/x-www-form-urlencoded\s*(;.*)?$/i)),this._highlightedElement=null;const s=new R.TreeOutlineInShadow;s.registerRequiredCSS("object_ui/objectValue.css",{enableLegacyPatching:!0}),s.registerRequiredCSS("object_ui/objectPropertiesSection.css",{enableLegacyPatching:!0}),s.registerRequiredCSS("network/requestHeadersTree.css",{enableLegacyPatching:!0}),s.element.classList.add("request-headers-tree"),s.makeDense(),this.element.appendChild(s.element);const r=new st(s,"general",t.UIString("General"));r.hidden=!1,this._root=r,this.setDefaultFocusedElement(this._root.listItemElement),this._urlItem=r.createLeaf(),this._requestMethodItem=r.createLeaf(),this._statusCodeItem=r.createLeaf(),this._remoteAddressItem=r.createLeaf(),this._remoteAddressItem.hidden=!0,this._referrerPolicyItem=r.createLeaf(),this._referrerPolicyItem.hidden=!0,this._responseHeadersCategory=new st(s,"responseHeaders",""),this._requestHeadersCategory=new st(s,"requestHeaders",""),this._queryStringCategory=new st(s,"queryString",""),this._formDataCategory=new st(s,"formData",""),this._requestPayloadCategory=new st(s,"requestPayload",t.UIString("Request Payload"))}wasShown(){this._clearHighlight(),this._request.addEventListener($.Events.RemoteAddressChanged,this._refreshRemoteAddress,this),this._request.addEventListener($.Events.RequestHeadersChanged,this._refreshRequestHeaders,this),this._request.addEventListener($.Events.ResponseHeadersChanged,this._refreshResponseHeaders,this),this._request.addEventListener($.Events.FinishedLoading,this._refreshHTTPInformation,this),this._refreshURL(),this._refreshQueryString(),this._refreshRequestHeaders(),this._refreshResponseHeaders(),this._refreshHTTPInformation(),this._refreshRemoteAddress(),this._refreshReferrerPolicy(),this._root.select(!0,!1)}willHide(){this._request.removeEventListener($.Events.RemoteAddressChanged,this._refreshRemoteAddress,this),this._request.removeEventListener($.Events.RequestHeadersChanged,this._refreshRequestHeaders,this),this._request.removeEventListener($.Events.ResponseHeadersChanged,this._refreshResponseHeaders,this),this._request.removeEventListener($.Events.FinishedLoading,this._refreshHTTPInformation,this)}_addEntryContextMenuHandler(e,t){e.listItemElement.addEventListener("contextmenu",e=>{e.consume(!0);const i=new I.ContextMenu(e),s=decodeURIComponent(t);i.clipboardSection().appendItem(ls`Copy value`,()=>{h.actionTaken(u.Action.NetworkPanelCopyValue),c.InspectorFrontendHostInstance.copyText(s)}),i.show()})}_formatHeader(e,t){const i=document.createDocumentFragment();return i.createChild("div","header-name").textContent=e+": ",i.createChild("span","header-separator"),i.createChild("div","header-value source-code").textContent=t,i}_formatHeaderObject(e){const t=document.createDocumentFragment();e.headerNotSet&&(t.createChild("div","header-badge header-badge-text").textContent="not-set");const i=e.value?": ":"";if(t.createChild("div","header-name").textContent=e.name+i,t.createChild("span","header-separator"),e.value&&(e.headerValueIncorrect?t.createChild("div","header-value source-code header-warning").textContent=e.value.toString():t.createChild("div","header-value source-code").textContent=e.value.toString()),e.details){const i=t.createChild("div","header-details").createChild("div","call-to-action").createChild("div","call-to-action-body");i.createChild("div","explanation").textContent=e.details.explanation;for(const t of e.details.examples){const e=i.createChild("div","example");e.createChild("code").textContent=t.codeSnippet,t.comment&&(e.createChild("span","comment").textContent=t.comment)}if(ke.hasIssueOfCategory(this._request,J.IssueCategory.CrossOriginEmbedderPolicy)){const e=document.createElement("div");e.classList.add("devtools-link"),e.onclick=()=>{h.issuesPanelOpenedFrom(u.IssueOpener.LearnMoreLinkCOEP),ke.reveal(this._request,J.IssueCategory.CrossOriginEmbedderPolicy)};const t=document.createElement("span");t.classList.add("devtools-link"),t.textContent=ls`Learn more in the issues tab`,e.appendChild(t),e.prepend(y.Icon.create("largeicon-breaking-change","icon")),i.appendChild(e)}else if(e.details.link){const t=q.XLink.create(e.details.link.url,ls`Learn more`,"link");t.prepend(y.Icon.create("largeicon-link")),i.appendChild(t)}}return t}_formatParameter(e,i,s){let r=!1;if(s&&(e=e.replace(/\+/g," ")).indexOf("%")>=0)try{e=decodeURIComponent(e)}catch(e){r=!0}const o=document.createElement("div");return i&&(o.className=i),""===e&&o.classList.add("empty-value"),r?o.createChild("span","header-decode-error").textContent=t.UIString("(unable to decode value)"):o.textContent=e,o}_refreshURL(){this._urlItem.title=this._formatHeader(t.UIString("Request URL"),this._request.url())}_refreshQueryString(){const e=this._request.queryString(),i=this._request.queryParameters;this._queryStringCategory.hidden=!i,i&&this._refreshParams(t.UIString("Query String Parameters"),i,e,this._queryStringCategory)}async _refreshFormData(){const e=await this._request.requestFormData();if(!e)return this._formDataCategory.hidden=!0,void(this._requestPayloadCategory.hidden=!0);const i=await this._request.formParameters();if(i)this._formDataCategory.hidden=!1,this._requestPayloadCategory.hidden=!0,this._refreshParams(t.UIString("Form Data"),i,e,this._formDataCategory);else{this._requestPayloadCategory.hidden=!1,this._formDataCategory.hidden=!0;try{const t=JSON.parse(e);this._refreshRequestJSONPayload(t,e)}catch(t){this._populateTreeElementWithSourceText(this._requestPayloadCategory,e)}}}_populateTreeElementWithSourceText(e,i){const s=(i||"").trim(),r=s.length>3e3,o=document.createElement("span");o.classList.add("header-value"),o.classList.add("source-code"),o.textContent=r?s.substr(0,3e3):s;const n=new R.TreeElement(o);if(e.removeChildren(),e.appendChild(n),!r)return;const a=document.createElement("button");function l(){a.remove(),o.textContent=s,n.listItemElement.removeEventListener("contextmenu",d)}function d(e){const t=new I.ContextMenu(e);t.newSection().appendItem(ls`Show more`,l),t.show()}a.classList.add("request-headers-show-more-button"),a.textContent=t.UIString("Show more"),a.addEventListener("click",l),n.listItemElement.addEventListener("contextmenu",d),o.appendChild(a)}_refreshParams(e,i,s,r){r.removeChildren(),r.listItemElement.removeChildren(),r.listItemElement.createChild("div","selection fill"),v.createTextChild(r.listItemElement,e);const o=document.createElement("span");o.classList.add("header-count");const n=i?i.length:0;o.textContent=t.UIString(" (%d)",n),r.listItemElement.appendChild(o);tt.has(r)?this._appendParamsSource(e,i,s,r):this._appendParamsParsed(e,i,s,r)}_appendParamsSource(e,t,i,s){this._populateTreeElementWithSourceText(s,i);const r=s.listItemElement,o=function(o){r.removeEventListener("contextmenu",n),tt.delete(s),this._refreshParams(e,t,i,s),o.consume()},n=e=>{if(!s.expanded)return;const t=new I.ContextMenu(e);t.newSection().appendItem(ls`View parsed`,o.bind(this,e)),t.show()},a=this._createViewSourceToggle(!0,o.bind(this));r.appendChild(a),r.addEventListener("contextmenu",n)}_appendParamsParsed(e,i,s,r){for(const e of i||[]){const i=document.createDocumentFragment();if(""!==e.name){const t=this._formatParameter(e.name+": ","header-name",this._decodeRequestParameters),s=this._formatParameter(e.value,"header-value source-code",this._decodeRequestParameters);i.appendChild(t),i.createChild("span","header-separator"),i.appendChild(s)}else i.appendChild(this._formatParameter(t.UIString("(empty)"),"empty-request-header",this._decodeRequestParameters));const s=new R.TreeElement(i);this._addEntryContextMenuHandler(s,e.value),r.appendChild(s)}const o=r.listItemElement,n=function(t){o.removeEventListener("contextmenu",l),tt.add(r),this._refreshParams(e,i,s,r),t.consume()},a=function(e){o.removeEventListener("contextmenu",l),this._toggleURLDecoding(e)},l=e=>{if(!r.expanded)return;const t=new I.ContextMenu(e),i=t.newSection();i.appendItem(ls`View source`,n.bind(this,e));const s=this._decodeRequestParameters?ls`View URL encoded`:ls`View decoded`;i.appendItem(s,a.bind(this,e)),t.show()},d=this._createViewSourceToggle(!1,n.bind(this));o.appendChild(d);const c=this._decodeRequestParameters?ls`view URL encoded`:ls`view decoded`,h=this._createToggleButton(c);h.addEventListener("click",a.bind(this),!1),o.appendChild(h),o.addEventListener("contextmenu",l)}_refreshRequestJSONPayload(e,t){const i=this._requestPayloadCategory;i.removeChildren();const s=i.listItemElement;s.removeChildren(),s.createChild("div","selection fill"),v.createTextChild(s,this._requestPayloadCategory.title.toString()),tt.has(i)?this._appendJSONPayloadSource(i,e,t):this._appendJSONPayloadParsed(i,e,t)}_appendJSONPayloadSource(e,t,i){const s=e.listItemElement;this._populateTreeElementWithSourceText(e,i);const r=function(r){s.removeEventListener("contextmenu",n),tt.delete(e),this._refreshRequestJSONPayload(t,i),r.consume()},o=this._createViewSourceToggle(!0,r.bind(this));s.appendChild(o);const n=t=>{if(!e.expanded)return;const i=new I.ContextMenu(t);i.newSection().appendItem(ls`View parsed`,r.bind(this,t)),i.show()};s.addEventListener("contextmenu",n)}_appendJSONPayloadParsed(e,t,i){const s=Z.RemoteObject.fromLocalObject(t),r=new Re.RootElement(s);r.title=s.description,r.expand(),r.editable=!1,e.childrenListElement.classList.add("source-code","object-properties-section"),e.appendChild(r);const o=e.listItemElement,n=function(s){o.removeEventListener("contextmenu",a),tt.add(e),this._refreshRequestJSONPayload(t,i),s.consume()},a=t=>{if(!e.expanded)return;const i=new I.ContextMenu(t);i.newSection().appendItem(ls`View source`,n.bind(this,t)),i.show()},l=this._createViewSourceToggle(!1,n.bind(this));o.appendChild(l),o.addEventListener("contextmenu",a)}_createViewSourceToggle(e,i){const s=e?t.UIString("view parsed"):t.UIString("view source"),r=this._createToggleButton(s);return r.addEventListener("click",i,!1),r}_toggleURLDecoding(e){this._decodeRequestParameters=!this._decodeRequestParameters,this._refreshQueryString(),this._refreshFormData(),e.consume()}_refreshRequestHeaders(){const e=this._requestHeadersCategory,i=this._request.requestHeaders().slice();i.sort((function(e,t){return e.name.toLowerCase().compareTo(t.name.toLowerCase())}));const s=this._request.requestHeadersText();if(this._showRequestHeadersText&&s?this._refreshHeadersText(t.UIString("Request Headers"),i.length,s,e):this._refreshHeaders(t.UIString("Request Headers"),i,e,void 0===s),s){const t=this._createHeadersToggleButton(this._showRequestHeadersText);t.addEventListener("click",this._toggleRequestHeadersText.bind(this),!1),e.listItemElement.appendChild(t)}this._refreshFormData()}_refreshResponseHeaders(){const e=this._responseHeadersCategory,i=this._request.sortedResponseHeaders.slice(),s=this._request.responseHeadersText;if(this._showResponseHeadersText)this._refreshHeadersText(t.UIString("Response Headers"),i.length,s,e);else{const s=[];if(this._request.wasBlocked()){const e=rt.get(this._request.blockedReason());e&&s.push(e)}this._refreshHeaders(t.UIString("Response Headers"),function(e,t){let i=0,s=0;const r=[];for(;i<e.length||s<t.length;)i<e.length&&(s>=t.length||e[i].name<t[s].name)?r.push({...e[i++],headerNotSet:!1}):s<t.length&&(i>=e.length||e[i].name>t[s].name)?r.push({...t[s++],headerNotSet:!0}):i<e.length&&s<t.length&&e[i].name===t[s].name&&r.push({...t[s++],...e[i++],headerNotSet:!1});return r}(i,s),e,!1,this._request.blockedResponseCookies())}if(s){const t=this._createHeadersToggleButton(this._showResponseHeadersText);t.addEventListener("click",this._toggleResponseHeadersText.bind(this),!1),e.listItemElement.appendChild(t)}}_refreshHTTPInformation(){const e=this._requestMethodItem;e.hidden=!this._request.statusCode;const t=this._statusCodeItem;if(t.hidden=!this._request.statusCode,this._request.statusCode){const i=document.createDocumentFragment();i.createChild("div","header-name").textContent=ls`Status Code`+": ",i.createChild("span","header-separator");const s=i.createChild("span","resource-status-image","dt-icon-label");s.title=this._request.statusCode+" "+this._request.statusText,this._request.statusCode<300||304===this._request.statusCode?s.type="smallicon-green-ball":this._request.statusCode<400?s.type="smallicon-orange-ball":s.type="smallicon-red-ball",e.title=this._formatHeader(ls`Request Method`,this._request.requestMethod);const r=i.createChild("div","header-value source-code");let o=this._request.statusCode+" "+this._request.statusText;this._request.cachedInMemory()?(o+=" "+ls`(from memory cache)`,r.classList.add("status-from-cache")):this._request.fetchedViaServiceWorker?(o+=" "+ls`(from service worker)`,r.classList.add("status-from-cache")):this._request.redirectSourceSignedExchangeInfoHasNoErrors()?(o+=" "+ls`(from signed-exchange)`,r.classList.add("status-from-cache")):this._request.fromPrefetchCache()?(o+=" "+ls`(from prefetch cache)`,r.classList.add("status-from-cache")):this._request.cached()&&(o+=" "+ls`(from disk cache)`,r.classList.add("status-from-cache")),r.textContent=o,t.title=i}}_refreshHeadersTitle(e,i,s){i.listItemElement.removeChildren(),i.listItemElement.createChild("div","selection fill"),v.createTextChild(i.listItemElement,e);const r=t.UIString(" (%d)",s);i.listItemElement.createChild("span","header-count").textContent=r}_refreshHeaders(e,t,i,s,r){i.removeChildren();const o=t.length;if(this._refreshHeadersTitle(e,i,o),s){let e,t="";this._request.cachedInMemory()||this._request.cached()?(e=ls`Provisional headers are shown. Disable cache to see full headers.`,t=ls`Only provisional headers are available because this request was not sent over the network and instead was served from a local cache, which doesn’t store the original request headers. Disable cache to see full request headers.`):e=ls`Provisional headers are shown`;const s=document.createElement("div");s.title=t,s.createChild("span","","dt-icon-label").type="smallicon-warning",s.createChild("div","caution").textContent=e;const r=new R.TreeElement(s);i.appendChild(r)}const n=new Map;r&&r.forEach(e=>{n.set(e.cookieLine,e.blockedReasons)}),i.hidden=!o&&!s;for(const e of t){const t=new R.TreeElement(this._formatHeaderObject(e));it.set(t,e.name);const s=e.name.toLowerCase();if("set-cookie"===s){const i=n.get(e.value);if(i){const e=y.Icon.create("smallicon-warning","");t.listItemElement.appendChild(e);let s="";for(const e of i)s&&(s+="\n"),s+=$.setCookieBlockedReasonToUiString(e);e.title=s}}if(this._addEntryContextMenuHandler(t,e.value),i.appendChild(t),"x-client-data"===s){const i=Te(e.value),s=ye(i,ls`Active client experiment variation IDs.`,ls`Active client experiment variation IDs that trigger server-side behavior.`),r=document.createElement("div");r.classList.add("x-client-data-details"),v.createTextChild(r,ls`Decoded:`);const o=r.createChild("div");o.classList.add("source-code"),o.textContent=s,t.listItemElement.appendChild(r)}}}_refreshHeadersText(e,t,i,s){this._populateTreeElementWithSourceText(s,i),this._refreshHeadersTitle(e,s,t)}_refreshRemoteAddress(){const e=this._request.remoteAddress(),i=this._remoteAddressItem;i.hidden=!e,e&&(i.title=this._formatHeader(t.UIString("Remote Address"),e))}_refreshReferrerPolicy(){const e=this._request.referrerPolicy(),i=this._referrerPolicyItem;i.hidden=!e,e&&(i.title=this._formatHeader(t.UIString("Referrer Policy"),e))}_toggleRequestHeadersText(e){this._showRequestHeadersText=!this._showRequestHeadersText,this._refreshRequestHeaders(),e.consume()}_toggleResponseHeadersText(e){this._showResponseHeadersText=!this._showResponseHeadersText,this._refreshResponseHeaders(),e.consume()}_createToggleButton(e){const t=document.createElement("span");return t.classList.add("header-toggle"),t.textContent=e,t}_createHeadersToggleButton(e){const i=e?t.UIString("view parsed"):t.UIString("view source");return this._createToggleButton(i)}_clearHighlight(){this._highlightedElement&&this._highlightedElement.listItemElement.classList.remove("header-highlight"),this._highlightedElement=null}_revealAndHighlight(e,t){if(this._clearHighlight(),e)for(const i of e.children())if(it.get(i)===t)return this._highlightedElement=i,i.reveal(),void i.listItemElement.classList.add("header-highlight")}revealRequestHeader(e){this._revealAndHighlight(this._requestHeadersCategory,e)}revealResponseHeader(e){this._revealAndHighlight(this._responseHeadersCategory,e)}}const tt=new WeakSet,it=new WeakMap;class st extends R.TreeElement{constructor(t,i,s){super(s||"",!0),this.toggleOnClick=!0,this.hidden=!0,this._expandedSetting=e.Settings.instance().createSetting("request-info-"+i+"-category-expanded",!0),this.expanded=this._expandedSetting.get(),t.appendChild(this)}createLeaf(){const e=new R.TreeElement;return this.appendChild(e),e}onexpand(){this._expandedSetting.set(!0)}oncollapse(){this._expandedSetting.set(!1)}}const rt=new Map([[Protocol.Network.BlockedReason.CoepFrameResourceNeedsCoepHeader,{name:"cross-origin-embedder-policy",value:null,headerValueIncorrect:null,details:{explanation:ls`To embed this frame in your document, the response needs to enable the cross-origin embedder policy by specifying the following response header:`,examples:[{codeSnippet:"Cross-Origin-Embedder-Policy: require-corp",comment:void 0}],link:{url:"https://web.dev/coop-coep/"}},headerNotSet:null}],[Protocol.Network.BlockedReason.CorpNotSameOriginAfterDefaultedToSameOriginByCoep,{name:"cross-origin-resource-policy",value:null,headerValueIncorrect:null,details:{explanation:ls`To use this resource from a different origin, the server needs to specify a cross-origin resource policy in the response headers:`,examples:[{codeSnippet:"Cross-Origin-Resource-Policy: same-site",comment:ls`Choose this option if the resource and the document are served from the same site.`},{codeSnippet:"Cross-Origin-Resource-Policy: cross-origin",comment:ls`Only choose this option if an arbitrary website including this resource does not impose a security risk.`}],link:{url:"https://web.dev/coop-coep/"}},headerNotSet:null}],[Protocol.Network.BlockedReason.CoopSandboxedIframeCannotNavigateToCoopPage,{name:"cross-origin-opener-policy",value:null,headerValueIncorrect:!1,details:{explanation:ls`This document was blocked from loading in an iframe with a sandbox attribute because this document specified a cross-origin opener policy.`,examples:[],link:{url:"https://web.dev/coop-coep/"}},headerNotSet:null}],[Protocol.Network.BlockedReason.CorpNotSameSite,{name:"cross-origin-resource-policy",value:null,headerValueIncorrect:!0,details:{explanation:ls`To use this resource from a different site, the server may relax the cross-origin resource policy response header:`,examples:[{codeSnippet:"Cross-Origin-Resource-Policy: cross-origin",comment:ls`Only choose this option if an arbitrary website including this resource does not impose a security risk.`}],link:null},headerNotSet:null}],[Protocol.Network.BlockedReason.CorpNotSameOrigin,{name:"cross-origin-resource-policy",value:null,headerValueIncorrect:!0,details:{explanation:ls`To use this resource from a different origin, the server may relax the cross-origin resource policy response header:`,examples:[{codeSnippet:"Cross-Origin-Resource-Policy: same-site",comment:ls`Choose this option if the resource and the document are served from the same site.`},{codeSnippet:"Cross-Origin-Resource-Policy: cross-origin",comment:ls`Only choose this option if an arbitrary website including this resource does not impose a security risk.`}],link:null},headerNotSet:null}]]);var ot=Object.freeze({__proto__:null,RequestHeadersView:et,Category:st});class nt extends C.VBox{constructor(e){super(),this.registerRequiredCSS("network/requestInitiatorView.css",{enableLegacyPatching:!0}),this.element.classList.add("request-initiator-view"),this._linkifier=new _e.Linkifier,this._request=e,this._emptyWidget=new T.EmptyWidget(t.UIString("This request has no initiator data.")),this._emptyWidget.show(this.element),this._hasShown=!1}static createStackTracePreview(e,t,i,s){const r=e.initiator();if(!r||!r.stack)return null;const o=K.NetworkManager.forRequest(e),n=o?o.target():null;return pe.buildStackTracePreviewContents(n,t,{stackTrace:r.stack,contentUpdated:s,tabStops:i})}_appendExpandableSection(e,t,i){const s=document.createElement("div");s.classList.add("request-initiator-view-section");const r=y.Icon.create("smallicon-triangle-right"),o=s.createChild("div","request-initiator-view-section-title");o.appendChild(r),v.createTextChild(o,t),o.tabIndex=0,e.classList.add("hidden","request-initiator-view-section-content"),s.appendChild(e);const n=t=>{r.setIconType(t?"smallicon-triangle-down":"smallicon-triangle-right"),e.classList.toggle("hidden",!t)};self.onInvokeElement(o,t=>{n(e.classList.contains("hidden")),t.consume()}),n(i),this.element.appendChild(s)}_buildRequestChainTree(e){const t=new R.TreeOutlineInShadow,i=e.initiators;let s=t;for(const e of Array.from(i).reverse()){const i=new R.TreeElement(e.url());s.appendChild(i),s!==t&&s instanceof R.TreeElement&&s.expand(),s=i}s instanceof R.TreeElement&&(s.select(),s.titleElement.style.fontWeight="bold");const r=e.initiated;return this._depthFirstSearchTreeBuilder(r,s,this._request),t}_depthFirstSearchTreeBuilder(e,t,i){const s=new Set;s.add(this._request);for(const r of e.keys())if(e.get(r)===i){const i=new R.TreeElement(r.url());t.appendChild(i),t.expand(),s.has(r)||(s.add(r),this._depthFirstSearchTreeBuilder(e,i,r))}}wasShown(){if(this._hasShown)return;let e=!1;const t=nt.createStackTracePreview(this._request,this._linkifier,!0);t&&(e=!0,this._appendExpandableSection(t.element,ls`Request call stack`,!0));const i=Y.NetworkLog.instance().initiatorGraphForRequest(this._request);(i.initiators.size>1||i.initiated.size>1)&&(e=!0,this._appendExpandableSection(this._buildRequestChainTree(i).element,ls`Request initiator chain`,!0)),e&&this._emptyWidget.hideWidget(),this._hasShown=!0}}var at=Object.freeze({__proto__:null,RequestInitiatorView:nt});class lt extends C.VBox{constructor(e){super(!0),this.registerRequiredCSS("network/requestHTMLView.css",{enableLegacyPatching:!0}),this._dataURL=encodeURI(e).replace(/#/g,"%23"),this.contentElement.classList.add("html","request-view")}wasShown(){this._createIFrame()}willHide(){this.contentElement.removeChildren()}_createIFrame(){this.contentElement.removeChildren();const e=document.createElement("iframe");e.className="html-preview-frame",e.setAttribute("sandbox",""),e.setAttribute("src",this._dataURL),e.tabIndex=-1,b.markAsPresentation(e),this.contentElement.appendChild(e)}}var dt=Object.freeze({__proto__:null,RequestHTMLView:lt});class ct extends C.VBox{constructor(e){super(),this.element.classList.add("request-view"),this.request=e,this._contentViewPromise=null}static _hasTextContent(e,t){const i=e.mimeType||"";let s=r.ResourceType.fromMimeType(i);return s===r.resourceTypes.Other&&(s=e.contentType()),s===r.resourceTypes.Image?i.startsWith("image/svg"):!!s.isTextType()||!t.error&&(s===r.resourceTypes.Other&&(!!t.content&&!t.encoded))}static async sourceViewForRequest(e){let t=ht.get(e);if(void 0!==t)return t;const i=await e.contentData();if(!ct._hasTextContent(e,i))return ht.delete(e),null;const s=e.resourceType().canonicalMimeType()||e.mimeType;return t=p.ResourceSourceFrame.createSearchableView(e,s),ht.set(e,t),t}wasShown(){this._doShowPreview()}_doShowPreview(){return this._contentViewPromise||(this._contentViewPromise=this.showPreview()),this._contentViewPromise}async showPreview(){const e=await this.createPreview();return e.show(this.element),e}async createPreview(){const e=await this.request.contentData(),i=await ct.sourceViewForRequest(this.request);return e.content&&i||e.error?e.content&&i?i:new T.EmptyWidget(t.UIString("Failed to load response data")):new T.EmptyWidget(t.UIString("This request has no response data available."))}async revealLine(e){const t=await this._doShowPreview();t instanceof p.SearchableContainer&&t.revealPosition(e)}}const ht=new WeakMap;var ut=Object.freeze({__proto__:null,RequestResponseView:ct});class mt extends C.VBox{constructor(e){super(),console.assert(null!==e.signedExchangeInfo());const i=e.signedExchangeInfo();this.registerRequiredCSS("network/signedExchangeInfoView.css",{enableLegacyPatching:!0}),this.element.classList.add("signed-exchange-info-view");const s=new R.TreeOutlineInShadow;s.registerRequiredCSS("network/signedExchangeInfoTree.css",{enableLegacyPatching:!0}),s.element.classList.add("signed-exchange-info-tree"),s.setFocusable(!1),s.makeDense(),s.expandTreeElementsWhenArrowing=!0,this.element.appendChild(s.element);const r=new Map;if(i.errors&&i.errors.length){const e=new _t(s,t.UIString("Errors"));for(const t of i.errors){const i=document.createDocumentFragment();if(i.appendChild(y.Icon.create("smallicon-error","prompt-icon")),i.createChild("div","error-log").textContent=t.message,e.createLeaf(i),t.errorField){let e=r.get(t.signatureIndex);e||(e=new Set,r.set(t.signatureIndex,e)),e.add(t.errorField)}}}const o=document.createDocumentFragment();o.createChild("div","header-name").textContent=t.UIString("Signed HTTP exchange");const n=q.XLink.create("https://github.com/WICG/webpackage",t.UIString("Learn more"),"header-toggle");o.appendChild(n);const a=new _t(s,o);if(i.header){const o=i.header,n=e.redirectDestination(),l=this._formatHeader(t.UIString("Request URL"),o.requestUrl);if(n){const e=_e.Linkifier.linkifyRevealable(n,"View request");e.classList.add("header-toggle"),l.appendChild(e)}a.createLeaf(l),a.createLeaf(this._formatHeader(t.UIString("Response code"),o.responseCode+"")),a.createLeaf(this._formatHeader(t.UIString("Header integrity hash"),o.headerIntegrity)),this._responseHeadersItem=a.createLeaf(this._formatHeader(t.UIString("Response headers"),""));const d=o.responseHeaders;for(const e in d){const t=new R.TreeElement(this._formatHeader(e,d[e]));t.selectable=!1,this._responseHeadersItem.appendChild(t)}this._responseHeadersItem.expand();for(let e=0;e<o.signatures.length;++e){const i=r.get(e)||new Set,n=o.signatures[e],a=new _t(s,t.UIString("Signature"));if(a.createLeaf(this._formatHeader(t.UIString("Label"),n.label)),a.createLeaf(this._formatHeaderForHexData(t.UIString("Signature"),n.signature,i.has(Protocol.Network.SignedExchangeErrorField.SignatureSig))),n.certUrl){const e=this._formatHeader(t.UIString("Certificate URL"),n.certUrl,i.has(Protocol.Network.SignedExchangeErrorField.SignatureCertUrl));if(n.certificates){const i=e.createChild("span","devtools-link header-toggle");i.textContent=t.UIString("View certificate"),i.addEventListener("click",c.InspectorFrontendHostInstance.showCertificateViewer.bind(null,n.certificates),!1)}a.createLeaf(e)}a.createLeaf(this._formatHeader(t.UIString("Integrity"),n.integrity,i.has(Protocol.Network.SignedExchangeErrorField.SignatureIntegrity))),n.certSha256&&a.createLeaf(this._formatHeaderForHexData(t.UIString("Certificate SHA256"),n.certSha256,i.has(Protocol.Network.SignedExchangeErrorField.SignatureCertSha256))),a.createLeaf(this._formatHeader(t.UIString("Validity URL"),n.validityUrl,i.has(Protocol.Network.SignedExchangeErrorField.SignatureValidityUrl))),a.createLeaf().title=this._formatHeader(t.UIString("Date"),new Date(1e3*n.date).toUTCString(),i.has(Protocol.Network.SignedExchangeErrorField.SignatureTimestamps)),a.createLeaf().title=this._formatHeader(t.UIString("Expires"),new Date(1e3*n.expires).toUTCString(),i.has(Protocol.Network.SignedExchangeErrorField.SignatureTimestamps))}}if(i.securityDetails){const e=i.securityDetails,r=new _t(s,t.UIString("Certificate"));r.createLeaf(this._formatHeader(t.UIString("Subject"),e.subjectName)),r.createLeaf(this._formatHeader(t.UIString("Valid from"),new Date(1e3*e.validFrom).toUTCString())),r.createLeaf(this._formatHeader(t.UIString("Valid until"),new Date(1e3*e.validTo).toUTCString())),r.createLeaf(this._formatHeader(t.UIString("Issuer"),e.issuer))}}_formatHeader(e,t,i){const s=document.createDocumentFragment(),r=s.createChild("div","header-name");r.textContent=e+": ",s.createChild("span","header-separator");const o=s.createChild("div","header-value source-code");return o.textContent=t,i&&(r.classList.add("error-field"),o.classList.add("error-field")),s}_formatHeaderForHexData(e,t,i){const s=document.createDocumentFragment(),r=s.createChild("div","header-name");r.textContent=e+": ",s.createChild("span","header-separator");const o=s.createChild("div","header-value source-code hex-data");return o.textContent=t.replace(/(.{2})/g,"$1 "),i&&(r.classList.add("error-field"),o.classList.add("error-field")),s}}class _t extends R.TreeElement{constructor(e,t){super(t,!0),this.selectable=!1,this.toggleOnClick=!0,this.expanded=!0,e.appendChild(this)}createLeaf(e){const t=new R.TreeElement(e);return t.selectable=!1,this.appendChild(t),t}}var pt=Object.freeze({__proto__:null,SignedExchangeInfoView:mt,Category:_t});class gt extends ct{constructor(e){super(e)}async showPreview(){const e=await super.showPreview();if(!(e instanceof L.SimpleView))return e;const t=new S.Toolbar("network-item-preview-toolbar",this.element);return e.toolbarItems().then(e=>{e.map(e=>t.appendToolbarItem(e))}),e}async _htmlPreview(){const e=await this.request.contentData();if(e.error)return new T.EmptyWidget(t.UIString("Failed to load response data"));if(!new Set(["text/html","text/plain","application/xhtml+xml"]).has(this.request.mimeType))return null;const i=e.encoded?window.atob(e.content):e.content,s=await g.JSONView.createView(i);if(s)return s;const r=Ie.contentAsDataURL(e.content,this.request.mimeType,e.encoded,this.request.charset());return r?new lt(r):null}async createPreview(){if(this.request.signedExchangeInfo())return new mt(this.request);const e=await this._htmlPreview();if(e)return e;const i=await w.PreviewFactory.createPreview(this.request,this.request.mimeType);return i||new T.EmptyWidget(t.UIString("Preview not available"))}}var wt=Object.freeze({__proto__:null,RequestPreviewView:gt});class Ct{constructor(e,t){this.minimum=e,this.maximum=t}equals(e){return this.minimum===e.minimum&&this.maximum===e.maximum}}class St extends o.ObjectWrapper{constructor(e){super(),this.startAtZero=e,this._minimumBoundary=-1,this._maximumBoundary=-1,this._boundryChangedEventThrottler=new i.Throttler(0),this._window=null}setWindow(e){this._window=e,this._boundaryChanged()}setInitialUserFriendlyBoundaries(){this._minimumBoundary=0,this._maximumBoundary=1}computePosition(e){return(e-this.minimumBoundary())/this.boundarySpan()*(this._workingArea||0)}formatValue(e,t){return Number.secondsToString(e,!!t)}minimumBoundary(){return this._window?this._window.minimum:this._minimumBoundary}zeroTime(){return this._minimumBoundary}maximumBoundary(){return this._window?this._window.maximum:this._maximumBoundary}boundary(){return new Ct(this.minimumBoundary(),this.maximumBoundary())}boundarySpan(){return this.maximumBoundary()-this.minimumBoundary()}reset(){this._minimumBoundary=-1,this._maximumBoundary=-1,this._boundaryChanged()}_value(){return 0}setDisplayWidth(e){this._workingArea=e}computeBarGraphPercentages(e){let t,i,s;return t=-1!==e.startTime?(e.startTime-this.minimumBoundary())/this.boundarySpan()*100:0,i=-1!==e.responseReceivedTime?(e.responseReceivedTime-this.minimumBoundary())/this.boundarySpan()*100:this.startAtZero?t:100,s=-1!==e.endTime?(e.endTime-this.minimumBoundary())/this.boundarySpan()*100:this.startAtZero?i:100,this.startAtZero&&(s-=t,i-=t,t=0),{start:t,middle:i,end:s}}computePercentageFromEventTime(e){return-1===e||this.startAtZero?0:(e-this.minimumBoundary())/this.boundarySpan()*100}percentageToTime(e){return e*this.boundarySpan()/100+this.minimumBoundary()}_boundaryChanged(){this._boundryChangedEventThrottler.schedule(async()=>{this.dispatchEventToListeners(vt.BoundariesChanged)})}updateBoundariesForEventTime(e){-1===e||this.startAtZero||(void 0===this._maximumBoundary||e>this._maximumBoundary)&&(this._maximumBoundary=e,this._boundaryChanged())}computeBarGraphLabels(e){let t="";-1!==e.responseReceivedTime&&-1!==e.endTime&&(t=Number.secondsToString(e.endTime-e.responseReceivedTime));const i=e.latency>0,s=i?Number.secondsToString(e.latency):t;if(e.timing)return{left:s,right:t,tooltip:void 0};let r;if(i&&t){const i=Number.secondsToString(e.duration);r=bt.format(s,t,i)}else i?r=kt.format(s):t&&(r=Tt.format(t));return e.fetchedViaServiceWorker?r=yt.format(r):e.cached()&&(r=Rt.format(r)),{left:s,right:t,tooltip:r}}updateBoundaries(e){const t=this._lowerBound(e),i=this._upperBound(e);let s=!1;(-1!==t||this.startAtZero)&&(s=this._extendBoundariesToIncludeTimestamp(this.startAtZero?0:t)),-1!==i&&(s=this._extendBoundariesToIncludeTimestamp(i)||s),s&&this._boundaryChanged()}_extendBoundariesToIncludeTimestamp(e){const t=this._minimumBoundary,i=this._maximumBoundary,s=ft;return-1===this._minimumBoundary||-1===this._maximumBoundary?(this._minimumBoundary=e,this._maximumBoundary=e+s):(this._minimumBoundary=Math.min(e,this._minimumBoundary),this._maximumBoundary=Math.max(e,this._minimumBoundary+s,this._maximumBoundary)),t!==this._minimumBoundary||i!==this._maximumBoundary}_lowerBound(e){return 0}_upperBound(e){return 0}}const ft=.1,vt={BoundariesChanged:Symbol("BoundariesChanged")},bt=new t.UIStringFormat("%s latency, %s download (%s total)"),kt=new t.UIStringFormat("%s latency"),Tt=new t.UIStringFormat("%s download"),yt=new t.UIStringFormat("%s (from ServiceWorker)"),Rt=new t.UIStringFormat("%s (from cache)");class It extends St{constructor(){super(!1)}formatValue(e,t){return Number.secondsToString(e-this.zeroTime(),!!t)}_lowerBound(e){return e.issueTime()}_upperBound(e){return e.endTime}}class qt extends St{constructor(){super(!0)}formatValue(e,t){return Number.secondsToString(e,!!t)}_upperBound(e){return e.duration}}var Lt=Object.freeze({__proto__:null,NetworkTimeBoundary:Ct,NetworkTimeCalculator:St,_minimumSpread:ft,Events:vt,_latencyDownloadTotalFormat:bt,_latencyFormat:kt,_downloadFormat:Tt,_fromServiceWorkerFormat:yt,_fromCacheFormat:Rt,NetworkTransferTimeCalculator:It,NetworkTransferDurationCalculator:qt});class xt extends C.VBox{constructor(e,t){super(),this.element.classList.add("resource-timing-view"),this._request=e,this._calculator=t}static _timeRangeTitle(e){switch(e){case Ft.Push:return t.UIString("Receiving Push");case Ft.Queueing:return t.UIString("Queueing");case Ft.Blocking:return t.UIString("Stalled");case Ft.Connecting:return t.UIString("Initial connection");case Ft.DNS:return t.UIString("DNS Lookup");case Ft.Proxy:return t.UIString("Proxy negotiation");case Ft.ReceivingPush:return t.UIString("Reading Push");case Ft.Receiving:return t.UIString("Content Download");case Ft.Sending:return t.UIString("Request sent");case Ft.ServiceWorker:return t.UIString("Request to ServiceWorker");case Ft.ServiceWorkerPreparation:return t.UIString("Startup");case Ft.ServiceWorkerRespondWith:return t.UIString("respondWith");case Ft.SSL:return t.UIString("SSL");case Ft.Total:return t.UIString("Total");case Ft.Waiting:return t.UIString("Waiting (TTFB)");default:return t.UIString(e)}}static calculateRequestTimeRanges(e,t){const i=[];function s(e,t,s){t<Number.MAX_VALUE&&t<=s&&i.push({name:e,start:t,end:s})}function r(e){for(let t=0;t<e.length;++t)if(e[t]>0)return e[t]}function o(e,t,i){t>=0&&i>=0&&s(e,l+t/1e3,l+i/1e3)}const n=e.timing;if(!n){const t=-1!==e.issueTime()?e.issueTime():-1!==e.startTime?e.startTime:0,r=-1===e.responseReceivedTime?Number.MAX_VALUE:e.responseReceivedTime,o=-1===e.endTime?Number.MAX_VALUE:e.endTime;return s(Ft.Total,t,o),s(Ft.Blocking,t,r),s(Ft.Receiving,r,o),i}const a=e.issueTime(),l=n.requestTime,d=r([e.endTime,e.responseReceivedTime])||l;if(s(Ft.Total,a<l?a:l,d),n.pushStart){const e=n.pushEnd||d;e>t&&s(Ft.Push,Math.max(n.pushStart,t),e)}a<l&&s(Ft.Queueing,a,l);const c=1e3*(e.responseReceivedTime-l);if(e.fetchedViaServiceWorker)o(Ft.Blocking,0,n.workerStart),o(Ft.ServiceWorkerPreparation,n.workerStart,n.workerReady),o(Ft.ServiceWorkerRespondWith,n.workerFetchStart,n.workerRespondWithSettled),o(Ft.ServiceWorker,n.workerReady,n.sendEnd),o(Ft.Waiting,n.sendEnd,c);else if(!n.pushStart){const e=r([n.dnsStart,n.connectStart,n.sendStart,c])||0;o(Ft.Blocking,0,e),o(Ft.Proxy,n.proxyStart,n.proxyEnd),o(Ft.DNS,n.dnsStart,n.dnsEnd),o(Ft.Connecting,n.connectStart,n.connectEnd),o(Ft.SSL,n.sslStart,n.sslEnd),o(Ft.Sending,n.sendStart,n.sendEnd),o(Ft.Waiting,Math.max(n.sendEnd,n.connectEnd,n.dnsEnd,n.proxyEnd,e),c)}return-1!==e.endTime&&s(n.pushStart?Ft.ReceivingPush:Ft.Receiving,e.responseReceivedTime,d),i}static createTimingTable(e,i){const s=document.createElement("table");s.classList.add("network-timing-table"),x.appendStyle(s,"network/networkTimingTable.css",{enableLegacyPatching:!0});const r=s.createChild("colgroup");r.createChild("col","labels"),r.createChild("col","bars"),r.createChild("col","duration");const o=xt.calculateRequestTimeRanges(e,i.minimumBoundary()),a=o.map(e=>e.start).reduce((e,t)=>Math.min(e,t)),l=o.map(e=>e.end).reduce((e,t)=>Math.max(e,t)),d=100/(l-a);let c,h,u,m,_=0;const p=s.createChild("thead","network-timing-start"),g=p.createChild("tr"),w=g.createChild("th");w.createChild("span","network-timing-hidden-header").textContent=ls`Label`,w.scope="col";const C=g.createChild("th");C.createChild("span","network-timing-hidden-header").textContent=ls`Waterfall`,C.scope="col";const S=g.createChild("th");S.createChild("span","network-timing-hidden-header").textContent=ls`Duration`,S.scope="col";const f=p.createChild("tr").createChild("td"),k=p.createChild("tr").createChild("td");let T;f.colSpan=k.colSpan=3,v.createTextChild(f,t.UIString("Queued at %s",i.formatValue(e.issueTime(),2))),v.createTextChild(k,t.UIString("Started at %s",i.formatValue(e.startTime,2)));for(let e=0;e<o.length;++e){const r=o[e],n=r.name;if(n===Ft.Total){_=r.end-r.start;continue}n===Ft.Push?M(t.UIString("Server Push")):n===Ft.Queueing?m||(m=M(ls`Resource Scheduling`)):Pt.has(n)?c||(c=M(t.UIString("Connection Start"))):Et.has(n)?h||(h=M(ls`Service Worker`)):u||(u=M(t.UIString("Request/Response")));const p=d*(r.start-a);T=d*(l-r.end);const g=r.end-r.start,w=s.createChild("tr"),C=w.createChild("td");v.createTextChild(C,xt._timeRangeTitle(n));const S=w.createChild("td").createChild("div","network-timing-row"),f=S.createChild("span","network-timing-bar "+n);f.style.left=p+"%",f.style.right=T+"%",f.textContent="​",b.setAccessibleName(S,ls`Started at ${i.formatValue(r.start,2)}`);w.createChild("td").createChild("div","network-timing-bar-title").textContent=Number.secondsToString(g,!0),"serviceworker-respondwith"===r.name&&(C.classList.add("network-fetch-timing-bar-clickable"),s.createChild("tr","network-fetch-timing-bar-details"),C.setAttribute("tabindex","0"),C.setAttribute("role","switch"),b.setChecked(C,!1))}if(!e.finished){const e=s.createChild("tr").createChild("td","caution");e.colSpan=3,v.createTextChild(e,t.UIString("CAUTION: request is not finished yet!"))}const y=s.createChild("tr","network-timing-footer"),R=y.createChild("td");R.colSpan=1,R.appendChild(v.createDocumentationLink("network-performance/reference#timing-explanation",t.UIString("Explanation"))),y.createChild("td"),v.createTextChild(y.createChild("td"),Number.secondsToString(_,!0));const I=e.serverTimings,L=void 0===T?100:T,F=s.createChild("tr","network-timing-table-header").createChild("td");F.colSpan=3,F.createChild("hr","break");const E=s.createChild("tr","network-timing-table-header");if(v.createTextChild(E.createChild("td"),t.UIString("Server Timing")),E.createChild("td"),v.createTextChild(E.createChild("td"),t.UIString("TIME")),!I){const e=s.createChild("tr").createChild("td");e.colSpan=3;const t=q.XLink.create("https://web.dev/custom-metrics/#server-timing-api",ls`the Server Timing API`);return e.appendChild(v.formatLocalized("During development, you can use %s to add insights into the server-side timing of this request.",[t])),s}return I.filter(e=>"total"!==e.metric.toLowerCase()).forEach(e=>P(e,L)),I.filter(e=>"total"===e.metric.toLowerCase()).forEach(e=>P(e,L)),s;function P(e,t){const i=new n.Generator({min:0,max:360,count:36},{min:50,max:80,count:void 0},80),r="total"===e.metric.toLowerCase(),o=s.createChild("tr",r?"network-timing-footer":""),c=o.createChild("td","network-timing-metric"),h=e.description||e.metric;v.createTextChild(c,h),c.title=h;const u=o.createChild("td").createChild("div","network-timing-row");if(null===e.value)return;const m=d*(l-a-e.value/1e3);if(m>=0){const s=u.createChild("span","network-timing-bar server-timing");s.style.left=m+"%",s.style.right=t+"%",s.textContent="​",r||(s.style.backgroundColor=i.colorForID(e.metric))}o.createChild("td").createChild("div","network-timing-bar-title").textContent=Number.millisToString(e.value,!0)}function M(e){const t=s.createChild("tr","network-timing-table-header"),i=t.createChild("td");return v.createTextChild(i,e),b.markAsHeading(i,2),v.createTextChild(t.createChild("td"),""),v.createTextChild(t.createChild("td"),ls`DURATION`),t}}_constructFetchDetailsView(){if(!this._tableElement)return;const e=this._tableElement.ownerDocument,t=e.querySelector(".network-fetch-timing-bar-details");if(!t)return;t.classList.add("network-fetch-timing-bar-details-collapsed"),self.onInvokeElement(this._tableElement,this._onToggleFetchDetails.bind(this,t));const i=new R.TreeOutlineInShadow;t.appendChild(i.element);const s=Y.NetworkLog.instance().originalRequestForURL(this._request.url());if(s){const e=Z.RemoteObject.fromLocalObject(s),t=new Re.RootElement(e);t.title=ls`Original Request`,i.appendChild(t)}const r=Y.NetworkLog.instance().originalResponseForURL(this._request.url());if(r){const e=Z.RemoteObject.fromLocalObject(r),t=new Re.RootElement(e);t.title=ls`Response Received`,i.appendChild(t)}const o=e.createElementWithClass("div","network-fetch-details-treeitem");let n=ls`Unknown`;const a=this._request.serviceWorkerResponseSource();a&&(n=this._getLocalizedResponseSourceForCode(a)),o.textContent=ls`Source of response: ${n}`;const l=new R.TreeElement(o);i.appendChild(l);const d=e.createElementWithClass("div","network-fetch-details-treeitem"),c=this._request.getResponseCacheStorageCacheName();d.textContent=c?ls`Cache storage cache name: ${c}`:ls`Cache storage cache name: Unknown`;const h=new R.TreeElement(d);i.appendChild(h);const u=this._request.getResponseRetrievalTime();if(u){const t=e.createElementWithClass("div","network-fetch-details-treeitem");t.textContent=ls`Retrieval Time: ${u}`;const s=new R.TreeElement(t);i.appendChild(s)}}_getLocalizedResponseSourceForCode(e){switch(e){case Protocol.Network.ServiceWorkerResponseSource.CacheStorage:return ls`ServiceWorker cache storage`;case Protocol.Network.ServiceWorkerResponseSource.HttpCache:return ls`From HTTP cache`;case Protocol.Network.ServiceWorkerResponseSource.Network:return ls`Network fetch`;default:return ls`Fallback code`}}_onToggleFetchDetails(e,t){if(!t.target)return;const i=t.target;if(i.classList.contains("network-fetch-timing-bar-clickable")){e.classList.contains("network-fetch-timing-bar-details-collapsed")&&h.actionTaken(u.Action.NetworkPanelServiceWorkerRespondWith);const t="true"===i.getAttribute("aria-checked");i.setAttribute("aria-checked",String(!t)),e.classList.toggle("network-fetch-timing-bar-details-collapsed"),e.classList.toggle("network-fetch-timing-bar-details-expanded")}}wasShown(){this._request.addEventListener($.Events.TimingChanged,this._refresh,this),this._request.addEventListener($.Events.FinishedLoading,this._refresh,this),this._calculator.addEventListener(vt.BoundariesChanged,this._refresh,this),this._refresh()}willHide(){this._request.removeEventListener($.Events.TimingChanged,this._refresh,this),this._request.removeEventListener($.Events.FinishedLoading,this._refresh,this),this._calculator.removeEventListener(vt.BoundariesChanged,this._refresh,this)}_refresh(){this._tableElement&&this._tableElement.remove(),this._tableElement=xt.createTimingTable(this._request,this._calculator),this._tableElement.classList.add("resource-timing-table"),this.element.appendChild(this._tableElement),this._request.fetchedViaServiceWorker&&this._constructFetchDetailsView()}}const Ft={Push:"push",Queueing:"queueing",Blocking:"blocking",Connecting:"connecting",DNS:"dns",Proxy:"proxy",Receiving:"receiving",ReceivingPush:"receiving-push",Sending:"sending",ServiceWorker:"serviceworker",ServiceWorkerPreparation:"serviceworker-preparation",ServiceWorkerRespondWith:"serviceworker-respondwith",SSL:"ssl",Total:"total",Waiting:"waiting"},Et=new Set([Ft.ServiceWorker,Ft.ServiceWorkerPreparation,Ft.ServiceWorkerRespondWith]),Pt=new Set([Ft.Queueing,Ft.Blocking,Ft.Connecting,Ft.DNS,Ft.Proxy,Ft.SSL]);var Mt=Object.freeze({__proto__:null,RequestTimingView:xt,RequestTimeRangeNames:Ft,ServiceWorkerRangeNames:Et,ConnectionSetupRangeNames:Pt,RequestTimeRange:void 0});class Ht extends C.VBox{constructor(e){super(),this.registerRequiredCSS("network/webSocketFrameView.css",{enableLegacyPatching:!0}),this.element.classList.add("websocket-frame-view"),this._request=e,this._splitWidget=new F.SplitWidget(!1,!0,"resourceWebSocketFrameSplitViewState"),this._splitWidget.show(this.element);const i=[{id:"data",title:t.UIString("Data"),sortable:!1,weight:88},{id:"length",title:t.UIString("Length"),sortable:!1,align:ne.Align.Right,weight:5},{id:"time",title:t.UIString("Time"),sortable:!0,weight:7}];this._dataGrid=new oe.SortableDataGrid({displayName:ls`Web Socket Frame`,columns:i,editCallback:void 0,deleteCallback:void 0,refreshCallback:void 0}),this._dataGrid.setRowContextMenuCallback(function(e,i){const s=i,r=s.binaryView();r?r.addCopyToContextMenu(e,ls`Copy message...`):e.clipboardSection().appendItem(t.UIString("Copy message"),c.InspectorFrontendHostInstance.copyText.bind(c.InspectorFrontendHostInstance,s.data.data));e.footerSection().appendItem(t.UIString("Clear all"),this._clearFrames.bind(this))}.bind(this)),this._dataGrid.setStickToBottom(!0),this._dataGrid.setCellClass("websocket-frame-view-td"),this._timeComparator=At,this._dataGrid.sortNodes(this._timeComparator,!1),this._dataGrid.markColumnAsSortedBy("time",ne.Order.Ascending),this._dataGrid.addEventListener(ne.Events.SortingChanged,this._sortItems,this),this._dataGrid.setName("ResourceWebSocketFrameView"),this._dataGrid.addEventListener(ne.Events.SelectedNode,e=>{this._onFrameSelected(e)},this),this._dataGrid.addEventListener(ne.Events.DeselectedNode,this._onFrameDeselected,this),this._mainToolbar=new S.Toolbar(""),this._clearAllButton=new S.ToolbarButton(t.UIString("Clear All"),"largeicon-clear"),this._clearAllButton.addEventListener(S.ToolbarButton.Events.Click,this._clearFrames,this),this._mainToolbar.appendToolbarItem(this._clearAllButton),this._filterTypeCombobox=new S.ToolbarComboBox(this._updateFilterSetting.bind(this),ls`Filter`);for(const e of Nt){const t=this._filterTypeCombobox.createOption(e.label,e.name);this._filterTypeCombobox.addOption(t)}this._mainToolbar.appendToolbarItem(this._filterTypeCombobox),this._filterType=null;this._filterTextInput=new S.ToolbarInput(t.UIString("Enter regex, for example: (web)?socket"),"",.4),this._filterTextInput.addEventListener(S.ToolbarInput.Event.TextChanged,this._updateFilterSetting,this),this._mainToolbar.appendToolbarItem(this._filterTextInput),this._filterRegex=null;const s=new C.VBox;s.element.appendChild(this._mainToolbar.element),this._dataGrid.asWidget().show(s.element),s.setMinimumSize(0,72),this._splitWidget.setMainWidget(s),this._frameEmptyWidget=new T.EmptyWidget(t.UIString("Select message to browse its content.")),this._splitWidget.setSidebarWidget(this._frameEmptyWidget),this._selectedNode=null}static opCodeDescription(e,t){const i=Bt[e]||"";return t?ls`${i} (Opcode ${e}, mask)`:ls`${i} (Opcode ${e})`}wasShown(){this.refresh(),this._request.addEventListener($.Events.WebsocketFrameAdded,this._frameAdded,this)}willHide(){this._request.removeEventListener($.Events.WebsocketFrameAdded,this._frameAdded,this)}_frameAdded(e){const t=e.data;this._frameFilter(t)&&this._dataGrid.insertChild(new Vt(this._request.url(),t))}_frameFilter(e){return(!this._filterType||e.type===this._filterType)&&(!this._filterRegex||this._filterRegex.test(e.text))}_clearFrames(){Wt.set(this._request,this._request.frames().length),this.refresh()}_updateFilterSetting(){const e=this._filterTextInput.value(),t=this._filterTypeCombobox.selectedOption().value;this._filterRegex=e?new RegExp(e,"i"):null,this._filterType="all"===t?null:t,this.refresh()}async _onFrameSelected(e){this._currentSelectedNode=e.data;const t=this._currentSelectedNode.dataText(),i=this._currentSelectedNode.binaryView();if(i)return void this._splitWidget.setSidebarWidget(i);const s=await g.JSONView.createView(t);s?this._splitWidget.setSidebarWidget(s):this._splitWidget.setSidebarWidget(new p.ResourceSourceFrame(qe.StaticContentProvider.fromString(this._request.url(),r.resourceTypes.WebSocket,t)))}_onFrameDeselected(e){this._currentSelectedNode=null,this._splitWidget.setSidebarWidget(this._frameEmptyWidget)}refresh(){this._dataGrid.rootNode().removeChildren();const e=this._request.url();let t=this._request.frames();const i=Wt.get(this._request)||0;t=t.slice(i),t=t.filter(this._frameFilter.bind(this)),t.forEach(t=>this._dataGrid.insertChild(new Vt(e,t)))}_sortItems(){this._dataGrid.sortNodes(this._timeComparator,!this._dataGrid.isSortOrderAscending())}}const Ut={ContinuationFrame:0,TextFrame:1,BinaryFrame:2,ConnectionCloseFrame:8,PingFrame:9,PongFrame:10},Bt=function(){const e=Ut,t=[];return t[e.ContinuationFrame]=ls`Continuation Frame`,t[e.TextFrame]=ls`Text Message`,t[e.BinaryFrame]=ls`Binary Message`,t[e.ContinuationFrame]=ls`Connection Close Message`,t[e.PingFrame]=ls`Ping Message`,t[e.PongFrame]=ls`Pong Message`,t}(),Nt=[{name:"all",label:t.UIString("All"),title:void 0},{name:"send",label:t.UIString("Send"),title:void 0},{name:"receive",label:t.UIString("Receive"),title:void 0}];class Vt extends oe.SortableDataGridNode{constructor(e,t){let i=String(t.text.length);const s=new Date(1e3*t.time),r=("0"+s.getHours()).substr(-2)+":"+("0"+s.getMinutes()).substr(-2)+":"+("0"+s.getSeconds()).substr(-2)+"."+("00"+s.getMilliseconds()).substr(-3),o=document.createElement("div");v.createTextChild(o,r),o.title=s.toLocaleString();let n=t.text,a=Ht.opCodeDescription(t.opCode,t.mask);const l=t.opCode===Ut.TextFrame;t.type===$.WebSocketFrameType.Error?(a=n,i=ls`N/A`):l?a=n:t.opCode===Ut.BinaryFrame?(i=de.bytesToString(base64ToSize(t.text)),a=Bt[t.opCode]):n=a,super({data:a,length:i,time:o}),this._url=e,this._frame=t,this._isTextFrame=l,this._dataText=n,this._binaryView=null}createCells(e){e.classList.toggle("websocket-frame-view-row-error",this._frame.type===$.WebSocketFrameType.Error),e.classList.toggle("websocket-frame-view-row-send",this._frame.type===$.WebSocketFrameType.Send),e.classList.toggle("websocket-frame-view-row-receive",this._frame.type===$.WebSocketFrameType.Receive),super.createCells(e)}nodeSelfHeight(){return 21}dataText(){return this._dataText}opCode(){return this._frame.opCode}binaryView(){return this._isTextFrame||this._frame.type===$.WebSocketFrameType.Error?null:(this._binaryView||this.dataText.length>0&&(this._binaryView=new Me(this._dataText,"",r.resourceTypes.WebSocket)),this._binaryView)}}function At(e,t){return e._frame.time-t._frame.time}const Wt=new WeakMap;var Ot=Object.freeze({__proto__:null,ResourceWebSocketFrameView:Ht,OpCodes:Ut,opCodeDescriptions:Bt,_filterTypes:Nt,ResourceWebSocketFrameNode:Vt,ResourceWebSocketFrameNodeTimeComparator:At});class Dt extends E.TabbedPane{constructor(i,s,o){if(super(),this._request=i,this.element.classList.add("network-item-view"),this._resourceViewTabSetting=e.Settings.instance().createSetting("resourceViewTab","preview"),this._headersView=new et(i),this.appendTab(Gt.Headers,t.UIString("Headers"),this._headersView,t.UIString("Headers and request body")),this.addEventListener(E.Events.TabSelected,this._tabSelected,this),i.resourceType()===r.resourceTypes.WebSocket){const e=new Ht(i);this.appendTab(Gt.WsFrames,t.UIString("Messages"),e,t.UIString("WebSocket messages"))}else if("text/event-stream"===i.mimeType)this.appendTab(Gt.EventSource,t.UIString("EventStream"),new Ae(i));else{this._responseView=new ct(i);const e=new gt(i);this.appendTab(Gt.Preview,t.UIString("Preview"),e,t.UIString("Response preview"));const s=i.signedExchangeInfo();if(s&&s.errors&&s.errors.length){const e=y.Icon.create("smallicon-error");e.title=t.UIString("SignedExchange error"),this.setTabIcon(Gt.Preview,e)}this.appendTab(Gt.Response,t.UIString("Response"),this._responseView,t.UIString("Raw response data"))}this.appendTab(Gt.Initiator,ls`Initiator`,new nt(i),ls`Request initiator call stack`),this.appendTab(Gt.Timing,t.UIString("Timing"),new xt(i,s),t.UIString("Request and response timeline")),this._cookiesView=null,this._initialTab=o||this._resourceViewTabSetting.get()}wasShown(){super.wasShown(),this._request.addEventListener($.Events.RequestHeadersChanged,this._maybeAppendCookiesPanel,this),this._request.addEventListener($.Events.ResponseHeadersChanged,this._maybeAppendCookiesPanel,this),this._maybeAppendCookiesPanel(),this._selectTab(this._initialTab)}willHide(){this._request.removeEventListener($.Events.RequestHeadersChanged,this._maybeAppendCookiesPanel,this),this._request.removeEventListener($.Events.ResponseHeadersChanged,this._maybeAppendCookiesPanel,this)}_maybeAppendCookiesPanel(){const e=this._request.hasRequestCookies()||this._request.responseCookies.length>0;console.assert(e||!this._cookiesView,"Cookies were introduced in headers and then removed!"),e&&!this._cookiesView&&(this._cookiesView=new Ze(this._request),this.appendTab(Gt.Cookies,t.UIString("Cookies"),this._cookiesView,t.UIString("Request and response cookies")))}_selectTab(e){this.selectTab(e)||this.selectTab("headers")}_tabSelected(e){e.data.isUserGesture&&this._resourceViewTabSetting.set(e.data.tabId)}request(){return this._request}async revealResponseBody(e){this._selectTab(Gt.Response),this._responseView&&"number"==typeof e&&await this._responseView.revealLine(e)}revealRequestHeader(e){this._selectTab(Gt.Headers),this._headersView.revealRequestHeader(e)}revealResponseHeader(e){this._selectTab(Gt.Headers),this._headersView.revealResponseHeader(e)}}const Gt={Cookies:"cookies",EventSource:"eventSource",Headers:"headers",Initiator:"initiator",Preview:"preview",Response:"response",Timing:"timing",WsFrames:"webSocketFrames"};var zt=Object.freeze({__proto__:null,NetworkItemView:Dt,Tabs:Gt});const Kt={RequestSelected:Symbol("RequestSelected"),RequestActivated:Symbol("RequestActivated")};class jt extends oe.SortableDataGridNode{constructor(e){super({}),this._parentView=e,this._isHovered=!1,this._showingInitiatorChain=!1,this._requestOrFirstKnownChildRequest=null}displayName(){return""}displayType(){return""}createCell(e){const t=this.createTD(e);return this.renderCell(t,e),t}renderCell(e,t){}_isFailed(){return!1}backgroundColor(){const e=$t,t=document.hasFocus(),i=this.dataGrid&&this.dataGrid.element===document.activeElement,s=this._isFailed();return this.selected&&t&&i&&s?e.FocusSelectedHasError:this.selected&&t&&i?e.FocusSelected:this.selected?e.Selected:this.hovered()?e.Hovered:this.isOnInitiatorPath()?e.InitiatorPath:this.isOnInitiatedPath()?e.InitiatedPath:this.isStriped()?e.Stripe:e.Default}updateBackgroundColor(){const e=this.existingElement();e&&(e.style.backgroundColor=`var(${this.backgroundColor()})`,this._parentView.stylesChanged())}setStriped(e){super.setStriped(e),this.updateBackgroundColor()}select(e){super.select(e),this.updateBackgroundColor(),this._parentView.updateNodeSelectedClass(!0)}deselect(e){super.deselect(e),this.updateBackgroundColor(),this._parentView.updateNodeSelectedClass(!1)}parentView(){return this._parentView}hovered(){return this._isHovered}showingInitiatorChain(){return this._showingInitiatorChain}nodeSelfHeight(){return this._parentView.rowHeight()}setHovered(e,t){this._isHovered===e&&this._showingInitiatorChain===t||(this._isHovered!==e&&(this._isHovered=e,this.attached()&&this.element().classList.toggle("hover",e)),this._showingInitiatorChain!==t&&(this._showingInitiatorChain=t,this.showingInitiatorChainChanged()),this._parentView.stylesChanged(),this.updateBackgroundColor())}showingInitiatorChainChanged(){}isOnInitiatorPath(){return!1}isOnInitiatedPath(){return!1}request(){return null}isNavigationRequest(){return!1}clearFlatNodes(){super.clearFlatNodes(),this._requestOrFirstKnownChildRequest=null}requestOrFirstKnownChildRequest(){if(this._requestOrFirstKnownChildRequest)return this._requestOrFirstKnownChildRequest;let e=this.request();if(e||!this.hasChildren())return this._requestOrFirstKnownChildRequest=e,this._requestOrFirstKnownChildRequest;let t=null;const i=this.flatChildren();for(let s=0;s<i.length;s++)e=i[s].request(),(!t||e&&e.issueTime()<t.issueTime())&&(t=e);return this._requestOrFirstKnownChildRequest=t,this._requestOrFirstKnownChildRequest}}const $t={Default:"--network-grid-default-color",Stripe:"--network-grid-stripe-color",Navigation:"--network-grid-navigation-color",Hovered:"--network-grid-hovered-color",InitiatorPath:"--network-grid-initiator-path-color",InitiatedPath:"--network-grid-initiated-path-color",Selected:"--network-grid-selected-color",FocusSelected:"--network-grid-focus-selected-color",FocusSelectedHasError:"--network-grid-focus-selected-color-has-error",FromFrame:"--network-grid-from-frame-color"};class Xt extends jt{constructor(e,t){super(e),this._nameCell=null,this._initiatorCell=null,this._request=t,this._isNavigationRequest=!1,this.selectable=!0,this._isOnInitiatorPath=!1,this._isOnInitiatedPath=!1}static NameComparator(e,t){const i=e.displayName().toLowerCase(),s=t.displayName().toLowerCase();if(i===s){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();return i&&s?i.identityCompare(s):i?-1:1}return i<s?-1:1}static RemoteAddressComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;const r=i.remoteAddress(),o=s.remoteAddress();return r>o?1:o>r?-1:i.identityCompare(s)}static SizeComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();return i&&s?s.cached()&&!i.cached()?1:i.cached()&&!s.cached()?-1:i.transferSize-s.transferSize||i.resourceSize-s.resourceSize||i.identityCompare(s):i?1:-1}static TypeComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;const r=e.displayType(),o=t.displayType();return r>o?1:o>r?-1:i.identityCompare(s)}static InitiatorComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;const r=e instanceof Xt&&e._initiatorCell,o=t instanceof Xt&&t._initiatorCell;if(!r||!o)return r?1:-1;const n=e,a=t,l=n._linkifiedInitiatorAnchor?n._linkifiedInitiatorAnchor.textContent||"":n._initiatorCell.title,d=a._linkifiedInitiatorAnchor?a._linkifiedInitiatorAnchor.textContent||"":a._initiatorCell.title;return l.localeCompare(d)}static RequestCookiesCountComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;return i.includedRequestCookies().length-s.includedRequestCookies().length||i.identityCompare(s)}static ResponseCookiesCountComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;return(i.responseCookies?i.responseCookies.length:0)-(s.responseCookies?s.responseCookies.length:0)||i.identityCompare(s)}static PriorityComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;const r=i.priority();let o=r?ge.networkPriorityWeight(r):0;o=o||0;const n=s.priority();let a=n?ge.networkPriorityWeight(n):0;return a=a||0,o-a||i.identityCompare(s)}static RequestPropertyComparator(e,t,i){const s=t.requestOrFirstKnownChildRequest(),r=i.requestOrFirstKnownChildRequest();if(!s||!r)return s?1:-1;const o=s[e],n=r[e];return o===n?s.identityCompare(r):o>n?1:-1}static RequestURLComparator(e,t){const i=e.requestOrFirstKnownChildRequest(),s=t.requestOrFirstKnownChildRequest();if(!i||!s)return i?1:-1;const r=i.url(),o=s.url();return r===o?i.identityCompare(s):r>o?1:-1}static ResponseHeaderStringComparator(e,t,i){const s=t.requestOrFirstKnownChildRequest(),r=i.requestOrFirstKnownChildRequest();if(!s||!r)return s?1:-1;const o=String(s.responseHeaderValue(e)||""),n=String(r.responseHeaderValue(e)||"");return o.localeCompare(n)||s.identityCompare(r)}static ResponseHeaderNumberComparator(e,t,i){const s=t.requestOrFirstKnownChildRequest(),r=i.requestOrFirstKnownChildRequest();if(!s||!r)return s?1:-1;const o=s.responseHeaderValue(e),n=void 0!==o?parseFloat(o):-1/0,a=r.responseHeaderValue(e),l=void 0!==a?parseFloat(a):-1/0;return n===l?s.identityCompare(r):n>l?1:-1}static ResponseHeaderDateComparator(e,t,i){const s=t.requestOrFirstKnownChildRequest(),r=i.requestOrFirstKnownChildRequest();if(!s||!r)return s?1:-1;const o=s.responseHeaderValue(e),n=r.responseHeaderValue(e),a=o?new Date(o).getTime():-1/0,l=n?new Date(n).getTime():-1/0;return a===l?s.identityCompare(r):a>l?1:-1}showingInitiatorChainChanged(){const e=this.showingInitiatorChain(),t=Y.NetworkLog.instance().initiatorGraphForRequest(this._request);for(const i of t.initiators){if(i===this._request)continue;const t=this.parentView().nodeForRequest(i);t&&t._setIsOnInitiatorPath(e)}for(const i of t.initiated.keys()){if(i===this._request)continue;const t=this.parentView().nodeForRequest(i);t&&t._setIsOnInitiatedPath(e)}}_setIsOnInitiatorPath(e){this._isOnInitiatorPath!==e&&this.attached()&&(this._isOnInitiatorPath=e,this.updateBackgroundColor())}isOnInitiatorPath(){return this._isOnInitiatorPath}_setIsOnInitiatedPath(e){this._isOnInitiatedPath!==e&&this.attached()&&(this._isOnInitiatedPath=e,this.updateBackgroundColor())}isOnInitiatedPath(){return this._isOnInitiatedPath}displayType(){const e=this._request.mimeType||this._request.requestContentType()||"",t=this._request.resourceType();let i=t.name();return t!==r.resourceTypes.Other&&t!==r.resourceTypes.Image||(i=e.replace(/^(application|image)\//,"")),this._request.isRedirect()&&(i+=" / "+ls`Redirect`),i}displayName(){return this._request.name()}request(){return this._request}isNavigationRequest(){const e=Y.PageLoad.forRequest(this._request);return!!e&&e.mainRequest===this._request}nodeSelfHeight(){return this.parentView().rowHeight()}createCells(e){this._nameCell=null,this._initiatorCell=null,e.classList.toggle("network-error-row",this._isFailed()),e.classList.toggle("network-navigation-row",this._isNavigationRequest),super.createCells(e),this.updateBackgroundColor()}_setTextAndTitle(e,t,i){v.createTextChild(e,t),e.title=i||t}_setTextAndTitleAndLink(e,t,i,s){v.createTextChild(e,t),e.createChild("span","separator-in-cell");const r=document.createElement("span");r.classList.add("devtools-link"),r.textContent=i,r.addEventListener("click",s),e.appendChild(r),e.title=t}renderCell(e,t){const i=e;switch(t){case"name":this._renderPrimaryCell(i,t);break;case"path":this._renderPrimaryCell(i,t,this._request.pathname);break;case"url":this._renderPrimaryCell(i,t,this._request.url());break;case"method":this._setTextAndTitle(i,this._request.requestMethod);break;case"status":this._renderStatusCell(i);break;case"protocol":this._setTextAndTitle(i,this._request.protocol);break;case"scheme":this._setTextAndTitle(i,this._request.scheme);break;case"domain":this._setTextAndTitle(i,this._request.domain);break;case"remoteaddress":this._setTextAndTitle(i,this._request.remoteAddress());break;case"cookies":this._setTextAndTitle(i,this._arrayLength(this._request.includedRequestCookies()));break;case"setcookies":this._setTextAndTitle(i,this._arrayLength(this._request.responseCookies));break;case"priority":{const e=this._request.priority();this._setTextAndTitle(i,e?ge.uiLabelForNetworkPriority(e):"");break}case"connectionid":this._setTextAndTitle(i,this._request.connectionId);break;case"type":this._setTextAndTitle(i,this.displayType());break;case"initiator":this._renderInitiatorCell(i);break;case"size":this._renderSizeCell(i);break;case"time":this._renderTimeCell(i);break;case"timeline":this._setTextAndTitle(i,"");break;default:this._setTextAndTitle(i,this._request.responseHeaderValue(t)||"")}}_arrayLength(e){return e?""+e.length:""}select(e){super.select(e),this.parentView().dispatchEventToListeners(Kt.RequestSelected,this._request)}highlightMatchedSubstring(e){if(!e||!this._nameCell||null===this._nameCell.textContent)return[];this.element();const t=[],i=this._nameCell.textContent.match(e);return i&&v.highlightSearchResult(this._nameCell,i.index||0,i[0].length,t),t}_openInNewTab(){c.InspectorFrontendHostInstance.openInNewTab(this._request.url())}_isFailed(){const e=this._request.signedExchangeInfo();return this._request.failed&&!this._request.statusCode||this._request.statusCode>=400||!!e&&!!e.errors}_renderPrimaryCell(e,t,i){if(0===this.dataGrid.indexOfVisibleColumn(t)){const t=this.leftPadding?this.leftPadding+"px":"";let i;if(e.style.setProperty("padding-left",t),this._nameCell=e,e.addEventListener("dblclick",this._openInNewTab.bind(this),!1),e.addEventListener("click",()=>{this.parentView().dispatchEventToListeners(Kt.RequestActivated,{showPanel:!0})}),this._request.resourceType()===r.resourceTypes.Image){const e=document.createElement("img");e.classList.add("image-network-icon-preview"),e.alt=this._request.resourceType().title(),this._request.populateImageSource(e),i=document.createElement("div"),i.classList.add("icon"),i.appendChild(e)}else i=document.createElement("img"),i.classList.add("icon"),i.alt=this._request.resourceType().title();i.classList.add(this._request.resourceType().name()),e.appendChild(i)}if("name"===t){const t=this._request.name().trimMiddle(100),i=K.NetworkManager.forRequest(this._request);v.createTextChild(e,i?i.target().decorateLabel(t):t),this._appendSubtitle(e,this._request.path()),e.title=this._request.url()}else i&&(v.createTextChild(e,i),e.title=i)}_renderStatusCell(e){e.classList.toggle("network-dim-cell",!this._isFailed()&&(this._request.cached()||!this._request.statusCode));const i=this._request.corsErrorStatus();if(!this._request.failed||this._request.canceled||this._request.wasBlocked()||i)if(this._request.statusCode)v.createTextChild(e,""+this._request.statusCode),this._appendSubtitle(e,this._request.statusText),e.title=this._request.statusCode+" "+this._request.statusText;else if(this._request.parsedURL.isDataURL())this._setTextAndTitle(e,t.UIString("(data)"));else if(this._request.canceled)this._setTextAndTitle(e,t.UIString("(canceled)"));else if(this._request.wasBlocked()){let i=t.UIString("other"),s=!1;switch(this._request.blockedReason()){case Protocol.Network.BlockedReason.Other:i=t.UIString("other");break;case Protocol.Network.BlockedReason.Csp:i=t.UIString("csp");break;case Protocol.Network.BlockedReason.MixedContent:i=t.UIString("mixed-content");break;case Protocol.Network.BlockedReason.Origin:i=t.UIString("origin");break;case Protocol.Network.BlockedReason.Inspector:i=t.UIString("devtools");break;case Protocol.Network.BlockedReason.SubresourceFilter:i=t.UIString("subresource-filter");break;case Protocol.Network.BlockedReason.ContentType:i=t.UIString("content-type");break;case Protocol.Network.BlockedReason.CollapsedByClient:i=t.UIString("extension");break;case Protocol.Network.BlockedReason.CoepFrameResourceNeedsCoepHeader:s=!0,i=t.UIString("CoepFrameResourceNeedsCoepHeader");break;case Protocol.Network.BlockedReason.CoopSandboxedIframeCannotNavigateToCoopPage:s=!0,i=t.UIString("CoopSandboxedIframeCannotNavigateToCoopPage");break;case Protocol.Network.BlockedReason.CorpNotSameOrigin:s=!0,i=t.UIString("NotSameOrigin");break;case Protocol.Network.BlockedReason.CorpNotSameSite:s=!0,i=t.UIString("NotSameSite");break;case Protocol.Network.BlockedReason.CorpNotSameOriginAfterDefaultedToSameOriginByCoep:s=!0,i=t.UIString("NotSameOriginAfterDefaultedToSameOriginByCoep")}s?this._setTextAndTitleAndLink(e,t.UIString("(blocked:%s)",i),"View Headers",()=>{this.parentView().dispatchEventToListeners(Kt.RequestActivated,{showPanel:!0,tab:Gt.Headers})}):this._setTextAndTitle(e,t.UIString("(blocked:%s)",i))}else i?this._setTextAndTitle(e,t.UIString("CORS error"),ls`Cross-Origin Resource Sharing error: ${i.corsError}`):this._request.finished?this._setTextAndTitle(e,t.UIString("Finished")):this._setTextAndTitle(e,t.UIString("(pending)"));else{const i=t.UIString("(failed)");this._request.localizedFailDescription?(v.createTextChild(e,i),this._appendSubtitle(e,this._request.localizedFailDescription,!0),e.title=i+" "+this._request.localizedFailDescription):this._setTextAndTitle(e,i)}}_renderInitiatorCell(e){this._initiatorCell=e;const i=this._request,s=Y.NetworkLog.instance().initiatorInfoForRequest(i),r=i.timing;switch(r&&r.pushStart&&e.appendChild(document.createTextNode(t.UIString("Push / "))),s.type){case $.InitiatorType.Parser:{e.title=s.url+":"+(s.lineNumber+1);const i=fe.WorkspaceImpl.instance().uiSourceCodeForURL(s.url);e.appendChild(_e.Linkifier.linkifyURL(s.url,{text:i?i.displayName():void 0,lineNumber:s.lineNumber,columnNumber:s.columnNumber})),this._appendSubtitle(e,t.UIString("Parser"));break}case $.InitiatorType.Redirect:{e.title=s.url;const r=i.redirectSource();console.assert(null!==r),this.parentView().nodeForRequest(r)?e.appendChild(_e.Linkifier.linkifyRevealable(r,he.displayNameForURL(r.url()))):e.appendChild(_e.Linkifier.linkifyURL(r.url())),this._appendSubtitle(e,t.UIString("Redirect"));break}case $.InitiatorType.Script:{const r=K.NetworkManager.forRequest(i);if(!r)return;const o=this.parentView().linkifier();s.stack?this._linkifiedInitiatorAnchor=o.linkifyStackTraceTopFrame(r.target(),s.stack):this._linkifiedInitiatorAnchor=o.linkifyScriptLocation(r.target(),s.scriptId,s.url,s.lineNumber,{columnNumber:s.columnNumber,className:void 0,tabStop:void 0}),this._linkifiedInitiatorAnchor.title="",e.appendChild(this._linkifiedInitiatorAnchor),this._appendSubtitle(e,t.UIString("Script")),e.classList.add("network-script-initiated");break}case $.InitiatorType.Preload:e.title=t.UIString("Preload"),e.classList.add("network-dim-cell"),e.appendChild(document.createTextNode(t.UIString("Preload")));break;case $.InitiatorType.SignedExchange:e.appendChild(_e.Linkifier.linkifyURL(s.url)),this._appendSubtitle(e,t.UIString("signed-exchange"));break;default:e.title=t.UIString("Other"),e.classList.add("network-dim-cell"),e.appendChild(document.createTextNode(t.UIString("Other")))}}_renderSizeCell(e){const t=de.bytesToString(this._request.resourceSize);if(this._request.cachedInMemory())v.createTextChild(e,ls`(memory cache)`),e.title=ls`Served from memory cache, resource size: ${t}`,e.classList.add("network-dim-cell");else if(this._request.fetchedViaServiceWorker)v.createTextChild(e,ls`(ServiceWorker)`),e.title=ls`Served from ServiceWorker, resource size: ${t}`,e.classList.add("network-dim-cell");else if(this._request.redirectSourceSignedExchangeInfoHasNoErrors())v.createTextChild(e,ls`(signed-exchange)`),e.title=ls`Served from Signed HTTP Exchange, resource size: ${t}`,e.classList.add("network-dim-cell");else if(this._request.fromPrefetchCache())v.createTextChild(e,ls`(prefetch cache)`),e.title=ls`Served from prefetch cache, resource size: ${t}`,e.classList.add("network-dim-cell");else if(this._request.cached())v.createTextChild(e,ls`(disk cache)`),e.title=ls`Served from disk cache, resource size: ${t}`,e.classList.add("network-dim-cell");else{const i=de.bytesToString(this._request.transferSize);v.createTextChild(e,i),e.title=`${i} transferred over network, resource size: ${t}`}this._appendSubtitle(e,t)}_renderTimeCell(e){this._request.duration>0?(this._setTextAndTitle(e,Number.secondsToString(this._request.duration)),this._appendSubtitle(e,Number.secondsToString(this._request.latency))):(e.classList.add("network-dim-cell"),this._setTextAndTitle(e,t.UIString("Pending")))}_appendSubtitle(e,t,i=!1){const s=document.createElement("div");s.classList.add("network-cell-subtitle"),i&&s.classList.add("network-cell-subtitle-show-inline-when-selected"),s.textContent=t,e.appendChild(s)}}class Qt extends jt{createCells(e){super.createCells(e);const t=this.dataGrid.visibleColumnsArray[0],i=ls`${t.title}`,s=ls`level 1`;this.nodeAccessibleText=`${s} ${i}: ${this.cellAccessibleTextMap.get(t.id)}`}renderCell(e,t){if(0===this.dataGrid.indexOfVisibleColumn(t)){const i=e,s=this.leftPadding?this.leftPadding+"px":"";i.style.setProperty("padding-left",s),i.classList.add("disclosure"),this.setCellAccessibleName(i.textContent||"",i,t)}}select(e){super.select(e);const t=this.traverseNextNode(!1,void 0,!0);t&&t.request()&&this.parentView().dispatchEventToListeners(Kt.RequestSelected,t.request())}}var Jt=Object.freeze({__proto__:null,Events:Kt,NetworkLogViewInterface:class{static HTTPRequestsFilter(e){throw new Error("not implemented")}async onLoadFromFile(e){}nodeForRequest(e){throw new Error("not implemented")}headerHeight(){throw new Error("not implemented")}setRecording(e){}setWindow(e,t){}resetFocus(){}columnExtensionResolved(){}hoveredNode(){throw new Error("not implemented")}scheduleRefresh(){}addFilmStripFrames(e){}selectFilmStripFrame(e){}clearFilmStripFrame(){}timeCalculator(){throw new Error("not implemented")}calculator(){throw new Error("not implemented")}setCalculator(e){}flatNodesList(){throw new Error("not implemented")}updateNodeBackground(){}updateNodeSelectedClass(e){}stylesChanged(){}setTextFilterValue(e){}rowHeight(){throw new Error("not implemented")}switchViewMode(e){}handleContextMenuForRequest(e,t){}async exportAll(){}revealAndHighlightRequest(e){}selectRequest(e){}removeAllNodeHighlights(){}static getDCLEventColor(){throw new Error("not implemented")}static getLoadEventColor(){throw new Error("not implemented")}modelAdded(e){}modelRemoved(e){}linkifier(){throw new Error("not implemented")}},NetworkNode:jt,_backgroundColors:$t,NetworkRequestNode:Xt,NetworkGroupNode:Qt});class Zt{constructor(e){this._parentView=e,this._activeGroups=new Map}groupNodeForRequest(e){const t=ee.ResourceTreeModel.frameForRequest(e);if(!t||t.isTopFrame())return null;let i=this._activeGroups.get(t);return i||(i=new Yt(this._parentView,t),this._activeGroups.set(t,i),i)}reset(){this._activeGroups.clear()}}class Yt extends Qt{constructor(e,t){super(e),this._frame=t}displayName(){return new a.ParsedURL(this._frame.url).domain()||this._frame.name||"<iframe>"}renderCell(e,t){super.renderCell(e,t);if(0===this.dataGrid.indexOfVisibleColumn(t)){const i=this.displayName();e.appendChild(y.Icon.create("largeicon-navigator-frame","network-frame-group-icon")),v.createTextChild(e,i),e.title=i,this.setCellAccessibleName(e.textContent||"",e,t)}}}var ei=Object.freeze({__proto__:null,NetworkFrameGrouper:Zt,FrameGroupNode:Yt});class ti extends C.VBox{constructor(e,i,s,r){super(!0),this.registerRequiredCSS("network/networkManageCustomHeadersView.css",{enableLegacyPatching:!0}),this.contentElement.classList.add("custom-headers-wrapper"),this.contentElement.createChild("div","header").textContent=t.UIString("Manage Header Columns"),this._list=new f.ListWidget(this),this._list.element.classList.add("custom-headers-list"),this._list.registerRequiredCSS("network/networkManageCustomHeadersView.css",{enableLegacyPatching:!0});const o=document.createElement("div");o.classList.add("custom-headers-list-list-empty"),o.textContent=t.UIString("No custom headers"),this._list.setEmptyPlaceholder(o),this._list.show(this.contentElement),this.contentElement.appendChild(v.createTextButton(t.UIString("Add custom header…"),this._addButtonClicked.bind(this),"add-button")),this._columnConfigs=new Map,e.forEach(e=>this._columnConfigs.set(e.title.toLowerCase(),e)),this._addHeaderColumnCallback=i,this._changeHeaderColumnCallback=s,this._removeHeaderColumnCallback=r,this.contentElement.tabIndex=0}wasShown(){this._headersUpdated()}_headersUpdated(){this._list.clear(),this._columnConfigs.forEach(e=>this._list.appendItem({header:e.title},e.editable))}_addButtonClicked(){this._list.addNewItem(this._columnConfigs.size,{header:""})}renderItem(e,t){const i=document.createElement("div");i.classList.add("custom-headers-list-item");const s=i.createChild("div","custom-header-name");return s.textContent=e.header,s.title=e.header,i}removeItemRequested(e,t){this._removeHeaderColumnCallback(e.header),this._columnConfigs.delete(e.header.toLowerCase()),this._headersUpdated()}commitEdit(e,t,i){const s=t.control("header").value.trim();let r;r=i?this._addHeaderColumnCallback(s):this._changeHeaderColumnCallback(e.header,s),r&&!i&&this._columnConfigs.delete(e.header.toLowerCase()),r&&this._columnConfigs.set(s.toLowerCase(),{title:s,editable:!0}),this._headersUpdated()}beginEdit(e){const t=this._createEditor();return t.control("header").value=e.header,t}_createEditor(){if(this._editor)return this._editor;const e=new f.Editor;this._editor=e;const i=e.contentElement();i.createChild("div","custom-headers-edit-row").createChild("div","custom-headers-header").textContent=t.UIString("Header Name");return i.createChild("div","custom-headers-edit-row").createChild("div","custom-headers-header").appendChild(e.createInput("header","text","x-custom-header",function(t,i,s){let r=!0;const o=e.control("header").value.trim().toLowerCase();this._columnConfigs.has(o)&&t.header!==o&&(r=!1);return{valid:r,errorMessage:void 0}}.bind(this))),e}}var ii=Object.freeze({__proto__:null,NetworkManageCustomHeadersView:ti});class si extends C.VBox{constructor(e){super(!1),this.registerRequiredCSS("network/networkWaterfallColumn.css",{enableLegacyPatching:!0}),this._canvas=this.contentElement.createChild("canvas"),this._canvas.tabIndex=-1,this.setDefaultFocusedElement(this._canvas),this._canvasPosition=this._canvas.getBoundingClientRect(),this._leftPadding=5,this._fontSize=10,this._rightPadding=0,this._scrollTop=0,this._headerHeight=0,this._calculator=e,this._rawRowHeight=0,this._rowHeight=0,this._offsetWidth=0,this._offsetHeight=0,this._startTime=this._calculator.minimumBoundary(),this._endTime=this._calculator.maximumBoundary(),this._popoverHelper=new P.PopoverHelper(this.element,this._getPopoverRequest.bind(this)),this._popoverHelper.setHasPadding(!0),this._popoverHelper.setTimeout(300,300),this._nodes=[],this._hoveredNode=null,this._eventDividers=new Map,this._updateRequestID,this.element.addEventListener("mousemove",this._onMouseMove.bind(this),!0),this.element.addEventListener("mouseleave",e=>this._setHoveredNode(null,!1),!0),this.element.addEventListener("click",this._onClick.bind(this),!0),this._styleForTimeRangeName=si._buildRequestTimeRangeStyle();const t=si._buildResourceTypeStyle();this._styleForWaitingResourceType=t[0],this._styleForDownloadingResourceType=t[1];const i=Ee.instance().patchColorText("#a5a5a5",Ee.ColorUsage.Foreground);this._wiskerStyle={borderColor:i,lineWidth:1,fillStyle:void 0},this._hoverDetailsStyle={fillStyle:i,lineWidth:1,borderColor:i},this._pathForStyle=new Map,this._textLayers=[]}static _buildRequestTimeRangeStyle(){const e=Ft,t=new Map;return t.set(e.Connecting,{fillStyle:"#FF9800"}),t.set(e.SSL,{fillStyle:"#9C27B0"}),t.set(e.DNS,{fillStyle:"#009688"}),t.set(e.Proxy,{fillStyle:"#A1887F"}),t.set(e.Blocking,{fillStyle:"#AAAAAA"}),t.set(e.Push,{fillStyle:"#8CDBff"}),t.set(e.Queueing,{fillStyle:"white",lineWidth:2,borderColor:"lightgrey"}),t.set(e.Receiving,{fillStyle:"#03A9F4",lineWidth:2,borderColor:"#03A9F4"}),t.set(e.Waiting,{fillStyle:"#00C853"}),t.set(e.ReceivingPush,{fillStyle:"#03A9F4"}),t.set(e.ServiceWorker,{fillStyle:"orange"}),t.set(e.ServiceWorkerPreparation,{fillStyle:"orange"}),t.set(e.ServiceWorkerRespondWith,{fillStyle:"#A8A3FF"}),t}static _buildResourceTypeStyle(){const e=new Map([["document","hsl(215, 100%, 80%)"],["font","hsl(8, 100%, 80%)"],["media","hsl(90, 50%, 80%)"],["image","hsl(90, 50%, 80%)"],["script","hsl(31, 100%, 80%)"],["stylesheet","hsl(272, 64%, 80%)"],["texttrack","hsl(8, 100%, 80%)"],["websocket","hsl(0, 0%, 95%)"],["xhr","hsl(53, 100%, 80%)"],["fetch","hsl(53, 100%, 80%)"],["other","hsl(0, 0%, 95%)"]]),t=new Map,i=new Map;for(const n of Object.values(r.resourceTypes)){let r=e.get(n.name());r||(r=e.get("other"));const a=s(r);t.set(n,{fillStyle:o(r),lineWidth:1,borderColor:a}),i.set(n,{fillStyle:r,lineWidth:1,borderColor:a})}return[t,i];function s(e){const t=n.Color.parse(e);if(!t)return"";const i=t.hsla();return i[1]/=2,i[2]-=Math.min(i[2],.2),t.asString(null)}function o(e){const t=n.Color.parse(e);if(!t)return"";return t.hsla()[2]*=1.1,t.asString(null)}}_resetPaths(){this._pathForStyle.clear(),this._pathForStyle.set(this._wiskerStyle,new Path2D),this._styleForTimeRangeName.forEach(e=>this._pathForStyle.set(e,new Path2D)),this._styleForWaitingResourceType.forEach(e=>this._pathForStyle.set(e,new Path2D)),this._styleForDownloadingResourceType.forEach(e=>this._pathForStyle.set(e,new Path2D)),this._pathForStyle.set(this._hoverDetailsStyle,new Path2D)}willHide(){this._popoverHelper.hidePopover()}wasShown(){this.update()}_onMouseMove(e){this._setHoveredNode(this.getNodeFromPoint(e.offsetX,e.offsetY),e.shiftKey)}_onClick(e){this._setSelectedNode(this.getNodeFromPoint(e.offsetX,e.offsetY))&&e.consume(!0)}_getPopoverRequest(t){if(!this._hoveredNode)return null;const i=this._hoveredNode.request();if(!i)return null;let s,r,o;if(!e.Settings.instance().moduleSetting("networkColorCodeResourceTypes").get()&&!this._calculator.startAtZero?(s=xt.calculateRequestTimeRanges(i,0).find(e=>e.name===Ft.Total),r=this._timeToPosition(s.start),o=this._timeToPosition(s.end)):(s=this._getSimplifiedBarRange(i,0),r=s.start,o=s.end),o-r<50){const e=(o-r)/2;r=r+e-25,o=o-e+25}if(t.clientX<this._canvasPosition.left+r||t.clientX>this._canvasPosition.left+o)return null;const n=this._nodes.findIndex(e=>e.hovered()),a=this._getBarHeight(s.name),l=this._headerHeight+(this._rowHeight*n-this._scrollTop)+(this._rowHeight-a)/2;if(t.clientY<this._canvasPosition.top+l||t.clientY>this._canvasPosition.top+l+a)return null;const d=this.element.boxInWindow();return d.x+=r,d.y+=l,d.width=o-r,d.height=a,{box:d,show:e=>{const t=xt.createTimingTable(i,this._calculator);return e.contentElement.appendChild(t),Promise.resolve(!0)},hide:void 0}}_setHoveredNode(e,t){this._hoveredNode&&this._hoveredNode.setHovered(!1,!1),this._hoveredNode=e,this._hoveredNode&&this._hoveredNode.setHovered(!0,t)}_setSelectedNode(e){return!(!e||!e.dataGrid)&&(e.select(),e.dataGrid.element.focus(),!0)}setRowHeight(e){this._rawRowHeight=e,this._updateRowHeight()}_updateRowHeight(){this._rowHeight=Math.round(this._rawRowHeight*window.devicePixelRatio)/window.devicePixelRatio}setHeaderHeight(e){this._headerHeight=e}setRightPadding(e){this._rightPadding=e,this._calculateCanvasSize()}setCalculator(e){this._calculator=e}getNodeFromPoint(e,t){return t<=this._headerHeight?null:this._nodes[Math.floor((this._scrollTop+t-this._headerHeight)/this._rowHeight)]}scheduleDraw(){this._updateRequestID||(this._updateRequestID=this.element.window().requestAnimationFrame(()=>this.update()))}update(e,t,i){void 0!==e&&this._scrollTop!==e&&(this._popoverHelper.hidePopover(),this._scrollTop=e),i&&(this._nodes=i,this._calculateCanvasSize()),void 0!==t&&(this._eventDividers=t),this._updateRequestID&&(this.element.window().cancelAnimationFrame(this._updateRequestID),delete this._updateRequestID),this._startTime=this._calculator.minimumBoundary(),this._endTime=this._calculator.maximumBoundary(),this._resetCanvas(),this._resetPaths(),this._textLayers=[],this._draw()}_resetCanvas(){const e=window.devicePixelRatio;this._canvas.width=this._offsetWidth*e,this._canvas.height=this._offsetHeight*e,this._canvas.style.width=this._offsetWidth+"px",this._canvas.style.height=this._offsetHeight+"px"}onResize(){super.onResize(),this._updateRowHeight(),this._calculateCanvasSize(),this.scheduleDraw()}_calculateCanvasSize(){this._offsetWidth=this.contentElement.offsetWidth-this._rightPadding,this._offsetHeight=this.contentElement.offsetHeight,this._calculator.setDisplayWidth(this._offsetWidth),this._canvasPosition=this._canvas.getBoundingClientRect()}_timeToPosition(e){const t=(this._offsetWidth-this._leftPadding)/(this._endTime-this._startTime);return Math.floor(this._leftPadding+(e-this._startTime)*t)}_didDrawForTest(){}_draw(){const t=!e.Settings.instance().moduleSetting("networkColorCodeResourceTypes").get()&&!this._calculator.startAtZero,i=this._nodes,s=this._canvas.getContext("2d");if(!s)return;s.save(),s.scale(window.devicePixelRatio,window.devicePixelRatio),s.translate(0,this._headerHeight),s.rect(0,0,this._offsetWidth,this._offsetHeight),s.clip();const r=Math.floor(this._scrollTop/this._rowHeight),o=Math.min(i.length,r+Math.ceil(this._offsetHeight/this._rowHeight));for(let e=r;e<o;e++){const r=this._rowHeight*e,o=i[e];this._decorateRow(s,o,r-this._scrollTop);let n=[];o.hasChildren()&&!o.expanded&&(n=o.flatChildren()),n.push(o);for(const e of n)t?this._buildTimingBarLayers(e,r-this._scrollTop):this._buildSimplifiedBarLayers(s,e,r-this._scrollTop)}this._drawLayers(s),s.save(),s.fillStyle=Ee.instance().patchColorText("#888",Ee.ColorUsage.Foreground);for(const e of this._textLayers)s.fillText(e.text,e.x,e.y);s.restore(),this._drawEventDividers(s),s.restore();const n=we.TimelineGrid.calculateGridOffsets(this._calculator);we.TimelineGrid.drawCanvasGrid(s,n),we.TimelineGrid.drawCanvasHeaders(s,n,e=>this._calculator.formatValue(e,n.precision),this._fontSize,this._headerHeight,75),s.clearRect(this._offsetWidth-18,0,18,this._headerHeight),this._didDrawForTest()}_drawLayers(e){for(const t of this._pathForStyle){const i=t[0],s=t[1];e.save(),e.beginPath(),i.lineWidth&&(e.lineWidth=i.lineWidth,i.borderColor&&(e.strokeStyle=i.borderColor),e.stroke(s)),i.fillStyle&&(e.fillStyle=i.fillStyle,e.fill(s)),e.restore()}}_drawEventDividers(e){e.save(),e.lineWidth=1;for(const t of this._eventDividers.keys()){e.strokeStyle=t;for(const i of this._eventDividers.get(t)||[]){e.beginPath();const t=this._timeToPosition(i);e.moveTo(t,0),e.lineTo(t,this._offsetHeight)}e.stroke()}e.restore()}_getBarHeight(e){const t=Ft;switch(e){case t.Connecting:case t.SSL:case t.DNS:case t.Proxy:case t.Blocking:case t.Push:case t.Queueing:return 7;default:return 13}}_getSimplifiedBarRange(e,t){const i=this._offsetWidth-this._leftPadding,s=this._calculator.computeBarGraphPercentages(e);return{start:this._leftPadding+Math.floor(s.start/100*i)+t,mid:this._leftPadding+Math.floor(s.middle/100*i)+t,end:this._leftPadding+Math.floor(s.end/100*i)+t}}_buildSimplifiedBarLayers(e,t,i){const s=t.request();if(!s)return;const r=this._getSimplifiedBarRange(s,.5),o=this._getBarHeight();i+=Math.floor(this._rowHeight/2-o/2+1)-.5;const n=this._styleForWaitingResourceType.get(s.resourceType());this._pathForStyle.get(n).rect(r.start,i,r.mid-r.start,o-1);const a=Math.max(2,r.end-r.mid),l=this._styleForDownloadingResourceType.get(s.resourceType());this._pathForStyle.get(l).rect(r.mid,i,a,o-1);let d=null;if(t.hovered()){d=this._calculator.computeBarGraphLabels(s);const t=10,n=e.measureText(d.left).width,l=e.measureText(d.right).width,c=this._pathForStyle.get(this._hoverDetailsStyle);if(n<r.mid-r.start){const e=r.start+(r.mid-r.start-n)/2;this._textLayers.push({text:d.left,x:e,y:i+this._fontSize})}else t+n+this._leftPadding<r.start&&(this._textLayers.push({text:d.left,x:r.start-n-t-1,y:i+this._fontSize}),c.moveTo(r.start-t,i+Math.floor(o/2)),c.arc(r.start,i+Math.floor(o/2),2,0,2*Math.PI),c.moveTo(r.start-t,i+Math.floor(o/2)),c.lineTo(r.start,i+Math.floor(o/2)));const h=r.mid+a+.5;if(l<h-r.mid){const e=r.mid+(h-r.mid-l)/2;this._textLayers.push({text:d.right,x:e,y:i+this._fontSize})}else h+t+l<this._offsetWidth-this._leftPadding&&(this._textLayers.push({text:d.right,x:h+t+1,y:i+this._fontSize}),c.moveTo(h,i+Math.floor(o/2)),c.arc(h,i+Math.floor(o/2),2,0,2*Math.PI),c.moveTo(h,i+Math.floor(o/2)),c.lineTo(h+t,i+Math.floor(o/2)))}if(!this._calculator.startAtZero){const t=xt.calculateRequestTimeRanges(s,0).find(e=>e.name===Ft.Total),n=d?e.measureText(d.left).width:0,a=n<r.mid-r.start,l=13,c=d&&!a?n+l:0,h=this._timeToPosition(t.start);if(r.start-c>h){const e=this._pathForStyle.get(this._wiskerStyle);e.moveTo(h,i+Math.floor(o/2)),e.lineTo(r.start-c,i+Math.floor(o/2));const t=o/2;e.moveTo(h+.5,i+t/2),e.lineTo(h+.5,i+o-t/2-1)}}}_buildTimingBarLayers(e,t){const i=e.request();if(!i)return;const s=xt.calculateRequestTimeRanges(i,0);for(const e of s){if(e.name===Ft.Total||e.name===Ft.Sending||e.end-e.start==0)continue;const i=this._styleForTimeRangeName.get(e.name),s=this._pathForStyle.get(i),r=i.lineWidth||0,o=this._getBarHeight(e.name),n=t+Math.floor(this._rowHeight/2-o/2)+r/2,a=this._timeToPosition(e.start),l=this._timeToPosition(e.end);s.rect(a,n,l-a,o-r)}}_decorateRow(e,t,i){const s=t.backgroundColor();e.save(),e.beginPath(),e.fillStyle=Ee.instance().getComputedValue(s),e.rect(0,i,this._offsetWidth,this._rowHeight),e.fill(),e.restore()}}var ri=Object.freeze({__proto__:null,NetworkWaterfallColumn:si,_TextLayer:void 0,_LayerStyle:void 0});class oi{constructor(t,i,s,r){this._networkLogView=t,this._persistantSettings=e.Settings.instance().createSetting("networkLogColumns",{}),this._networkLogLargeRowsSetting=r,this._networkLogLargeRowsSetting.addChangeListener(this._updateRowsSize,this),this._eventDividers=new Map,this._eventDividersShown=!1,this._gridMode=!0,this._columns=[],this._waterfallRequestsAreStale=!1,this._waterfallScrollerWidthIsStale=!0,this._popupLinkifier=new _e.Linkifier,this._calculatorsMap=new Map,this._calculatorsMap.set(ai.Time,i),this._calculatorsMap.set(ai.Duration,s),this._lastWheelTime=0,this._dataGrid,this._splitWidget,this._waterfallColumn,this._activeScroller,this._dataGridScroller,this._waterfallScroller,this._waterfallScrollerContent,this._waterfallHeaderElement,this._waterfallColumnSortIcon,this._activeWaterfallSortId,this._setupDataGrid(),this._setupWaterfall()}static _convertToDataGridDescriptor(e){return{id:e.id,title:e.title,sortable:e.sortable,align:e.align,nonSelectable:e.nonSelectable,weight:e.weight,allowInSortByEvenWhenHidden:e.allowInSortByEvenWhenHidden}}wasShown(){this._updateRowsSize()}willHide(){this._popoverHelper&&this._popoverHelper.hidePopover()}reset(){this._popoverHelper&&this._popoverHelper.hidePopover(),this._eventDividers.clear()}_setupDataGrid(){const e=di,t=li;this._columns=[];for(const i of e){const e=Object.assign({},t,i);e.id=e.id,e.subtitle&&(e.titleDOMFragment=this._makeHeaderFragment(e.title,e.subtitle)),this._columns.push(e)}this._loadCustomColumnsAndSettings(),this._popoverHelper=new P.PopoverHelper(this._networkLogView.element,this._getPopoverRequest.bind(this)),this._popoverHelper.setHasPadding(!0),this._popoverHelper.setTimeout(300,300),this._dataGrid=new oe.SortableDataGrid({displayName:ls`Network Log`,columns:this._columns.map(oi._convertToDataGridDescriptor)}),this._dataGrid.element.addEventListener("mousedown",e=>{!this._dataGrid.selectedNode&&e.button&&e.consume()},!0),this._dataGridScroller=this._dataGrid.scrollContainer,this._updateColumns(),this._dataGrid.addEventListener(ne.Events.SortingChanged,this._sortHandler,this),this._dataGrid.setHeaderContextMenuCallback(this._innerHeaderContextMenu.bind(this)),this._activeWaterfallSortId=hi.StartTime,this._dataGrid.markColumnAsSortedBy(ni,ne.Order.Ascending),this._splitWidget=new F.SplitWidget(!0,!0,"networkPanelSplitViewWaterfall",200);const i=this._dataGrid.asWidget();i.setMinimumSize(150,0),this._splitWidget.setMainWidget(i)}_setupWaterfall(){this._waterfallColumn=new si(this._networkLogView.calculator()),this._waterfallColumn.element.addEventListener("contextmenu",function(e){const t=e,i=this._waterfallColumn.getNodeFromPoint(t.offsetX,t.offsetY);if(!i)return;const s=i.request();if(!s)return;const r=new I.ContextMenu(t);this._networkLogView.handleContextMenuForRequest(r,s),r.show()}.bind(this)),this._waterfallColumn.element.addEventListener("mousewheel",this._onMouseWheel.bind(this,!1),{passive:!0}),this._waterfallColumn.element.addEventListener("touchstart",this._onTouchStart.bind(this)),this._waterfallColumn.element.addEventListener("touchmove",this._onTouchMove.bind(this)),this._waterfallColumn.element.addEventListener("touchend",this._onTouchEnd.bind(this)),this._dataGridScroller.addEventListener("mousewheel",this._onMouseWheel.bind(this,!0),!0),this._dataGridScroller.addEventListener("touchstart",this._onTouchStart.bind(this)),this._dataGridScroller.addEventListener("touchmove",this._onTouchMove.bind(this)),this._dataGridScroller.addEventListener("touchend",this._onTouchEnd.bind(this)),this._waterfallScroller=this._waterfallColumn.contentElement.createChild("div","network-waterfall-v-scroll"),this._waterfallScrollerContent=this._waterfallScroller.createChild("div","network-waterfall-v-scroll-content"),this._dataGrid.addEventListener(ne.Events.PaddingChanged,()=>{this._waterfallScrollerWidthIsStale=!0,this._syncScrollers()}),this._dataGrid.addEventListener(ae.Events.ViewportCalculated,this._redrawWaterfallColumn.bind(this)),this._createWaterfallHeader(),this._waterfallColumn.contentElement.classList.add("network-waterfall-view"),this._waterfallColumn.setMinimumSize(100,0),this._splitWidget.setSidebarWidget(this._waterfallColumn),this.switchViewMode(!1)}_onMouseWheel(e,t){e&&t.consume(!0);const i=t,s=Date.now()-this._lastWheelTime<80;this._activeScroller.scrollBy({top:i.deltaY,behavior:s?"auto":"smooth"}),this._syncScrollers(),this._lastWheelTime=Date.now()}_onTouchStart(e){const t=e;this._hasScrollerTouchStarted=!0,this._scrollerTouchStartPos=t.changedTouches[0].pageY}_onTouchMove(e){if(!this._hasScrollerTouchStarted)return;const t=e.changedTouches[0].pageY,i=this._scrollerTouchStartPos-t;this._activeScroller.scrollBy({top:i,behavior:"auto"}),this._syncScrollers(),this._scrollerTouchStartPos=t}_onTouchEnd(){this._hasScrollerTouchStarted=!1}_syncScrollers(){this._waterfallColumn.isShowing()&&(this._waterfallScrollerContent.style.height=this._dataGridScroller.scrollHeight+"px",this._updateScrollerWidthIfNeeded(),this._dataGridScroller.scrollTop=this._waterfallScroller.scrollTop)}_updateScrollerWidthIfNeeded(){this._waterfallScrollerWidthIsStale&&(this._waterfallScrollerWidthIsStale=!1,this._waterfallColumn.setRightPadding(this._waterfallScroller.offsetWidth-this._waterfallScrollerContent.offsetWidth))}_redrawWaterfallColumn(){if(!this._waterfallRequestsAreStale)return this._updateScrollerWidthIfNeeded(),void this._waterfallColumn.update(this._activeScroller.scrollTop,this._eventDividersShown?this._eventDividers:void 0);this._syncScrollers();const e=this._networkLogView.flatNodesList();this._waterfallColumn.update(this._activeScroller.scrollTop,this._eventDividers,e)}_createWaterfallHeader(){this._waterfallHeaderElement=this._waterfallColumn.contentElement.createChild("div","network-waterfall-header"),this._waterfallHeaderElement.addEventListener("click",function(){const e=ne.Order,t="waterfall"===this._dataGrid.sortColumnId(),i=this._dataGrid.isSortOrderAscending(),s=t&&i?e.Descending:e.Ascending;this._dataGrid.markColumnAsSortedBy("waterfall",s),this._sortHandler()}.bind(this)),this._waterfallHeaderElement.addEventListener("contextmenu",e=>this._innerHeaderContextMenu(new I.ContextMenu(e)));this._waterfallHeaderElement.createChild("div").textContent=t.UIString("Waterfall"),this._waterfallColumnSortIcon=y.Icon.create("","sort-order-icon"),this._waterfallHeaderElement.createChild("div","sort-order-icon-container").appendChild(this._waterfallColumnSortIcon)}setCalculator(e){this._waterfallColumn.setCalculator(e)}scheduleRefresh(){this._waterfallColumn.scheduleDraw()}_updateRowsSize(){const e=!!this._networkLogLargeRowsSetting.get();this._dataGrid.element.classList.toggle("small",!e),this._dataGrid.scheduleUpdate(),this._waterfallScrollerWidthIsStale=!0,this._waterfallColumn.setRowHeight(e?41:21),this._waterfallScroller.classList.toggle("small",!e),this._waterfallHeaderElement.classList.toggle("small",!e),window.requestAnimationFrame(()=>{this._waterfallColumn.setHeaderHeight(this._waterfallScroller.offsetTop)})}show(e){this._splitWidget.show(e)}setHidden(e){b.setHidden(this._splitWidget.element,e)}dataGrid(){return this._dataGrid}sortByCurrentColumn(){this._sortHandler()}_sortHandler(){const e=this._dataGrid.sortColumnId();if(this._networkLogView.removeAllNodeHighlights(),this._waterfallRequestsAreStale=!0,"waterfall"===e){this._dataGrid.sortOrder()===ne.Order.Ascending?this._waterfallColumnSortIcon.setIconType("smallicon-triangle-up"):this._waterfallColumnSortIcon.setIconType("smallicon-triangle-down");const e=Xt.RequestPropertyComparator.bind(null,this._activeWaterfallSortId);return this._dataGrid.sortNodes(e,!this._dataGrid.isSortOrderAscending()),void this._dataGridSortedForTest()}this._waterfallColumnSortIcon.setIconType("");const t=this._columns.find(t=>t.id===e);if(!t||!t.sortingFunction)return;const i=t.sortingFunction;i&&(this._dataGrid.sortNodes(i,!this._dataGrid.isSortOrderAscending()),this._dataGridSortedForTest())}_dataGridSortedForTest(){}_updateColumns(){if(!this._dataGrid)return;const e=new Set;if(this._gridMode)for(const t of this._columns)t.visible&&e.add(t.id);else{const t=this._columns.find(e=>"path"===e.hideableGroup&&e.visible);t?e.add(t.id):e.add("name")}this._dataGrid.setColumnsVisiblity(e)}switchViewMode(e){this._gridMode!==e&&(this._gridMode=e,e?(this._splitWidget.showBoth(),this._activeScroller=this._waterfallScroller,this._waterfallScroller.scrollTop=this._dataGridScroller.scrollTop,this._dataGrid.setScrollContainer(this._waterfallScroller)):(this._networkLogView.removeAllNodeHighlights(),this._splitWidget.hideSidebar(),this._activeScroller=this._dataGridScroller,this._dataGrid.setScrollContainer(this._dataGridScroller)),this._networkLogView.element.classList.toggle("brief-mode",!e),this._updateColumns(),this._updateRowsSize())}_toggleColumnVisibility(e){this._loadCustomColumnsAndSettings(),e.visible=!e.visible,this._saveColumnsSettings(),this._updateColumns()}_saveColumnsSettings(){const e={};for(const t of this._columns)e[t.id]={visible:t.visible,title:t.title};this._persistantSettings.set(e)}_loadCustomColumnsAndSettings(){const e=this._persistantSettings.get(),t=Object.keys(e);for(const i of t){const t=e[i];let s=this._columns.find(e=>e.id===i);s||(s=this._addCustomHeader(t.title,i)||void 0),s&&s.hideable&&"boolean"==typeof t.visible&&(s.visible=!!t.visible),s&&"string"==typeof t.title&&(s.title=t.title)}}_makeHeaderFragment(e,t){const i=document.createDocumentFragment();v.createTextChild(i,e);const s=i.createChild("div","network-header-subtitle");return v.createTextChild(s,t),i}_innerHeaderContextMenu(e){const i=this._columns.filter(e=>e.hideable),s=i.filter(e=>!e.isResponseHeader),r=new Map,o=[];for(const e of s)if(e.hideableGroup){const t=e.hideableGroup;let i=r.get(t);i||(i=[],r.set(t,i)),i.push(e)}else o.push(e);for(const t of r.values()){const i=t.filter(e=>e.visible);for(const s of t){const t=1===i.length&&i[0]===s;e.headerSection().appendCheckboxItem(s.title,this._toggleColumnVisibility.bind(this,s),s.visible,t)}e.headerSection().appendSeparator()}for(const t of o)e.headerSection().appendCheckboxItem(t.title,this._toggleColumnVisibility.bind(this,t),t.visible);const n=e.footerSection().appendSubMenuItem(t.UIString("Response Headers")),a=i.filter(e=>e.isResponseHeader);for(const e of a)n.defaultSection().appendCheckboxItem(e.title,this._toggleColumnVisibility.bind(this,e),e.visible);n.footerSection().appendItem(t.UIString("Manage Header Columns…"),this._manageCustomHeaderDialog.bind(this));const l=hi,d=e.footerSection().appendSubMenuItem(t.UIString("Waterfall"));function c(e){let t=this._calculatorsMap.get(ai.Time);const i=hi;e!==i.Duration&&e!==i.Latency||(t=this._calculatorsMap.get(ai.Duration)),this._networkLogView.setCalculator(t),this._activeWaterfallSortId=e,this._dataGrid.markColumnAsSortedBy("waterfall",ne.Order.Ascending),this._sortHandler()}d.defaultSection().appendCheckboxItem(t.UIString("Start Time"),c.bind(this,l.StartTime),this._activeWaterfallSortId===l.StartTime),d.defaultSection().appendCheckboxItem(t.UIString("Response Time"),c.bind(this,l.ResponseTime),this._activeWaterfallSortId===l.ResponseTime),d.defaultSection().appendCheckboxItem(t.UIString("End Time"),c.bind(this,l.EndTime),this._activeWaterfallSortId===l.EndTime),d.defaultSection().appendCheckboxItem(t.UIString("Total Duration"),c.bind(this,l.Duration),this._activeWaterfallSortId===l.Duration),d.defaultSection().appendCheckboxItem(t.UIString("Latency"),c.bind(this,l.Latency),this._activeWaterfallSortId===l.Latency)}_manageCustomHeaderDialog(){const e=[];for(const t of this._columns)t.isResponseHeader&&e.push({title:t.title,editable:t.isCustomHeader});const t=new ti(e,e=>!!this._addCustomHeader(e),this._changeCustomHeader.bind(this),this._removeCustomHeader.bind(this)),i=new M.Dialog;t.show(i.contentElement),i.setSizeBehavior(H.SizeBehavior.MeasureContent),i.show(this._networkLogView.element)}_removeCustomHeader(e){e=e.toLowerCase();const t=this._columns.findIndex(t=>t.id===e);return-1!==t&&(this._columns.splice(t,1),this._dataGrid.removeColumn(e),this._saveColumnsSettings(),this._updateColumns(),!0)}_addCustomHeader(e,t,i){t||(t=e.toLowerCase()),void 0===i&&(i=this._columns.length-1);if(this._columns.find(e=>e.id===t))return null;const s=Object.assign({},li,{id:t,title:e,isResponseHeader:!0,isCustomHeader:!0,visible:!0,sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,t)});return this._columns.splice(i,0,s),this._dataGrid&&this._dataGrid.addColumn(oi._convertToDataGridDescriptor(s),i),this._saveColumnsSettings(),this._updateColumns(),s}_changeCustomHeader(e,t,i){i||(i=t.toLowerCase()),e=e.toLowerCase();const s=this._columns.findIndex(t=>t.id===e),r=this._columns[s],o=this._columns.find(e=>e.id===i);return!(!r||o&&e!==i)&&(this._removeCustomHeader(e),this._addCustomHeader(t,i,s),!0)}_getPopoverRequest(e){if(!this._gridMode)return null;const t=this._networkLogView.hoveredNode();if(!t||!e.target)return null;const i=e.target.enclosingNodeOrSelfWithClass("network-script-initiated");if(!i)return null;const s=t.request();return s?{box:i.boxInWindow(),show:async e=>{this._popupLinkifier.setLiveLocationUpdateCallback(()=>{e.setSizeBehavior(H.SizeBehavior.MeasureContent)});const t=nt.createStackTracePreview(s,this._popupLinkifier,!1);return!!t&&(e.contentElement.appendChild(t.element),!0)},hide:this._popupLinkifier.reset.bind(this._popupLinkifier)}:null}addEventDividers(e,t){let i="transparent";switch(t){case"network-dcl-divider":i="#0867CB";break;case"network-load-divider":i="#B31412";break;default:return}const s=this._eventDividers.get(i)||[];this._eventDividers.set(i,s.concat(e)),this._networkLogView.scheduleRefresh()}hideEventDividers(){this._eventDividersShown=!0,this._redrawWaterfallColumn()}showEventDividers(){this._eventDividersShown=!1,this._redrawWaterfallColumn()}selectFilmStripFrame(e){this._eventDividers.set(ci,[e]),this._redrawWaterfallColumn()}clearFilmStripFrame(){this._eventDividers.delete(ci),this._redrawWaterfallColumn()}}const ni="waterfall",ai={Duration:"Duration",Time:"Time"},li={subtitle:null,visible:!1,weight:6,sortable:!0,hideable:!0,hideableGroup:null,nonSelectable:!1,isResponseHeader:!1,isCustomHeader:!1,allowInSortByEvenWhenHidden:!1},di=[{id:"name",title:t.UIString("Name"),subtitle:t.UIString("Path"),visible:!0,weight:20,hideable:!0,hideableGroup:"path",sortingFunction:Xt.NameComparator},{id:"path",title:ls`Path`,hideable:!0,hideableGroup:"path",sortingFunction:Xt.RequestPropertyComparator.bind(null,"pathname")},{id:"url",title:ls`Url`,hideable:!0,hideableGroup:"path",sortingFunction:Xt.RequestURLComparator},{id:"method",title:t.UIString("Method"),sortingFunction:Xt.RequestPropertyComparator.bind(null,"requestMethod")},{id:"status",title:t.UIString("Status"),visible:!0,subtitle:t.UIString("Text"),sortingFunction:Xt.RequestPropertyComparator.bind(null,"statusCode")},{id:"protocol",title:t.UIString("Protocol"),sortingFunction:Xt.RequestPropertyComparator.bind(null,"protocol")},{id:"scheme",title:t.UIString("Scheme"),sortingFunction:Xt.RequestPropertyComparator.bind(null,"scheme")},{id:"domain",title:t.UIString("Domain"),sortingFunction:Xt.RequestPropertyComparator.bind(null,"domain")},{id:"remoteaddress",title:t.UIString("Remote Address"),weight:10,align:ne.Align.Right,sortingFunction:Xt.RemoteAddressComparator},{id:"type",title:t.UIString("Type"),visible:!0,sortingFunction:Xt.TypeComparator},{id:"initiator",title:t.UIString("Initiator"),visible:!0,weight:10,sortingFunction:Xt.InitiatorComparator},{id:"cookies",title:t.UIString("Cookies"),align:ne.Align.Right,sortingFunction:Xt.RequestCookiesCountComparator},{id:"setcookies",title:t.UIString("Set Cookies"),align:ne.Align.Right,sortingFunction:Xt.ResponseCookiesCountComparator},{id:"size",title:t.UIString("Size"),visible:!0,subtitle:t.UIString("Content"),align:ne.Align.Right,sortingFunction:Xt.SizeComparator},{id:"time",title:t.UIString("Time"),visible:!0,subtitle:t.UIString("Latency"),align:ne.Align.Right,sortingFunction:Xt.RequestPropertyComparator.bind(null,"duration")},{id:"priority",title:t.UIString("Priority"),sortingFunction:Xt.PriorityComparator},{id:"connectionid",title:t.UIString("Connection ID"),sortingFunction:Xt.RequestPropertyComparator.bind(null,"connectionId")},{id:"cache-control",isResponseHeader:!0,title:t.UIString("Cache-Control"),sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"cache-control")},{id:"connection",isResponseHeader:!0,title:ls`${"Connection"}`,sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"connection")},{id:"content-encoding",isResponseHeader:!0,title:t.UIString("Content-Encoding"),sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"content-encoding")},{id:"content-length",isResponseHeader:!0,title:t.UIString("Content-Length"),align:ne.Align.Right,sortingFunction:Xt.ResponseHeaderNumberComparator.bind(null,"content-length")},{id:"etag",isResponseHeader:!0,title:t.UIString("ETag"),sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"etag")},{id:"keep-alive",isResponseHeader:!0,title:t.UIString("Keep-Alive"),sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"keep-alive")},{id:"last-modified",isResponseHeader:!0,title:t.UIString("Last-Modified"),sortingFunction:Xt.ResponseHeaderDateComparator.bind(null,"last-modified")},{id:"server",isResponseHeader:!0,title:t.UIString("Server"),sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"server")},{id:"vary",isResponseHeader:!0,title:t.UIString("Vary"),sortingFunction:Xt.ResponseHeaderStringComparator.bind(null,"vary")},{id:"waterfall",title:ls`Waterfall`,visible:!1,hideable:!1,allowInSortByEvenWhenHidden:!0}],ci="#fccc49",hi={StartTime:"startTime",ResponseTime:"responseReceivedTime",EndTime:"endTime",Duration:"duration",Latency:"latency"};var ui=Object.freeze({__proto__:null,NetworkLogViewColumns:oi,_initialSortColumn:ni,_calculatorTypes:ai,_defaultColumnConfig:li,_filmStripDividerColor:ci,WaterfallSortIds:hi,Descriptor:void 0});class mi extends C.VBox{constructor(i,s,o){function n(){this._rawRowHeight=this._networkLogLargeRowsSetting.get()?41:21,this._rowHeight=this._computeRowHeight()}super(),this.setMinimumSize(50,64),this.registerRequiredCSS("network/networkLogView.css",{enableLegacyPatching:!0}),this.element.id="network-container",this.element.classList.add("no-node-selected"),this._networkHideDataURLSetting=e.Settings.instance().createSetting("networkHideDataURL",!1),this._networkShowIssuesOnlySetting=e.Settings.instance().createSetting("networkShowIssuesOnly",!1),this._networkOnlyBlockedRequestsSetting=e.Settings.instance().createSetting("networkOnlyBlockedRequests",!1),this._networkResourceTypeFiltersSetting=e.Settings.instance().createSetting("networkResourceTypeFilters",{}),this._rawRowHeight=0,this._progressBarContainer=s,this._networkLogLargeRowsSetting=o,this._networkLogLargeRowsSetting.addChangeListener(n.bind(this),this),this._rawRowHeight=0,this._rowHeight=0,n.call(this),this._timeCalculator=new It,this._durationCalculator=new qt,this._calculator=this._timeCalculator,this._columns=new oi(this,this._timeCalculator,this._durationCalculator,o),this._columns.show(this.element),this._staleRequests=new Set,this._mainRequestLoadTime=-1,this._mainRequestDOMContentLoadedTime=-1,this._highlightedSubstringChanges=[],this._filters=[],this._timeFilter=null,this._hoveredNode=null,this._recordingHint=null,this._refreshRequestId=null,this._highlightedNode=null,this._linkifier=new _e.Linkifier,this._recording=!1,this._needsRefresh=!1,this._headerHeight=0,this._groupLookups=new Map,this._groupLookups.set("Frame",new Zt(this)),this._activeGroupLookup=null,this._textFilterUI=new U.TextFilterUI,this._textFilterUI.addEventListener(U.FilterUI.Events.FilterChanged,this._filterChanged,this),i.addFilter(this._textFilterUI),this._dataURLFilterUI=new U.CheckboxFilterUI("hide-data-url",t.UIString("Hide data URLs"),!0,this._networkHideDataURLSetting),this._dataURLFilterUI.addEventListener(U.FilterUI.Events.FilterChanged,this._filterChanged.bind(this),this),this._dataURLFilterUI.element().title=ls`Hides data: and blob: URLs`,i.addFilter(this._dataURLFilterUI);const a=Object.values(r.resourceCategories).map(e=>({name:e.title,label:e.shortTitle,title:e.title}));this._resourceCategoryFilterUI=new U.NamedBitSetFilterUI(a,this._networkResourceTypeFiltersSetting),b.setAccessibleName(this._resourceCategoryFilterUI.element(),ls`Resource types to include`),this._resourceCategoryFilterUI.addEventListener(U.FilterUI.Events.FilterChanged,this._filterChanged.bind(this),this),i.addFilter(this._resourceCategoryFilterUI),this._onlyIssuesFilterUI=new U.CheckboxFilterUI("only-show-issues",ls`Has blocked cookies`,!0,this._networkShowIssuesOnlySetting),this._onlyIssuesFilterUI.addEventListener(U.FilterUI.Events.FilterChanged,this._filterChanged.bind(this),this),this._onlyIssuesFilterUI.element().title=ls`Only show requests with blocked response cookies`,i.addFilter(this._onlyIssuesFilterUI),this._onlyBlockedRequestsUI=new U.CheckboxFilterUI("only-show-blocked-requests",ls`Blocked Requests`,!0,this._networkOnlyBlockedRequestsSetting),this._onlyBlockedRequestsUI.addEventListener(U.FilterUI.Events.FilterChanged,this._filterChanged.bind(this),this),this._onlyBlockedRequestsUI.element().title=ls`Only show blocked requests`,i.addFilter(this._onlyBlockedRequestsUI),this._filterParser=new Le.FilterParser(vi),this._suggestionBuilder=new B.FilterSuggestionBuilder(vi,mi._sortSearchValues),this._resetSuggestionBuilder(),this._dataGrid=this._columns.dataGrid(),this._setupDataGrid(),this._columns.sortByCurrentColumn(),i.filterButton().addEventListener(S.ToolbarButton.Events.Click,this._dataGrid.scheduleUpdate.bind(this._dataGrid,!0)),this._summaryToolbar=new S.Toolbar("network-summary-bar",this.element),new N.DropTarget(this.element,[N.Type.File],t.UIString("Drop HAR files here"),this._handleDrop.bind(this)),e.Settings.instance().moduleSetting("networkColorCodeResourceTypes").addChangeListener(this._invalidateAllItems.bind(this,!1),this),j.TargetManager.instance().observeModels(K.NetworkManager,this),Y.NetworkLog.instance().addEventListener(Y.Events.RequestAdded,this._onRequestUpdated,this),Y.NetworkLog.instance().addEventListener(Y.Events.RequestUpdated,this._onRequestUpdated,this),Y.NetworkLog.instance().addEventListener(Y.Events.Reset,this._reset,this),this._updateGroupByFrame(),e.Settings.instance().moduleSetting("network.group-by-frame").addChangeListener(()=>this._updateGroupByFrame()),this._filterBar=i,this._textFilterSetting=e.Settings.instance().createSetting("networkTextFilter",""),this._textFilterSetting.get()&&this.setTextFilterValue(this._textFilterSetting.get())}_updateGroupByFrame(){const t=e.Settings.instance().moduleSetting("network.group-by-frame").get();this._setGrouping(t?"Frame":null)}static _sortSearchValues(e,t){e===Ci.Priority?t.sort((e,t)=>{const i=ge.uiLabelToNetworkPriority(e),s=ge.uiLabelToNetworkPriority(t);return ge.networkPriorityWeight(i)-ge.networkPriorityWeight(s)}):t.sort()}static _negativeFilter(e,t){return!e(t)}static _requestPathFilter(e,t){return!!e&&e.test(t.path()+"/"+t.name())}static _subdomains(e){const t=[e];let i=e.indexOf(".");for(;-1!==i;)t.push("*"+e.substring(i)),i=e.indexOf(".",i+1);return t}static _createRequestDomainFilter(e){const t=e.split("*").map((function(e){return e.escapeForRegExp()})).join(".*");return mi._requestDomainFilter.bind(null,new RegExp("^"+t+"$","i"))}static _requestDomainFilter(e,t){return e.test(t.domain)}static _runningRequestFilter(e){return!e.finished}static _fromCacheRequestFilter(e){return e.cached()}static _interceptedByServiceWorkerFilter(e){return e.fetchedViaServiceWorker}static _initiatedByServiceWorkerFilter(e){return e.initiatedByServiceWorker()}static _requestResponseHeaderFilter(e,t){return void 0!==t.responseHeaderValue(e)}static _requestMethodFilter(e,t){return t.requestMethod===e}static _requestPriorityFilter(e,t){return t.priority()===e}static _requestMimeTypeFilter(e,t){return t.mimeType===e}static _requestMixedContentFilter(e,t){return e===Si.Displayed?t.mixedContentType===Protocol.Security.MixedContentType.OptionallyBlockable:e===Si.Blocked?t.mixedContentType===Protocol.Security.MixedContentType.Blockable&&t.wasBlocked():e===Si.BlockOverridden?t.mixedContentType===Protocol.Security.MixedContentType.Blockable&&!t.wasBlocked():e===Si.All&&t.mixedContentType!==Protocol.Security.MixedContentType.None}static _requestSchemeFilter(e,t){return t.scheme===e}static _requestCookieDomainFilter(e,t){return t.allCookiesIncludingBlockedOnes().some(t=>t.domain()===e)}static _requestCookieNameFilter(e,t){return t.allCookiesIncludingBlockedOnes().some(t=>t.name()===e)}static _requestCookiePathFilter(e,t){return t.allCookiesIncludingBlockedOnes().some(t=>t.path()===e)}static _requestCookieValueFilter(e,t){return t.allCookiesIncludingBlockedOnes().some(t=>t.value()===e)}static _requestSetCookieDomainFilter(e,t){return t.responseCookies.some(t=>t.domain()===e)}static _requestSetCookieNameFilter(e,t){return t.responseCookies.some(t=>t.name()===e)}static _requestSetCookieValueFilter(e,t){return t.responseCookies.some(t=>t.value()===e)}static _requestSizeLargerThanFilter(e,t){return t.transferSize>=e}static _statusCodeFilter(e,t){return""+t.statusCode===e}static HTTPRequestsFilter(e){return e.parsedURL.isValid&&e.scheme in wi}static _resourceTypeFilter(e,t){return t.resourceType().name()===e}static _requestUrlFilter(e,t){return new RegExp(e.escapeForRegExp(),"i").test(t.url())}static _requestTimeFilter(e,t,i){return!(i.issueTime()>t)&&!(-1!==i.endTime&&i.endTime<e)}static _copyRequestHeaders(e){c.InspectorFrontendHostInstance.copyText(e.requestHeadersText())}static _copyResponseHeaders(e){c.InspectorFrontendHostInstance.copyText(e.responseHeadersText)}static async _copyResponse(e){const t=await e.contentData();let i=t.content||"";e.contentType().isTextType()?t.encoded&&i&&(i=window.atob(i)):i=Ie.contentAsDataURL(i,e.mimeType,t.encoded),c.InspectorFrontendHostInstance.copyText(i)}_handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0].webkitGetAsEntry();i.isDirectory||i.file(this.onLoadFromFile.bind(this))}async onLoadFromFile(e){const t=new l.StringOutputStream,i=new ue.ChunkedFileReader(e,1e7);if(!await i.read(t)){const e=i.error();return void(e&&this._harLoadFailed(e.message))}let s;try{s=new xe.HARRoot(JSON.parse(t.data()))}catch(e){return void this._harLoadFailed(e)}Y.NetworkLog.instance().importRequests(Fe.Importer.requestsFromHARLog(s.log))}_harLoadFailed(e){d.Console.instance().error("Failed to load HAR file with following error: "+e)}_setGrouping(e){this._activeGroupLookup&&this._activeGroupLookup.reset();const t=e&&this._groupLookups.get(e)||null;this._activeGroupLookup=t,this._invalidateAllItems()}_computeRowHeight(){return Math.round(this._rawRowHeight*window.devicePixelRatio)/window.devicePixelRatio}nodeForRequest(e){return gi.get(e)||null}headerHeight(){return this._headerHeight}setRecording(e){this._recording=e,this._updateSummaryBar()}modelAdded(e){if(e.target().parentTarget())return;const t=e.target().model(ee.ResourceTreeModel);t&&(t.addEventListener(ee.Events.Load,this._loadEventFired,this),t.addEventListener(ee.Events.DOMContentLoaded,this._domContentLoadedEventFired,this))}modelRemoved(e){if(!e.target().parentTarget()){const t=e.target().model(ee.ResourceTreeModel);t&&(t.removeEventListener(ee.Events.Load,this._loadEventFired,this),t.removeEventListener(ee.Events.DOMContentLoaded,this._domContentLoadedEventFired,this))}}linkifier(){return this._linkifier}setWindow(e,t){e||t?(this._timeFilter=mi._requestTimeFilter.bind(null,e,t),this._timeCalculator.setWindow(new Ct(e,t))):(this._timeFilter=null,this._timeCalculator.setWindow(null)),this._filterRequests()}resetFocus(){this._dataGrid.element.focus()}_resetSuggestionBuilder(){this._suggestionBuilder.clear(),this._suggestionBuilder.addItem(Ci.Is,fi.Running),this._suggestionBuilder.addItem(Ci.Is,fi.FromCache),this._suggestionBuilder.addItem(Ci.Is,fi.ServiceWorkerIntercepted),this._suggestionBuilder.addItem(Ci.Is,fi.ServiceWorkerInitiated),this._suggestionBuilder.addItem(Ci.LargerThan,"100"),this._suggestionBuilder.addItem(Ci.LargerThan,"10k"),this._suggestionBuilder.addItem(Ci.LargerThan,"1M"),this._textFilterUI.setSuggestionProvider(this._suggestionBuilder.completions.bind(this._suggestionBuilder))}_filterChanged(e){this.removeAllNodeHighlights(),this._parseFilterQuery(this._textFilterUI.value()),this._filterRequests(),this._textFilterSetting.set(this._textFilterUI.value())}async resetFilter(){this._textFilterUI.clear()}_showRecordingHint(){this._hideRecordingHint(),this._recordingHint=this.element.createChild("div","network-status-pane fill");const e=this._recordingHint.createChild("div","recording-hint");let i=null;const s=V.ShortcutRegistry.instance().shortcutsForAction("inspector_main.reload")[0];if(s&&(i=this._recordingHint.createChild("b"),i.textContent=s.title()),this._recording){e.createChild("span").textContent=t.UIString("Recording network activity…"),i&&(e.createChild("br"),e.appendChild(v.formatLocalized("Perform a request or hit %s to record the reload.",[i])))}else{const t=e.createChild("b");t.textContent=V.ShortcutRegistry.instance().shortcutTitleForAction("network.toggle-recording")||"",i?e.appendChild(v.formatLocalized("Record (%s) or reload (%s) to display network activity.",[t,i])):e.appendChild(v.formatLocalized("Record (%s) to display network activity.",[t]))}e.createChild("br"),e.appendChild(q.XLink.create("https://developers.google.com/web/tools/chrome-devtools/network/?utm_source=devtools&utm_campaign=2019Q1",ls`Learn more`)),this._setHidden(!0),this._dataGrid.updateGridAccessibleName("")}_hideRecordingHint(){this._setHidden(!1),this._recordingHint&&this._recordingHint.remove(),this._dataGrid.updateGridAccessibleName(ls`Network Data Available`),this._recordingHint=null}_setHidden(e){this._columns.setHidden(e),b.setHidden(this._summaryToolbar.element,e)}elementsToRestoreScrollPositionsFor(){return this._dataGrid?[this._dataGrid.scrollContainer]:[]}columnExtensionResolved(){this._invalidateAllItems(!0)}_setupDataGrid(){return this._dataGrid.setRowContextMenuCallback((e,t)=>{const i=t.request();i&&this.handleContextMenuForRequest(e,i)}),this._dataGrid.setStickToBottom(!0),this._dataGrid.setName("networkLog"),this._dataGrid.setResizeMethod(ne.ResizeMethod.Last),this._dataGrid.element.classList.add("network-log-grid"),this._dataGrid.element.addEventListener("mousedown",this._dataGridMouseDown.bind(this),!0),this._dataGrid.element.addEventListener("mousemove",this._dataGridMouseMove.bind(this),!0),this._dataGrid.element.addEventListener("mouseleave",()=>this._setHoveredNode(null),!0),this._dataGrid.element.addEventListener("keydown",e=>{isEnterOrSpaceKey(e)&&(this.dispatchEventToListeners(Kt.RequestActivated,{showPanel:!0,takeFocus:!0}),e.consume(!0))}),this._dataGrid.element.addEventListener("focus",this._onDataGridFocus.bind(this),!0),this._dataGrid.element.addEventListener("blur",this._onDataGridBlur.bind(this),!0),this._dataGrid}_dataGridMouseMove(e){const t=e,i=this._dataGrid.dataGridNodeFromNode(t.target),s=t.shiftKey;this._setHoveredNode(i,s)}hoveredNode(){return this._hoveredNode}_setHoveredNode(e,t){this._hoveredNode&&this._hoveredNode.setHovered(!1,!1),this._hoveredNode=e,this._hoveredNode&&this._hoveredNode.setHovered(!0,!!t)}_dataGridMouseDown(e){const t=e;!this._dataGrid.selectedNode&&t.button&&t.consume()}_updateSummaryBar(){this._hideRecordingHint();let e=0,t=0,i=0,s=0,o=0,n=-1,a=-1,l=0;for(const d of Y.NetworkLog.instance().requests()){const c=gi.get(d);if(!c)continue;l++;const h=d.transferSize;e+=h;const u=d.resourceSize;t+=u,pi.has(c)||(i++,s+=h,o+=u);const m=K.NetworkManager.forRequest(d);m&&d.url()===m.target().inspectedURL()&&d.resourceType()===r.resourceTypes.Document&&!m.target().parentTarget()&&(n=d.startTime),d.endTime>a&&(a=d.endTime)}if(!l)return void this._showRecordingHint();this._summaryToolbar.removeToolbarItems();const d=(e,t)=>{const i=new S.ToolbarText(e);return i.setTitle(t||e),this._summaryToolbar.appendToolbarItem(i),i.element};if(i!==l?(d(ls`${i} / ${l} requests`),this._summaryToolbar.appendSeparator(),d(ls`${de.bytesToString(s)} / ${de.bytesToString(e)} transferred`,ls`${s} B / ${e} B transferred over network`),this._summaryToolbar.appendSeparator(),d(ls`${de.bytesToString(o)} / ${de.bytesToString(t)} resources`,ls`${o} B / ${t} B resources loaded by the page`)):(d(ls`${l} requests`),this._summaryToolbar.appendSeparator(),d(ls`${de.bytesToString(e)} transferred`,ls`${e} B transferred over network`),this._summaryToolbar.appendSeparator(),d(ls`${de.bytesToString(t)} resources`,ls`${t} B resources loaded by the page`)),-1!==n&&-1!==a){if(this._summaryToolbar.appendSeparator(),d(ls`Finish: ${Number.secondsToString(a-n)}`),-1!==this._mainRequestDOMContentLoadedTime&&this._mainRequestDOMContentLoadedTime>n){this._summaryToolbar.appendSeparator();d(ls`DOMContentLoaded: ${Number.secondsToString(this._mainRequestDOMContentLoadedTime-n)}`).style.color=mi.getDCLEventColor()}if(-1!==this._mainRequestLoadTime){this._summaryToolbar.appendSeparator();d(ls`Load: ${Number.secondsToString(this._mainRequestLoadTime-n)}`).style.color=mi.getLoadEventColor()}}}scheduleRefresh(){this._needsRefresh||(this._needsRefresh=!0,this.isShowing()&&!this._refreshRequestId&&(this._refreshRequestId=this.element.window().requestAnimationFrame(this._refresh.bind(this))))}addFilmStripFrames(e){this._columns.addEventDividers(e,"network-frame-divider")}selectFilmStripFrame(e){this._columns.selectFilmStripFrame(e)}clearFilmStripFrame(){this._columns.clearFilmStripFrame()}_refreshIfNeeded(){this._needsRefresh&&this._refresh()}_invalidateAllItems(e){this._staleRequests=new Set(Y.NetworkLog.instance().requests()),e?this.scheduleRefresh():this._refresh()}timeCalculator(){return this._timeCalculator}calculator(){return this._calculator}setCalculator(e){e&&this._calculator!==e&&(this._calculator!==e&&(this._calculator=e,this._columns.setCalculator(this._calculator)),this._calculator.reset(),this._calculator.startAtZero?this._columns.hideEventDividers():this._columns.showEventDividers(),this._invalidateAllItems())}_loadEventFired(e){if(!this._recording)return;const t=e.data.loadTime;t&&(this._mainRequestLoadTime=t,this._columns.addEventDividers([t],"network-load-divider"))}_domContentLoadedEventFired(e){if(!this._recording)return;const t=e.data;t&&(this._mainRequestDOMContentLoadedTime=t,this._columns.addEventDividers([t],"network-dcl-divider"))}wasShown(){this._refreshIfNeeded(),this._columns.wasShown()}willHide(){this._columns.willHide()}onResize(){this._rowHeight=this._computeRowHeight()}flatNodesList(){return this._dataGrid.rootNode().flatChildren()}_onDataGridFocus(){this._dataGrid.element.matches(":focus-visible")&&this.element.classList.add("grid-focused"),this.updateNodeBackground()}_onDataGridBlur(){this.element.classList.remove("grid-focused"),this.updateNodeBackground()}updateNodeBackground(){this._dataGrid.selectedNode&&this._dataGrid.selectedNode.updateBackgroundColor()}updateNodeSelectedClass(e){e?this.element.classList.remove("no-node-selected"):this.element.classList.add("no-node-selected")}stylesChanged(){this._columns.scheduleRefresh()}_refresh(){this._needsRefresh=!1,this._refreshRequestId&&(this.element.window().cancelAnimationFrame(this._refreshRequestId),this._refreshRequestId=null),this.removeAllNodeHighlights(),this._timeCalculator.updateBoundariesForEventTime(this._mainRequestLoadTime),this._durationCalculator.updateBoundariesForEventTime(this._mainRequestLoadTime),this._timeCalculator.updateBoundariesForEventTime(this._mainRequestDOMContentLoadedTime),this._durationCalculator.updateBoundariesForEventTime(this._mainRequestDOMContentLoadedTime);const e=new Map,t=[],i=new Set;for(;this._staleRequests.size;){const e=this._staleRequests.values().next().value;this._staleRequests.delete(e);let t=gi.get(e);t||(t=this._createNodeForRequest(e)),i.add(t)}for(const s of i){const i=!this._applyFilter(s);i&&s===this._hoveredNode&&this._setHoveredNode(null),i||t.push(s);const r=s.request();this._timeCalculator.updateBoundaries(r),this._durationCalculator.updateBoundaries(r);const o=this._parentNodeForInsert(s);if(pi.has(s)===i&&s.parent===o)continue;i?pi.add(s):pi.delete(s);if(s.parent&&(i||s.parent!==o)){let e=s.parent;if(!e)continue;for(e.removeChild(s);e&&!e.hasChildren()&&e.dataGrid&&e.dataGrid.rootNode()!==e;){const t=e.parent;t.removeChild(e),e=t}}o&&!i&&(o.dataGrid||e.has(o)||(e.set(o,this._dataGrid.rootNode()),t.push(o)),e.set(s,o))}for(const t of e.keys())e.get(t).appendChild(t);for(const e of t)e.refresh();this._updateSummaryBar(),e.size&&this._columns.sortByCurrentColumn(),this._dataGrid.updateInstantly(),this._didRefreshForTest()}_didRefreshForTest(){}_parentNodeForInsert(e){if(!this._activeGroupLookup)return this._dataGrid.rootNode();const t=this._activeGroupLookup.groupNodeForRequest(e.request());return t||this._dataGrid.rootNode()}_reset(){this.dispatchEventToListeners(Kt.RequestActivated,{showPanel:!1}),this._setHoveredNode(null),this._columns.reset(),this._timeFilter=null,this._calculator.reset(),this._timeCalculator.setWindow(null),this._linkifier.reset(),this._activeGroupLookup&&this._activeGroupLookup.reset(),this._staleRequests.clear(),this._resetSuggestionBuilder(),this._mainRequestLoadTime=-1,this._mainRequestDOMContentLoadedTime=-1,this._dataGrid.rootNode().removeChildren(),this._updateSummaryBar(),this._dataGrid.setStickToBottom(!0),this.scheduleRefresh()}setTextFilterValue(e){this._textFilterUI.setValue(e),this._dataURLFilterUI.setChecked(!1),this._onlyIssuesFilterUI.setChecked(!1),this._onlyBlockedRequestsUI.setChecked(!1),this._resourceCategoryFilterUI.reset()}_createNodeForRequest(e){const t=new Xt(this,e);gi.set(e,t),pi.add(t);for(let t=e.redirectSource();t;t=t.redirectSource())this._refreshRequest(t);return t}_onRequestUpdated(e){const t=e.data;this._refreshRequest(t)}_refreshRequest(e){mi._subdomains(e.domain).forEach(this._suggestionBuilder.addItem.bind(this._suggestionBuilder,Ci.Domain)),this._suggestionBuilder.addItem(Ci.Method,e.requestMethod),this._suggestionBuilder.addItem(Ci.MimeType,e.mimeType),this._suggestionBuilder.addItem(Ci.Scheme,""+e.scheme),this._suggestionBuilder.addItem(Ci.StatusCode,""+e.statusCode),this._suggestionBuilder.addItem(Ci.ResourceType,e.resourceType().name()),this._suggestionBuilder.addItem(Ci.Url,e.securityOrigin());const t=e.priority();if(t&&this._suggestionBuilder.addItem(Ci.Priority,ge.uiLabelForNetworkPriority(t)),e.mixedContentType!==Protocol.Security.MixedContentType.None&&this._suggestionBuilder.addItem(Ci.MixedContent,Si.All),e.mixedContentType===Protocol.Security.MixedContentType.OptionallyBlockable&&this._suggestionBuilder.addItem(Ci.MixedContent,Si.Displayed),e.mixedContentType===Protocol.Security.MixedContentType.Blockable){const t=e.wasBlocked()?Si.Blocked:Si.BlockOverridden;this._suggestionBuilder.addItem(Ci.MixedContent,t)}const i=e.responseHeaders;for(let e=0,t=i.length;e<t;++e)this._suggestionBuilder.addItem(Ci.HasResponseHeader,i[e].name);for(const t of e.responseCookies)this._suggestionBuilder.addItem(Ci.SetCookieDomain,t.domain()),this._suggestionBuilder.addItem(Ci.SetCookieName,t.name()),this._suggestionBuilder.addItem(Ci.SetCookieValue,t.value());for(const t of e.allCookiesIncludingBlockedOnes())this._suggestionBuilder.addItem(Ci.CookieDomain,t.domain()),this._suggestionBuilder.addItem(Ci.CookieName,t.name()),this._suggestionBuilder.addItem(Ci.CookiePath,t.path()),this._suggestionBuilder.addItem(Ci.CookieValue,t.value());this._staleRequests.add(e),this.scheduleRefresh()}rowHeight(){return this._rowHeight}switchViewMode(e){this._columns.switchViewMode(e)}handleContextMenuForRequest(e,i){e.appendApplicableItems(i);let s=e.clipboardSection().appendSubMenuItem(t.UIString("Copy"));const r=s.footerSection();if(i){s.defaultSection().appendItem(v.copyLinkAddressLabel(),c.InspectorFrontendHostInstance.copyText.bind(c.InspectorFrontendHostInstance,i.contentURL())),i.requestHeadersText()&&s.defaultSection().appendItem(t.UIString("Copy request headers"),mi._copyRequestHeaders.bind(null,i)),i.responseHeadersText&&s.defaultSection().appendItem(t.UIString("Copy response headers"),mi._copyResponseHeaders.bind(null,i)),i.finished&&s.defaultSection().appendItem(t.UIString("Copy response"),mi._copyResponse.bind(null,i));const e=i.initiator();if(e){const i=e.stack;if(i){const e=_i(i);""!==e&&s.defaultSection().appendItem(t.UIString("Copy stacktrace"),()=>{c.InspectorFrontendHostInstance.copyText(e)})}}const o=i.isBlobRequest();m.isWin()?(r.appendItem(t.UIString("Copy as PowerShell"),this._copyPowerShellCommand.bind(this,i),o),r.appendItem(t.UIString("Copy as fetch"),this._copyFetchCall.bind(this,i,!1),o),r.appendItem(t.UIString("Copy as Node.js fetch"),this._copyFetchCall.bind(this,i,!0),o),r.appendItem(t.UIString("Copy as cURL (cmd)"),this._copyCurlCommand.bind(this,i,"win"),o),r.appendItem(t.UIString("Copy as cURL (bash)"),this._copyCurlCommand.bind(this,i,"unix"),o),r.appendItem(t.UIString("Copy all as PowerShell"),this._copyAllPowerShellCommand.bind(this)),r.appendItem(t.UIString("Copy all as fetch"),this._copyAllFetchCall.bind(this,!1)),r.appendItem(t.UIString("Copy all as Node.js fetch"),this._copyAllFetchCall.bind(this,!0)),r.appendItem(t.UIString("Copy all as cURL (cmd)"),this._copyAllCurlCommand.bind(this,"win")),r.appendItem(t.UIString("Copy all as cURL (bash)"),this._copyAllCurlCommand.bind(this,"unix"))):(r.appendItem(t.UIString("Copy as fetch"),this._copyFetchCall.bind(this,i,!1),o),r.appendItem(t.UIString("Copy as Node.js fetch"),this._copyFetchCall.bind(this,i,!0),o),r.appendItem(t.UIString("Copy as cURL"),this._copyCurlCommand.bind(this,i,"unix"),o),r.appendItem(t.UIString("Copy all as fetch"),this._copyAllFetchCall.bind(this,!1)),r.appendItem(t.UIString("Copy all as Node.js fetch"),this._copyAllFetchCall.bind(this,!0)),r.appendItem(t.UIString("Copy all as cURL"),this._copyAllCurlCommand.bind(this,"unix")))}else s=e.clipboardSection().appendSubMenuItem(t.UIString("Copy"));if(r.appendItem(t.UIString("Copy all as HAR"),this._copyAll.bind(this)),e.saveSection().appendItem(ls`Save all as HAR with content`,this.exportAll.bind(this)),e.editSection().appendItem(t.UIString("Clear browser cache"),this._clearBrowserCache.bind(this)),e.editSection().appendItem(t.UIString("Clear browser cookies"),this._clearBrowserCookies.bind(this)),i){const s=20,r=K.MultitargetNetworkManager.instance();let a=r.blockedPatterns();function o(e){a.push({enabled:!0,url:e}),r.setBlockedPatterns(a),r.setBlockingEnabled(!0),A.ViewManager.instance().showView("network.blocked-urls")}function n(e){a=a.filter(t=>t.url!==e),r.setBlockedPatterns(a),A.ViewManager.instance().showView("network.blocked-urls")}const l=i.parsedURL.urlWithoutScheme();if(l&&!a.find(e=>e.url===l))e.debugSection().appendItem(t.UIString("Block request URL"),o.bind(null,l));else if(l){const i=l.trimMiddle(s);e.debugSection().appendItem(t.UIString("Unblock %s",i),n.bind(null,l))}const d=i.parsedURL.domain();if(d&&!a.find(e=>e.url===d))e.debugSection().appendItem(t.UIString("Block request domain"),o.bind(null,d));else if(d){const i=d.trimMiddle(s);e.debugSection().appendItem(t.UIString("Unblock %s",i),n.bind(null,d))}K.NetworkManager.canReplayRequest(i)&&e.debugSection().appendItem(t.UIString("Replay XHR"),K.NetworkManager.replayRequest.bind(null,i))}}_harRequests(){return Y.NetworkLog.instance().requests().filter(mi.HTTPRequestsFilter).filter(e=>e.finished||e.resourceType()===r.resourceTypes.WebSocket&&e.responseReceivedTime)}async _copyAll(){const e={log:await X.HARLog.build(this._harRequests())};c.InspectorFrontendHostInstance.copyText(JSON.stringify(e,null,2))}async _copyCurlCommand(e,t){const i=await this._generateCurlCommand(e,t);c.InspectorFrontendHostInstance.copyText(i)}async _copyAllCurlCommand(e){const t=await this._generateAllCurlCommand(Y.NetworkLog.instance().requests(),e);c.InspectorFrontendHostInstance.copyText(t)}async _copyFetchCall(e,t){const i=await this._generateFetchCall(e,t);c.InspectorFrontendHostInstance.copyText(i)}async _copyAllFetchCall(e){const t=await this._generateAllFetchCall(Y.NetworkLog.instance().requests(),e);c.InspectorFrontendHostInstance.copyText(t)}async _copyPowerShellCommand(e){const t=await this._generatePowerShellCommand(e);c.InspectorFrontendHostInstance.copyText(t)}async _copyAllPowerShellCommand(){const e=await this._generateAllPowerShellCommand(Y.NetworkLog.instance().requests());c.InspectorFrontendHostInstance.copyText(e)}async exportAll(){const e=j.TargetManager.instance().mainTarget();if(!e)return;const t=e.inspectedURL(),i=a.ParsedURL.fromString(t),s=i?i.host:"network-log",r=new ue.FileOutputStream;if(!await r.open(s+".har"))return;const o=new W.ProgressIndicator;this._progressBarContainer.appendChild(o.element),await ze.write(r,this._harRequests(),o),o.done(),r.close()}_clearBrowserCache(){confirm(t.UIString("Are you sure you want to clear browser cache?"))&&K.MultitargetNetworkManager.instance().clearBrowserCache()}_clearBrowserCookies(){confirm(t.UIString("Are you sure you want to clear browser cookies?"))&&K.MultitargetNetworkManager.instance().clearBrowserCookies()}_removeAllHighlights(){this.removeAllNodeHighlights();for(let e=0;e<this._highlightedSubstringChanges.length;++e)v.revertDomChanges(this._highlightedSubstringChanges[e]);this._highlightedSubstringChanges=[]}_applyFilter(e){const t=e.request();if(this._timeFilter&&!this._timeFilter(t))return!1;const i=t.resourceType().category().title;if(!this._resourceCategoryFilterUI.accept(i))return!1;if(this._dataURLFilterUI.checked()&&(t.parsedURL.isDataURL()||t.parsedURL.isBlobURL()))return!1;if(this._onlyIssuesFilterUI.checked()&&!ke.hasIssueOfCategory(t,J.IssueCategory.SameSiteCookie))return!1;if(this._onlyBlockedRequestsUI.checked()&&!t.wasBlocked()&&!t.corsErrorStatus())return!1;if("Service Worker Fallback Required"===t.statusText)return!1;for(let e=0;e<this._filters.length;++e)if(!this._filters[e](t))return!1;return!0}_parseFilterQuery(e){const t=this._filterParser.parse(e);this._filters=t.map(e=>{const t=e.key,i=e.text||"",s=e.regex;let r;if(t){const e=(t+":"+i).escapeForRegExp();r=this._createSpecialFilter(t,i)||mi._requestPathFilter.bind(null,new RegExp(e,"i"))}else r=e.regex?mi._requestPathFilter.bind(null,s):mi._requestPathFilter.bind(null,new RegExp(i.escapeForRegExp(),"i"));return e.negative?mi._negativeFilter.bind(null,r):r})}_createSpecialFilter(e,t){switch(e){case Ci.Domain:return mi._createRequestDomainFilter(t);case Ci.HasResponseHeader:return mi._requestResponseHeaderFilter.bind(null,t);case Ci.Is:if(t.toLowerCase()===fi.Running)return mi._runningRequestFilter;if(t.toLowerCase()===fi.FromCache)return mi._fromCacheRequestFilter;if(t.toLowerCase()===fi.ServiceWorkerIntercepted)return mi._interceptedByServiceWorkerFilter;if(t.toLowerCase()===fi.ServiceWorkerInitiated)return mi._initiatedByServiceWorkerFilter;break;case Ci.LargerThan:return this._createSizeFilter(t.toLowerCase());case Ci.Method:return mi._requestMethodFilter.bind(null,t);case Ci.MimeType:return mi._requestMimeTypeFilter.bind(null,t);case Ci.MixedContent:return mi._requestMixedContentFilter.bind(null,t);case Ci.Scheme:return mi._requestSchemeFilter.bind(null,t);case Ci.SetCookieDomain:return mi._requestSetCookieDomainFilter.bind(null,t);case Ci.SetCookieName:return mi._requestSetCookieNameFilter.bind(null,t);case Ci.SetCookieValue:return mi._requestSetCookieValueFilter.bind(null,t);case Ci.CookieDomain:return mi._requestCookieDomainFilter.bind(null,t);case Ci.CookieName:return mi._requestCookieNameFilter.bind(null,t);case Ci.CookiePath:return mi._requestCookiePathFilter.bind(null,t);case Ci.CookieValue:return mi._requestCookieValueFilter.bind(null,t);case Ci.Priority:return mi._requestPriorityFilter.bind(null,ge.uiLabelToNetworkPriority(t));case Ci.StatusCode:return mi._statusCodeFilter.bind(null,t);case Ci.ResourceType:return mi._resourceTypeFilter.bind(null,t);case Ci.Url:return mi._requestUrlFilter.bind(null,t)}return null}_createSizeFilter(e){let t=1;e.endsWith("k")?(t=1e3,e=e.substring(0,e.length-1)):e.endsWith("m")&&(t=1e6,e=e.substring(0,e.length-1));const i=Number(e);return isNaN(i)?null:mi._requestSizeLargerThanFilter.bind(null,i*t)}_filterRequests(){this._removeAllHighlights(),this._invalidateAllItems()}_reveal(e){this.removeAllNodeHighlights();const t=gi.get(e);return t&&t.dataGrid?(t.parent&&t.parent instanceof Qt&&(t.parent.reveal(),t.parent.expand()),t.reveal(),t):null}revealAndHighlightRequest(e){const t=this._reveal(e);t&&this._highlightNode(t)}selectRequest(e,t){const{clearFilter:i}=t||{clearFilter:!0};i&&this.setTextFilterValue("");const s=this._reveal(e);s&&s.select()}removeAllNodeHighlights(){this._highlightedNode&&(this._highlightedNode.element().classList.remove("highlighted-row"),this._highlightedNode=null)}_highlightNode(e){v.runCSSAnimationOnce(e.element(),"highlighted-row"),this._highlightedNode=e}_filterOutBlobRequests(e){return e.filter(e=>!e.isBlobRequest())}async _generateFetchCall(e,t){const i=new Set(["method","path","scheme","version","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via","user-agent"]),s=new Set(["cookie","authorization"]),r=JSON.stringify(e.url()),o=e.requestHeaders(),n=o.reduce((e,t)=>{const s=t.name;return i.has(s.toLowerCase())||s.includes(":")||e.append(s,t.value),e},new Headers),a={};for(const e of n)a[e[0]]=e[1];const l=e.includedRequestCookies().length||o.some(({name:e})=>s.has(e.toLowerCase()))?"include":"omit",d=o.find(({name:e})=>"referer"===e.toLowerCase()),c=d?d.value:void 0,h=e.referrerPolicy()||void 0,u=await e.requestFormData(),m={headers:Object.keys(a).length?a:void 0,referrer:c,referrerPolicy:h,body:u,method:e.requestMethod,mode:"cors"};if(t){const e=o.find(e=>"cookie"===e.name.toLowerCase());e&&(m.headers={...a,cookie:e.value})}else m.credentials=l;return`fetch(${r}, ${JSON.stringify(m,null,2)});`}async _generateAllFetchCall(e,t){const i=this._filterOutBlobRequests(e);return(await Promise.all(i.map(e=>this._generateFetchCall(e,t)))).join(" ;\n")}async _generateCurlCommand(e,t){let i=[];const s=new Set(["accept-encoding","host","method","path","scheme","version"]);const r="win"===t?function(e){const t=/[\r\n]/.test(e)?'^"':'"';return t+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/[^a-zA-Z0-9\s_\-:=+~'\/.',?;()*`&]/g,"^$&").replace(/%(?=[a-zA-Z0-9_])/g,"%^").replace(/\r?\n/g,"^\n\n")+t}:function(e){return/[\0-\x1F\x7F-\x9F!]|\'/.test(e)?"$'"+e.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\0-\x1F\x7F-\x9F!]/g,(function(e){let t=e.charCodeAt(0).toString(16);for(;t.length<4;)t="0"+t;return"\\u"+t}))+"'":"'"+e+"'"};i.push(r(e.url()).replace(/[[{}\]]/g,"\\$&"));let o="GET";const n=[],a=e.requestContentType(),l=await e.requestFormData();(a&&a.startsWith("application/x-www-form-urlencoded")&&l||l)&&(n.push("--data-raw "+r(l)),s.add("content-length"),o="POST"),e.requestMethod!==o&&i.push("-X "+r(e.requestMethod));const d=e.requestHeaders();for(let e=0;e<d.length;e++){const t=d[e],o=t.name.replace(/^:/,"");s.has(o.toLowerCase())||i.push("-H "+r(o+": "+t.value))}return i=i.concat(n),i.push("--compressed"),e.securityState()===Protocol.Security.SecurityState.Insecure&&i.push("--insecure"),"curl "+i.join(i.length>=3?"win"===t?" ^\n  ":" \\\n  ":" ")}async _generateAllCurlCommand(e,t){const i=this._filterOutBlobRequests(e),s=await Promise.all(i.map(e=>this._generateCurlCommand(e,t)));return"win"===t?s.join(" &\r\n"):s.join(" ;\n")}async _generatePowerShellCommand(e){const t=[],i=new Set(["host","connection","proxy-connection","content-length","expect","range","content-type"]);function s(e){return'"'+e.replace(/[`\$"]/g,"`$&").replace(/[^\x20-\x7E]/g,e=>"$([char]"+e.charCodeAt(0)+")")+'"'}t.push("-Uri "+s(e.url())),"GET"!==e.requestMethod&&t.push("-Method "+s(e.requestMethod));const r=e.requestHeaders(),o=[];for(const e of r){const t=e.name.replace(/^:/,"");i.has(t.toLowerCase())||o.push(s(t)+"="+s(e.value))}o.length&&t.push("-Headers @{\n"+o.join("\n  ")+"\n}");const n=r.find(({name:e})=>"content-type"===e.toLowerCase());n&&t.push("-ContentType "+s(n.value));const a=await e.requestFormData();if(a){const e=s(a);/[^\x20-\x7E]/.test(a)?t.push("-Body ([System.Text.Encoding]::UTF8.GetBytes("+e+"))"):t.push("-Body "+e)}return"Invoke-WebRequest "+t.join(t.length>=3?" `\n":" ")}async _generateAllPowerShellCommand(e){const t=this._filterOutBlobRequests(e);return(await Promise.all(t.map(e=>this._generatePowerShellCommand(e)))).join(";\r\n")}static getDCLEventColor(){return"dark"===Ee.instance().themeName()?"#03A9F4":"#0867CB"}static getLoadEventColor(){return Ee.instance().patchColorText("#B31412",Ee.ColorUsage.Foreground)}}function _i(e){let t="";for(const i of e.callFrames){t+=`${v.beautifyFunctionName(i.functionName)} @ ${i.url}:${i.lineNumber+1}\n`}return e.parent&&(t+=_i(e.parent)),t}const pi=new WeakSet,gi=new WeakMap;const wi={http:!0,https:!0,ws:!0,wss:!0},Ci={Domain:"domain",HasResponseHeader:"has-response-header",Is:"is",LargerThan:"larger-than",Method:"method",MimeType:"mime-type",MixedContent:"mixed-content",Priority:"priority",Scheme:"scheme",SetCookieDomain:"set-cookie-domain",SetCookieName:"set-cookie-name",SetCookieValue:"set-cookie-value",ResourceType:"resource-type",CookieDomain:"cookie-domain",CookieName:"cookie-name",CookiePath:"cookie-path",CookieValue:"cookie-value",StatusCode:"status-code",Url:"url"},Si={All:"all",Displayed:"displayed",Blocked:"blocked",BlockOverridden:"block-overridden"},fi={Running:"running",FromCache:"from-cache",ServiceWorkerIntercepted:"service-worker-intercepted",ServiceWorkerInitiated:"service-worker-initiated"},vi=Object.values(Ci);var bi=Object.freeze({__proto__:null,NetworkLogView:mi,computeStackTraceText:_i,isRequestFilteredOut:function(e){return pi.has(e)},HTTPSchemas:wi,FilterType:Ci,MixedContentFilterValues:Si,IsFilterType:fi,_searchKeys:vi,GroupLookupInterface:class{groupNodeForRequest(e){throw new Error("Not implemented yet")}reset(){}},Filter:void 0});class ki{performIndexing(e){setImmediate(e.done.bind(e))}async performSearch(e,t,i,s){const r=[],o=Y.NetworkLog.instance().requests().filter(t=>e.filePathMatchesFileQuery(t.url()));t.setTotalWork(o.length);for(const i of o){const s=this._searchRequest(e,i,t);r.push(s)}const n=(await Promise.all(r)).filter(e=>null!==e);if(t.isCanceled())s(!1);else{for(const e of n.sort((e,t)=>e.label().localeCompare(t.label())))e.matchesCount()>0&&i(e);t.done(),s(!0)}}async _searchRequest(e,t,i){let s=[];if(t.contentType().isTextType()&&(s=await t.searchInContent(e.query(),!e.ignoreCase(),e.isRegex())),i.isCanceled())return null;const r=[];n(t.url())&&r.push(Ti.urlMatch(t));for(const e of t.requestHeaders())o(e)&&r.push(Ti.requestHeaderMatch(t,e));for(const e of t.responseHeaders)o(e)&&r.push(Ti.responseHeaderMatch(t,e));for(const e of s)r.push(Ti.bodyMatch(t,e));return i.worked(),new yi(t,r);function o(e){return n(`${e.name}: ${e.value}`)}function n(t){const i=e.ignoreCase()?"i":"",s=e.queries().map(e=>new RegExp(e,i));let r=0;for(const e of s){const i=t.substr(r).match(e);if(!i||!i.index)return!1;r+=i.index+i[0].length}return!0}}stopSearch(){}}class Ti{constructor(e,t,i,s,r){this.request=e,this.requestHeader=t,this.responseHeader=i,this.searchMatch=s,this.isUrlMatch=r}static requestHeaderMatch(e,t){return new Ti(e,t,null,null,!1)}static responseHeaderMatch(e,t){return new Ti(e,null,t,null,!1)}static bodyMatch(e,t){return new Ti(e,null,null,t,!1)}static urlMatch(e){return new Ti(e,null,null,null,!0)}}class yi{constructor(e,t){this._request=e,this._locations=t}matchesCount(){return this._locations.length}label(){return this._request.displayName}description(){const e=this._request.parsedURL;return e?e.urlWithoutScheme():this._request.url()}matchLineContent(e){const t=this._locations[e];if(t.isUrlMatch)return this._request.url();const i=t.requestHeader||t.responseHeader;return i?i.value:t.searchMatch.lineContent}matchRevealable(e){return this._locations[e]}matchLabel(e){const i=this._locations[e];if(i.isUrlMatch)return t.UIString("URL");const s=i.requestHeader||i.responseHeader;return s?s.name+":":i.searchMatch.lineNumber+1}}var Ri=Object.freeze({__proto__:null,NetworkSearchScope:ki,UIRequestLocation:Ti,NetworkSearchResult:yi});class Ii extends Ce.TimelineOverviewBase{constructor(){super(),this._selectedFilmStripTime=-1,this.element.classList.add("network-overview"),this._numBands=1,this._updateScheduled=!1,this._highlightedRequest=null,j.TargetManager.instance().addModelListener(ee.ResourceTreeModel,ee.Events.Load,this._loadEventFired,this),j.TargetManager.instance().addModelListener(ee.ResourceTreeModel,ee.Events.DOMContentLoaded,this._domContentLoadedEventFired,this),this._loadEvents,this._domContentLoadedEvents,this._nextBand,this._bandMap,this._requestsList,this._requestsSet,this._span,this.reset()}setHighlightedRequest(e){this._highlightedRequest=e,this.scheduleUpdate()}setFilmStripModel(e){this._filmStripModel=e,this.scheduleUpdate()}selectFilmStripFrame(e){this._selectedFilmStripTime=e,this.scheduleUpdate()}clearFilmStripFrame(){this._selectedFilmStripTime=-1,this.scheduleUpdate()}_loadEventFired(e){const t=e.data.loadTime;t&&this._loadEvents.push(1e3*t),this.scheduleUpdate()}_domContentLoadedEventFired(e){const t=e.data;t&&this._domContentLoadedEvents.push(1e3*t),this.scheduleUpdate()}_bandId(e){if(!e||"0"===e)return-1;if(this._bandMap.has(e))return this._bandMap.get(e);const t=this._nextBand++;return this._bandMap.set(e,t),t}updateRequest(e){this._requestsSet.has(e)||(this._requestsSet.add(e),this._requestsList.push(e)),this.scheduleUpdate()}wasShown(){this.onResize()}calculator(){return super.calculator()}onResize(){const e=this.element.offsetWidth,t=this.element.offsetHeight;this.calculator().setDisplayWidth(e),this.resetCanvas();const i=(t-xi-1)/Li-1|0;this._numBands=i>0?i:1,this.scheduleUpdate()}reset(){this._filmStripModel=null,this._span=1,this._lastBoundary=null,this._nextBand=0,this._bandMap=new Map,this._requestsList=[],this._requestsSet=new Set,this._loadEvents=[],this._domContentLoadedEvents=[],this.resetCanvas()}scheduleUpdate(){!this._updateScheduled&&this.isShowing()&&(this._updateScheduled=!0,this.element.window().requestAnimationFrame(this.update.bind(this)))}update(){this._updateScheduled=!1;const e=this.calculator(),t=new Ct(e.minimumBoundary(),e.maximumBoundary());if(!this._lastBoundary||!t.equals(this._lastBoundary)){const t=e.boundarySpan();for(;this._span<t;)this._span*=1.25;e.setBounds(e.minimumBoundary(),e.minimumBoundary()+this._span),this._lastBoundary=new Ct(e.minimumBoundary(),e.maximumBoundary())}const i=this.context(),s=new Map,r=xi;function o(t){const o=s.get(t);if(!o)return;const n=o.length;i.beginPath(),i.strokeStyle=qi[t];for(let t=0;t<n;){const s=o[t++]*Li+r,n=o[t++];let a=o[t++];a===Number.MAX_VALUE&&(a=e.maximumBoundary()),i.moveTo(e.computePosition(n),s),i.lineTo(e.computePosition(a)+1,s)}i.stroke()}function n(e,t,i,r){let o=s.get(e);o||(o=[],s.set(e,o)),o.push(t,i,r)}const a=this._requestsList,l=a.length;for(let e=0;e<l;++e){const t=a[e],i=this._bandId(t.connectionId),s=-1===i?0:i%this._numBands+1,r=xt.calculateRequestTimeRanges(t,this.calculator().minimumBoundary());for(let e=0;e<r.length;++e){const t=r[e].name;-1===i&&t!==Ft.Total||n(t,s,1e3*r[e].start,1e3*r[e].end)}}if(i.clearRect(0,0,this.width(),this.height()),i.save(),i.scale(window.devicePixelRatio,window.devicePixelRatio),i.lineWidth=2,o(Ft.Total),o(Ft.Blocking),o(Ft.Connecting),o(Ft.ServiceWorker),o(Ft.ServiceWorkerPreparation),o(Ft.ServiceWorkerRespondWith),o(Ft.Push),o(Ft.Proxy),o(Ft.DNS),o(Ft.SSL),o(Ft.Sending),o(Ft.Waiting),o(Ft.Receiving),this._highlightedRequest){const t=5,s=2,o=this._highlightedRequest,n=this._bandId(o.connectionId),a=(-1===n?0:n%this._numBands+1)*Li+r,l=xt.calculateRequestTimeRanges(o,this.calculator().minimumBoundary());i.fillStyle=Ee.instance().getComputedValue("--selection-bg-color");const d=1e3*l[0].start,c=1e3*l[0].end;i.fillRect(e.computePosition(d)-s,a-t/2-s,e.computePosition(c)-e.computePosition(d)+1+2*s,t*s);for(let s=0;s<l.length;++s){const r=l[s].name;if(-1!==n||r===Ft.Total){i.beginPath(),i.strokeStyle=qi[r],i.lineWidth=t;const o=1e3*l[s].start,n=1e3*l[s].end;i.moveTo(e.computePosition(o)-0,a),i.lineTo(e.computePosition(n)+1,a),i.stroke()}}}const d=this.element.offsetHeight;i.lineWidth=1,i.beginPath(),i.strokeStyle=mi.getDCLEventColor();for(let t=this._domContentLoadedEvents.length-1;t>=0;--t){const s=Math.round(e.computePosition(this._domContentLoadedEvents[t]))+.5;i.moveTo(s,0),i.lineTo(s,d)}i.stroke(),i.beginPath(),i.strokeStyle=mi.getLoadEventColor();for(let t=this._loadEvents.length-1;t>=0;--t){const s=Math.round(e.computePosition(this._loadEvents[t]))+.5;i.moveTo(s,0),i.lineTo(s,d)}if(i.stroke(),-1!==this._selectedFilmStripTime){i.lineWidth=2,i.beginPath(),i.strokeStyle=Ee.instance().getComputedValue("--network-frame-divider-color");const t=Math.round(e.computePosition(this._selectedFilmStripTime));i.moveTo(t,0),i.lineTo(t,d),i.stroke()}i.restore()}}const qi={[Ft.Total]:"#CCCCCC",[Ft.Blocking]:"#AAAAAA",[Ft.Connecting]:"#FF9800",[Ft.ServiceWorker]:"#FF9800",[Ft.ServiceWorkerPreparation]:"#FF9800",[Ft.ServiceWorkerRespondWith]:"#00FFFF",[Ft.Push]:"#8CDBff",[Ft.Proxy]:"#A1887F",[Ft.DNS]:"#009688",[Ft.SSL]:"#9C27B0",[Ft.Sending]:"#B0BEC5",[Ft.Waiting]:"#00C853",[Ft.Receiving]:"#03A9F4"},Li=3,xi=5;var Fi=Object.freeze({__proto__:null,NetworkOverview:Ii,RequestTimeRangeNameToColor:qi,_bandHeight:Li,_padding:xi});let Ei;class Pi extends O.Panel{constructor(){super("network"),this.registerRequiredCSS("network/networkPanel.css",{enableLegacyPatching:!0}),this._networkLogShowOverviewSetting=e.Settings.instance().createSetting("networkLogShowOverview",!0),this._networkLogLargeRowsSetting=e.Settings.instance().createSetting("networkLogLargeRows",!1),this._networkRecordFilmStripSetting=e.Settings.instance().createSetting("networkRecordFilmStripSetting",!1),this._toggleRecordAction=D.ActionRegistry.instance().action("network.toggle-recording"),this._pendingStopTimer,this._networkItemView=null,this._filmStripView=null,this._filmStripRecorder=null,this._currentRequest=null;const i=new C.VBox,s=i.contentElement.createChild("div","network-toolbar-container");this._panelToolbar=new S.Toolbar("",s),this._rightToolbar=new S.Toolbar("",s),this._filterBar=new U.FilterBar("networkPanel",!0),this._filterBar.show(i.contentElement),this._filterBar.addEventListener(U.FilterBar.Events.Changed,this._handleFilterChanged.bind(this)),this._settingsPane=new C.HBox,this._settingsPane.element.classList.add("network-settings-pane"),this._settingsPane.show(i.contentElement),this._showSettingsPaneSetting=e.Settings.instance().createSetting("networkShowSettingsToolbar",!1),this._showSettingsPaneSetting.addChangeListener(this._updateSettingsPaneVisibility.bind(this)),this._updateSettingsPaneVisibility(),this._filmStripPlaceholderElement=i.contentElement.createChild("div","network-film-strip-placeholder"),this._overviewPane=new Ce.TimelineOverviewPane("network"),this._overviewPane.addEventListener(Ce.Events.WindowChanged,this._onWindowChanged.bind(this)),this._overviewPane.element.id="network-overview-panel",this._networkOverview=new Ii,this._overviewPane.setOverviewControls([this._networkOverview]),this._overviewPlaceholderElement=i.contentElement.createChild("div"),this._calculator=new It,this._splitWidget=new F.SplitWidget(!0,!1,"networkPanelSplitViewState"),this._splitWidget.hideMain(),this._splitWidget.show(i.contentElement),i.setDefaultFocusedChild(this._filterBar);const r=new F.SplitWidget(!0,!1,"networkPanelSidebarState",225);r.hideSidebar(),r.enableShowModeSaving(),r.show(this.element),this._sidebarLocation=A.ViewManager.instance().createTabbedLocation(async()=>{A.ViewManager.instance().showView("network"),r.showBoth()},"network-sidebar",!0);const o=this._sidebarLocation.tabbedPane();o.setMinimumSize(100,25),o.element.classList.add("network-tabbed-pane"),o.element.addEventListener("keydown",e=>{"Escape"===e.key&&(r.hideSidebar(),e.consume())});const n=new S.ToolbarButton(t.UIString("Close"),"largeicon-delete");n.addEventListener(S.ToolbarButton.Events.Click,()=>r.hideSidebar()),o.rightToolbar().appendToolbarItem(n),r.setSidebarWidget(o),r.setMainWidget(i),r.setDefaultFocusedChild(i),this.setDefaultFocusedChild(r),this._progressBarContainer=document.createElement("div"),this._networkLogView=new mi(this._filterBar,this._progressBarContainer,this._networkLogLargeRowsSetting),this._splitWidget.setSidebarWidget(this._networkLogView),this._fileSelectorElement=v.createFileSelectorElement(this._networkLogView.onLoadFromFile.bind(this._networkLogView)),i.element.appendChild(this._fileSelectorElement),this._detailsWidget=new C.VBox,this._detailsWidget.element.classList.add("network-details-view"),this._splitWidget.setMainWidget(this._detailsWidget),this._closeButtonElement=document.createElement("div",{is:"dt-close-button"}),this._closeButtonElement.addEventListener("click",async()=>{const e=D.ActionRegistry.instance().action("network.hide-request-details");e&&await e.execute()},!1),this._closeButtonElement.style.margin="0 5px",this._networkLogShowOverviewSetting.addChangeListener(this._toggleShowOverview,this),this._networkLogLargeRowsSetting.addChangeListener(this._toggleLargerRequests,this),this._networkRecordFilmStripSetting.addChangeListener(this._toggleRecordFilmStrip,this),this._preserveLogSetting=e.Settings.instance().moduleSetting("network_log.preserve-log"),this._throttlingSelect=this._createThrottlingConditionsSelect(),this._setupToolbarButtons(r),this._toggleRecord(!0),this._toggleShowOverview(),this._toggleLargerRequests(),this._toggleRecordFilmStrip(),this._updateUI(),j.TargetManager.instance().addModelListener(ee.ResourceTreeModel,ee.Events.WillReloadPage,this._willReloadPage,this),j.TargetManager.instance().addModelListener(ee.ResourceTreeModel,ee.Events.Load,this._load,this),this._networkLogView.addEventListener(Kt.RequestSelected,this._onRequestSelected,this),this._networkLogView.addEventListener(Kt.RequestActivated,this._onRequestActivated,this),Y.NetworkLog.instance().addEventListener(Y.Events.RequestAdded,this._onUpdateRequest,this),Y.NetworkLog.instance().addEventListener(Y.Events.RequestUpdated,this._onUpdateRequest,this),Y.NetworkLog.instance().addEventListener(Y.Events.Reset,this._onNetworkLogReset,this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return Ei&&!t||(Ei=new Pi),Ei}static revealAndFilter(e){const t=Pi._instance();let i="";for(const t of e)t.filterType?i+=`${t.filterType}:${t.filterValue} `:i+=t.filterValue+" ";t._networkLogView.setTextFilterValue(i),A.ViewManager.instance().showView("network")}static async selectAndShowRequest(e,t,i){const s=Pi._instance();await s.selectAndActivateRequest(e,t,i)}static _instance(){return Pi.instance()}throttlingSelectForTest(){return this._throttlingSelect}_onWindowChanged(e){const t=Math.max(this._calculator.minimumBoundary(),e.data.startTime/1e3),i=Math.min(this._calculator.maximumBoundary(),e.data.endTime/1e3);this._networkLogView.setWindow(t,i)}async _searchToggleClick(e){const t=D.ActionRegistry.instance().action("network.search");t&&await t.execute()}_setupToolbarButtons(i){const s=new S.ToolbarToggle(ls`Search`,"largeicon-search");function r(){const e=i.showMode()!==F.ShowMode.OnlyMain;s.setToggled(e),e||s.element.focus()}this._panelToolbar.appendToolbarItem(S.Toolbar.createActionButton(this._toggleRecordAction));const o=new S.ToolbarButton(t.UIString("Clear"),"largeicon-clear");o.addEventListener(S.ToolbarButton.Events.Click,()=>Y.NetworkLog.instance().reset(),this),this._panelToolbar.appendToolbarItem(o),this._panelToolbar.appendSeparator(),this._panelToolbar.appendToolbarItem(this._filterBar.filterButton()),r(),i.addEventListener(F.Events.ShowModeChanged,r),s.addEventListener(S.ToolbarButton.Events.Click,e=>{this._searchToggleClick(e)}),this._panelToolbar.appendToolbarItem(s),this._panelToolbar.appendSeparator(),this._panelToolbar.appendToolbarItem(new S.ToolbarSettingCheckbox(this._preserveLogSetting,t.UIString("Do not clear log on page reload / navigation"),t.UIString("Preserve log")));const n=new S.ToolbarSettingCheckbox(e.Settings.instance().moduleSetting("cacheDisabled"),t.UIString("Disable cache (while DevTools is open)"),t.UIString("Disable cache"));this._panelToolbar.appendToolbarItem(n),this._panelToolbar.appendSeparator(),this._panelToolbar.appendToolbarItem(this._throttlingSelect),this._rightToolbar.appendToolbarItem(new S.ToolbarItem(this._progressBarContainer)),this._rightToolbar.appendSeparator(),this._rightToolbar.appendToolbarItem(new S.ToolbarSettingToggle(this._showSettingsPaneSetting,"largeicon-settings-gear",ls`Network settings`));const a=new S.Toolbar("",this._settingsPane.element);a.makeVertical(),a.appendToolbarItem(new S.ToolbarSettingCheckbox(this._networkLogLargeRowsSetting,ls`Show more information in request rows`,ls`Use large request rows`)),a.appendToolbarItem(new S.ToolbarSettingCheckbox(this._networkLogShowOverviewSetting,ls`Show overview of network requests`,ls`Show overview`));const l=new S.Toolbar("",this._settingsPane.element);l.makeVertical(),l.appendToolbarItem(new S.ToolbarSettingCheckbox(e.Settings.instance().moduleSetting("network.group-by-frame"),ls`Group requests by top level request frame`,ls`Group by frame`)),l.appendToolbarItem(new S.ToolbarSettingCheckbox(this._networkRecordFilmStripSetting,ls`Capture screenshots when loading a page`,ls`Capture screenshots`)),this._panelToolbar.appendSeparator();const d=new S.ToolbarButton(ls`Import HAR file...`,"largeicon-load");d.addEventListener(S.ToolbarButton.Events.Click,()=>this._fileSelectorElement.click(),this),this._panelToolbar.appendToolbarItem(d);const c=new S.ToolbarButton(ls`Export HAR...`,"largeicon-download");c.addEventListener(S.ToolbarButton.Events.Click,e=>{this._networkLogView.exportAll()},this),this._panelToolbar.appendToolbarItem(c)}_updateSettingsPaneVisibility(){this._settingsPane.element.classList.toggle("hidden",!this._showSettingsPaneSetting.get())}_createThrottlingConditionsSelect(){const e=new S.ToolbarComboBox(null,ls`Throttling`);return e.setMaxWidth(160),ce.throttlingManager().decorateSelectWithNetworkThrottling(e.selectElement()),e}_toggleRecording(){this._preserveLogSetting.get()||this._toggleRecordAction.toggled()||Y.NetworkLog.instance().reset(),this._toggleRecord(!this._toggleRecordAction.toggled())}_toggleRecord(e){this._toggleRecordAction.setToggled(e),this._networkLogView.setRecording(e),!e&&this._filmStripRecorder&&this._filmStripRecorder.stopRecording(this._filmStripAvailable.bind(this)),Y.NetworkLog.instance().setIsRecording(e)}_filmStripAvailable(e){if(!e)return;const t=this._networkLogView.timeCalculator();this._filmStripView&&this._filmStripView.setModel(e,1e3*t.minimumBoundary(),1e3*t.boundarySpan()),this._networkOverview.setFilmStripModel(e);const i=e.frames().map((function(e){return e.timestamp/1e3}));this._networkLogView.addFilmStripFrames(i)}_onNetworkLogReset(){Ne.reset(),this._preserveLogSetting.get()||(this._calculator.reset(),this._overviewPane.reset()),this._filmStripView&&this._resetFilmStripView()}_willReloadPage(e){this._toggleRecord(!0),this._pendingStopTimer&&(clearTimeout(this._pendingStopTimer),delete this._pendingStopTimer),this.isShowing()&&this._filmStripRecorder&&this._filmStripRecorder.startRecording()}_load(e){this._filmStripRecorder&&this._filmStripRecorder.isRecording()&&(this._pendingStopTimer=window.setTimeout(this._stopFilmStripRecording.bind(this),Mi))}_stopFilmStripRecording(){this._filmStripRecorder&&this._filmStripRecorder.stopRecording(this._filmStripAvailable.bind(this)),delete this._pendingStopTimer}_toggleLargerRequests(){this._updateUI()}_toggleShowOverview(){this._networkLogShowOverviewSetting.get()?this._overviewPane.show(this._overviewPlaceholderElement):this._overviewPane.detach(),this.doResize()}_toggleRecordFilmStrip(){const e=this._networkRecordFilmStripSetting.get();e&&!this._filmStripRecorder&&(this._filmStripView=new Se.FilmStripView,this._filmStripView.setMode(Se.Modes.FrameBased),this._filmStripView.element.classList.add("network-film-strip"),this._filmStripRecorder=new Hi(this._networkLogView.timeCalculator(),this._filmStripView),this._filmStripView.show(this._filmStripPlaceholderElement),this._filmStripView.addEventListener(Se.Events.FrameSelected,this._onFilmFrameSelected,this),this._filmStripView.addEventListener(Se.Events.FrameEnter,this._onFilmFrameEnter,this),this._filmStripView.addEventListener(Se.Events.FrameExit,this._onFilmFrameExit,this),this._resetFilmStripView()),!e&&this._filmStripRecorder&&(this._filmStripView&&this._filmStripView.detach(),this._filmStripView=null,this._filmStripRecorder=null)}_resetFilmStripView(){const e=V.ShortcutRegistry.instance().shortcutsForAction("inspector_main.reload")[0];this._filmStripView&&(this._filmStripView.reset(),e&&this._filmStripView.setStatusText(t.UIString("Hit %s to reload and capture filmstrip.",e.title())))}elementsToRestoreScrollPositionsFor(){return this._networkLogView.elementsToRestoreScrollPositionsFor()}wasShown(){G.Context.instance().setFlavor(Pi,this),h.panelLoaded("network","DevTools.Launch.Network")}willHide(){G.Context.instance().setFlavor(Pi,null)}revealAndHighlightRequest(e){this._hideRequestPanel(),e&&this._networkLogView.revealAndHighlightRequest(e)}async selectAndActivateRequest(e,t,i){return await A.ViewManager.instance().showView("network"),this._networkLogView.selectRequest(e,i),this._showRequestPanel(t),this._networkItemView}_handleFilterChanged(e){this._hideRequestPanel()}_onRowSizeChanged(e){this._updateUI()}_onRequestSelected(e){const t=e.data;this._currentRequest=t,this._networkOverview.setHighlightedRequest(t),this._updateNetworkItemView()}_onRequestActivated(e){const t=e.data;t.showPanel?this._showRequestPanel(t.tab,t.takeFocus):this._hideRequestPanel()}_showRequestPanel(e,t){if(this._clearNetworkItemView(),this._currentRequest){const i=this._createNetworkItemView(e);i&&t&&i.focus()}this._updateUI()}_hideRequestPanel(){this._clearNetworkItemView(),this._splitWidget.hideMain(),this._updateUI()}_updateNetworkItemView(){this._splitWidget.showMode()===F.ShowMode.Both&&(this._clearNetworkItemView(),this._createNetworkItemView(),this._updateUI())}_clearNetworkItemView(){this._networkItemView&&(this._networkItemView.detach(),this._networkItemView=null)}_createNetworkItemView(e){if(this._currentRequest)return this._networkItemView=new Dt(this._currentRequest,this._networkLogView.timeCalculator(),e),this._networkItemView.leftToolbar().appendToolbarItem(new S.ToolbarItem(this._closeButtonElement)),this._networkItemView.show(this._detailsWidget.element),this._splitWidget.showBoth(),this._networkItemView}_updateUI(){this._detailsWidget&&this._detailsWidget.element.classList.toggle("network-details-view-tall-header",this._networkLogLargeRowsSetting.get()),this._networkLogView&&this._networkLogView.switchViewMode(!this._splitWidget.isResizable())}appendApplicableItems(e,i,s){function r(e){A.ViewManager.instance().showView("network").then(this._networkLogView.resetFilter.bind(this._networkLogView)).then(this.revealAndHighlightRequest.bind(this,e))}function o(e){i.revealSection().appendItem(t.UIString("Reveal in Network panel"),r.bind(this,e))}if(e.target.isSelfOrDescendant(this.element))return;if(s instanceof te.Resource){const e=s;return void(e.request&&o.call(this,e.request))}if(s instanceof ve.UISourceCode){const e=s,t=he.resourceForURL(e.url());return void(t&&t.request&&o.call(this,t.request))}if(!(s instanceof $.NetworkRequest))return;const n=s;this._networkItemView&&this._networkItemView.isShowing()&&this._networkItemView.request()===n||o.call(this,n)}_onFilmFrameSelected(e){const t=e.data;this._overviewPane.setWindowTimes(0,t)}_onFilmFrameEnter(e){const t=e.data;this._networkOverview.selectFilmStripFrame(t),this._networkLogView.selectFilmStripFrame(t/1e3)}_onFilmFrameExit(e){this._networkOverview.clearFilmStripFrame(),this._networkLogView.clearFilmStripFrame()}_onUpdateRequest(e){const t=e.data;this._calculator.updateBoundaries(t),this._overviewPane.setBounds(1e3*this._calculator.minimumBoundary(),1e3*this._calculator.maximumBoundary()),this._networkOverview.updateRequest(t),this._overviewPane.scheduleUpdate()}resolveLocation(e){return"network-sidebar"===e?this._sidebarLocation:null}}const Mi=1e3;class Hi{constructor(e,t){this._tracingManager=null,this._resourceTreeModel=null,this._timeCalculator=e,this._filmStripView=t,this._tracingModel=null,this._callback=null}traceEventsCollected(e){this._tracingModel&&this._tracingModel.addEvents(e)}tracingComplete(){this._tracingModel&&this._tracingManager&&(this._tracingModel.tracingComplete(),this._tracingManager=null,this._callback&&this._callback(new ie.FilmStripModel(this._tracingModel,1e3*this._timeCalculator.minimumBoundary())),this._callback=null,this._resourceTreeModel&&this._resourceTreeModel.resumeReload(),this._resourceTreeModel=null)}tracingBufferUsage(){}eventsRetrievalProgress(e){}startRecording(){this._filmStripView.reset(),this._filmStripView.setStatusText(t.UIString("Recording frames..."));const e=j.TargetManager.instance().models(se.TracingManager);!this._tracingManager&&e.length&&(this._tracingManager=e[0],this._tracingManager&&(this._resourceTreeModel=this._tracingManager.target().model(ee.ResourceTreeModel),this._tracingModel&&this._tracingModel.dispose(),this._tracingModel=new re.TracingModel(new me.TempFileBackingStorage),this._tracingManager.start(this,"-*,disabled-by-default-devtools.screenshot",""),h.actionTaken(u.Action.FilmStripStartedRecording)))}isRecording(){return!!this._tracingManager}stopRecording(e){this._tracingManager&&(this._tracingManager.stop(),this._resourceTreeModel&&this._resourceTreeModel.suspendReload(),this._callback=e,this._filmStripView.setStatusText(t.UIString("Fetching frames...")))}}let Ui;class Bi extends Pe.SearchView{constructor(){super("network")}static instance(e={forceNew:null}){const{forceNew:t}=e;return Ui&&!t||(Ui=new Bi),Ui}static async openSearch(e,t){await A.ViewManager.instance().showView("network.search-network-tab");const i=Bi.instance();return i.toggle(e,!!t),i}createScope(){return new ki}}var Ni=Object.freeze({__proto__:null,NetworkPanel:Pi,displayScreenshotDelay:Mi,ContextMenuProvider:class{appendApplicableItems(e,t,i){Pi._instance().appendApplicableItems(e,t,i)}},RequestRevealer:class{reveal(e){if(!(e instanceof $.NetworkRequest))return Promise.reject(new Error("Internal error: not a network request"));const t=Pi._instance();return A.ViewManager.instance().showView("network").then(t.revealAndHighlightRequest.bind(t,e))}},FilmStripRecorder:Hi,ActionDelegate:class{handleAction(e,t){const i=G.Context.instance().flavor(Pi);if(console.assert(!!(i&&i instanceof Pi)),!i)return!1;switch(t){case"network.toggle-recording":return i._toggleRecording(),!0;case"network.hide-request-details":return!!i._networkItemView&&(i._hideRequestPanel(),i._networkLogView.resetFocus(),!0);case"network.search":{const e=z.InspectorView.instance().element.window().getSelection();if(e){let t="";return e.rangeCount&&(t=e.toString().replace(/\r?\n.*/,"")),Bi.openSearch(t),!0}}}return!1}},RequestLocationRevealer:class{async reveal(e){const t=e,i=await Pi._instance().selectAndActivateRequest(t.request);i&&(t.searchMatch&&await i.revealResponseBody(t.searchMatch.lineNumber),t.requestHeader&&i.revealRequestHeader(t.requestHeader.name),t.responseHeader&&i.revealResponseHeader(t.responseHeader.name))}},SearchNetworkView:Bi,FilterOptions:void 0});document.body.addEventListener("networkrevealandfilter",e=>{Pi.revealAndFilter(e.detail)});export{Ue as BinaryResourceView,Ve as BlockedURLsPane,Ge as EventSourceMessagesView,$e as HARWriter,Je as NetworkConfigView,Jt as NetworkDataGridNode,ei as NetworkFrameGrouper,zt as NetworkItemView,bi as NetworkLogView,ui as NetworkLogViewColumns,ii as NetworkManageCustomHeadersView,Fi as NetworkOverview,Ni as NetworkPanel,Ri as NetworkSearchScope,Lt as NetworkTimeCalculator,ri as NetworkWaterfallColumn,Ye as RequestCookiesView,dt as RequestHTMLView,ot as RequestHeadersView,at as RequestInitiatorView,wt as RequestPreviewView,ut as RequestResponseView,Mt as RequestTimingView,Ot as ResourceWebSocketFrameView,pt as SignedExchangeInfoView};
