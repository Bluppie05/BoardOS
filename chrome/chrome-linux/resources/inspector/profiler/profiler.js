import{ArrayUtilities as e,NumberUtilities as t,DateUtilities as i,StringUtilities as s}from"../platform/platform.js";import{UIString as r,Color as o,ObjectWrapper as n,Settings as a,Revealer as l,ParsedURL as d,Console as h,Worker as c,Throttler as p}from"../common/common.js";import{DataGrid as u,ShowMoreDataGridNode as _,SortableDataGrid as m}from"../data_grid/data_grid.js";import{UIUtils as f,Icon as g,Widget as v,TreeOutline as S,InplaceEditor as w,ARIAUtils as C,ContextMenu as b,View as P,SearchableView as T,Toolbar as y,Context as x,ListModel as I,ListControl as R,InspectorView as E,Fragment as N,SplitWidget as D,TabbedPane as F,PopoverHelper as L,SettingsUI as k,Panel as M,ActionRegistry as O,ViewManager as V}from"../ui/ui.js";import{Platform as B,userMetrics as G,UserMetrics as H}from"../host/host.js";import{FlameChart as z,OverviewGrid as j,LineLevelProfile as U,PieChart as A}from"../perf_ui/perf_ui.js";import{Linkifier as W}from"../components/components.js";import{SDKModel as $,CPUProfilerModel as q,CPUProfileDataModel as J,IsolateManager as Q,RuntimeModel as K,HeapProfilerModel as X,ProfileTreeModel as Y,ConsoleModel as Z,RemoteObject as ee,ResourceTreeModel as te}from"../sdk/sdk.js";import{DebuggerWorkspaceBinding as ie,FileUtils as se,TempFile as re}from"../bindings/bindings.js";import{HeapSnapshotModel as oe}from"../heap_snapshot_model/heap_snapshot_model.js";import{ObjectPopoverHelper as ne}from"../object_ui/object_ui.js";import{Workspace as ae}from"../workspace/workspace.js";class le extends u.DataGridNode{constructor(e,t,i){super(null,i),this._searchMatchedSelfColumn=!1,this._searchMatchedTotalColumn=!1,this._searchMatchedFunctionColumn=!1,this.profileNode=e,this.tree=t,this.childrenByCallUID=new Map,this.lastComparator=null,this.callUID=e.callUID,this.self=e.self,this.total=e.total,this.functionName=f.beautifyFunctionName(e.functionName),this._deoptReason=e.deoptReason||"",this.url=e.url,this.linkElement=null}static sort(e,t,i){for(let s=0;s<e.length;++s){const r=e[s],o=r.length;for(let s=0;s<o;++s){const o=r[s];if(!(i||o.expanded&&o.lastComparator!==t)){o.children.length&&(o.shouldRefreshChildren=!0);continue}o.lastComparator=t;const n=o.children,a=n.length;if(a){n.sort(t);for(let e=0;e<a;++e)n[e].recalculateSiblings(e);e.push(n)}}}}static merge(e,t,i){e.self+=t.self,i||(e.total+=t.total);let s=e.children.slice();e.removeChildren();let r=s.length;for(let o=0;o<r;++o)i&&s[o]===t||e.appendChild(s[o]);s=t.children.slice(),r=s.length;for(let t=0;t<r;++t){const i=s[t],r=e.childrenByCallUID.get(i.callUID);r?r.merge(i,!1):e.appendChild(i)}}static populate(e){if(e._populated)return;e._populated=!0,e.populateChildren();const t=e.tree.lastComparator;t&&e.sort(t,!0)}createCell(e){switch(e){case"self":{const t=this._createValueCell(this.self,this.selfPercent,e);return t.classList.toggle("highlight",this._searchMatchedSelfColumn),t}case"total":{const t=this._createValueCell(this.total,this.totalPercent,e);return t.classList.toggle("highlight",this._searchMatchedTotalColumn),t}case"function":{const t=this.createTD(e);if(t.classList.toggle("highlight",this._searchMatchedFunctionColumn),this._deoptReason){t.classList.add("not-optimized");const e=g.Icon.create("smallicon-warning","profile-warn-marker");e.title=r.UIString("Not optimized: %s",this._deoptReason),t.appendChild(e)}if(f.createTextChild(t,this.functionName),"0"===this.profileNode.scriptId)return t;const i=this.tree._formatter.linkifyNode(this);return i?(i.style.maxWidth="75%",t.appendChild(i),this.linkElement=i,t):t}}return super.createCell(e)}_createValueCell(e,t,i){const s=document.createElement("td");s.classList.add("numeric-column");const r=s.createChild("div","profile-multiple-values"),o=r.createChild("span"),n=this.tree._formatter.formatValue(e,this);o.textContent=n;const a=r.createChild("span","percent-column"),l=this.tree._formatter.formatPercent(t,this);a.textContent=l;const d=this.tree._formatter.formatValueAccessibleText(e,this);return this.setCellAccessibleName(ls`${d}, ${l}`,s,i),s}sort(e,t){return le.sort([[this]],e,t)}insertChild(e,t){super.insertChild(e,t),this.childrenByCallUID.set(e.callUID,e)}removeChild(e){super.removeChild(e),this.childrenByCallUID.delete(e.callUID)}removeChildren(){super.removeChildren(),this.childrenByCallUID.clear()}findChild(e){return e?this.childrenByCallUID.get(e.callUID):null}get selfPercent(){return this.self/this.tree.total*100}get totalPercent(){return this.total/this.tree.total*100}populate(){le.populate(this)}populateChildren(){}save(){this._savedChildren||(this._savedSelf=this.self,this._savedTotal=this.total,this._savedChildren=this.children.slice())}restore(){if(!this._savedChildren)return;this.self=this._savedSelf,this.total=this._savedTotal,this.removeChildren();const e=this._savedChildren,t=e.length;for(let i=0;i<t;++i)e[i].restore(),this.appendChild(e[i])}merge(e,t){le.merge(this,e,t)}}class de{constructor(e,t,i){this.tree=this,this.children=[],this._formatter=e,this._searchableView=t,this.total=i,this.lastComparator=null,this.childrenByCallUID=new Map,this.deepSearch=!0}static propertyComparator(e,t){let i=de.propertyComparators[t?1:0][e];return i||(i=t?function(t,i){return t[e]<i[e]?-1:t[e]>i[e]?1:0}:function(t,i){return t[e]>i[e]?-1:t[e]<i[e]?1:0},de.propertyComparators[t?1:0][e]=i),i}get expanded(){return!0}appendChild(e){this.insertChild(e,this.children.length)}insertChild(e,t){this.children.splice(t,0,e),this.childrenByCallUID.set(e.callUID,e)}removeChildren(){this.children=[],this.childrenByCallUID.clear()}populateChildren(){}findChild(e){return e?this.childrenByCallUID.get(e.callUID):null}sort(e,t){return le.sort([[this]],e,t)}save(){this._savedChildren||(this._savedTotal=this.total,this._savedChildren=this.children.slice())}restore(){if(!this._savedChildren)return;this.children=this._savedChildren,this.total=this._savedTotal;const e=this.children,t=e.length;for(let i=0;i<t;++i)e[i].restore();this._savedChildren=null}_matchFunction(e){const t=e.query.trim();if(!t.length)return null;const i=t.startsWith(">"),s=t.startsWith("<");let r=t.startsWith("=")||(i||s)&&1===t.indexOf("=");const o=t.endsWith("%"),n=t.length>2&&t.endsWith("ms"),a=!n&&t.endsWith("s");let l=parseFloat(t);(i||s||r)&&(l=r&&(i||s)?parseFloat(t.substring(2)):parseFloat(t.substring(1)));const d=a?1e3*l:l;isNaN(l)||i||s||(r=!0);const h=createPlainTextSearchRegex(t,"i");return function(e){return e._searchMatchedSelfColumn=!1,e._searchMatchedTotalColumn=!1,e._searchMatchedFunctionColumn=!1,o?(s?(e.selfPercent<l&&(e._searchMatchedSelfColumn=!0),e.totalPercent<l&&(e._searchMatchedTotalColumn=!0)):i&&(e.selfPercent>l&&(e._searchMatchedSelfColumn=!0),e.totalPercent>l&&(e._searchMatchedTotalColumn=!0)),r&&(e.selfPercent===l&&(e._searchMatchedSelfColumn=!0),e.totalPercent===l&&(e._searchMatchedTotalColumn=!0))):(n||a)&&(s?(e.self<d&&(e._searchMatchedSelfColumn=!0),e.total<d&&(e._searchMatchedTotalColumn=!0)):i&&(e.self>d&&(e._searchMatchedSelfColumn=!0),e.total>d&&(e._searchMatchedTotalColumn=!0)),r&&(e.self===d&&(e._searchMatchedSelfColumn=!0),e.total===d&&(e._searchMatchedTotalColumn=!0))),(e.functionName.match(h)||e.url&&e.url.match(h))&&(e._searchMatchedFunctionColumn=!0),!!(e._searchMatchedSelfColumn||e._searchMatchedTotalColumn||e._searchMatchedFunctionColumn)&&(e.refresh(),!0)}}performSearch(e,t,i){this.searchCanceled();const s=this._matchFunction(e);if(!s)return;this._searchResults=[];const r=this.deepSearch;for(let e=this.children[0];e;e=e.traverseNextNode(!r,null,!r))s(e)&&this._searchResults.push({profileNode:e});this._searchResultIndex=i?0:this._searchResults.length-1,this._searchableView.updateSearchMatchesCount(this._searchResults.length),this._searchableView.updateCurrentMatchIndex(this._searchResultIndex)}searchCanceled(){if(this._searchResults)for(let e=0;e<this._searchResults.length;++e){const t=this._searchResults[e].profileNode;t._searchMatchedSelfColumn=!1,t._searchMatchedTotalColumn=!1,t._searchMatchedFunctionColumn=!1,t.refresh()}this._searchResults=[],this._searchResultIndex=-1}jumpToNextSearchResult(){this._searchResults&&this._searchResults.length&&(this._searchResultIndex=(this._searchResultIndex+1)%this._searchResults.length,this._jumpToSearchResult(this._searchResultIndex))}jumpToPreviousSearchResult(){this._searchResults&&this._searchResults.length&&(this._searchResultIndex=(this._searchResultIndex-1+this._searchResults.length)%this._searchResults.length,this._jumpToSearchResult(this._searchResultIndex))}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}_jumpToSearchResult(e){const t=this._searchResults[e];if(!t)return;t.profileNode.revealAndSelect(),this._searchableView.updateCurrentMatchIndex(e)}}de.propertyComparators=[{},{}];var he=Object.freeze({__proto__:null,ProfileDataGridNode:le,ProfileDataGridTree:de,Formatter:class{formatValue(e,t){}formatValueAccessibleText(e){}formatPercent(e,t){}linkifyNode(e){}}});class ce extends le{constructor(e,t){super(e,t,!!e.parent&&!!e.parent.parent),this._remainingNodeInfos=[]}static _sharedPopulate(e){const t=e._remainingNodeInfos,i=t.length;for(let s=0;s<i;++s){const i=t[s],r=i.ancestor,o=i.focusNode;let n=e.findChild(r);if(n){const e=i.totalAccountedFor;n.self+=o.self,e||(n.total+=o.total)}else n=new ce(r,e.tree),r!==o&&(n.self=o.self,n.total=o.total),e.appendChild(n);const a=r.parent;a&&a.parent&&(i.ancestor=a,n._remainingNodeInfos.push(i))}delete e._remainingNodeInfos}_takePropertiesFromProfileDataGridNode(e){this.save(),this.self=e.self,this.total=e.total}_keepOnlyChild(e){this.save(),this.removeChildren(),this.appendChild(e)}_exclude(e){this._remainingNodeInfos&&this.populate(),this.save();const t=this.children;let i=this.children.length;for(;i--;)t[i]._exclude(e);const s=this.childrenByCallUID.get(e);s&&this.merge(s,!0)}restore(){super.restore(),this.children.length||this.setHasChildren(this._willHaveChildren(this.profileNode))}merge(e,t){this.self-=e.self,super.merge(e,t)}populateChildren(){ce._sharedPopulate(this)}_willHaveChildren(e){return!(!e.parent||!e.parent.parent)}}class pe extends de{constructor(e,t,i,s){super(e,t,s),this.deepSearch=!1;let r=0;const o=[[],[i]],n=new Map;this._remainingNodeInfos=[];for(let e=0;e<o.length;++e){const t=o[e],i=o[++e],s=i.length;for(let e=0;e<s;++e){const s=i[e];if(s.UID||(s.UID=++r),s.parent){let e=n.get(s.callUID),i=!1;if(e){const s=t.length;for(let r=0;r<s;++r)if(e.has(t[r].UID)){i=!0;break}}else e=new Set,n.set(s.callUID,e);e.add(s.UID),this._remainingNodeInfos.push({ancestor:s,focusNode:s,totalAccountedFor:i})}const a=s.children;a.length&&(o.push(t.concat([s])),o.push(a))}}return le.populate(this),this}focus(e){if(!e)return;this.save();let t=e,i=e;for(;t.parent&&t instanceof le;)t._takePropertiesFromProfileDataGridNode(e),i=t,t=t.parent,t instanceof le&&t._keepOnlyChild(i);this.children=[i],this.total=e.total}exclude(t){if(!t)return;this.save();const i=t.callUID,s=this.childrenByCallUID.get(i);s&&e.removeElement(this.children,s);const r=this.children,o=r.length;for(let e=0;e<o;++e)r[e]._exclude(i);this.lastComparator&&this.sort(this.lastComparator,!0)}populateChildren(){ce._sharedPopulate(this)}}var ue=Object.freeze({__proto__:null,BottomUpProfileDataGridNode:ce,BottomUpProfileDataGridTree:pe});var _e=Object.freeze({__proto__:null,ChildrenProvider:class{dispose(){}nodePosition(e){}isEmpty(){}serializeItemsRange(e,t){}sortAndRewind(e){}}});class me{constructor(){this._colorGenerator=me.colorGenerator()}static colorGenerator(){if(!me._colorGenerator){const e=new o.Generator({min:30,max:330},{min:50,max:80,count:5},{min:80,max:90,count:3});e.setColorForID("(idle)","hsl(0, 0%, 94%)"),e.setColorForID("(program)","hsl(0, 0%, 80%)"),e.setColorForID("(garbage collector)","hsl(0, 0%, 80%)"),me._colorGenerator=e}return me._colorGenerator}minimumBoundary(){return this._cpuProfile.profileStartTime}totalTime(){return this._cpuProfile.profileHead.total}formatValue(e,t){return Number.preciseMillisToString(e,t)}maxStackDepth(){return this._maxStackDepth}timelineData(){return this._timelineData||this._calculateTimelineData()}_calculateTimelineData(){throw"Not implemented."}prepareHighlightedEntryInfo(e){throw"Not implemented."}canJumpToEntry(e){return"0"!==this._entryNodes[e].scriptId}entryTitle(e){const t=this._entryNodes[e];return f.beautifyFunctionName(t.functionName)}entryFont(e){this._font||(this._font="11px "+B.fontFamily(),this._boldFont="bold "+this._font);return this._entryNodes[e].deoptReason?this._boldFont:this._font}entryColor(e){const t=this._entryNodes[e];return this._colorGenerator.colorForID(t.url||("0"!==t.scriptId?t.scriptId:t.functionName))}decorateEntry(e,t,i,s,r,o,n){return!1}forceDecoration(e){return!1}textColor(e){return"#333"}navStartTimes(){return new Map}}class fe extends v.VBox{constructor(e,t){super(),this.element.id="cpu-flame-chart",this._searchableView=e,this._overviewPane=new ve(t),this._overviewPane.show(this.element),this._mainPane=new z.FlameChart(t,this._overviewPane),this._mainPane.setBarHeight(15),this._mainPane.setTextBaseline(4),this._mainPane.setTextPadding(2),this._mainPane.show(this.element),this._mainPane.addEventListener(z.Events.EntrySelected,this._onEntrySelected,this),this._mainPane.addEventListener(z.Events.EntryInvoked,this._onEntryInvoked,this),this._entrySelected=!1,this._mainPane.addEventListener(z.Events.CanvasFocused,this._onEntrySelected,this),this._overviewPane.addEventListener(j.Events.WindowChanged,this._onWindowChanged,this),this._dataProvider=t,this._searchResults=[]}focus(){this._mainPane.focus()}_onWindowChanged(e){const t=e.data.windowTimeLeft,i=e.data.windowTimeRight;this._mainPane.setWindowTimes(t,i,!0)}selectRange(e,t){this._overviewPane._selectRange(e,t)}_onEntrySelected(e){if(e.data){const t=Number(e.data);this._mainPane.setSelectedEntry(t),this._entrySelected=-1!==t}else this._entrySelected||(this._mainPane.setSelectedEntry(0),this._entrySelected=!0)}_onEntryInvoked(e){this._onEntrySelected(e),this.dispatchEventToListeners(z.Events.EntryInvoked,e.data)}update(){this._overviewPane.update(),this._mainPane.update()}performSearch(e,t,i){const s=createPlainTextSearchRegex(e.query,e.caseSensitive?"":"i"),r=-1!==this._searchResultIndex?this._searchResults[this._searchResultIndex]:-1;this._searchResults=[];const o=this._dataProvider._entryNodes.length;for(let e=0;e<o;++e)this._dataProvider.entryTitle(e).match(s)&&this._searchResults.push(e);this._searchResults.length?(this._searchResultIndex=this._searchResults.indexOf(r),-1===this._searchResultIndex&&(this._searchResultIndex=i?this._searchResults.length-1:0),this._mainPane.setSelectedEntry(this._searchResults[this._searchResultIndex])):this.searchCanceled(),this._searchableView.updateSearchMatchesCount(this._searchResults.length),this._searchableView.updateCurrentMatchIndex(this._searchResultIndex)}searchCanceled(){this._mainPane.setSelectedEntry(-1),this._searchResults=[],this._searchResultIndex=-1}jumpToNextSearchResult(){this._searchResultIndex=(this._searchResultIndex+1)%this._searchResults.length,this._mainPane.setSelectedEntry(this._searchResults[this._searchResultIndex]),this._searchableView.updateCurrentMatchIndex(this._searchResultIndex)}jumpToPreviousSearchResult(){this._searchResultIndex=(this._searchResultIndex-1+this._searchResults.length)%this._searchResults.length,this._mainPane.setSelectedEntry(this._searchResults[this._searchResultIndex]),this._searchableView.updateCurrentMatchIndex(this._searchResultIndex)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}}class ge{constructor(e){this._dataProvider=e}_updateBoundaries(e){this._minimumBoundaries=e._dataProvider.minimumBoundary();const t=e._dataProvider.totalTime();this._maximumBoundaries=this._minimumBoundaries+t,this._xScaleFactor=e._overviewContainer.clientWidth/t}computePosition(e){return(e-this._minimumBoundaries)*this._xScaleFactor}formatValue(e,t){return this._dataProvider.formatValue(e-this._minimumBoundaries,t)}maximumBoundary(){return this._maximumBoundaries}minimumBoundary(){return this._minimumBoundaries}zeroTime(){return this._minimumBoundaries}boundarySpan(){return this._maximumBoundaries-this._minimumBoundaries}}class ve extends v.VBox{constructor(e){super(),this.element.classList.add("cpu-profile-flame-chart-overview-pane"),this._overviewContainer=this.element.createChild("div","cpu-profile-flame-chart-overview-container"),this._overviewCalculator=new ge(e),this._overviewGrid=new j.OverviewGrid("cpu-profile-flame-chart",this._overviewCalculator),this._overviewGrid.element.classList.add("fill"),this._overviewCanvas=this._overviewContainer.createChild("canvas","cpu-profile-flame-chart-overview-canvas"),this._overviewContainer.appendChild(this._overviewGrid.element),this._dataProvider=e,this._overviewGrid.addEventListener(j.Events.WindowChanged,this._onWindowChanged,this)}windowChanged(e,t){this._selectRange(e,t)}updateRangeSelection(e,t){}updateSelectedGroup(e,t){}_selectRange(e,t){const i=this._dataProvider.minimumBoundary(),s=this._dataProvider.totalTime();this._overviewGrid.setWindow((e-i)/s,(t-i)/s)}_onWindowChanged(e){const t={windowTimeLeft:e.data.rawStartValue,windowTimeRight:e.data.rawEndValue};this._windowTimeLeft=t.windowTimeLeft,this._windowTimeRight=t.windowTimeRight,this.dispatchEventToListeners(j.Events.WindowChanged,t)}_timelineData(){return this._dataProvider.timelineData()}onResize(){this._scheduleUpdate()}_scheduleUpdate(){this._updateTimerId||(this._updateTimerId=this.element.window().requestAnimationFrame(this.update.bind(this)))}update(){this._updateTimerId=0;this._timelineData()&&(this._resetCanvas(this._overviewContainer.clientWidth,this._overviewContainer.clientHeight-z.HeaderHeight),this._overviewCalculator._updateBoundaries(this),this._overviewGrid.updateDividers(this._overviewCalculator),this._drawOverviewCanvas())}_drawOverviewCanvas(){const e=this._overviewCanvas.width,t=this._overviewCanvas.height,i=this._calculateDrawData(e),s=this._overviewCanvas.getContext("2d"),r=window.devicePixelRatio,o=t/(1.1*this._dataProvider.maxStackDepth());let n;s.lineWidth=1,s.translate(.5,.5),s.strokeStyle="rgba(20,0,0,0.4)",s.fillStyle="rgba(214,225,254,0.8)",s.moveTo(-1,t+1),s.lineTo(-1,Math.round(t-i[0]*o-r));for(let a=0;a<e;++a)n=Math.round(t-i[a]*o-r),s.lineTo(a,n);s.lineTo(e+1,n),s.lineTo(e+1,t+1),s.fill(),s.stroke(),s.closePath()}_calculateDrawData(e){const t=this._dataProvider,i=this._timelineData(),s=i.entryStartTimes,r=i.entryTotalTimes,o=i.entryLevels,n=s.length,a=this._dataProvider.minimumBoundary(),l=new Uint8Array(e),d=e/t.totalTime();for(let e=0;e<n;++e){const t=Math.floor((s[e]-a)*d),i=Math.floor((s[e]-a+r[e])*d);for(let s=t;s<=i;++s)l[s]=Math.max(l[s],o[e]+1)}return l}_resetCanvas(e,t){const i=window.devicePixelRatio;this._overviewCanvas.width=e*i,this._overviewCanvas.height=t*i,this._overviewCanvas.style.width=e+"px",this._overviewCanvas.style.height=t+"px"}}var Se=Object.freeze({__proto__:null,ProfileFlameChartDataProvider:me,CPUProfileFlameChart:fe,OverviewCalculator:ge,OverviewPane:ve});class we extends n.ObjectWrapper{constructor(e,t){super(),this._profileType=e,this.title=t,this.uid=e.incrementProfileUid(),this._fromFile=!1,this.tempFile=null}setTitle(e){this.title=e,this.dispatchEventToListeners(be.ProfileTitleChanged,this)}profileType(){return this._profileType}updateStatus(e,t){this.dispatchEventToListeners(be.UpdateStatus,new Ce(e,t))}createSidebarTreeElement(e){throw new Error("Not implemented.")}createView(e){throw new Error("Not implemented.")}removeTempFile(){this.tempFile&&this.tempFile.remove()}dispose(){}canSaveToFile(){return!1}saveToFile(){throw new Error("Not implemented")}loadFromFile(e){throw new Error("Not implemented")}fromFile(){return this._fromFile}setFromFile(){this._fromFile=!0}setProfile(e){}}class Ce{constructor(e,t){this.subtitle=e,this.wait=t}}const be={UpdateStatus:Symbol("UpdateStatus"),ProfileReceived:Symbol("ProfileReceived"),ProfileTitleChanged:Symbol("ProfileTitleChanged")};class Pe extends n.ObjectWrapper{constructor(e,t){super(),this._id=e,this._name=t,this._profiles=[],this._profileBeingRecorded=null,this._nextProfileUid=1,window.opener||window.addEventListener("unload",this._clearTempStorage.bind(this),!1)}typeName(){return""}nextProfileUid(){return this._nextProfileUid}incrementProfileUid(){return this._nextProfileUid++}hasTemporaryView(){return!1}fileExtension(){return null}get buttonTooltip(){return""}get id(){return this._id}get treeItemTitle(){return this._name}get name(){return this._name}buttonClicked(){return!1}get description(){return""}isInstantProfile(){return!1}isEnabled(){return!0}getProfiles(){return this._profiles.filter(function(e){return this._profileBeingRecorded!==e}.bind(this))}customContent(){return null}setCustomContentEnabled(e){}getProfile(e){for(let t=0;t<this._profiles.length;++t)if(this._profiles[t].uid===e)return this._profiles[t];return null}loadFromFile(e){let t=e.name;const i=this.fileExtension();i&&t.endsWith(i)&&(t=t.substr(0,t.length-i.length));const s=this.createProfileLoadedFromFile(t);return s.setFromFile(),this.setProfileBeingRecorded(s),this.addProfile(s),s.loadFromFile(e)}createProfileLoadedFromFile(e){throw new Error("Needs implemented.")}addProfile(e){this._profiles.push(e),this.dispatchEventToListeners(Te.AddProfileHeader,e)}removeProfile(e){const t=this._profiles.indexOf(e);-1!==t&&(this._profiles.splice(t,1),this._disposeProfile(e))}_clearTempStorage(){for(let e=0;e<this._profiles.length;++e)this._profiles[e].removeTempFile()}profileBeingRecorded(){return this._profileBeingRecorded}setProfileBeingRecorded(e){this._profileBeingRecorded=e}profileBeingRecordedRemoved(){}reset(){for(const e of this._profiles.slice())this._disposeProfile(e);this._profiles=[],this._nextProfileUid=1}_disposeProfile(e){this.dispatchEventToListeners(Te.RemoveProfileHeader,e),e.dispose(),this._profileBeingRecorded===e&&(this.profileBeingRecordedRemoved(),this.setProfileBeingRecorded(null))}}const Te={AddProfileHeader:Symbol("add-profile-header"),ProfileComplete:Symbol("profile-complete"),RemoveProfileHeader:Symbol("remove-profile-header"),ViewUpdated:Symbol("view-updated")};var ye=Object.freeze({__proto__:null,ProfileHeader:we,StatusUpdate:Ce,Events:be,ProfileType:Pe,ProfileEvents:Te,DataDisplayDelegate:class{showProfile(e){throw new Error("not implemented")}showObject(e,t){}async linkifyObject(e){throw new Error("not implemented")}}});let xe=null;function Ie(){return xe}function Re(e){xe=e}class Ee extends S.TreeElement{constructor(e,t,i){super("",!1),this._iconElement=document.createElement("div"),this._iconElement.classList.add("icon"),this._titlesElement=document.createElement("div"),this._titlesElement.classList.add("titles"),this._titlesElement.classList.add("no-subtitle"),this._titleContainer=this._titlesElement.createChild("span","title-container"),this.titleElement=this._titleContainer.createChild("span","title"),this._subtitleElement=this._titlesElement.createChild("span","subtitle"),this.titleElement.textContent=t.title,this._className=i,this._small=!1,this._dataDisplayDelegate=e,this.profile=t,t.addEventListener(be.UpdateStatus,this._updateStatus,this),t.canSaveToFile()?this._createSaveLink():t.addEventListener(be.ProfileReceived,this._onProfileReceived,this)}_createSaveLink(){this._saveLinkElement=this._titleContainer.createChild("span","save-link"),this._saveLinkElement.textContent=r.UIString("Save"),this._saveLinkElement.addEventListener("click",this._saveProfile.bind(this),!1)}_onProfileReceived(e){this._createSaveLink()}_updateStatus(e){const t=e.data;null!==t.subtitle&&(this._subtitleElement.textContent=t.subtitle||"",this._titlesElement.classList.toggle("no-subtitle",!t.subtitle)),"boolean"==typeof t.wait&&this.listItemElement&&(this._iconElement.classList.toggle("spinner",t.wait),this.listItemElement.classList.toggle("wait",t.wait))}ondblclick(e){return this._editing||this._startEditing(e.target),!1}_startEditing(e){const t=e.enclosingNodeOrSelfWithClass("title");if(!t)return;const i=new w.Config(this._editingCommitted.bind(this),this._editingCancelled.bind(this));this._editing=w.InplaceEditor.startEditing(t,i)}_editingCommitted(e,t){delete this._editing,this.profile.setTitle(t)}_editingCancelled(){delete this._editing}dispose(){this.profile.removeEventListener(be.UpdateStatus,this._updateStatus,this),this.profile.removeEventListener(be.ProfileReceived,this._onProfileReceived,this)}onselect(){return this._dataDisplayDelegate.showProfile(this.profile),!0}ondelete(){return this.profile.profileType().removeProfile(this.profile),!0}onattach(){this._className&&this.listItemElement.classList.add(this._className),this._small&&this.listItemElement.classList.add("small"),this.listItemElement.append(this._iconElement,this._titlesElement),this.listItemElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!0),C.setDescription(this.listItemElement,ls`${this.profile.profileType().name}`)}_handleContextMenuEvent(e){const t=this.profile,i=new b.ContextMenu(e),s=Ie();if(!s)throw new Error("File selector element shared by ProfilePanel instances is missing");i.headerSection().appendItem(r.UIString("Load…"),s.click.bind(s)),t.canSaveToFile()&&i.saveSection().appendItem(r.UIString("Save…"),t.saveToFile.bind(t)),i.footerSection().appendItem(r.UIString("Delete"),this.ondelete.bind(this)),i.show()}_saveProfile(e){this.profile.saveToFile()}setSmall(e){this._small=e,this.listItemElement&&this.listItemElement.classList.toggle("small",this._small)}setMainTitle(e){this.titleElement.textContent=e}}var Ne=Object.freeze({__proto__:null,setSharedFileSelectorElement:Re,ProfileSidebarTreeElement:Ee});class De extends le{constructor(e,t){super(e,t,!(!e.children||!e.children.length)),this._remainingChildren=e.children}static _sharedPopulate(e){const t=e._remainingChildren,i=t.length;for(let s=0;s<i;++s)e.appendChild(new De(t[s],e.tree));e._remainingChildren=null}static _excludeRecursively(e,t){e._remainingChildren&&e.populate(),e.save();const i=e.children;let s=e.children.length;for(;s--;)De._excludeRecursively(i[s],t);const r=e.childrenByCallUID.get(t);r&&le.merge(e,r,!0)}populateChildren(){De._sharedPopulate(this)}}class Fe extends de{constructor(e,t,i,s){super(e,t,s),this._remainingChildren=i.children,le.populate(this)}focus(e){e&&(this.save(),e.savePosition(),this.children=[e],this.total=e.total)}exclude(e){e&&(this.save(),De._excludeRecursively(this,e.callUID),this.lastComparator&&this.sort(this.lastComparator,!0))}restore(){this._savedChildren&&(this.children[0].restorePosition(),super.restore())}populateChildren(){De._sharedPopulate(this)}}var Le=Object.freeze({__proto__:null,TopDownProfileDataGridNode:De,TopDownProfileDataGridTree:Fe});class ke extends P.SimpleView{constructor(){super(r.UIString("Profile")),this._profile=null,this._searchableView=new T.SearchableView(this),this._searchableView.setPlaceholder(r.UIString("Find by cost (>50ms), name or file")),this._searchableView.show(this.element);const e=[];e.push({id:"self",title:this.columnHeader("self"),width:"120px",fixedWidth:!0,sortable:!0,sort:u.Order.Descending}),e.push({id:"total",title:this.columnHeader("total"),width:"120px",fixedWidth:!0,sortable:!0}),e.push({id:"function",title:r.UIString("Function"),disclosure:!0,sortable:!0}),this.dataGrid=new u.DataGridImpl({displayName:ls`Profiler`,columns:e}),this.dataGrid.addEventListener(u.Events.SortingChanged,this._sortProfile,this),this.dataGrid.addEventListener(u.Events.SelectedNode,this._nodeSelected.bind(this,!0)),this.dataGrid.addEventListener(u.Events.DeselectedNode,this._nodeSelected.bind(this,!1)),this.dataGrid.setRowContextMenuCallback(this._populateContextMenu.bind(this)),this.viewSelectComboBox=new y.ToolbarComboBox(this._changeView.bind(this),ls`Profile view mode`),this.focusButton=new y.ToolbarButton(r.UIString("Focus selected function"),"largeicon-visibility"),this.focusButton.setEnabled(!1),this.focusButton.addEventListener(y.ToolbarButton.Events.Click,this._focusClicked,this),this.excludeButton=new y.ToolbarButton(r.UIString("Exclude selected function"),"largeicon-delete"),this.excludeButton.setEnabled(!1),this.excludeButton.addEventListener(y.ToolbarButton.Events.Click,this._excludeClicked,this),this.resetButton=new y.ToolbarButton(r.UIString("Restore all functions"),"largeicon-refresh"),this.resetButton.setEnabled(!1),this.resetButton.addEventListener(y.ToolbarButton.Events.Click,this._resetClicked,this),this._linkifier=new W.Linkifier(Me)}static buildPopoverTable(e){const t=createElement("table");for(const i of e){const e=t.createChild("tr");e.createChild("td").textContent=i.title,e.createChild("td").textContent=i.value}return t}setProfile(e){this._profile=e,this._bottomUpProfileDataGridTree=null,this._topDownProfileDataGridTree=null,this._changeView(),this.refresh()}profile(){return this._profile}initialize(e){this._nodeFormatter=e,this._viewType=a.Settings.instance().createSetting("profileView",Oe.Heavy);const t=[Oe.Flame,Oe.Heavy,Oe.Tree],i=new Map([[Oe.Flame,ls`Chart`],[Oe.Heavy,ls`Heavy (Bottom Up)`],[Oe.Tree,ls`Tree (Top Down)`]]),s=new Map(t.map(e=>[e,this.viewSelectComboBox.createOption(i.get(e),e)])),r=this._viewType.get()||t[0],o=s.get(r)||s.get(t[0]);this.viewSelectComboBox.select(o),this._changeView(),this._flameChart&&this._flameChart.update()}focus(){this._flameChart?this._flameChart.focus():super.focus()}columnHeader(e){throw"Not implemented"}selectRange(e,t){this._flameChart&&this._flameChart.selectRange(e,t)}async toolbarItems(){return[this.viewSelectComboBox,this.focusButton,this.excludeButton,this.resetButton]}_getBottomUpProfileDataGridTree(){return this._bottomUpProfileDataGridTree||(this._bottomUpProfileDataGridTree=new pe(this._nodeFormatter,this._searchableView,this._profile.root,this.adjustedTotal)),this._bottomUpProfileDataGridTree}_getTopDownProfileDataGridTree(){return this._topDownProfileDataGridTree||(this._topDownProfileDataGridTree=new Fe(this._nodeFormatter,this._searchableView,this._profile.root,this.adjustedTotal)),this._topDownProfileDataGridTree}_populateContextMenu(e,t){const i=t;i.linkElement&&!e.containsTarget(i.linkElement)&&e.appendApplicableItems(i.linkElement)}willHide(){this._currentSearchResultIndex=-1}refresh(){if(!this.profileDataGridTree)return;const e=this.dataGrid.selectedNode?this.dataGrid.selectedNode.profileNode:null;this.dataGrid.rootNode().removeChildren();const t=this.profileDataGridTree.children,i=t.length;for(let e=0;e<i;++e)this.dataGrid.rootNode().appendChild(t[e]);e&&(e.selected=!0)}refreshVisibleData(){let e=this.dataGrid.rootNode().children[0];for(;e;)e.refresh(),e=e.traverseNextNode(!1,null,!0)}searchableView(){return this._searchableView}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}searchCanceled(){this._searchableElement.searchCanceled()}performSearch(e,t,i){this._searchableElement.performSearch(e,t,i)}jumpToNextSearchResult(){this._searchableElement.jumpToNextSearchResult()}jumpToPreviousSearchResult(){this._searchableElement.jumpToPreviousSearchResult()}linkifier(){return this._linkifier}createFlameChartDataProvider(){throw"Not implemented"}_ensureFlameChartCreated(){this._flameChart||(this._dataProvider=this.createFlameChartDataProvider(),this._flameChart=new fe(this._searchableView,this._dataProvider),this._flameChart.addEventListener(z.Events.EntryInvoked,e=>{this._onEntryInvoked(e)}))}async _onEntryInvoked(e){const t=e.data,i=this._dataProvider._entryNodes[t],s=this._profileHeader._debuggerModel;if(!i||!i.scriptId||!s)return;const r=s.scriptForId(i.scriptId);if(!r)return;const o=s.createRawLocation(r,i.lineNumber,i.columnNumber),n=await ie.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(o);l.reveal(n)}_changeView(){if(!this._profile)return;switch(this._searchableView.closeSearch(),this._visibleView&&this._visibleView.detach(),this._viewType.set(this.viewSelectComboBox.selectedOption().value),this._viewType.get()){case Oe.Flame:this._ensureFlameChartCreated(),this._visibleView=this._flameChart,this._searchableElement=this._flameChart;break;case Oe.Tree:this.profileDataGridTree=this._getTopDownProfileDataGridTree(),this._sortProfile(),this._visibleView=this.dataGrid.asWidget(),this._searchableElement=this.profileDataGridTree;break;case Oe.Heavy:this.profileDataGridTree=this._getBottomUpProfileDataGridTree(),this._sortProfile(),this._visibleView=this.dataGrid.asWidget(),this._searchableElement=this.profileDataGridTree}const e=this._viewType.get()===Oe.Flame;this.focusButton.setVisible(!e),this.excludeButton.setVisible(!e),this.resetButton.setVisible(!e),this._visibleView.show(this._searchableView.element)}_nodeSelected(e){this.focusButton.setEnabled(e),this.excludeButton.setEnabled(e)}_focusClicked(e){this.dataGrid.selectedNode&&(this.resetButton.setEnabled(!0),this.resetButton.element.focus(),this.profileDataGridTree.focus(this.dataGrid.selectedNode),this.refresh(),this.refreshVisibleData(),G.actionTaken(H.Action.CpuProfileNodeFocused))}_excludeClicked(e){const t=this.dataGrid.selectedNode;t&&(this.resetButton.setEnabled(!0),this.resetButton.element.focus(),t.deselect(),this.profileDataGridTree.exclude(t),this.refresh(),this.refreshVisibleData(),G.actionTaken(H.Action.CpuProfileNodeExcluded))}_resetClicked(e){this.viewSelectComboBox.selectElement().focus(),this.resetButton.setEnabled(!1),this.profileDataGridTree.restore(),this._linkifier.reset(),this.refresh(),this.refreshVisibleData()}_sortProfile(){const e=this.dataGrid.isSortOrderAscending(),t=this.dataGrid.sortColumnId(),i="function"===t?"functionName":t||"";this.profileDataGridTree.sort(de.propertyComparator(i,e)),this.refresh()}}const Me=30,Oe={Flame:"Flame",Tree:"Tree",Heavy:"Heavy"};class Ve extends we{constructor(e,t,i){super(t,i||r.UIString("Profile %d",t.nextProfileUid())),this._debuggerModel=e}_onChunkTransferred(e){this.updateStatus(r.UIString("Loading… %d%%",t.bytesToString(this._jsonifiedProfile.length)))}_onError(e){this.updateStatus(r.UIString("File '%s' read error: %s",e.fileName(),e.error().message))}async write(e){this._jsonifiedProfile+=e}close(){}dispose(){this.removeTempFile()}createSidebarTreeElement(e){return new Ee(e,this,"profile-sidebar-tree-item")}canSaveToFile(){return!this.fromFile()&&this._protocolProfile}async saveToFile(){const e=new se.FileOutputStream;if(!this._fileName){const e=i.toISO8601Compact(new Date),t=this.profileType().fileExtension();this._fileName=`${this.profileType().typeName()}-${e}${t}`}if(!await e.open(this._fileName)||!this.tempFile)return;const t=await this.tempFile.read();t&&await e.write(t),e.close()}async loadFromFile(e){this.updateStatus(r.UIString("Loading…"),!0);const t=new se.ChunkedFileReader(e,1e7,this._onChunkTransferred.bind(this));this._jsonifiedProfile="";if(!await t.read(this))return this._onError(t),new Error(r.UIString("Failed to read file"));this.updateStatus(r.UIString("Parsing…"),!0);let i=null;try{this._profile=JSON.parse(this._jsonifiedProfile),this.setProfile(this._profile),this.updateStatus(r.UIString("Loaded"),!1)}catch(e){i=e,this.profileType().removeProfile(this)}return this._jsonifiedProfile=null,this.profileType().profileBeingRecorded()===this&&this.profileType().setProfileBeingRecorded(null),i}setProtocolProfile(e){this.setProfile(e),this._protocolProfile=e,this.tempFile=new re.TempFile,this.tempFile.write([JSON.stringify(e)]),this.canSaveToFile()&&this.dispatchEventToListeners(be.ProfileReceived)}}var Be=Object.freeze({__proto__:null,ProfileView:ke,maxLinkLength:Me,ViewTypes:Oe,WritableProfileHeader:Ve});class Ge extends ke{constructor(e){super(),this._profileHeader=e,this.initialize(new je(this));const t=e.profileModel();this.adjustedTotal=t.profileHead.total,this.adjustedTotal-=t.idleNode?t.idleNode.total:0,this.setProfile(t)}wasShown(){super.wasShown(),U.Performance.instance().reset(),U.Performance.instance().appendCPUProfile(this._profileHeader.profileModel())}columnHeader(e){switch(e){case"self":return r.UIString("Self Time");case"total":return r.UIString("Total Time")}return""}createFlameChartDataProvider(){return new Ue(this._profileHeader.profileModel(),this._profileHeader._cpuProfilerModel)}}class He extends Pe{constructor(){super(He.TypeId,r.UIString("Record JavaScript CPU Profile")),this._recording=!1,$.TargetManager.instance().addModelListener(q.CPUProfilerModel,q.Events.ConsoleProfileFinished,this._consoleProfileFinished,this)}profileBeingRecorded(){return super.profileBeingRecorded()}typeName(){return"CPU"}fileExtension(){return".cpuprofile"}get buttonTooltip(){return this._recording?r.UIString("Stop CPU profiling"):r.UIString("Start CPU profiling")}buttonClicked(){return this._recording?(this._stopRecordingProfile(),!1):(this._startRecordingProfile(),!0)}get treeItemTitle(){return r.UIString("CPU PROFILES")}get description(){return r.UIString("CPU profiles show where the execution time is spent in your page's JavaScript functions.")}_consoleProfileFinished(e){const t=e.data,i=t.cpuProfile,s=new ze(t.cpuProfilerModel,this,t.title);s.setProtocolProfile(i),this.addProfile(s)}_startRecordingProfile(){const e=x.Context.instance().flavor(q.CPUProfilerModel);if(this.profileBeingRecorded()||!e)return;const t=new ze(e,this);this.setProfileBeingRecorded(t),$.TargetManager.instance().suspendAllTargets(),this.addProfile(t),t.updateStatus(r.UIString("Recording…")),this._recording=!0,e.startRecording(),G.actionTaken(H.Action.ProfilesCPUProfileTaken)}async _stopRecordingProfile(){this._recording=!1;const e=this.profileBeingRecorded();if(!e||!e._cpuProfilerModel)return;const t=await e._cpuProfilerModel.stopRecording(),i=this.profileBeingRecorded();if(i){if(!t)throw new Error("Expected profile to be non-null");i.setProtocolProfile(t),i.updateStatus(""),this.setProfileBeingRecorded(null)}await $.TargetManager.instance().resumeAllTargets(),this.dispatchEventToListeners(Te.ProfileComplete,i)}createProfileLoadedFromFile(e){return new ze(null,this,e)}profileBeingRecordedRemoved(){this._stopRecordingProfile()}}He.TypeId="CPU";class ze extends Ve{constructor(e,t,i){super(e&&e.debuggerModel(),t,i),this._cpuProfilerModel=e}createView(){return new Ge(this)}protocolProfile(){if(!this._protocolProfile)throw new Error("Expected _protocolProfile to be available");return this._protocolProfile}profileModel(){if(!this._profileModel)throw new Error("Expected _profileModel to be available");return this._profileModel}setProfile(e){const t=this._cpuProfilerModel&&this._cpuProfilerModel.target()||null;this._profileModel=new J.CPUProfileDataModel(e,t)}}class je{constructor(e){this._profileView=e}formatValue(e){return r.UIString("%.1f ms",e)}formatValueAccessibleText(e){return this.formatValue(e)}formatPercent(e,t){if(this._profileView){const i=this._profileView.profile();if(i&&t.profileNode!==i.idleNode)return r.UIString("%.2f %%",e)}return""}linkifyNode(e){const t=this._profileView._profileHeader._cpuProfilerModel,i=t?t.target():null,s={className:"profile-node-file",columnNumber:void 0,tabStop:void 0};return this._profileView.linkifier().maybeLinkifyConsoleCallFrame(i,e.profileNode.callFrame,s)}}class Ue extends me{constructor(e,t){super(),this._cpuProfile=e,this._cpuProfilerModel=t}_calculateTimelineData(){const e=[],t=[];let i=5;this._cpuProfile.forEachFrame((function(){t.push(e.length),e.push(null)}),(function(s,r,o,n,a){const l=t.pop();e[l]=new Ue.ChartEntry(s,n,o,a,r),i=Math.max(i,s)}));const s=new Array(e.length),r=new Uint16Array(e.length),o=new Float32Array(e.length),n=new Float32Array(e.length),a=new Float64Array(e.length);for(let t=0;t<e.length;++t){const i=e[t];i&&(s[t]=i.node,r[t]=i.depth,o[t]=i.duration,a[t]=i.startTime,n[t]=i.selfTime)}return this._maxStackDepth=i+1,this._timelineData=new z.TimelineData(r,o,a,null),this._entryNodes=s,this._entrySelfTimes=n,this._timelineData}prepareHighlightedEntryInfo(e){if(!this._entryNodes)return null;const t=this._timelineData,i=this._entryNodes[e];if(!i)return null;const s=[];function o(e,t){s.push({title:e,value:t})}function n(e){return 0===e?"0":e<1e3?r.UIString("%.1f ms",e):Number.secondsToString(e/1e3,!0)}const a=f.beautifyFunctionName(i.functionName);o(ls`Name`,a);const l=n(this._entrySelfTimes[e]),d=n(t.entryTotalTimes[e]);o(ls`Self time`,l),o(ls`Total time`,d);const h=new W.Linkifier,c=h.maybeLinkifyConsoleCallFrame(this._cpuProfilerModel&&this._cpuProfilerModel.target(),i.callFrame);return c&&o(ls`URL`,c.textContent||""),h.dispose(),o(ls`Aggregated self time`,Number.secondsToString(i.self/1e3,!0)),o(ls`Aggregated total time`,Number.secondsToString(i.total/1e3,!0)),i.deoptReason&&o(ls`Not optimized`,i.deoptReason),ke.buildPopoverTable(s)}}Ue.ChartEntry=class{constructor(e,t,i,s,r){this.depth=e,this.duration=t,this.startTime=i,this.selfTime=s,this.node=r}};var Ae=Object.freeze({__proto__:null,CPUProfileView:Ge,CPUProfileType:He,CPUProfileHeader:ze,NodeFormatter:je,CPUFlameChartDataProvider:Ue});class We extends v.VBox{constructor(){super(!1),this._items=new I.ListModel,this._list=new R.ListControl(this._items,this,R.ListMode.NonViewport),this._list.element.classList.add("javascript-vm-instances-list"),C.setAccessibleName(this._list.element,ls`JavaScript VM instances`),this.contentElement.appendChild(this._list.element),this._itemByIsolate=new Map,this._totalElement=document.createElement("div"),this._totalElement.classList.add("profile-memory-usage-item"),this._totalElement.classList.add("hbox"),this._totalValueDiv=this._totalElement.createChild("div","profile-memory-usage-item-size"),this._totalTrendDiv=this._totalElement.createChild("div","profile-memory-usage-item-trend"),this._totalElement.createChild("div").textContent=ls`Total JS heap size`;const e=Math.round(Q.MemoryTrendWindowMs/6e4);this._totalTrendDiv.title=ls`Total page JS heap size change trend over the last ${e} minutes.`,this._totalValueDiv.title=ls`Total page JS heap size across all VM instances.`,Q.IsolateManager.instance().observeIsolates(this),$.TargetManager.instance().addEventListener($.Events.NameChanged,this._targetChanged,this),$.TargetManager.instance().addEventListener($.Events.InspectedURLChanged,this._targetChanged,this)}wasShown(){Q.IsolateManager.instance().addEventListener(Q.Events.MemoryChanged,this._heapStatsChanged,this)}willHide(){Q.IsolateManager.instance().removeEventListener(Q.Events.MemoryChanged,this._heapStatsChanged,this)}isolateAdded(e){this._list.element.tabIndex=0;const t=new $e(e),i=t.model().target()===$.TargetManager.instance().mainTarget()?0:this._items.length;this._items.insert(i,t),this._itemByIsolate.set(e,t),(1===this._items.length||e.isMainThread())&&this._list.selectItem(t),this._update()}isolateChanged(e){const t=this._itemByIsolate.get(e);t&&t.updateTitle(),this._update()}isolateRemoved(e){const t=this._itemByIsolate.get(e);t&&this._items.remove(this._items.indexOf(t)),this._itemByIsolate.delete(e),0===this._items.length&&(this._list.element.tabIndex=-1),this._update()}_targetChanged(e){const t=e.data.model(K.RuntimeModel);if(!t)return;const i=Q.IsolateManager.instance().isolateByModel(t),s=i&&this._itemByIsolate.get(i);s&&s.updateTitle()}_heapStatsChanged(e){const t=e.data,i=this._itemByIsolate.get(t);i&&i.updateStats(),this._updateTotal()}_updateTotal(){let e=0,i=0;for(const t of Q.IsolateManager.instance().isolates())e+=t.usedHeapSize(),i+=t.usedHeapSizeGrowRate();this._totalValueDiv.textContent=t.bytesToString(e),We._formatTrendElement(i,this._totalTrendDiv)}static _formatTrendElement(e,i){const s=1e3*e;if(Math.abs(s)<1e3)return;const r=t.bytesToString(Math.abs(s));let o,n;s>0?(o=ls`\u2B06${r}/s`,i.classList.toggle("increasing",!0),n=ls`increasing by ${r} per second`):(o=ls`\u2B07${r}/s`,i.classList.toggle("increasing",!1),n=ls`decreasing by ${r} per second`),i.textContent=o,C.setAccessibleName(i,n)}totalMemoryElement(){return this._totalElement}createElementForItem(e){return e.element}heightForItem(e){return console.assert(!1,"should not be called"),0}updateSelectedItemARIA(e,t){return!1}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&i.classList.remove("selected"),s&&s.classList.add("selected");const r=t&&t.model();x.Context.instance().setFlavor(X.HeapProfilerModel,r&&r.heapProfilerModel()),x.Context.instance().setFlavor(q.CPUProfilerModel,r&&r.target().model(q.CPUProfilerModel))}_update(){this._updateTotal(),this._list.invalidateRange(0,this._items.length)}}class $e{constructor(e){this._isolate=e;const t=Math.round(Q.MemoryTrendWindowMs/6e4);this.element=document.createElement("div"),this.element.classList.add("profile-memory-usage-item"),this.element.classList.add("hbox"),C.markAsOption(this.element),this._heapDiv=this.element.createChild("div","profile-memory-usage-item-size"),this._heapDiv.title=ls`Heap size in use by live JS objects.`,this._trendDiv=this.element.createChild("div","profile-memory-usage-item-trend"),this._trendDiv.title=ls`Heap size change trend over the last ${t} minutes.`,this._nameDiv=this.element.createChild("div","profile-memory-usage-item-name"),this.updateTitle()}model(){return this._isolate.runtimeModel()}updateStats(){this._heapDiv.textContent=t.bytesToString(this._isolate.usedHeapSize()),We._formatTrendElement(this._isolate.usedHeapSizeGrowRate(),this._trendDiv)}updateTitle(){const e=new Map;for(const t of this._isolate.models()){const i=t.target(),s=$.TargetManager.instance().mainTarget()!==i?i.name():"",r=new d.ParsedURL(i.inspectedURL()),o=r.isValid?r.domain():"",n=i.decorateLabel(o&&s?`${o}: ${s}`:s||o||ls`(empty)`);e.set(n,(e.get(n)||0)+1)}this._nameDiv.removeChildren();const t=[];for(const[i,s]of e){const e=s>1?`${i} (${s})`:i;t.push(e);const r=this._nameDiv.createChild("div");r.textContent=e,r.title=e}}}var qe=Object.freeze({__proto__:null,IsolateSelector:We,ListItem:$e});class Je extends v.VBox{constructor(e){super(),this.registerRequiredCSS("profiler/profileLauncherView.css",{enableLegacyPatching:!0}),this._panel=e,this.element.classList.add("profile-launcher-view"),this._contentElement=this.element.createChild("div","profile-launcher-view-content vbox");const t=this._contentElement.createChild("div","vbox");this._selectedProfileTypeSetting=a.Settings.instance().createSetting("selectedProfileType","CPU"),this._profileTypeHeaderElement=t.createChild("h1"),this._profileTypeSelectorForm=t.createChild("form"),C.markAsRadioGroup(this._profileTypeSelectorForm);const i=this._contentElement.createChild("div","vbox profile-isolate-selector-block");i.createChild("h1").textContent=ls`Select JavaScript VM instance`;const s=new We;s.show(i.createChild("div","vbox profile-launcher-target-list")),i.appendChild(s.totalMemoryElement());const r=this._contentElement.createChild("div","hbox profile-launcher-buttons");this._controlButton=f.createTextButton("",this._controlButtonClicked.bind(this),"",!0),this._loadButton=f.createTextButton(ls`Load`,this._loadButtonClicked.bind(this),""),r.appendChild(this._controlButton),r.appendChild(this._loadButton),this._recordButtonEnabled=!0,this._typeIdToOptionElement=new Map}_loadButtonClicked(){this._panel.showLoadFromFileDialog()}_updateControls(){this._isEnabled&&this._recordButtonEnabled?this._controlButton.removeAttribute("disabled"):this._controlButton.setAttribute("disabled",""),this._controlButton.title=this._recordButtonEnabled?"":f.anotherProfilerActiveLabel(),this._isInstantProfile?(this._controlButton.classList.remove("running"),this._controlButton.classList.add("primary-button"),this._controlButton.textContent=r.UIString("Take snapshot")):this._isProfiling?(this._controlButton.classList.add("running"),this._controlButton.classList.remove("primary-button"),this._controlButton.textContent=r.UIString("Stop")):(this._controlButton.classList.remove("running"),this._controlButton.classList.add("primary-button"),this._controlButton.textContent=r.UIString("Start"));for(const e of this._typeIdToOptionElement.values())e.disabled=!!this._isProfiling}profileStarted(){this._isProfiling=!0,this._updateControls()}profileFinished(){this._isProfiling=!1,this._updateControls()}updateProfileType(e,t){this._isInstantProfile=e.isInstantProfile(),this._recordButtonEnabled=t,this._isEnabled=e.isEnabled(),this._updateControls()}addProfileType(e){const t=f.createRadioLabel("profile-type",e.name);this._profileTypeSelectorForm.appendChild(t);const i=t.radioElement;this._typeIdToOptionElement.set(e.id,i),i._profileType=e,i.style.hidden=!0,i.addEventListener("change",this._profileTypeChanged.bind(this,e),!1);this._profileTypeSelectorForm.createChild("p").textContent=e.description,C.setDescription(i,e.description);const s=e.customContent();s&&(this._profileTypeSelectorForm.createChild("p").appendChild(s),e.setCustomContentEnabled(!1));const r=this._typeIdToOptionElement.size>1?ls`Select profiling type`:e.name;this._profileTypeHeaderElement.textContent=r,C.setAccessibleName(this._profileTypeSelectorForm,r)}restoreSelectedProfileType(){let e=this._selectedProfileTypeSetting.get();this._typeIdToOptionElement.has(e)||(e=this._typeIdToOptionElement.keys().next().value,this._selectedProfileTypeSetting.set(e)),this._typeIdToOptionElement.get(e).checked=!0;const t=this._typeIdToOptionElement.get(e)._profileType;for(const[t,i]of this._typeIdToOptionElement){const s=t===e;i._profileType.setCustomContentEnabled(s)}this.dispatchEventToListeners(Qe.ProfileTypeSelected,t)}_controlButtonClicked(){this._panel.toggleRecord()}_profileTypeChanged(e){const t=this._selectedProfileTypeSetting.get();this._typeIdToOptionElement.get(t)._profileType.setCustomContentEnabled(!1),e.setCustomContentEnabled(!0),this.dispatchEventToListeners(Qe.ProfileTypeSelected,e),this._isInstantProfile=e.isInstantProfile(),this._isEnabled=e.isEnabled(),this._updateControls(),this._selectedProfileTypeSetting.set(e.id)}}const Qe={ProfileTypeSelected:Symbol("ProfileTypeSelected")};var Ke=Object.freeze({__proto__:null,ProfileLauncherView:Je,Events:Qe});class Xe extends v.VBox{constructor(){super(),this.element.id="heap-recording-view",this.element.classList.add("heap-tracking-overview"),this._overviewCalculator=new tt,this._overviewContainer=this.element.createChild("div","heap-overview-container"),this._overviewGrid=new j.OverviewGrid("heap-recording",this._overviewCalculator),this._overviewGrid.element.classList.add("fill"),this._overviewCanvas=this._overviewContainer.createChild("canvas","heap-recording-overview-canvas"),this._overviewContainer.appendChild(this._overviewGrid.element),this._overviewGrid.addEventListener(j.Events.WindowChanged,this._onWindowChanged,this),this._windowLeft=0,this._windowRight=1,this._overviewGrid.setWindow(this._windowLeft,this._windowRight),this._yScale=new Ze,this._xScale=new Ze,this._profileSamples=new et}start(){this._running=!0;const e=()=>{this.update(),this._running&&this.element.window().requestAnimationFrame(e)};e()}stop(){this._running=!1}setSamples(e){this._profileSamples=e,this._running||this.update()}_drawOverviewCanvas(e,i){if(!this._profileSamples)return;const s=this._profileSamples,r=s.sizes,o=s.max,n=s.timestamps,a=n[0],l=this._xScale.nextScale(e/s.totalTime);let d=0;function h(e,t){let i=0,s=0;for(let r=1;r<n.length;++r){const o=Math.floor((n[r]-a)*l);o!==s&&(i&&t(s,i),i=0,s=o),i+=e[r]}t(s,i)}h(r,(function(e,t){d=Math.max(d,t)}));const c=this._yScale.nextScale(d?i/(1.1*d):0);this._overviewCanvas.width=e*window.devicePixelRatio,this._overviewCanvas.height=i*window.devicePixelRatio,this._overviewCanvas.style.width=e+"px",this._overviewCanvas.style.height=i+"px";const p=this._overviewCanvas.getContext("2d");if(p.scale(window.devicePixelRatio,window.devicePixelRatio),this._running){p.beginPath(),p.lineWidth=2,p.strokeStyle="rgba(192, 192, 192, 0.6)";const e=(Date.now()-a)*l;p.moveTo(e,i-1),p.lineTo(e,0),p.stroke(),p.closePath()}let u,_;if(c){const t=(i-14)/c;_=Math.pow(1024,Math.floor(Math.log(t)/Math.log(1024))),_*=Math.pow(10,Math.floor(Math.log(t/_)/Math.LN10)),5*_<=t&&(_*=5),u=Math.round(i-_*c-.5)+.5,p.beginPath(),p.lineWidth=1,p.strokeStyle="rgba(0, 0, 0, 0.2)",p.moveTo(0,u),p.lineTo(e,u),p.stroke(),p.closePath()}function m(e,t){p.moveTo(e,i-1),p.lineTo(e,Math.round(i-t*c-1))}if(p.beginPath(),p.lineWidth=2,p.strokeStyle="rgba(192, 192, 192, 0.6)",h(o,m),p.stroke(),p.closePath(),p.beginPath(),p.lineWidth=2,p.strokeStyle="rgba(0, 0, 192, 0.8)",h(r,m),p.stroke(),p.closePath(),_){const e=t.bytesToString(_),i=4,s=0,r=u-.5,o=2*i+p.measureText(e).width;p.beginPath(),p.textBaseline="bottom",p.font="10px "+window.getComputedStyle(this.element,null).getPropertyValue("font-family"),p.fillStyle="rgba(255, 255, 255, 0.75)",p.fillRect(s,r-14,o,14),p.fillStyle="rgb(64, 64, 64)",p.fillText(e,s+i,r),p.fill(),p.closePath()}}onResize(){this._updateOverviewCanvas=!0,this._scheduleUpdate()}_onWindowChanged(){this._updateGridTimerId||(this._updateGridTimerId=setTimeout(this.updateGrid.bind(this),10))}_scheduleUpdate(){this._updateTimerId||(this._updateTimerId=setTimeout(this.update.bind(this),10))}_updateBoundaries(){this._windowLeft=this._overviewGrid.windowLeft(),this._windowRight=this._overviewGrid.windowRight(),this._windowWidth=this._windowRight-this._windowLeft}update(){this._updateTimerId=null,this.isShowing()&&(this._updateBoundaries(),this._overviewCalculator._updateBoundaries(this),this._overviewGrid.updateDividers(this._overviewCalculator),this._drawOverviewCanvas(this._overviewContainer.clientWidth,this._overviewContainer.clientHeight-20))}updateGrid(){this._updateGridTimerId=0,this._updateBoundaries();const e=this._profileSamples.ids;if(!e.length)return;const t=this._profileSamples.timestamps,i=this._profileSamples.sizes,s=t[0],r=this._profileSamples.totalTime,o=s+r*this._windowLeft,n=s+r*this._windowRight,a=t.lowerBound(o),l=t.upperBound(n);let d=0;for(let e=a;e<=l;++e)d+=i[e];const h=a>0?e[a-1]:0,c=l<e.length?e[l]:1/0;this.dispatchEventToListeners(Ye,{minId:h,maxId:c,size:d})}}const Ye=Symbol("IdsRangeChanged");class Ze{constructor(){this._lastUpdate=0,this._currentScale=0}nextScale(e){if(e=e||this._currentScale,this._currentScale){const i=Date.now(),s=i-this._lastUpdate;this._lastUpdate=i;const r=20,o=Math.pow(r,s/1e3),n=e/this._currentScale;this._currentScale*=t.clamp(n,1/o,o)}else this._currentScale=e;return this._currentScale}}class et{constructor(){this.sizes=[],this.ids=[],this.timestamps=[],this.max=[],this.totalTime=3e4}}class tt{_updateBoundaries(e){this._minimumBoundaries=0,this._maximumBoundaries=e._profileSamples.totalTime,this._xScaleFactor=e._overviewContainer.clientWidth/this._maximumBoundaries}computePosition(e){return(e-this._minimumBoundaries)*this._xScaleFactor}formatValue(e,t){return Number.secondsToString(e/1e3,!!t)}maximumBoundary(){return this._maximumBoundaries}minimumBoundary(){return this._minimumBoundaries}zeroTime(){return this._minimumBoundaries}boundarySpan(){return this._maximumBoundaries-this._minimumBoundaries}}var it=Object.freeze({__proto__:null,HeapTimelineOverview:Xe,IdsRangeChanged:Ye,SmoothScale:Ze,Samples:et,OverviewCalculator:tt});class st extends ke{constructor(e){super(),this._profileHeader=e,this._profileType=e.profileType(),this.initialize(new dt(this));const t=new lt(e._profile||e.protocolProfile());this.adjustedTotal=t.total,this.setProfile(t),this._selectedSizeText=new y.ToolbarText,Root.Runtime.experiments.isEnabled("samplingHeapProfilerTimeline")&&(this._timelineOverview=new Xe,this._timelineOverview.addEventListener(Ye,this._onIdsRangeChanged.bind(this)),this._timelineOverview.show(this.element,this.element.firstChild),this._timelineOverview.start(),this._profileType.addEventListener(ot.Events.StatsUpdate,this._onStatsUpdate,this),this._profileType.once(Te.ProfileComplete).then(()=>{this._profileType.removeEventListener(ot.Events.StatsUpdate,this._onStatsUpdate,this),this._timelineOverview.stop(),this._timelineOverview.updateGrid()}))}async toolbarItems(){return[...await super.toolbarItems(),this._selectedSizeText]}_onIdsRangeChanged(e){const i=e.data.minId,s=e.data.maxId;this._selectedSizeText.setText(ls`Selected size: ${t.bytesToString(e.data.size)}`),this._setSelectionRange(i,s)}_setSelectionRange(e,t){const i=new lt(this._profileHeader._profile||this._profileHeader.protocolProfile(),e,t);this.adjustedTotal=i.total,this.setProfile(i)}_onStatsUpdate(e){const t=e.data;this._totalTime||(this._timestamps=[],this._sizes=[],this._max=[],this._ordinals=[],this._totalTime=3e4,this._lastOrdinal=0),this._sizes.fill(0),this._sizes.push(0),this._timestamps.push(Date.now()),this._ordinals.push(this._lastOrdinal+1),this._lastOrdinal=t.samples.reduce((e,t)=>Math.max(e,t.ordinal),this._lastOrdinal);for(const e of t.samples){const t=this._ordinals.upperBound(e.ordinal)-1;this._sizes[t]+=e.size}this._max.push(this._sizes.peekLast()),this._timestamps.peekLast()-this._timestamps[0]>this._totalTime&&(this._totalTime*=2);const i={sizes:this._sizes,max:this._max,ids:this._ordinals,timestamps:this._timestamps,totalTime:this._totalTime};this._timelineOverview.setSamples(i)}columnHeader(e){switch(e){case"self":return r.UIString("Self Size (bytes)");case"total":return r.UIString("Total Size (bytes)")}return""}createFlameChartDataProvider(){return new ht(this.profile(),this._profileHeader.heapProfilerModel())}}class rt extends Pe{constructor(e,t){super(e,t),this._recording=!1}profileBeingRecorded(){return super.profileBeingRecorded()}typeName(){return"Heap"}fileExtension(){return".heapprofile"}get buttonTooltip(){return this._recording?ls`Stop heap profiling`:ls`Start heap profiling`}buttonClicked(){return this._recording?this._stopRecordingProfile():this._startRecordingProfile(),this._recording}_startRecordingProfile(){const e=x.Context.instance().flavor(X.HeapProfilerModel);if(this.profileBeingRecorded()||!e)return;const t=new nt(e,this);this.setProfileBeingRecorded(t),this.addProfile(t),t.updateStatus(ls`Recording…`);const i=g.Icon.create("smallicon-warning");i.title=ls`Heap profiler is recording`,E.InspectorView.instance().setPanelIcon("heap_profiler",i),this._recording=!0,this._startSampling()}async _stopRecordingProfile(){if(this._recording=!1,!this.profileBeingRecorded()||!this.profileBeingRecorded().heapProfilerModel())return;this.profileBeingRecorded().updateStatus(ls`Stopping…`);const e=await this._stopSampling(),t=this.profileBeingRecorded();t&&(console.assert(e),t.setProtocolProfile(e),t.updateStatus(""),this.setProfileBeingRecorded(null)),E.InspectorView.instance().setPanelIcon("heap_profiler",null),this.dispatchEventToListeners(Te.ProfileComplete,t)}createProfileLoadedFromFile(e){return new nt(null,this,e)}profileBeingRecordedRemoved(){this._stopRecordingProfile()}_startSampling(){throw"Not implemented"}_stopSampling(){throw"Not implemented"}}class ot extends rt{constructor(){super(ot.TypeId,ls`Allocation sampling`),ot.instance=this,this._updateTimer=null,this._updateIntervalMs=200}get treeItemTitle(){return ls`SAMPLING PROFILES`}get description(){return ls`Record memory allocations using sampling method.
              This profile type has minimal performance overhead and can be used for long running operations.
              It provides good approximation of allocations broken down by JavaScript execution stack.`}hasTemporaryView(){return Root.Runtime.experiments.isEnabled("samplingHeapProfilerTimeline")}_startSampling(){this.profileBeingRecorded().heapProfilerModel().startSampling(),Root.Runtime.experiments.isEnabled("samplingHeapProfilerTimeline")&&(this._updateTimer=setTimeout(this._updateStats.bind(this),this._updateIntervalMs))}_stopSampling(){return clearTimeout(this._updateTimer),this._updateTimer=null,this.dispatchEventToListeners(ot.Events.RecordingStopped),this.profileBeingRecorded().heapProfilerModel().stopSampling()}async _updateStats(){const e=await this.profileBeingRecorded().heapProfilerModel().getSamplingProfile();this._updateTimer&&(this.dispatchEventToListeners(ot.Events.StatsUpdate,e),this._updateTimer=setTimeout(this._updateStats.bind(this),this._updateIntervalMs))}}ot.TypeId="SamplingHeap",ot.Events={RecordingStopped:Symbol("RecordingStopped"),StatsUpdate:Symbol("StatsUpdate")};class nt extends Ve{constructor(e,t,i){super(e&&e.debuggerModel(),t,i||r.UIString("Profile %d",t.nextProfileUid())),this._heapProfilerModel=e,this._protocolProfile={head:{callFrame:{},children:[]}}}createView(){return new st(this)}protocolProfile(){return this._protocolProfile}heapProfilerModel(){return this._heapProfilerModel}}class at extends Y.ProfileNode{constructor(e){super(e.callFrame||{functionName:e.functionName,scriptId:e.scriptId,url:e.url,lineNumber:e.lineNumber-1,columnNumber:e.columnNumber-1}),this.self=e.selfSize}}class lt extends Y.ProfileTreeModel{constructor(e,t,i){super(),this.modules=e.modules||[];let s=null;if(t||i){s=new Map,t=t||0,i=i||1/0;for(const r of e.samples){if(r.ordinal<t||r.ordinal>i)continue;const e=s.get(r.nodeId)||0;s.set(r.nodeId,e+r.size)}}function r(e){return e.children=e.children.filter(r),!(!e.children.length&&!e.self)}this.initialize(function(e){const t=new at(e),i=[e],o=[t];for(;i.length;){const e=i.pop(),t=o.pop();t.children=e.children.map(e=>{const t=new at(e);return s&&(t.self=s.get(e.id)||0),t}),i.push(...e.children),o.push(...t.children)}return r(t),t}(e.head))}}class dt{constructor(e){this._profileView=e}formatValue(e){return Number.withThousandsSeparator(e)}formatValueAccessibleText(e){return ls`${e} bytes`}formatPercent(e,t){return r.UIString("%.2f %%",e)}linkifyNode(e){const t=this._profileView._profileHeader.heapProfilerModel(),i=t?t.target():null;return this._profileView.linkifier().maybeLinkifyConsoleCallFrame(i,e.profileNode.callFrame,{className:"profile-node-file"})}}class ht extends me{constructor(e,t){super(),this._profile=e,this._heapProfilerModel=t}minimumBoundary(){return 0}totalTime(){return this._profile.root.total}formatValue(e,t){return r.UIString("%s kB",Number.withThousandsSeparator(e/1e3))}_calculateTimelineData(){const e=function e(t){return t.children.reduce((t,i)=>t+e(i),1)}(this._profile.root),t=new Array(e),i=new Uint16Array(e),s=new Float32Array(e),r=new Float64Array(e);let o=0,n=0,a=0,l=0;return function e(d){const h=a;t[l]=d,i[l]=o,s[l]=d.total,r[l]=a,++l,++o,d.children.forEach(e),--o,n=Math.max(n,o),a=h+d.total}(this._profile.root),this._maxStackDepth=n+1,this._entryNodes=t,this._timelineData=new z.TimelineData(i,s,r,null),this._timelineData}prepareHighlightedEntryInfo(e){const i=this._entryNodes[e];if(!i)return null;const s=[];function r(e,t){s.push({title:e,value:t})}r(ls`Name`,f.beautifyFunctionName(i.functionName)),r(ls`Self size`,t.bytesToString(i.self)),r(ls`Total size`,t.bytesToString(i.total));const o=new W.Linkifier,n=o.maybeLinkifyConsoleCallFrame(this._heapProfilerModel?this._heapProfilerModel.target():null,i.callFrame);return n&&r(ls`URL`,n.textContent),o.dispose(),ke.buildPopoverTable(s)}}var ct=Object.freeze({__proto__:null,HeapProfileView:st,SamplingHeapProfileTypeBase:rt,SamplingHeapProfileType:ot,SamplingHeapProfileHeader:nt,SamplingHeapProfileNode:at,SamplingHeapProfileModel:lt,NodeFormatter:dt,HeapFlameChartDataProvider:ht});class pt extends u.DataGridNode{constructor(e,t){super(null,t),this._dataGrid=e,this._instanceCount=0,this._savedChildren=null,this._retrievedChildrenRanges=[],this._providerObject=null,this._reachableFromWindow=!1}static createComparator(e){return{fieldName1:e[0],ascending1:e[1],fieldName2:e[2],ascending2:e[3]}}heapSnapshotDataGrid(){return this._dataGrid}createProvider(){throw new Error("Not implemented.")}retainersDataSource(){return null}_provider(){return this._providerObject||(this._providerObject=this.createProvider()),this._providerObject}createCell(e){const t=super.createCell(e);return this._searchMatched&&t.classList.add("highlight"),t}collapse(){super.collapse(),this._dataGrid.updateVisibleNodes(!0)}expand(){super.expand(),this._dataGrid.updateVisibleNodes(!0)}dispose(){this._providerObject&&this._providerObject.dispose();for(let e=this.children[0];e;e=e.traverseNextNode(!0,this,!0))e.dispose&&e.dispose()}queryObjectContent(e,t){}tryQueryObjectContent(e,t){}populateContextMenu(e,t,i){}_toPercentString(e){return e.toFixed(0)+" %"}_toUIDistance(e){const t=oe.baseSystemDistance;return e>=0&&e<t?r.UIString("%d",e):r.UIString("−")}allChildren(){return this._dataGrid.allChildren(this)}removeChildByIndex(e){this._dataGrid.removeChildByIndex(this,e)}childForPosition(e){let t=0;for(let i=0;i<this._retrievedChildrenRanges.length;i++){const s=this._retrievedChildrenRanges[i];if(s.from<=e&&e<s.to){const i=t+e-s.from;return this.allChildren()[i]}t+=s.to-s.from+1}return null}_createValueCell(e){const t=N.html`<td class="numeric-column" />`;if(0!==this.dataGrid.snapshot.totalSize){const i=createElement("div"),s=N.html`<span>${this.data[e]}</span>`;i.appendChild(s);const r=e+"-percent";if(r in this.data){const o=N.html`<span class="percent-column">${this.data[r]}</span>`;i.appendChild(o),i.classList.add("profile-multiple-values"),C.markAsHidden(s),C.markAsHidden(o),this.setCellAccessibleName(ls`${this.data[e]}, ${this.data[r]}`,t,e)}t.appendChild(i)}return t}populate(){this._populated||(this._populated=!0,this._provider().sortAndRewind(this.comparator()).then(()=>this._populateChildren()))}expandWithoutPopulate(){return this._populated=!0,this.expand(),this._provider().sortAndRewind(this.comparator())}_populateChildren(e,t){let i;const s=new Promise(e=>{i=e});e=e||0,t=t||e+this._dataGrid.defaultPopulateCount();let r=e;return o.call(this),s;function o(){if(r>=t)return;const e=Math.min(r+this._dataGrid.defaultPopulateCount(),t);this._provider().serializeItemsRange(r,e).then(l.bind(this)),r=e}function n(e,t){if(this._savedChildren){const i=this._childHashForEntity(e);if(i in this._savedChildren)return void this._dataGrid.insertChild(this,this._savedChildren[i],t)}this._dataGrid.insertChild(this,this._createChildNode(e),t)}function a(e,t,i){const s=new _.ShowMoreDataGridNode(this._populateChildren.bind(this),e,t,this._dataGrid.defaultPopulateCount());this._dataGrid.insertChild(this,s,i)}function l(e){let s=0,l=e.startPosition;const d=e.items;let h=0;if(this._retrievedChildrenRanges.length){let t,i=0,r=!1;for(;i<this._retrievedChildrenRanges.length;){if(t=this._retrievedChildrenRanges[i],t.to>=l){r=!0;break}h+=t.to-t.from,t.to<e.totalLength&&(h+=1),++i}for(!r||e.startPosition<t.from?(this.allChildren()[h-1].setEndPosition(e.startPosition),a.call(this,e.startPosition,r?t.from:e.totalLength,h),t={from:e.startPosition,to:e.startPosition},r||(i=this._retrievedChildrenRanges.length),this._retrievedChildrenRanges.splice(i,0,t)):h+=l-t.from;t.to<e.endPosition;){const r=t.to-l;h+=r,s+=r,l=t.to;const o=this._retrievedChildrenRanges[i+1];let a=o?o.from:e.totalLength;for(a>e.endPosition&&(a=e.endPosition);l<a;)n.call(this,d[s++],h++),++l;o&&a===o.from?(t.to=o.to,this.removeChildByIndex(h),this._retrievedChildrenRanges.splice(i+1,1)):(t.to=a,a===e.totalLength?this.removeChildByIndex(h):this.allChildren()[h].setStartPosition(e.endPosition))}}else{e.startPosition>0&&(this._retrievedChildrenRanges.push({from:0,to:0}),a.call(this,0,e.startPosition,h++)),this._retrievedChildrenRanges.push({from:e.startPosition,to:e.endPosition});for(let e=0,t=d.length;e<t;++e)n.call(this,d[e],h++);e.endPosition<e.totalLength&&a.call(this,e.endPosition,e.totalLength,h++)}this._instanceCount+=d.length,r<t?o.call(this):(this.expanded&&this._dataGrid.updateVisibleNodes(!0),i(),this.dispatchEventToListeners(pt.Events.PopulateComplete))}}_saveChildren(){this._savedChildren=null;const e=this.allChildren();for(let t=0,i=e.length;t<i;++t){const i=e[t];i.expanded&&(this._savedChildren||(this._savedChildren={}),this._savedChildren[this._childHashForNode(i)]=i)}}async sort(){this._dataGrid.recursiveSortingEnter(),await this._provider().sortAndRewind(this.comparator()),this._saveChildren(),this._dataGrid.removeAllChildren(this),this._retrievedChildrenRanges=[];const e=this._instanceCount;this._instanceCount=0,await this._populateChildren(0,e);for(const e of this.allChildren())e.expanded&&e.sort();this._dataGrid.recursiveSortingLeave()}}pt.Events={PopulateComplete:Symbol("PopulateComplete")};class ut extends pt{constructor(e,t){if(super(e,!1),!t)return;this._name=t.name,this._type=t.type,this._distance=t.distance,this._shallowSize=t.selfSize,this._retainedSize=t.retainedSize,this.snapshotNodeId=t.id,this.snapshotNodeIndex=t.nodeIndex,"string"===this._type?this._reachableFromWindow=!0:"object"===this._type&&this._name.startsWith("Window")?(this._name=this.shortenWindowURL(this._name,!1),this._reachableFromWindow=!0):t.canBeQueried&&(this._reachableFromWindow=!0),t.detachedDOMTreeNode&&(this.detachedDOMTreeNode=!0);const i=e.snapshot,s=this._shallowSize/i.totalSize*100,r=this._retainedSize/i.totalSize*100;this.data={distance:this._toUIDistance(this._distance),shallowSize:Number.withThousandsSeparator(this._shallowSize),retainedSize:Number.withThousandsSeparator(this._retainedSize),"shallowSize-percent":this._toPercentString(s),"retainedSize-percent":this._toPercentString(r)}}retainersDataSource(){return{snapshot:this._dataGrid.snapshot,snapshotNodeIndex:this.snapshotNodeIndex}}createCell(e){const t="object"!==e?this._createValueCell(e):this._createObjectCell();return this._searchMatched&&t.classList.add("highlight"),t}_createObjectCell(){let e=this._name,t="object";switch(this._type){case"concatenated string":case"string":e=`"${e}"`,t="string";break;case"regexp":e=`/${e}/`,t="string";break;case"closure":e+="()",t="function";break;case"bigint":t="bigint";break;case"number":t="number";break;case"hidden":t="null";break;case"array":e=e?e+"[]":ls`(internal array)[]`}return this._createObjectCellWithValue(t,e)}_createObjectCellWithValue(e,t){const i=N.Fragment.build`
        <td class="object-column disclosure">
          <div class="source-code event-properties" style="overflow: visible" $="container">
            <span class="value object-value-${e}">${t}</span>
            <span class="object-value-id">@${this.snapshotNodeId}</span>
          </div>
        </td>`,s=i.$("container");this._prefixObjectCell(s),this._reachableFromWindow&&s.appendChild(N.html`<span class="heap-object-tag" title="${ls`User object reachable from window`}">🗖</span>`),this.detachedDOMTreeNode&&s.appendChild(N.html`<span class="heap-object-tag" title="${ls`Detached from DOM tree`}">✀</span>`),this._appendSourceLocation(s);const r=i.element();return this.depth&&r.style.setProperty("padding-left",this.depth*this.dataGrid.indentWidth+"px"),r.heapSnapshotNode=this,r}_prefixObjectCell(e){}async _appendSourceLocation(e){const t=N.html`<span class="heap-object-source-link" />`;e.appendChild(t);const i=await this._dataGrid.dataDisplayDelegate().linkifyObject(this.snapshotNodeIndex);i?(t.appendChild(i),this.linkElement=i):t.remove()}async queryObjectContent(e,t){return await this.tryQueryObjectContent(e,t)||e.runtimeModel().createRemoteObjectFromPrimitiveValue(ls`Preview is not available`)}async tryQueryObjectContent(e,t){return"string"===this._type?e.runtimeModel().createRemoteObjectFromPrimitiveValue(this._name):await e.objectForSnapshotObjectId(String(this.snapshotNodeId),t)}async updateHasChildren(){const e=await this._provider().isEmpty();this.setHasChildren(!e)}shortenWindowURL(e,t){const i=e.indexOf("/"),r=t?e.indexOf("@"):e.length;if(-1===i||-1===r)return e;const o=e.substring(i+1,r).trimLeft();let n=s.trimURL(o);return n.length>40&&(n=n.trimMiddle(40)),e.substr(0,i+2)+n+e.substr(r)}populateContextMenu(e,t,i){if(e.revealSection().appendItem(ls`Reveal in Summary view`,()=>{t.showObject(String(this.snapshotNodeId),ls`Summary`)}),this._referenceName)for(const i of this._referenceName.matchAll(/\((?<objectName>[^@)]*) @(?<snapshotNodeId>\d+)\)/g)){const{objectName:s,snapshotNodeId:r}=i.groups;e.revealSection().appendItem(ls`Reveal object '${s}' with id @${r} in Summary view`,()=>{t.showObject(r,ls`Summary`)})}i&&e.revealSection().appendItem(ls`Store as global variable`,async()=>{const e=await this.tryQueryObjectContent(i,"");e?await Z.ConsoleModel.instance().saveToTempVariable(x.Context.instance().flavor(K.ExecutionContext),e):h.Console.instance().error(ls`Preview is not available`)})}}class _t extends ut{constructor(e,t,i,s){super(e,i.node),this._referenceName=i.name,this._referenceType=i.type,this._edgeIndex=i.edgeIndex,this._snapshot=t,this._parentObjectNode=s,this._cycledWithAncestorGridNode=this._findAncestorWithSameSnapshotNodeId(),this._cycledWithAncestorGridNode||this.updateHasChildren();const r=this.data;r.count="",r.addedCount="",r.removedCount="",r.countDelta="",r.addedSize="",r.removedSize="",r.sizeDelta=""}retainersDataSource(){return{snapshot:this._snapshot,snapshotNodeIndex:this.snapshotNodeIndex}}createProvider(){return this._snapshot.createEdgesProvider(this.snapshotNodeIndex)}_findAncestorWithSameSnapshotNodeId(){let e=this._parentObjectNode;for(;e;){if(e.snapshotNodeId===this.snapshotNodeId)return e;e=e._parentObjectNode}return null}_createChildNode(e){return new _t(this._dataGrid,this._snapshot,e,this)}_childHashForEntity(e){return e.edgeIndex}_childHashForNode(e){return e._edgeIndex}comparator(){const e=this._dataGrid.isSortOrderAscending(),t={object:["!edgeName",e,"retainedSize",!1],count:["!edgeName",!0,"retainedSize",!1],shallowSize:["selfSize",e,"!edgeName",!0],retainedSize:["retainedSize",e,"!edgeName",!0],distance:["distance",e,"_name",!0]}[this._dataGrid.sortColumnId()]||["!edgeName",!0,"retainedSize",!1];return pt.createComparator(t)}_prefixObjectCell(e){let t=this._referenceName||"(empty)",i="name";switch(this._referenceType){case"context":i="object-value-number";break;case"internal":case"hidden":case"weak":i="object-value-null";break;case"element":t=`[${t}]`}this._cycledWithAncestorGridNode&&e.classList.add("cycled-ancessor-node"),e.prepend(N.html`<span class="property-name ${i}">${t}</span>
                        <span class="grayed">${this._edgeNodeSeparator()}</span>`)}_edgeNodeSeparator(){return"::"}}class mt extends _t{constructor(e,t,i,s){super(e,t,i,s)}createProvider(){return this._snapshot.createRetainingEdgesProvider(this.snapshotNodeIndex)}_createChildNode(e){return new mt(this._dataGrid,this._snapshot,e,this)}_edgeNodeSeparator(){return ls`in`}expand(){this._expandRetainersChain(20)}_expandRetainersChain(e){if(!this._populated)return this.once(pt.Events.PopulateComplete).then(()=>this._expandRetainersChain(e)),void this.populate();if(super.expand(),--e>0&&this.children.length>0){const t=this.children[0];if(t._distance>1)return void t._expandRetainersChain(e)}this._dataGrid.dispatchEventToListeners(yt.Events.ExpandRetainersComplete)}}class ft extends ut{constructor(e,t,i,s){super(e,i),this._baseSnapshotOrSnapshot=t,this._isDeletedNode=s,this.updateHasChildren();const r=this.data;r.count="",r.countDelta="",r.sizeDelta="",this._isDeletedNode?(r.addedCount="",r.addedSize="",r.removedCount="•",r.removedSize=Number.withThousandsSeparator(this._shallowSize)):(r.addedCount="•",r.addedSize=Number.withThousandsSeparator(this._shallowSize),r.removedCount="",r.removedSize="")}retainersDataSource(){return{snapshot:this._baseSnapshotOrSnapshot,snapshotNodeIndex:this.snapshotNodeIndex}}createProvider(){return this._baseSnapshotOrSnapshot.createEdgesProvider(this.snapshotNodeIndex)}_createChildNode(e){return new _t(this._dataGrid,this._baseSnapshotOrSnapshot,e,null)}_childHashForEntity(e){return e.edgeIndex}_childHashForNode(e){return e._edgeIndex}comparator(){const e=this._dataGrid.isSortOrderAscending(),t={object:["!edgeName",e,"retainedSize",!1],distance:["distance",e,"retainedSize",!1],count:["!edgeName",!0,"retainedSize",!1],addedSize:["selfSize",e,"!edgeName",!0],removedSize:["selfSize",e,"!edgeName",!0],shallowSize:["selfSize",e,"!edgeName",!0],retainedSize:["retainedSize",e,"!edgeName",!0]}[this._dataGrid.sortColumnId()]||["!edgeName",!0,"retainedSize",!1];return pt.createComparator(t)}}class gt extends pt{constructor(e,t,i,s){super(e,i.count>0),this._name=t,this._nodeFilter=s,this._distance=i.distance,this._count=i.count,this._shallowSize=i.self,this._retainedSize=i.maxRet;const r=e.snapshot,o=this._retainedSize/r.totalSize*100,n=this._shallowSize/r.totalSize*100;this.data={object:t,count:Number.withThousandsSeparator(this._count),distance:this._toUIDistance(this._distance),shallowSize:Number.withThousandsSeparator(this._shallowSize),retainedSize:Number.withThousandsSeparator(this._retainedSize),"shallowSize-percent":this._toPercentString(n),"retainedSize-percent":this._toPercentString(o)}}createProvider(){return this._dataGrid.snapshot.createNodesProviderForClass(this._name,this._nodeFilter)}async populateNodeBySnapshotObjectId(e){this._dataGrid.resetNameFilter(),await this.expandWithoutPopulate();const t=await this._provider().nodePosition(e);if(-1===t)return this.collapse(),[];await this._populateChildren(t,null);const i=this.childForPosition(t);return i?[this,i]:[]}filteredOut(e){return-1===this._name.toLowerCase().indexOf(e)}createCell(e){const t="object"===e?super.createCell(e):this._createValueCell(e);return"object"===e&&this._count>1&&t.appendChild(N.html`<span class="objects-count">×${this._count}</span>`),this._searchMatched&&t.classList.add("highlight"),t}_createChildNode(e){return new ft(this._dataGrid,this._dataGrid.snapshot,e,!1)}comparator(){const e=this._dataGrid.isSortOrderAscending(),t={object:["name",e,"id",!0],distance:["distance",e,"retainedSize",!1],shallowSize:["selfSize",e,"id",!0],retainedSize:["retainedSize",e,"id",!0]}[this._dataGrid.sortColumnId()];return pt.createComparator(t)}_childHashForEntity(e){return e.id}_childHashForNode(e){return e.snapshotNodeId}}class vt{constructor(e,t,i,s){this._addedNodesProvider=e,this._deletedNodesProvider=t,this._addedCount=i,this._removedCount=s}dispose(){this._addedNodesProvider.dispose(),this._deletedNodesProvider.dispose()}nodePosition(e){throw new Error("Unreachable")}isEmpty(){return Promise.resolve(!1)}async serializeItemsRange(e,t){let i,s;if(e<this._addedCount){i=await this._addedNodesProvider.serializeItemsRange(e,t);for(const e of i.items)e.isAddedNotRemoved=!0;if(i.endPosition>=t)return i.totalLength=this._addedCount+this._removedCount,i;s=i,i=await this._deletedNodesProvider.serializeItemsRange(0,t-i.endPosition)}else s=new oe.ItemsRange(0,0,0,[]),i=await this._deletedNodesProvider.serializeItemsRange(e-this._addedCount,t-this._addedCount);s.items.length||(s.startPosition=this._addedCount+i.startPosition);for(const e of i.items)e.isAddedNotRemoved=!1;return s.items.push(...i.items),s.endPosition=this._addedCount+i.endPosition,s.totalLength=this._addedCount+this._removedCount,s}async sortAndRewind(e){await this._addedNodesProvider.sortAndRewind(e),await this._deletedNodesProvider.sortAndRewind(e)}}class St extends pt{constructor(e,t,i){super(e,!0),this._name=t,this._addedCount=i.addedCount,this._removedCount=i.removedCount,this._countDelta=i.countDelta,this._addedSize=i.addedSize,this._removedSize=i.removedSize,this._sizeDelta=i.sizeDelta,this._deletedIndexes=i.deletedIndexes,this.data={object:t,addedCount:Number.withThousandsSeparator(this._addedCount),removedCount:Number.withThousandsSeparator(this._removedCount),countDelta:this._signForDelta(this._countDelta)+Number.withThousandsSeparator(Math.abs(this._countDelta)),addedSize:Number.withThousandsSeparator(this._addedSize),removedSize:Number.withThousandsSeparator(this._removedSize),sizeDelta:this._signForDelta(this._sizeDelta)+Number.withThousandsSeparator(Math.abs(this._sizeDelta))}}createProvider(){const e=this._dataGrid;return new vt(e.snapshot.createAddedNodesProvider(e.baseSnapshot.uid,this._name),e.baseSnapshot.createDeletedNodesProvider(this._deletedIndexes),this._addedCount,this._removedCount)}createCell(e){const t=super.createCell(e);return"object"!==e&&t.classList.add("numeric-column"),t}_createChildNode(e){return e.isAddedNotRemoved?new ft(this._dataGrid,this._dataGrid.snapshot,e,!1):new ft(this._dataGrid,this._dataGrid.baseSnapshot,e,!0)}_childHashForEntity(e){return e.id}_childHashForNode(e){return e.snapshotNodeId}comparator(){const e=this._dataGrid.isSortOrderAscending(),t={object:["name",e,"id",!0],addedCount:["name",!0,"id",!0],removedCount:["name",!0,"id",!0],countDelta:["name",!0,"id",!0],addedSize:["selfSize",e,"id",!0],removedSize:["selfSize",e,"id",!0],sizeDelta:["selfSize",e,"id",!0]}[this._dataGrid.sortColumnId()];return pt.createComparator(t)}filteredOut(e){return-1===this._name.toLowerCase().indexOf(e)}_signForDelta(e){return 0===e?"":e>0?"+":"−"}}class wt extends pt{constructor(e,t){super(e,t.hasChildren),this._populated=!1,this._allocationNode=t,this.data={liveCount:Number.withThousandsSeparator(t.liveCount),count:Number.withThousandsSeparator(t.count),liveSize:Number.withThousandsSeparator(t.liveSize),size:Number.withThousandsSeparator(t.size),name:t.name}}populate(){this._populated||this._doPopulate()}async _doPopulate(){this._populated=!0;const e=await this._dataGrid.snapshot.allocationNodeCallers(this._allocationNode.id),t=e.nodesWithSingleCaller;let i=this;const s=this._dataGrid;for(const e of t){const t=new wt(s,e);s.appendNode(i,t),i=t,i._populated=!0,this.expanded&&i.expand()}const r=e.branchingCallers;r.sort(this._dataGrid._createComparator());for(const e of r)s.appendNode(i,new wt(s,e));s.updateVisibleNodes(!0)}expand(){super.expand(),1===this.children.length&&this.children[0].expand()}createCell(e){if("name"!==e)return this._createValueCell(e);const t=super.createCell(e),i=this._allocationNode,s=this._dataGrid.heapProfilerModel();if(i.scriptId){const e=this._dataGrid._linkifier.linkifyScriptLocation(s?s.target():null,String(i.scriptId),i.scriptName,i.line-1,i.column-1,"profile-node-file");e.style.maxWidth="75%",t.insertBefore(e,t.firstChild)}return t}allocationNodeId(){return this._allocationNode.id}}var Ct=Object.freeze({__proto__:null,HeapSnapshotGridNode:pt,HeapSnapshotGenericObjectNode:ut,HeapSnapshotObjectNode:_t,HeapSnapshotRetainingObjectNode:mt,HeapSnapshotInstanceNode:ft,HeapSnapshotConstructorNode:gt,HeapSnapshotDiffNodesProvider:vt,HeapSnapshotDiffNode:St,AllocationGridNode:wt});class bt extends u.DataGridImpl{constructor(e,t,i){super(i),this._heapProfilerModel=e,this._dataDisplayDelegate=t;const s=[["distance",ls`Distance from window object`],["shallowSize",ls`Size of the object itself in bytes`],["retainedSize",ls`Size of the object plus the graph it retains in bytes`]];for(const e of s){const t=this.headerTableHeader(e[0]);t&&t.setAttribute("title",e[1])}this._recursiveSortingDepth=0,this._highlightedNode=null,this._populatedAndSorted=!1,this._nameFilter=null,this._nodeFilter=new oe.NodeFilter,this.addEventListener(bt.Events.SortingComplete,this._sortingComplete,this),this.addEventListener(u.Events.SortingChanged,this.sortingChanged,this),this.setRowContextMenuCallback(this._populateContextMenu.bind(this))}heapProfilerModel(){return this._heapProfilerModel}dataDisplayDelegate(){return this._dataDisplayDelegate}nodeFilter(){return this._nodeFilter}setNameFilter(e){this._nameFilter=e}defaultPopulateCount(){return 100}_disposeAllNodes(){const e=this.topLevelNodes();for(let t=0,i=e.length;t<i;++t)e[t].dispose()}wasShown(){this._nameFilter&&(this._nameFilter.addEventListener(y.ToolbarInput.Event.TextChanged,this._onNameFilterChanged,this),this.updateVisibleNodes(!0)),this._populatedAndSorted&&this.dispatchEventToListeners(bt.Events.ContentShown,this)}_sortingComplete(){this.removeEventListener(bt.Events.SortingComplete,this._sortingComplete,this),this._populatedAndSorted=!0,this.dispatchEventToListeners(bt.Events.ContentShown,this)}willHide(){this._nameFilter&&this._nameFilter.removeEventListener(y.ToolbarInput.Event.TextChanged,this._onNameFilterChanged,this),this._clearCurrentHighlight()}_populateContextMenu(e,t){t.populateContextMenu(e,this._dataDisplayDelegate,this.heapProfilerModel()),t.linkElement&&!e.containsTarget(t.linkElement)&&e.appendApplicableItems(t.linkElement)}resetSortingCache(){delete this._lastSortColumnId,delete this._lastSortAscending}topLevelNodes(){return this.rootNode().children}revealObjectByHeapSnapshotId(e){return Promise.resolve(null)}highlightNode(e){this._clearCurrentHighlight(),this._highlightedNode=e,f.runCSSAnimationOnce(this._highlightedNode.element(),"highlighted-row")}_clearCurrentHighlight(){this._highlightedNode&&(this._highlightedNode.element().classList.remove("highlighted-row"),this._highlightedNode=null)}resetNameFilter(){this._nameFilter.setValue("")}_onNameFilterChanged(){this.updateVisibleNodes(!0),this._deselectFilteredNodes()}_deselectFilteredNodes(){let e=this.selectedNode;for(;e;){if(this._isFilteredOut(e))return this.selectedNode.deselect(),void(this.selectedNode=null);e=e.parent}}sortingChanged(){const e=this.isSortOrderAscending(),t=this.sortColumnId();if(this._lastSortColumnId===t&&this._lastSortAscending===e)return;this._lastSortColumnId=t,this._lastSortAscending=e;const i=this._sortFields(t,e);this._performSorting((function(e,t){let s=e[i[0]],r=t[i[0]],o=s<r?-1:s>r?1:0;return i[1]||(o=-o),0!==o||(s=e[i[2]],r=t[i[2]],o=s<r?-1:s>r?1:0,i[3]||(o=-o)),o}))}_performSorting(e){this.recursiveSortingEnter();const t=this.allChildren(this.rootNode());this.rootNode().removeChildren(),t.sort(e);for(let e=0,i=t.length;e<i;++e){const i=t[e];this.appendChildAfterSorting(i),i.expanded&&i.sort()}this.recursiveSortingLeave()}appendChildAfterSorting(e){const t=e.revealed;this.rootNode().appendChild(e),e.revealed=t}recursiveSortingEnter(){++this._recursiveSortingDepth}recursiveSortingLeave(){this._recursiveSortingDepth&&(--this._recursiveSortingDepth||(this.updateVisibleNodes(!0),this.dispatchEventToListeners(bt.Events.SortingComplete)))}updateVisibleNodes(e){}allChildren(e){return e.children}insertChild(e,t,i){e.insertChild(t,i)}removeChildByIndex(e,t){e.removeChild(e.children[t])}removeAllChildren(e){e.removeChildren()}}bt.Events={ContentShown:Symbol("ContentShown"),SortingComplete:Symbol("SortingComplete")};class Pt extends bt{constructor(e,t,i){super(e,t,i),this.scrollContainer.addEventListener("scroll",this._onScroll.bind(this),!0),this._topPaddingHeight=0,this._bottomPaddingHeight=0}topLevelNodes(){return this.allChildren(this.rootNode())}appendChildAfterSorting(e){}updateVisibleNodes(e){const t=this.scrollContainer.scrollHeight;let i=this.scrollContainer.scrollTop,s=t-i-this.scrollContainer.offsetHeight;i=Math.max(0,i-40),s=Math.max(0,s-40);let r=t-i-s;if(!e&&i>=this._topPaddingHeight&&s>=this._bottomPaddingHeight)return;i-=500,r+=1e3;const o=this.selectedNode;this.rootNode().removeChildren(),this._topPaddingHeight=0,this._bottomPaddingHeight=0,this._addVisibleNodes(this.rootNode(),i,i+r),this.setVerticalPadding(this._topPaddingHeight,this._bottomPaddingHeight),o&&(o.parent?o.select(!0):this.selectedNode=o)}_addVisibleNodes(e,t,i){if(!e.expanded)return 0;const s=this.allChildren(e);let r=0,o=0;for(;o<s.length;++o){const e=s[o];if(this._isFilteredOut(e))continue;const i=r+this._nodeHeight(e);if(i>t)break;r=i}let n=r;for(;o<s.length&&n<i;++o){const r=s[o];if(this._isFilteredOut(r))continue;const a=r.hasChildren();r.removeChildren(),r.setHasChildren(a),e.appendChild(r),n+=r.nodeSelfHeight(),n+=this._addVisibleNodes(r,t-n,i-n)}let a=0;for(;o<s.length;++o){const e=s[o];this._isFilteredOut(e)||(a+=this._nodeHeight(e))}return this._topPaddingHeight+=r,this._bottomPaddingHeight+=a,n+a}_isFilteredOut(e){const t=this._nameFilter?this._nameFilter.value().toLowerCase():"";return!!(t&&e.filteredOut&&e.filteredOut(t))}_nodeHeight(e){let t=e.nodeSelfHeight();if(!e.expanded)return t;const i=this.allChildren(e);for(let e=0;e<i.length;e++)t+=this._nodeHeight(i[e]);return t}revealTreeNode(e){const t=this._calculateOffset(e),i=e.peekLast(),s=this.scrollContainer.scrollTop,r=s+this.scrollContainer.offsetHeight;if(t>=s&&t<r)return Promise.resolve(i);return this.scrollContainer.scrollTop=Math.max(0,t-40),new Promise(e=>{console.assert(!this._scrollToResolveCallback),this._scrollToResolveCallback=e.bind(null,i),this.scrollContainer.window().requestAnimationFrame(()=>{this._scrollToResolveCallback&&(this._scrollToResolveCallback(),this._scrollToResolveCallback=null)})})}_calculateOffset(e){let t=this.rootNode(),i=0;for(let s=0;s<e.length;++s){const r=e[s],o=this.allChildren(t);for(let e=0;e<o.length;++e){const t=o[e];if(r===t){i+=r.nodeSelfHeight();break}i+=this._nodeHeight(t)}t=r}return i-e.peekLast().nodeSelfHeight()}allChildren(e){return e._allChildren||(e._allChildren=[]),e._allChildren}appendNode(e,t){this.allChildren(e).push(t)}insertChild(e,t,i){this.allChildren(e).splice(i,0,t)}removeChildByIndex(e,t){this.allChildren(e).splice(t,1)}removeAllChildren(e){e._allChildren=[]}removeTopLevelNodes(){this._disposeAllNodes(),this.rootNode().removeChildren(),this.rootNode()._allChildren=[]}_isScrolledIntoView(e){const t=this.scrollContainer.scrollTop,i=t+this.scrollContainer.clientHeight,s=e.offsetTop;return s+e.offsetHeight<=i&&s>=t}onResize(){super.onResize(),this.updateVisibleNodes(!1)}_onScroll(e){this.updateVisibleNodes(!1),this._scrollToResolveCallback&&(this._scrollToResolveCallback(),this._scrollToResolveCallback=null)}}class Tt extends bt{constructor(e,t,i,s){super(e,t,{displayName:i,columns:s=s||[{id:"object",title:ls`Object`,disclosure:!0,sortable:!0},{id:"distance",title:ls`Distance`,width:"70px",sortable:!0,fixedWidth:!0},{id:"shallowSize",title:ls`Shallow Size`,width:"110px",sortable:!0,fixedWidth:!0},{id:"retainedSize",title:ls`Retained Size`,width:"110px",sortable:!0,fixedWidth:!0,sort:u.Order.Descending}]})}setDataSource(e,t){this.snapshot=e;const i={node:{nodeIndex:t||e.rootNodeIndex}};this.setRootNode(this._createRootNode(e,i)),this.rootNode().sort()}_createRootNode(e,t){return new _t(this,e,t,null)}sortingChanged(){const e=this.rootNode();e.hasChildren()&&e.sort()}}class yt extends Tt{constructor(e,t){const i=[{id:"object",title:ls`Object`,disclosure:!0,sortable:!0},{id:"distance",title:ls`Distance`,width:"70px",sortable:!0,fixedWidth:!0,sort:u.Order.Ascending},{id:"shallowSize",title:ls`Shallow Size`,width:"110px",sortable:!0,fixedWidth:!0},{id:"retainedSize",title:ls`Retained Size`,width:"110px",sortable:!0,fixedWidth:!0}];super(e,t,ls`Heap Snapshot Retainment`,i)}_createRootNode(e,t){return new mt(this,e,t,null)}_sortFields(e,t){return{object:["_name",t,"_count",!1],count:["_count",t,"_name",!0],shallowSize:["_shallowSize",t,"_name",!0],retainedSize:["_retainedSize",t,"_name",!0],distance:["_distance",t,"_name",!0]}[e]}reset(){this.rootNode().removeChildren(),this.resetSortingCache()}setDataSource(e,t){super.setDataSource(e,t),this.rootNode().expand()}}yt.Events={ExpandRetainersComplete:Symbol("ExpandRetainersComplete")};class xt extends Pt{constructor(e,t){const i=[{id:"object",title:ls`Constructor`,disclosure:!0,sortable:!0},{id:"distance",title:ls`Distance`,width:"70px",sortable:!0,fixedWidth:!0},{id:"shallowSize",title:ls`Shallow Size`,width:"110px",sortable:!0,fixedWidth:!0},{id:"retainedSize",title:ls`Retained Size`,width:"110px",sort:u.Order.Descending,sortable:!0,fixedWidth:!0}];super(e,t,{displayName:ls`Heap Snapshot Constructors`,columns:i}),this._profileIndex=-1,this._objectIdToSelect=null}_sortFields(e,t){return{object:["_name",t,"_retainedSize",!1],distance:["_distance",t,"_retainedSize",!1],shallowSize:["_shallowSize",t,"_name",!0],retainedSize:["_retainedSize",t,"_name",!0]}[e]}async revealObjectByHeapSnapshotId(e){if(!this.snapshot)return this._objectIdToSelect=e,null;const t=await this.snapshot.nodeClassName(parseInt(e,10));if(!t)return null;const i=this.topLevelNodes().find(e=>e._name===t);if(!i)return null;const s=await i.populateNodeBySnapshotObjectId(parseInt(e,10));return s.length?this.revealTreeNode(s):null}clear(){this._nextRequestedFilter=null,this._lastFilter=null,this.removeTopLevelNodes()}setDataSource(e){this.snapshot=e,-1===this._profileIndex&&this._populateChildren(),this._objectIdToSelect&&(this.revealObjectByHeapSnapshotId(this._objectIdToSelect),this._objectIdToSelect=null)}setSelectionRange(e,t){this._nodeFilter=new oe.NodeFilter(e,t),this._populateChildren(this._nodeFilter)}setAllocationNodeId(e){this._nodeFilter=new oe.NodeFilter,this._nodeFilter.allocationNodeId=e,this._populateChildren(this._nodeFilter)}_aggregatesReceived(e,t){this._filterInProgress=null,this._nextRequestedFilter&&(this.snapshot.aggregatesWithFilter(this._nextRequestedFilter).then(this._aggregatesReceived.bind(this,this._nextRequestedFilter)),this._filterInProgress=this._nextRequestedFilter,this._nextRequestedFilter=null),this.removeTopLevelNodes(),this.resetSortingCache();for(const i in t)this.appendNode(this.rootNode(),new gt(this,i,t[i],e));this.sortingChanged(),this._lastFilter=e}async _populateChildren(e){const t=e||new oe.NodeFilter;if(this._filterInProgress)return void(this._nextRequestedFilter=this._filterInProgress.equals(t)?null:t);if(this._lastFilter&&this._lastFilter.equals(t))return;this._filterInProgress=t;const i=await this.snapshot.aggregatesWithFilter(t);this._aggregatesReceived(t,i)}filterSelectIndexChanged(e,t){if(this._profileIndex=t,this._nodeFilter=void 0,-1!==t){const i=t>0?e[t-1].maxJSObjectId:0,s=e[t].maxJSObjectId;this._nodeFilter=new oe.NodeFilter(i,s)}this._populateChildren(this._nodeFilter)}}class It extends Pt{constructor(e,t){const i=[{id:"object",title:ls`Constructor`,disclosure:!0,sortable:!0},{id:"addedCount",title:ls`# New`,width:"75px",sortable:!0,fixedWidth:!0},{id:"removedCount",title:ls`# Deleted`,width:"75px",sortable:!0,fixedWidth:!0},{id:"countDelta",title:ls`# Delta`,width:"65px",sortable:!0,fixedWidth:!0},{id:"addedSize",title:ls`Alloc. Size`,width:"75px",sortable:!0,fixedWidth:!0,sort:u.Order.Descending},{id:"removedSize",title:ls`Freed Size`,width:"75px",sortable:!0,fixedWidth:!0},{id:"sizeDelta",title:ls`Size Delta`,width:"75px",sortable:!0,fixedWidth:!0}];super(e,t,{displayName:ls`Heap Snapshot Diff`,columns:i})}defaultPopulateCount(){return 50}_sortFields(e,t){return{object:["_name",t,"_count",!1],addedCount:["_addedCount",t,"_name",!0],removedCount:["_removedCount",t,"_name",!0],countDelta:["_countDelta",t,"_name",!0],addedSize:["_addedSize",t,"_name",!0],removedSize:["_removedSize",t,"_name",!0],sizeDelta:["_sizeDelta",t,"_name",!0]}[e]}setDataSource(e){this.snapshot=e}setBaseDataSource(e){this.baseSnapshot=e,this.removeTopLevelNodes(),this.resetSortingCache(),this.baseSnapshot!==this.snapshot?this._populateChildren():this.dispatchEventToListeners(bt.Events.SortingComplete)}async _populateChildren(){const e=await this.baseSnapshot.aggregatesForDiff(),t=await this.snapshot.calculateSnapshotDiff(this.baseSnapshot.uid,e);for(const e in t){const i=t[e];this.appendNode(this.rootNode(),new St(this,e,i))}this.sortingChanged()}}class Rt extends Pt{constructor(e,t){const i=[{id:"liveCount",title:ls`Live Count`,width:"75px",sortable:!0,fixedWidth:!0},{id:"count",title:ls`Count`,width:"65px",sortable:!0,fixedWidth:!0},{id:"liveSize",title:ls`Live Size`,width:"75px",sortable:!0,fixedWidth:!0},{id:"size",title:ls`Size`,width:"75px",sortable:!0,fixedWidth:!0,sort:u.Order.Descending},{id:"name",title:ls`Function`,disclosure:!0,sortable:!0}];super(e,t,{displayName:ls`Allocation`,columns:i}),this._linkifier=new W.Linkifier}dispose(){this._linkifier.reset()}async setDataSource(e){this.snapshot=e,this._topNodes=await this.snapshot.allocationTracesTops(),this._populateChildren()}_populateChildren(){this.removeTopLevelNodes();const e=this.rootNode(),t=this._topNodes;for(const i of t)this.appendNode(e,new wt(this,i));this.updateVisibleNodes(!0)}sortingChanged(){this._topNodes.sort(this._createComparator()),this.rootNode().removeChildren(),this._populateChildren()}_createComparator(){const e=this.sortColumnId(),t=this.sortOrder()===u.Order.Ascending?1:-1;return function(i,s){return i[e]>s[e]?t:i[e]<s[e]?-t:0}}}var Et=Object.freeze({__proto__:null,HeapSnapshotSortableDataGrid:bt,HeapSnapshotViewportDataGrid:Pt,HeapSnapshotContainmentDataGrid:Tt,HeapSnapshotRetainmentDataGrid:yt,HeapSnapshotConstructorsDataGrid:xt,HeapSnapshotDiffDataGrid:It,AllocationDataGrid:Rt});class Nt extends n.ObjectWrapper{constructor(e){super(),this._eventHandler=e,this._nextObjectId=1,this._nextCallId=1,this._callbacks=new Map,this._previousCallbacks=new Set,this._worker=new c.WorkerWrapper("heap_snapshot_worker_entrypoint"),this._worker.onmessage=this._messageReceived.bind(this)}createLoader(e,t){const i=this._nextObjectId++,s=new Ft(this,i,e,t);return this._postMessage({callId:this._nextCallId++,disposition:"create",objectId:i,methodName:"HeapSnapshotWorker.HeapSnapshotLoader"}),s}dispose(){this._worker.terminate(),this._interval&&clearInterval(this._interval)}disposeObject(e){this._postMessage({callId:this._nextCallId++,disposition:"dispose",objectId:e})}evaluateForTest(e,t){const i=this._nextCallId++;this._callbacks.set(i,t),this._postMessage({callId:i,disposition:"evaluateForTest",source:e})}callFactoryMethod(e,t,i,s){const r=this._nextCallId++,o=Array.prototype.slice.call(arguments,4),n=this._nextObjectId++;return e?(this._callbacks.set(r,function(t){e(t?new s(this,n):null)}.bind(this)),this._postMessage({callId:r,disposition:"factory",objectId:t,methodName:i,methodArguments:o,newObjectId:n}),null):(this._postMessage({callId:r,disposition:"factory",objectId:t,methodName:i,methodArguments:o,newObjectId:n}),new s(this,n))}callMethod(e,t,i){const s=this._nextCallId++,r=Array.prototype.slice.call(arguments,3);e&&this._callbacks.set(s,e),this._postMessage({callId:s,disposition:"method",objectId:t,methodName:i,methodArguments:r})}startCheckingForLongRunningCalls(){this._interval||(this._checkLongRunningCalls(),this._interval=setInterval(this._checkLongRunningCalls.bind(this),300))}_checkLongRunningCalls(){for(const e of this._previousCallbacks)this._callbacks.has(e)||this._previousCallbacks.delete(e);const e=!!this._previousCallbacks.size;this.dispatchEventToListeners(Nt.Events.Wait,e);for(const e of this._callbacks.keys())this._previousCallbacks.add(e)}_messageReceived(e){const t=e.data;if(t.eventName)return void(this._eventHandler&&this._eventHandler(t.eventName,t.data));if(t.error)return t.errorMethodName&&h.Console.instance().error(r.UIString("An error occurred when a call to method '%s' was requested",t.errorMethodName)),h.Console.instance().error(t.errorCallStack),void this._callbacks.delete(t.callId);if(!this._callbacks.has(t.callId))return;const i=this._callbacks.get(t.callId);this._callbacks.delete(t.callId),i(t.result)}_postMessage(e){this._worker.postMessage(e)}}Nt.Events={Wait:Symbol("Wait")};class Dt{constructor(e,t){this._worker=e,this._objectId=t}_callWorker(e,t){return t.splice(1,0,this._objectId),this._worker[e].apply(this._worker,t)}dispose(){this._worker.disposeObject(this._objectId)}disposeWorker(){this._worker.dispose()}callFactoryMethod(e,t,i,s){return this._callWorker("callFactoryMethod",Array.prototype.slice.call(arguments,0))}_callMethodPromise(e,t){const i=Array.prototype.slice.call(arguments);return new Promise(e=>this._callWorker("callMethod",[e,...i]))}}class Ft extends Dt{constructor(e,t,i,s){super(e,t),this._profileUid=i,this._snapshotReceivedCallback=s}write(e){return this._callMethodPromise("write",e)}async close(){await this._callMethodPromise("close");const e=await new Promise(e=>this.callFactoryMethod(e,"buildSnapshot",Lt));this.dispose(),e.setProfileUid(this._profileUid),await e.updateStaticData(),this._snapshotReceivedCallback(e)}}class Lt extends Dt{constructor(e,t){super(e,t),this._staticData=null}search(e,t){return this._callMethodPromise("search",e,t)}aggregatesWithFilter(e){return this._callMethodPromise("aggregatesWithFilter",e)}aggregatesForDiff(){return this._callMethodPromise("aggregatesForDiff")}calculateSnapshotDiff(e,t){return this._callMethodPromise("calculateSnapshotDiff",e,t)}nodeClassName(e){return this._callMethodPromise("nodeClassName",e)}createEdgesProvider(e){return this.callFactoryMethod(null,"createEdgesProvider",kt,e)}createRetainingEdgesProvider(e){return this.callFactoryMethod(null,"createRetainingEdgesProvider",kt,e)}createAddedNodesProvider(e,t){return this.callFactoryMethod(null,"createAddedNodesProvider",kt,e,t)}createDeletedNodesProvider(e){return this.callFactoryMethod(null,"createDeletedNodesProvider",kt,e)}createNodesProvider(e){return this.callFactoryMethod(null,"createNodesProvider",kt,e)}createNodesProviderForClass(e,t){return this.callFactoryMethod(null,"createNodesProviderForClass",kt,e,t)}allocationTracesTops(){return this._callMethodPromise("allocationTracesTops")}allocationNodeCallers(e){return this._callMethodPromise("allocationNodeCallers",e)}allocationStack(e){return this._callMethodPromise("allocationStack",e)}dispose(){throw new Error("Should never be called")}get nodeCount(){return this._staticData.nodeCount}get rootNodeIndex(){return this._staticData.rootNodeIndex}async updateStaticData(){this._staticData=await this._callMethodPromise("updateStaticData")}getStatistics(){return this._callMethodPromise("getStatistics")}getLocation(e){return this._callMethodPromise("getLocation",e)}getSamples(){return this._callMethodPromise("getSamples")}get totalSize(){return this._staticData.totalSize}get uid(){return this._profileUid}setProfileUid(e){this._profileUid=e}maxJSObjectId(){return this._staticData.maxJSObjectId}}class kt extends Dt{constructor(e,t){super(e,t)}nodePosition(e){return this._callMethodPromise("nodePosition",e)}isEmpty(){return this._callMethodPromise("isEmpty")}serializeItemsRange(e,t){return this._callMethodPromise("serializeItemsRange",e,t)}sortAndRewind(e){return this._callMethodPromise("sortAndRewind",e)}}var Mt=Object.freeze({__proto__:null,HeapSnapshotWorkerProxy:Nt,HeapSnapshotProxyObject:Dt,HeapSnapshotLoaderProxy:Ft,HeapSnapshotProxy:Lt,HeapSnapshotProviderProxy:kt});class Ot extends P.SimpleView{constructor(e,t){super(r.UIString("Heap Snapshot")),this.element.classList.add("heap-snapshot-view"),this._profile=t,this._linkifier=new W.Linkifier;const i=t.profileType();i.addEventListener(Ut.SnapshotReceived,this._onReceiveSnapshot,this),i.addEventListener(Te.RemoveProfileHeader,this._onProfileHeaderRemoved,this);const s=i.id===At.TypeId;s&&this._createOverview(),this._parentDataDisplayDelegate=e,this._searchableView=new T.SearchableView(this),this._searchableView.setPlaceholder(ls`Find`,ls`Find`),this._searchableView.show(this.element),this._splitWidget=new D.SplitWidget(!1,!0,"heapSnapshotSplitViewState",200,200),this._splitWidget.show(this._searchableView.element);const o=t.heapProfilerModel();let n;if(this._containmentDataGrid=new Tt(o,this,ls`Containment`),this._containmentDataGrid.addEventListener(u.Events.SelectedNode,this._selectionChanged,this),this._containmentWidget=this._containmentDataGrid.asWidget(),this._containmentWidget.setMinimumSize(50,25),this._statisticsView=new $t,this._constructorsDataGrid=new xt(o,this),this._constructorsDataGrid.addEventListener(u.Events.SelectedNode,this._selectionChanged,this),this._constructorsWidget=this._constructorsDataGrid.asWidget(),this._constructorsWidget.setMinimumSize(50,25),this._diffDataGrid=new It(o,this),this._diffDataGrid.addEventListener(u.Events.SelectedNode,this._selectionChanged,this),this._diffWidget=this._diffDataGrid.asWidget(),this._diffWidget.setMinimumSize(50,25),s&&(this._allocationDataGrid=new Rt(o,this),this._allocationDataGrid.addEventListener(u.Events.SelectedNode,this._onSelectAllocationNode,this),this._allocationWidget=this._allocationDataGrid.asWidget(),this._allocationWidget.setMinimumSize(50,25),this._allocationStackView=new qt(o),this._allocationStackView.setMinimumSize(50,25),this._tabbedPane=new F.TabbedPane),this._retainmentDataGrid=new yt(o,this),this._retainmentWidget=this._retainmentDataGrid.asWidget(),this._retainmentWidget.setMinimumSize(50,21),this._retainmentWidget.element.classList.add("retaining-paths-view"),this._allocationStackView)this._tabbedPane=new F.TabbedPane,this._tabbedPane.appendTab("retainers",r.UIString("Retainers"),this._retainmentWidget),this._tabbedPane.appendTab("allocation-stack",r.UIString("Allocation stack"),this._allocationStackView),n=this._tabbedPane.headerElement(),this._objectDetailsView=this._tabbedPane;else{const e=document.createElement("div");e.classList.add("heap-snapshot-view-resizer");e.createChild("div","title").createChild("span").textContent=r.UIString("Retainers"),n=e,this._objectDetailsView=new v.VBox,this._objectDetailsView.element.appendChild(e),this._retainmentWidget.show(this._objectDetailsView.element)}this._splitWidget.hideDefaultResizer(),this._splitWidget.installResizer(n),this._retainmentDataGrid.addEventListener(u.Events.SelectedNode,this._inspectedObjectChanged,this),this._retainmentDataGrid.reset(),this._perspectives=[],this._comparisonPerspective=new Gt,this._perspectives.push(new Bt),t.profileType()!==Kt.trackingHeapSnapshotProfileType&&this._perspectives.push(this._comparisonPerspective),this._perspectives.push(new Ht),this._allocationWidget&&this._perspectives.push(new zt),this._perspectives.push(new jt),this._perspectiveSelect=new y.ToolbarComboBox(this._onSelectedPerspectiveChanged.bind(this),ls`Perspective`),this._updatePerspectiveOptions(),this._baseSelect=new y.ToolbarComboBox(this._changeBase.bind(this),ls`Base snapshot`),this._baseSelect.setVisible(!1),this._updateBaseOptions(),this._filterSelect=new y.ToolbarComboBox(this._changeFilter.bind(this),ls`Filter`),this._filterSelect.setVisible(!1),this._updateFilterOptions(),this._classNameFilter=new y.ToolbarInput(ls`Class filter`),this._classNameFilter.setVisible(!1),this._constructorsDataGrid.setNameFilter(this._classNameFilter),this._diffDataGrid.setNameFilter(this._classNameFilter),this._selectedSizeText=new y.ToolbarText,this._popoverHelper=new L.PopoverHelper(this.element,this._getPopoverRequest.bind(this)),this._popoverHelper.setDisableOnClick(!0),this._popoverHelper.setHasPadding(!0),this.element.addEventListener("scroll",this._popoverHelper.hidePopover.bind(this._popoverHelper),!0),this._currentPerspectiveIndex=0,this._currentPerspective=this._perspectives[0],this._currentPerspective.activate(this),this._dataGrid=this._currentPerspective.masterGrid(this),this._populate(),this._searchThrottler=new p.Throttler(0);for(const e of this._profiles())e.addEventListener(be.ProfileTitleChanged,this._updateControls,this)}_createOverview(){const e=this._profile.profileType();this._trackingOverviewGrid=new Xe,this._trackingOverviewGrid.addEventListener(Ye,this._onIdsRangeChanged.bind(this)),this._profile.fromFile()||e.profileBeingRecorded()!==this._profile||(e.addEventListener(At.HeapStatsUpdate,this._onHeapStatsUpdate,this),e.addEventListener(At.TrackingStopped,this._onStopTracking,this),this._trackingOverviewGrid.start())}_onStopTracking(){this._profile.profileType().removeEventListener(At.HeapStatsUpdate,this._onHeapStatsUpdate,this),this._profile.profileType().removeEventListener(At.TrackingStopped,this._onStopTracking,this),this._trackingOverviewGrid&&this._trackingOverviewGrid.stop()}_onHeapStatsUpdate(e){e.data&&this._trackingOverviewGrid.setSamples(e.data)}searchableView(){return this._searchableView}showProfile(e){return this._parentDataDisplayDelegate.showProfile(e)}showObject(e,t){e<=this._profile.maxJSObjectId?this.selectLiveObject(t,e):this._parentDataDisplayDelegate.showObject(e,t)}async linkifyObject(e){const t=this._profile.heapProfilerModel();if(!t)return null;const i=await this._profile.getLocation(e);if(!i)return null;const s=t.runtimeModel().debuggerModel().createRawLocationByScriptId(String(i.scriptId),i.lineNumber,i.columnNumber);if(!s)return null;const r=s.script()&&s.script().sourceURL;return r&&this._linkifier?this._linkifier.linkifyRawLocation(s,r):null}async _populate(){const e=await this._profile._loadPromise;if(this._retrieveStatistics(e),this._dataGrid.setDataSource(e),this._profile.profileType().id===At.TypeId&&this._profile.fromFile()){const t=await e.getSamples();if(t){console.assert(t.timestamps.length);const e=new et;e.sizes=t.sizes,e.ids=t.lastAssignedIds,e.timestamps=t.timestamps,e.max=t.sizes,e.totalTime=Math.max(t.timestamps.peekLast(),1e4),this._trackingOverviewGrid.setSamples(e)}}const t=this._profiles().indexOf(this._profile);this._baseSelect.setSelectedIndex(Math.max(0,t-1)),this._trackingOverviewGrid&&this._trackingOverviewGrid.updateGrid()}async _retrieveStatistics(e){const t=await e.getStatistics(),i=[{value:t.code,color:"#f77",title:ls`Code`},{value:t.strings,color:"#5e5",title:ls`Strings`},{value:t.jsArrays,color:"#7af",title:ls`JS arrays`},{value:t.native,color:"#fc5",title:ls`Typed arrays`},{value:t.system,color:"#98f",title:ls`System objects`}];return this._statisticsView.setTotalAndRecords(t.total,i),t}_onIdsRangeChanged(e){const i=e.data.minId,s=e.data.maxId;this._selectedSizeText.setText(r.UIString("Selected size: %s",t.bytesToString(e.data.size))),this._constructorsDataGrid.snapshot&&this._constructorsDataGrid.setSelectionRange(i,s)}async toolbarItems(){const e=[this._perspectiveSelect,this._classNameFilter];return this._profile.profileType()!==Kt.trackingHeapSnapshotProfileType&&e.push(this._baseSelect,this._filterSelect),e.push(this._selectedSizeText),e}willHide(){this._currentSearchResultIndex=-1,this._popoverHelper.hidePopover()}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}searchCanceled(){this._currentSearchResultIndex=-1,this._searchResults=[]}_selectRevealedNode(e){e&&e.select()}performSearch(e,t,i){const s=new oe.SearchConfig(e.query.trim(),e.caseSensitive,e.isRegex,t,i||!1);this._searchThrottler.schedule(this._performSearch.bind(this,s))}async _performSearch(e){if(this.searchCanceled(),!this._currentPerspective.supportsSearch())return;this.currentQuery=e;const t=e.query.trim();if(t)if("@"!==t.charAt(0))this._searchResults=await this._profile._snapshotProxy.search(this.currentQuery,this._dataGrid.nodeFilter()),this._searchableView.updateSearchMatchesCount(this._searchResults.length),this._searchResults.length&&(this._currentSearchResultIndex=e.jumpBackwards?this._searchResults.length-1:0),await this._jumpToSearchResult(this._currentSearchResultIndex);else{const e=parseInt(t.substring(1),10);if(isNaN(e))return;const i=await this._dataGrid.revealObjectByHeapSnapshotId(String(e));this._selectRevealedNode(i)}}jumpToNextSearchResult(){this._searchResults.length&&(this._currentSearchResultIndex=(this._currentSearchResultIndex+1)%this._searchResults.length,this._searchThrottler.schedule(this._jumpToSearchResult.bind(this,this._currentSearchResultIndex)))}jumpToPreviousSearchResult(){this._searchResults.length&&(this._currentSearchResultIndex=(this._currentSearchResultIndex+this._searchResults.length-1)%this._searchResults.length,this._searchThrottler.schedule(this._jumpToSearchResult.bind(this,this._currentSearchResultIndex)))}async _jumpToSearchResult(e){if(this._searchableView.updateCurrentMatchIndex(e),-1===e)return;const t=await this._dataGrid.revealObjectByHeapSnapshotId(String(this._searchResults[e]));this._selectRevealedNode(t)}refreshVisibleData(){if(!this._dataGrid)return;let e=this._dataGrid.rootNode().children[0];for(;e;)e.refresh(),e=e.traverseNextNode(!1,null,!0)}_changeBase(){if(this._baseProfile===this._profiles()[this._baseSelect.selectedIndex()])return;this._baseProfile=this._profiles()[this._baseSelect.selectedIndex()];const e=this._dataGrid;e.snapshot&&this._baseProfile._loadPromise.then(e.setBaseDataSource.bind(e)),this.currentQuery&&this._searchResults&&this.performSearch(this.currentQuery,!1)}_changeFilter(){const e=this._filterSelect.selectedIndex()-1;this._dataGrid.filterSelectIndexChanged(this._profiles(),e),this.currentQuery&&this._searchResults&&this.performSearch(this.currentQuery,!1)}_profiles(){return this._profile.profileType().getProfiles()}_selectionChanged(e){const t=e.data;this._setSelectedNodeForDetailsView(t),this._inspectedObjectChanged(e)}_onSelectAllocationNode(e){const t=e.data;this._constructorsDataGrid.setAllocationNodeId(t.allocationNodeId()),this._setSelectedNodeForDetailsView(null)}_inspectedObjectChanged(e){const t=e.data,i=this._profile.heapProfilerModel();i&&t instanceof ut&&i.addInspectedHeapObject(String(t.snapshotNodeId))}_setSelectedNodeForDetailsView(e){const t=e&&e.retainersDataSource();t?(this._retainmentDataGrid.setDataSource(t.snapshot,t.snapshotNodeIndex),this._allocationStackView&&this._allocationStackView.setAllocatedObject(t.snapshot,t.snapshotNodeIndex)):(this._allocationStackView&&this._allocationStackView.clear(),this._retainmentDataGrid.reset())}_changePerspectiveAndWait(e){const t=this._perspectives.findIndex(t=>t.title()===e);if(-1===t||this._currentPerspectiveIndex===t)return Promise.resolve();const i=this._perspectives[t].masterGrid(this).once(bt.Events.ContentShown),s=this._perspectiveSelect.options().find(e=>e.value===String(t));return this._perspectiveSelect.select(s),this._changePerspective(t),i}async _updateDataSourceAndView(){const e=this._dataGrid;if(!e||e.snapshot)return;const t=await this._profile._loadPromise;if(this._dataGrid!==e)return;if(e.snapshot!==t&&e.setDataSource(t),e!==this._diffDataGrid)return;this._baseProfile||(this._baseProfile=this._profiles()[this._baseSelect.selectedIndex()]);const i=await this._baseProfile._loadPromise;this._diffDataGrid.baseSnapshot!==i&&this._diffDataGrid.setBaseDataSource(i)}_onSelectedPerspectiveChanged(e){this._changePerspective(e.target.selectedOptions[0].value)}_changePerspective(e){if(e===this._currentPerspectiveIndex)return;this._currentPerspectiveIndex=e,this._currentPerspective.deactivate(this);const t=this._perspectives[e];this._currentPerspective=t,this._dataGrid=t.masterGrid(this),t.activate(this),this.refreshVisibleData(),this._dataGrid&&this._dataGrid.updateWidths(),this._updateDataSourceAndView(),this.currentQuery&&this._searchResults&&this.performSearch(this.currentQuery,!1)}async selectLiveObject(e,t){await this._changePerspectiveAndWait(e);const i=await this._dataGrid.revealObjectByHeapSnapshotId(t);i?i.select():h.Console.instance().error("Cannot find corresponding heap snapshot node")}_getPopoverRequest(e){const t=e.target.enclosingNodeOrSelfWithNodeName("span"),i=e.target.enclosingNodeOrSelfWithNodeName("tr"),s=this._profile.heapProfilerModel();if(!i||!t||!s)return null;const r=i._dataGridNode;let o;return{box:t.boxInWindow(),show:async e=>{const t=await r.queryObjectContent(s,"popover");return!!t&&(o=await ne.ObjectPopoverHelper.buildObjectPopover(t,e),!!o||(s.runtimeModel().releaseObjectGroup("popover"),!1))},hide:()=>{s.runtimeModel().releaseObjectGroup("popover"),o.dispose()}}}_updatePerspectiveOptions(){const e=this._profiles().length>1;this._perspectiveSelect.removeOptions(),this._perspectives.forEach((t,i)=>{(e||t!==this._comparisonPerspective)&&this._perspectiveSelect.createOption(t.title(),String(i))})}_updateBaseOptions(){const e=this._profiles(),t=this._baseSelect.selectedIndex();this._baseSelect.removeOptions();for(const t of e)this._baseSelect.createOption(t.title);t>-1&&this._baseSelect.setSelectedIndex(t)}_updateFilterOptions(){const e=this._profiles(),t=this._filterSelect.selectedIndex();this._filterSelect.removeOptions(),this._filterSelect.createOption(r.UIString("All objects"));for(let t=0;t<e.length;++t){let i;i=t?r.UIString("Objects allocated between %s and %s",e[t-1].title,e[t].title):r.UIString("Objects allocated before %s",e[t].title),this._filterSelect.createOption(i)}t>-1&&this._filterSelect.setSelectedIndex(t)}_updateControls(){this._updatePerspectiveOptions(),this._updateBaseOptions(),this._updateFilterOptions()}_onReceiveSnapshot(e){this._updateControls();e.data.addEventListener(be.ProfileTitleChanged,this._updateControls,this)}_onProfileHeaderRemoved(e){const t=e.data;t.removeEventListener(be.ProfileTitleChanged,this._updateControls,this),this._profile===t?(this.detach(),this._profile.profileType().removeEventListener(Ut.SnapshotReceived,this._onReceiveSnapshot,this),this._profile.profileType().removeEventListener(Te.RemoveProfileHeader,this._onProfileHeaderRemoved,this),this.dispose()):this._updateControls()}dispose(){this._linkifier.dispose(),this._popoverHelper.dispose(),this._allocationStackView&&(this._allocationStackView.clear(),this._allocationDataGrid.dispose()),this._onStopTracking(),this._trackingOverviewGrid&&this._trackingOverviewGrid.removeEventListener(Ye,this._onIdsRangeChanged.bind(this))}}class Vt{constructor(e){this._title=e}activate(e){}deactivate(e){e._baseSelect.setVisible(!1),e._filterSelect.setVisible(!1),e._classNameFilter.setVisible(!1),e._trackingOverviewGrid&&e._trackingOverviewGrid.detach(),e._allocationWidget&&e._allocationWidget.detach(),e._statisticsView&&e._statisticsView.detach(),e._splitWidget.detach(),e._splitWidget.detachChildWidgets()}masterGrid(e){return null}title(){return this._title}supportsSearch(){return!1}}class Bt extends Vt{constructor(){super(r.UIString("Summary"))}activate(e){e._splitWidget.setMainWidget(e._constructorsWidget),e._splitWidget.setSidebarWidget(e._objectDetailsView),e._splitWidget.show(e._searchableView.element),e._filterSelect.setVisible(!0),e._classNameFilter.setVisible(!0),e._trackingOverviewGrid&&(e._trackingOverviewGrid.show(e._searchableView.element,e._splitWidget.element),e._trackingOverviewGrid.update(),e._trackingOverviewGrid.updateGrid())}masterGrid(e){return e._constructorsDataGrid}supportsSearch(){return!0}}class Gt extends Vt{constructor(){super(r.UIString("Comparison"))}activate(e){e._splitWidget.setMainWidget(e._diffWidget),e._splitWidget.setSidebarWidget(e._objectDetailsView),e._splitWidget.show(e._searchableView.element),e._baseSelect.setVisible(!0),e._classNameFilter.setVisible(!0)}masterGrid(e){return e._diffDataGrid}supportsSearch(){return!0}}class Ht extends Vt{constructor(){super(r.UIString("Containment"))}activate(e){e._splitWidget.setMainWidget(e._containmentWidget),e._splitWidget.setSidebarWidget(e._objectDetailsView),e._splitWidget.show(e._searchableView.element)}masterGrid(e){return e._containmentDataGrid}}class zt extends Vt{constructor(){super(r.UIString("Allocation")),this._allocationSplitWidget=new D.SplitWidget(!1,!0,"heapSnapshotAllocationSplitViewState",200,200),this._allocationSplitWidget.setSidebarWidget(new v.VBox)}activate(e){this._allocationSplitWidget.setMainWidget(e._allocationWidget),e._splitWidget.setMainWidget(e._constructorsWidget),e._splitWidget.setSidebarWidget(e._objectDetailsView);const t=new v.VBox,i=document.createElement("div");i.classList.add("heap-snapshot-view-resizer");i.createChild("div","title").createChild("span").textContent=r.UIString("Live objects"),this._allocationSplitWidget.hideDefaultResizer(),this._allocationSplitWidget.installResizer(i),t.element.appendChild(i),e._splitWidget.show(t.element),this._allocationSplitWidget.setSidebarWidget(t),this._allocationSplitWidget.show(e._searchableView.element),e._constructorsDataGrid.clear();const s=e._allocationDataGrid.selectedNode;s&&e._constructorsDataGrid.setAllocationNodeId(s.allocationNodeId())}deactivate(e){this._allocationSplitWidget.detach(),super.deactivate(e)}masterGrid(e){return e._allocationDataGrid}}class jt extends Vt{constructor(){super(r.UIString("Statistics"))}activate(e){e._statisticsView.show(e._searchableView.element)}masterGrid(e){return null}}class Ut extends Pe{constructor(e,t){super(e||Ut.TypeId,t||ls`Heap snapshot`),$.TargetManager.instance().observeModels(X.HeapProfilerModel,this),$.TargetManager.instance().addModelListener(X.HeapProfilerModel,X.Events.ResetProfiles,this._resetProfiles,this),$.TargetManager.instance().addModelListener(X.HeapProfilerModel,X.Events.AddHeapSnapshotChunk,this._addHeapSnapshotChunk,this),$.TargetManager.instance().addModelListener(X.HeapProfilerModel,X.Events.ReportHeapSnapshotProgress,this._reportHeapSnapshotProgress,this),this._treatGlobalObjectsAsRoots=a.Settings.instance().createSetting("treatGlobalObjectsAsRoots",!0),this._customContent=null}modelAdded(e){e.enable()}modelRemoved(e){}getProfiles(){return super.getProfiles()}fileExtension(){return".heapsnapshot"}get buttonTooltip(){return r.UIString("Take heap snapshot")}isInstantProfile(){return!0}buttonClicked(){return this._takeHeapSnapshot(),G.actionTaken(H.Action.ProfilesHeapProfileTaken),!1}get treeItemTitle(){return r.UIString("HEAP SNAPSHOTS")}get description(){return r.UIString("Heap snapshot profiles show memory distribution among your page's JavaScript objects and related DOM nodes.")}customContent(){const e=k.createSettingCheckbox(ls`Treat global objects as roots (recommended, unchecking this exposes internal nodes and introduces excessive detail, but might help debugging cycles in retaining paths)`,this._treatGlobalObjectsAsRoots,!0);this._customContent=e;return Root.Runtime.experiments.isEnabled("showOptionToNotTreatGlobalObjectsAsRoots")?e:null}setCustomContentEnabled(e){this._customContent.checkboxElement.disabled=!e}createProfileLoadedFromFile(e){return new Wt(null,this,e)}async _takeHeapSnapshot(){if(this.profileBeingRecorded())return;const e=x.Context.instance().flavor(X.HeapProfilerModel);if(!e)return;let t=new Wt(e,this);this.setProfileBeingRecorded(t),this.addProfile(t),t.updateStatus(r.UIString("Snapshotting…")),await e.takeHeapSnapshot(!0,this._treatGlobalObjectsAsRoots.get()),t=this.profileBeingRecorded(),t.title=r.UIString("Snapshot %d",t.uid),t._finishLoad(),this.setProfileBeingRecorded(null),this.dispatchEventToListeners(Te.ProfileComplete,t)}_addHeapSnapshotChunk(e){if(!this.profileBeingRecorded())return;const t=e.data;this.profileBeingRecorded().transferChunk(t)}_reportHeapSnapshotProgress(e){const t=this.profileBeingRecorded();if(!t)return;const i=e.data;t.updateStatus(r.UIString("%.0f%%",i.done/i.total*100),!0),i.finished&&t._prepareToLoad()}_resetProfiles(e){const t=e.data;for(const e of this.getProfiles())e.heapProfilerModel()===t&&this.removeProfile(e)}_snapshotReceived(e){this.profileBeingRecorded()===e&&this.setProfileBeingRecorded(null),this.dispatchEventToListeners(Ut.SnapshotReceived,e)}}Ut.TypeId="HEAP",Ut.SnapshotReceived="SnapshotReceived";class At extends Ut{constructor(){super(At.TypeId,ls`Allocation instrumentation on timeline`),this._recordAllocationStacksSetting=a.Settings.instance().createSetting("recordAllocationStacks",!1),this._customContent=null}modelAdded(e){super.modelAdded(e),e.addEventListener(X.Events.HeapStatsUpdate,this._heapStatsUpdate,this),e.addEventListener(X.Events.LastSeenObjectId,this._lastSeenObjectId,this)}modelRemoved(e){super.modelRemoved(e),e.removeEventListener(X.Events.HeapStatsUpdate,this._heapStatsUpdate,this),e.removeEventListener(X.Events.LastSeenObjectId,this._lastSeenObjectId,this)}_heapStatsUpdate(e){if(!this._profileSamples)return;const t=e.data;let i;for(let e=0;e<t.length;e+=3){i=t[e];const s=t[e+2];this._profileSamples.sizes[i]=s,this._profileSamples.max[i]||(this._profileSamples.max[i]=s)}}_lastSeenObjectId(e){const t=this._profileSamples;if(!t)return;const i=e.data,s=Math.max(t.ids.length,t.max.length-1);t.ids[s]=i.lastSeenObjectId,t.max[s]||(t.max[s]=0,t.sizes[s]=0),t.timestamps[s]=i.timestamp,t.totalTime<i.timestamp-t.timestamps[0]&&(t.totalTime*=2),this.dispatchEventToListeners(At.HeapStatsUpdate,this._profileSamples),this.profileBeingRecorded().updateStatus(null,!0)}hasTemporaryView(){return!0}get buttonTooltip(){return this._recording?ls`Stop recording heap profile`:ls`Start recording heap profile`}isInstantProfile(){return!1}buttonClicked(){return this._toggleRecording()}_startRecordingProfile(){if(this.profileBeingRecorded())return;const e=this._addNewProfile();e&&e.startTrackingHeapObjects(this._recordAllocationStacksSetting.get())}customContent(){const e=k.createSettingCheckbox(ls`Record allocation stacks (extra performance overhead)`,this._recordAllocationStacksSetting,!0);return this._customContent=e,e}setCustomContentEnabled(e){this._customContent.checkboxElement.disabled=!e}_addNewProfile(){const e=x.Context.instance().flavor(X.HeapProfilerModel);return e?(this.setProfileBeingRecorded(new Wt(e,this,void 0)),this._profileSamples=new et,this.profileBeingRecorded()._profileSamples=this._profileSamples,this._recording=!0,this.addProfile(this.profileBeingRecorded()),this.profileBeingRecorded().updateStatus(r.UIString("Recording…")),this.dispatchEventToListeners(At.TrackingStarted),e):null}async _stopRecordingProfile(){this.profileBeingRecorded().updateStatus(r.UIString("Snapshotting…"));const e=this.profileBeingRecorded().heapProfilerModel().stopTrackingHeapObjects(!0);this._recording=!1,this.dispatchEventToListeners(At.TrackingStopped),await e;const t=this.profileBeingRecorded();t&&(t._finishLoad(),this._profileSamples=null,this.setProfileBeingRecorded(null),this.dispatchEventToListeners(Te.ProfileComplete,t))}_toggleRecording(){return this._recording?this._stopRecordingProfile():this._startRecordingProfile(),this._recording}fileExtension(){return".heaptimeline"}get treeItemTitle(){return ls`ALLOCATION TIMELINES`}get description(){return ls`
        Allocation timelines show instrumented JavaScript memory allocations over time.
        Once profile is recorded you can select a time interval to see objects that
        were allocated within it and still alive by the end of recording.
        Use this profile type to isolate memory leaks.`}_resetProfiles(e){const t=this._recording;this.setProfileBeingRecorded(null),super._resetProfiles(e),this._profileSamples=null,t&&this._addNewProfile()}profileBeingRecordedRemoved(){this._stopRecordingProfile(),this._profileSamples=null}}At.TypeId="HEAP-RECORD",At.HeapStatsUpdate="HeapStatsUpdate",At.TrackingStarted="TrackingStarted",At.TrackingStopped="TrackingStopped";class Wt extends we{constructor(e,t,i){super(t,i||r.UIString("Snapshot %d",t.nextProfileUid())),this._heapProfilerModel=e,this.maxJSObjectId=-1,this._workerProxy=null,this._receiver=null,this._snapshotProxy=null,this._loadPromise=new Promise(e=>{this._fulfillLoad=e}),this._totalNumberOfChunks=0,this._bufferedWriter=null}heapProfilerModel(){return this._heapProfilerModel}getLocation(e){return this._snapshotProxy.getLocation(e)}createSidebarTreeElement(e){return new Ee(e,this,"heap-snapshot-sidebar-tree-item")}createView(e){return new Ot(e,this)}_prepareToLoad(){console.assert(!this._receiver,"Already loading"),this._setupWorker(),this.updateStatus(r.UIString("Loading…"),!0)}_finishLoad(){this._wasDisposed||this._receiver.close(),this._bufferedWriter&&this._didWriteToTempFile(this._bufferedWriter)}_didWriteToTempFile(e){this._wasDisposed?e&&e.remove():(this.tempFile=e,e||(this._failedToCreateTempFile=!0),this._onTempFileReady&&(this._onTempFileReady(),this._onTempFileReady=null))}_setupWorker(){console.assert(!this._workerProxy,"HeapSnapshotWorkerProxy already exists"),this._workerProxy=new Nt(this._handleWorkerEvent.bind(this)),this._workerProxy.addEventListener(Nt.Events.Wait,(function(e){this.updateStatus(null,e.data)}),this),this._receiver=this._workerProxy.createLoader(this.uid,this._snapshotReceived.bind(this))}_handleWorkerEvent(e,t){if(oe.HeapSnapshotProgressEvent.BrokenSnapshot===e){const e=t;return void h.Console.instance().error(e)}if(oe.HeapSnapshotProgressEvent.Update!==e)return;const i=t,s=r.deserializeUIString(i);this.updateStatus(ls(s.messageParts,s.values))}dispose(){this._workerProxy&&this._workerProxy.dispose(),this.removeTempFile(),this._wasDisposed=!0}_didCompleteSnapshotTransfer(){this._snapshotProxy&&this.updateStatus(t.bytesToString(this._snapshotProxy.totalSize),!1)}transferChunk(e){this._bufferedWriter||(this._bufferedWriter=new re.TempFile),this._bufferedWriter.write([e]),++this._totalNumberOfChunks,this._receiver.write(e)}_snapshotReceived(e){this._wasDisposed||(this._receiver=null,this._snapshotProxy=e,this.maxJSObjectId=e.maxJSObjectId(),this._didCompleteSnapshotTransfer(),this._workerProxy.startCheckingForLongRunningCalls(),this.notifySnapshotReceived())}notifySnapshotReceived(){this._fulfillLoad(this._snapshotProxy),this.profileType()._snapshotReceived(this),this.canSaveToFile()&&this.dispatchEventToListeners(be.ProfileReceived)}canSaveToFile(){return!this.fromFile()&&!!this._snapshotProxy}saveToFile(){const e=new se.FileOutputStream;this._fileName=this._fileName||"Heap-"+i.toISO8601Compact(new Date)+this.profileType().fileExtension(),e.open(this._fileName).then(async function t(i){if(!i)return;if(this._failedToCreateTempFile)return h.Console.instance().error("Failed to open temp file with heap snapshot"),void e.close();if(this.tempFile){const t=await this.tempFile.copyToOutputStream(e,this._onChunkTransferred.bind(this));return t&&h.Console.instance().error("Failed to read heap snapshot from temp file: "+t.message),void this._didCompleteSnapshotTransfer()}this._onTempFileReady=t.bind(this,i),this._updateSaveProgress(0,1)}.bind(this))}_onChunkTransferred(e){this._updateSaveProgress(e.loadedSize(),e.fileSize())}_updateSaveProgress(e,t){const i=(100*(t&&e/t)).toFixed(0);this.updateStatus(r.UIString("Saving… %d%%",i))}async loadFromFile(e){this.updateStatus(r.UIString("Loading…"),!0),this._setupWorker();const t=new se.ChunkedFileReader(e,1e7),i=await t.read(this._receiver);return i||this.updateStatus(t.error().message),i?null:t.error()}}class $t extends v.VBox{constructor(){super(),this.element.classList.add("heap-snapshot-statistics-view"),this._pieChart=A.createPieChart(),this.setTotalAndRecords(0,[]),this._pieChart.classList.add("heap-snapshot-stats-pie-chart"),this.element.appendChild(this._pieChart)}static _valueFormatter(e){return r.UIString("%s kB",Number.withThousandsSeparator(Math.round(e/1e3)))}setTotalAndRecords(e,t){this._pieChart.data={chartName:ls`Heap memory usage`,size:150,formatter:$t._valueFormatter,showLegend:!0,total:e,slices:t}}}class qt extends v.Widget{constructor(e){super(),this._heapProfilerModel=e,this._linkifier=new W.Linkifier,this._frameElements=[]}_onContextMenu(e,t){const i=new b.ContextMenu(t);i.containsTarget(e)||i.appendApplicableItems(e),i.show(),t.consume(!0)}_onStackViewKeydown(e){const t=e.target;if(!t)return;if(isEnterKey(e)){const i=t._linkElement;if(!i)return;return void(W.Linkifier.invokeFirstAction(i)&&e.consume(!0))}let i;if("ArrowUp"===e.key)i=!1;else{if("ArrowDown"!==e.key)return;i=!0}const s=this._frameElements.indexOf(t);if(-1===s)return;const r=i?s+1:s-1;if(r<0||r>=this._frameElements.length)return;const o=this._frameElements[r];o.tabIndex=0,t.tabIndex=-1,o.focus(),e.consume(!0)}async setAllocatedObject(e,t){this.clear();const i=await e.allocationStack(t);if(!i){const e=this.element.createChild("div","no-heap-allocation-stack");return void f.createTextChild(e,r.UIString("Stack was not recorded for this object because it had been allocated before this profile recording started."))}const s=this.element.createChild("div","heap-allocation-stack");s.addEventListener("keydown",this._onStackViewKeydown.bind(this),!1);for(const e of i){const t=s.createChild("div","stack-frame");this._frameElements.push(t),t.tabIndex=-1;if(t.createChild("div").textContent=f.beautifyFunctionName(e.functionName),!e.scriptId)continue;const i=this._heapProfilerModel?this._heapProfilerModel.target():null,r={columnNumber:e.column-1},o=this._linkifier.linkifyScriptLocation(i,String(e.scriptId),e.scriptName,e.line-1,r);t.appendChild(o),t._linkElement=o,t.addEventListener("contextmenu",this._onContextMenu.bind(this,o))}this._frameElements[0].tabIndex=0}clear(){this.element.removeChildren(),this._frameElements=[],this._linkifier.reset()}}var Jt=Object.freeze({__proto__:null,HeapSnapshotView:Ot,Perspective:Vt,SummaryPerspective:Bt,ComparisonPerspective:Gt,ContainmentPerspective:Ht,AllocationPerspective:zt,StatisticsPerspective:jt,HeapSnapshotProfileType:Ut,TrackingHeapSnapshotProfileType:At,HeapProfileHeader:Wt,HeapSnapshotStatisticsView:$t,HeapAllocationStackView:qt});class Qt{constructor(){this.cpuProfileType=new He,this.heapSnapshotProfileType=new Ut,this.samplingHeapProfileType=new ot,this.trackingHeapSnapshotProfileType=new At}}const Kt=new Qt;var Xt=Object.freeze({__proto__:null,ProfileTypeRegistry:Qt,instance:Kt});class Yt extends M.PanelWithSidebar{constructor(e,t,i){super(e),this._profileTypes=t,this.registerRequiredCSS("profiler/heapProfiler.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("profiler/profilesPanel.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("object_ui/objectValue.css",{enableLegacyPatching:!0});const s=new v.VBox;this.splitWidget().setMainWidget(s),this.profilesItemTreeElement=new ii(this),this._sidebarTree=new S.TreeOutlineInShadow,this._sidebarTree.registerRequiredCSS("profiler/profilesSidebarTree.css",{enableLegacyPatching:!0}),this._sidebarTree.element.classList.add("profiles-sidebar-tree-box"),this.panelSidebarElement().appendChild(this._sidebarTree.element),this._sidebarTree.appendChild(this.profilesItemTreeElement),this._sidebarTree.element.addEventListener("keydown",this._onKeyDown.bind(this),!1),this.profileViews=createElement("div"),this.profileViews.id="profile-views",this.profileViews.classList.add("vbox"),s.element.appendChild(this.profileViews),this._toolbarElement=document.createElement("div"),this._toolbarElement.classList.add("profiles-toolbar"),s.element.insertBefore(this._toolbarElement,s.element.firstChild),this.panelSidebarElement().classList.add("profiles-tree-sidebar");const o=document.createElement("div");o.classList.add("profiles-toolbar"),this.panelSidebarElement().insertBefore(o,this.panelSidebarElement().firstChild);const n=new y.Toolbar("",o);this._toggleRecordAction=O.ActionRegistry.instance().action(i),this._toggleRecordButton=y.Toolbar.createActionButton(this._toggleRecordAction),n.appendToolbarItem(this._toggleRecordButton),this.clearResultsButton=new y.ToolbarButton(r.UIString("Clear all profiles"),"largeicon-clear"),this.clearResultsButton.addEventListener(y.ToolbarButton.Events.Click,this._reset,this),n.appendToolbarItem(this.clearResultsButton),n.appendSeparator(),n.appendToolbarItem(y.Toolbar.createActionButtonForId("components.collect-garbage")),this._profileViewToolbar=new y.Toolbar("",this._toolbarElement),this._profileGroups={},this._launcherView=new Je(this),this._launcherView.addEventListener(Qe.ProfileTypeSelected,this._onProfileTypeSelected,this),this._profileToView=[],this._typeIdToSidebarSection={};const a=this._profileTypes;for(let e=0;e<a.length;e++)this._registerProfileType(a[e]);this._launcherView.restoreSelectedProfileType(),this.profilesItemTreeElement.select(),this._showLauncherView(),this._createFileSelectorElement(),this.element.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!1),$.TargetManager.instance().addEventListener($.Events.SuspendStateChanged,this._onSuspendStateChanged,this),x.Context.instance().addFlavorChangeListener(q.CPUProfilerModel,this._updateProfileTypeSpecificUI,this),x.Context.instance().addFlavorChangeListener(X.HeapProfilerModel,this._updateProfileTypeSpecificUI,this)}_onKeyDown(e){let t=!1;"ArrowDown"!==e.key||e.altKey?"ArrowUp"!==e.key||e.altKey||(t=this._sidebarTree.selectPrevious()):t=this._sidebarTree.selectNext(),t&&e.consume(!0)}searchableView(){return this.visibleView&&this.visibleView.searchableView?this.visibleView.searchableView():null}_createFileSelectorElement(){this._fileSelectorElement&&this.element.removeChild(this._fileSelectorElement),this._fileSelectorElement=f.createFileSelectorElement(this._loadFromFile.bind(this)),Re(this._fileSelectorElement),this.element.appendChild(this._fileSelectorElement)}_findProfileTypeByExtension(e){return this._profileTypes.find(t=>!!t.fileExtension()&&e.endsWith(t.fileExtension()||""))||null}async _loadFromFile(e){this._createFileSelectorElement();const t=this._findProfileTypeByExtension(e.name);if(!t){const e=new Set(this._profileTypes.map(e=>e.fileExtension()).filter(e=>e));return void h.Console.instance().error(r.UIString("Can’t load file. Supported file extensions: `%s`.",Array.from(e).join("', '")))}if(t.profileBeingRecorded())return void h.Console.instance().error(r.UIString("Can’t load profile while another profile is being recorded."));const i=await t.loadFromFile(e);i&&f.MessageDialog.show(r.UIString("Profile loading failed: %s.",i.message))}toggleRecord(){if(!this._toggleRecordAction.enabled())return!0;const e=this.element.ownerDocument.deepActiveElement(),t=this._selectedProfileType,i=t.buttonClicked();return this._updateToggleRecordAction(i),i?(this._launcherView.profileStarted(),t.hasTemporaryView()&&this.showProfile(t.profileBeingRecorded())):this._launcherView.profileFinished(),e&&e.focus(),!0}_onSuspendStateChanged(){this._updateToggleRecordAction(this._toggleRecordAction.toggled())}_updateToggleRecordAction(e){const t=!(!x.Context.instance().flavor(q.CPUProfilerModel)&&!x.Context.instance().flavor(X.HeapProfilerModel)),i=e||!$.TargetManager.instance().allTargetsSuspended()&&t;this._toggleRecordAction.setEnabled(i),this._toggleRecordAction.setToggled(e),i?this._toggleRecordButton.setTitle(this._selectedProfileType?this._selectedProfileType.buttonTooltip:""):this._toggleRecordButton.setTitle(f.anotherProfilerActiveLabel()),this._selectedProfileType&&this._launcherView.updateProfileType(this._selectedProfileType,i)}_profileBeingRecordedRemoved(){this._updateToggleRecordAction(!1),this._launcherView.profileFinished()}_onProfileTypeSelected(e){this._selectedProfileType=e.data,this._updateProfileTypeSpecificUI()}_updateProfileTypeSpecificUI(){this._updateToggleRecordAction(this._toggleRecordAction.toggled())}_reset(){this._profileTypes.forEach(e=>e.reset()),delete this.visibleView,this._profileGroups={},this._updateToggleRecordAction(!1),this._launcherView.profileFinished(),this._sidebarTree.element.classList.remove("some-expandable"),this._launcherView.detach(),this.profileViews.removeChildren(),this._profileViewToolbar.removeToolbarItems(),this.clearResultsButton.element.classList.remove("hidden"),this.profilesItemTreeElement.select(),this._showLauncherView()}_showLauncherView(){this.closeVisibleView(),this._profileViewToolbar.removeToolbarItems(),this._launcherView.show(this.profileViews),this.visibleView=this._launcherView,this._toolbarElement.classList.add("hidden")}_registerProfileType(e){this._launcherView.addProfileType(e);const t=new Zt(this,e);this._typeIdToSidebarSection[e.id]=t,this._sidebarTree.appendChild(t),t.childrenListElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!1),e.addEventListener(Te.ViewUpdated,this._updateProfileTypeSpecificUI,this),e.addEventListener(Te.AddProfileHeader,(function(e){this._addProfileHeader(e.data)}),this),e.addEventListener(Te.RemoveProfileHeader,(function(e){this._removeProfileHeader(e.data)}),this),e.addEventListener(Te.ProfileComplete,(function(e){this.showProfile(e.data)}),this);const i=e.getProfiles();for(let e=0;e<i.length;e++)this._addProfileHeader(i[e])}_handleContextMenuEvent(e){const t=new b.ContextMenu(e);this.panelSidebarElement().isSelfOrAncestor(e.srcElement)&&t.defaultSection().appendItem(r.UIString("Load…"),this._fileSelectorElement.click.bind(this._fileSelectorElement)),t.show()}showLoadFromFileDialog(){this._fileSelectorElement.click()}_addProfileHeader(e){const t=e.profileType().id;this._typeIdToSidebarSection[t].addProfileHeader(e),this.visibleView&&this.visibleView!==this._launcherView||this.showProfile(e)}_removeProfileHeader(e){e.profileType().profileBeingRecorded()===e&&this._profileBeingRecordedRemoved();const t=this._indexOfViewForProfile(e);-1!==t&&this._profileToView.splice(t,1);const i=e.profileType().id;this._typeIdToSidebarSection[i].removeProfileHeader(e)&&(this.profilesItemTreeElement.select(),this._showLauncherView())}showProfile(e){if(!e||e.profileType().profileBeingRecorded()===e&&!e.profileType().hasTemporaryView())return null;const t=this.viewForProfile(e);if(t===this.visibleView)return t;this.closeVisibleView(),t.show(this.profileViews),this._toolbarElement.classList.remove("hidden"),this.visibleView=t;return this._typeIdToSidebarSection[e.profileType().id].sidebarElementForProfile(e).revealAndSelect(),this._profileViewToolbar.removeToolbarItems(),t.toolbarItems().then(e=>{e.map(e=>this._profileViewToolbar.appendToolbarItem(e))}),t}showObject(e,t){}async linkifyObject(e){return null}viewForProfile(e){const t=this._indexOfViewForProfile(e);if(-1!==t)return this._profileToView[t].view;const i=e.createView(this);return i.element.classList.add("profile-view"),this._profileToView.push({profile:e,view:i}),i}_indexOfViewForProfile(e){return this._profileToView.findIndex(t=>t.profile===e)}closeVisibleView(){this.visibleView&&this.visibleView.detach(),delete this.visibleView}focus(){this._sidebarTree.focus()}}class Zt extends S.TreeElement{constructor(e,t){super(t.treeItemTitle,!0),this.selectable=!1,this._dataDisplayDelegate=e,this._profileTreeElements=[],this._profileGroups={},this.expand(),this.hidden=!0,this.setCollapsible(!1)}addProfileHeader(e){this.hidden=!1;const t=e.profileType();let i=this;const s=e.createSidebarTreeElement(this._dataDisplayDelegate);if(this._profileTreeElements.push(s),!e.fromFile()&&t.profileBeingRecorded()!==e){const t=e.title;let o=this._profileGroups[t];o||(o=new ei,this._profileGroups[t]=o),o.profileSidebarTreeElements.push(s);const n=o.profileSidebarTreeElements.length;if(2===n){o.sidebarTreeElement=new ti(this._dataDisplayDelegate,e.title);const t=o.profileSidebarTreeElements[0],i=this.children().indexOf(t);this.insertChild(o.sidebarTreeElement,i);const s=t.selected;this.removeChild(t),o.sidebarTreeElement.appendChild(t),s&&t.revealAndSelect(),t.setSmall(!0),t.setMainTitle(r.UIString("Run %d",1)),this.treeOutline.element.classList.add("some-expandable")}n>=2&&(i=o.sidebarTreeElement,s.setSmall(!0),s.setMainTitle(r.UIString("Run %d",n)))}i.appendChild(s)}removeProfileHeader(e){const t=this._sidebarElementIndex(e);if(-1===t)return!1;const i=this._profileTreeElements[t];this._profileTreeElements.splice(t,1);let s=this;const r=this._profileGroups[e.title];if(r){const t=r.profileSidebarTreeElements;if(t.splice(t.indexOf(i),1),1===t.length){const i=s.children().indexOf(r.sidebarTreeElement);r.sidebarTreeElement.removeChild(t[0]),this.insertChild(t[0],i),t[0].setSmall(!1),t[0].setMainTitle(e.title),this.removeChild(r.sidebarTreeElement)}0!==t.length&&(s=r.sidebarTreeElement)}return s.removeChild(i),i.dispose(),!this.childCount()&&(this.hidden=!0,!0)}sidebarElementForProfile(e){const t=this._sidebarElementIndex(e);return-1===t?null:this._profileTreeElements[t]}_sidebarElementIndex(e){const t=this._profileTreeElements;for(let i=0;i<t.length;i++)if(t[i].profile===e)return i;return-1}onattach(){this.listItemElement.classList.add("profiles-tree-section")}}class ei{constructor(){this.profileSidebarTreeElements=[],this.sidebarTreeElement=null}}class ti extends S.TreeElement{constructor(e,t){super("",!0),this.selectable=!1,this._dataDisplayDelegate=e,this._title=t,this.expand(),this.toggleOnClick=!0}onselect(){const e=this.childCount()>0;return e&&this._dataDisplayDelegate.showProfile(this.lastChild().profile),e}onattach(){this.listItemElement.classList.add("profile-group-sidebar-tree-item"),this.listItemElement.createChild("div","icon"),this.listItemElement.createChild("div","titles no-subtitle").createChild("span","title-container").createChild("span","title").textContent=this._title}}class ii extends S.TreeElement{constructor(e){super("",!1),this.selectable=!0,this._panel=e}onselect(){return this._panel._showLauncherView(),!0}onattach(){this.listItemElement.classList.add("profile-launcher-view-tree-item"),this.listItemElement.createChild("div","icon"),this.listItemElement.createChild("div","titles no-subtitle").createChild("span","title-container").createChild("span","title").textContent=r.UIString("Profiles")}}class si extends Yt{constructor(){super("js_profiler",[Kt.cpuProfileType],"profiler.js-toggle-recording")}wasShown(){x.Context.instance().setFlavor(si,this)}willHide(){x.Context.instance().setFlavor(si,null)}handleAction(e,t){const i=x.Context.instance().flavor(si);return console.assert(i&&i instanceof si),i.toggleRecord(),!0}}var ri=Object.freeze({__proto__:null,ProfilesPanel:Yt,ProfileTypeSidebarSection:Zt,ProfileGroup:ei,ProfileGroupSidebarTreeElement:ti,ProfilesSidebarTreeElement:ii,JSProfilerPanel:si});class oi extends Yt{constructor(){const e=Kt;super("heap_profiler",[e.heapSnapshotProfileType,e.trackingHeapSnapshotProfileType,e.samplingHeapProfileType],"profiler.heap-toggle-recording")}appendApplicableItems(e,t,i){if(!(i instanceof ee.RemoteObject))return;if(!this.isShowing())return;const s=i;if(!s.objectId)return;const o=s.objectId;if(!Kt.heapSnapshotProfileType.getProfiles().length)return;const n=s.runtimeModel().heapProfilerModel();n&&t.revealSection().appendItem(r.UIString("Reveal in Summary view"),function(e){n.snapshotObjectIdForObjectId(o).then(t=>{this.isShowing()&&t&&this.showObject(t,e)})}.bind(this,"Summary"))}handleAction(e,t){const i=x.Context.instance().flavor(oi);return console.assert(i&&i instanceof oi),i.toggleRecord(),!0}wasShown(){x.Context.instance().setFlavor(oi,this),G.panelLoaded("heap_profiler","DevTools.Launch.HeapProfiler")}willHide(){x.Context.instance().setFlavor(oi,null)}showObject(e,t){const i=Kt.heapSnapshotProfileType.getProfiles();for(let s=0;s<i.length;s++){const r=i[s];if(r.maxJSObjectId>=e){this.showProfile(r);this.viewForProfile(r).selectLiveObject(t,e);break}}}}var ni=Object.freeze({__proto__:null,HeapProfilerPanel:oi});class ai extends v.VBox{constructor(){super(!0),this._gridNodeByUrl=new Map,this.registerRequiredCSS("profiler/liveHeapProfile.css",{enableLegacyPatching:!0}),this._setting=a.Settings.instance().moduleSetting("memoryLiveHeapProfile");const e=new y.Toolbar("live-heap-profile-toolbar",this.contentElement);this._toggleRecordAction=O.ActionRegistry.instance().action("live-heap-profile.toggle-recording"),this._toggleRecordButton=y.Toolbar.createActionButton(this._toggleRecordAction),this._toggleRecordButton.setToggled(this._setting.get()),e.appendToolbarItem(this._toggleRecordButton);const t=$.TargetManager.instance().mainTarget();if(t&&t.model(te.ResourceTreeModel)){const t=O.ActionRegistry.instance().action("live-heap-profile.start-with-reload");this._startWithReloadButton=y.Toolbar.createActionButton(t),e.appendToolbarItem(this._startWithReloadButton)}this._dataGrid=this._createDataGrid(),this._dataGrid.asWidget().show(this.contentElement),this._currentPollId=0}_createDataGrid(){const e=[{id:"size",title:ls`JS Heap`,width:"72px",fixedWidth:!0,sortable:!0,align:u.Align.Right,sort:u.Order.Descending,tooltip:ls`Allocated JS heap size currently in use`},{id:"isolates",title:ls`VMs`,width:"40px",fixedWidth:!0,align:u.Align.Right,tooltip:ls`Number of VMs sharing the same script source`},{id:"url",title:ls`Script URL`,fixedWidth:!1,sortable:!0,tooltip:ls`URL of the script source`}],t=new m.SortableDataGrid({displayName:ls`Heap Profile`,columns:e});t.setResizeMethod(u.ResizeMethod.Last),t.element.classList.add("flex-auto"),t.element.addEventListener("keydown",this._onKeyDown.bind(this),!1),t.addEventListener(u.Events.OpenedNode,this._revealSourceForSelectedNode,this),t.addEventListener(u.Events.SortingChanged,this._sortingChanged,this);for(const i of e){const e=t.headerTableHeader(i.id);e&&e.setAttribute("title",i.tooltip)}return t}wasShown(){this._poll(),this._setting.addChangeListener(this._settingChanged,this)}willHide(){++this._currentPollId,this._setting.removeChangeListener(this._settingChanged,this)}_settingChanged(e){this._toggleRecordButton.setToggled(e.data)}async _poll(){const e=this._currentPollId;do{const t=Array.from(Q.IsolateManager.instance().isolates()),i=await Promise.all(t.map(e=>e.heapProfilerModel()&&e.heapProfilerModel().getSamplingProfile()));if(this._currentPollId!==e)return;this._update(t,i),await new Promise(e=>setTimeout(e,3e3))}while(this._currentPollId===e)}_update(e,t){const i=new Map;t.forEach((t,s)=>{t&&function e(t,s,o){const n=o.callFrame.url||s||function(e){const t=e.callFrame.functionName;return t.startsWith("(")&&"(root)"!==t?t:""}(o)||function(e){return Number(e.callFrame.scriptId)?r.UIString("(Anonymous Script %s)",e.callFrame.scriptId):""}(o);if(o.children.forEach(e.bind(null,t,n)),!o.selfSize)return;let a=i.get(n);a||(a={size:0,isolates:new Set},i.set(n,a));a.size+=o.selfSize,a.isolates.add(t)}(e[s],"",t.head)});const s=this._dataGrid.rootNode(),o=new Set;for(const e of i){const t=e[0],i=e[1].size,r=e[1].isolates.size;if(!t){console.info(`Node with empty URL: ${i} bytes`);continue}let n=this._gridNodeByUrl.get(t);n?n.updateNode(i,r):(n=new li(t,i,r),this._gridNodeByUrl.set(t,n),s.appendChild(n)),o.add(n)}for(const e of s.children.slice())o.has(e)||e.remove(),this._gridNodeByUrl.delete(e._url);this._sortingChanged()}_onKeyDown(e){isEnterKey(e)&&(e.consume(!0),this._revealSourceForSelectedNode())}_revealSourceForSelectedNode(){const e=this._dataGrid.selectedNode;if(!e||!e._url)return;const t=ae.WorkspaceImpl.instance().uiSourceCodeForURL(e._url);t&&l.reveal(t)}_sortingChanged(){const e=this._dataGrid.sortColumnId();if(!e)return;const t="url"===e?(e,t)=>t._url.localeCompare(e._url):(e,t)=>t._size-e._size;this._dataGrid.sortNodes(t,this._dataGrid.isSortOrderAscending())}_toggleRecording(){!this._setting.get()?this._startRecording(!1):this._stopRecording()}_startRecording(e){if(this._setting.set(!0),!e)return;const t=$.TargetManager.instance().mainTarget();if(!t)return;const i=t.model(te.ResourceTreeModel);i&&i.reloadPage()}async _stopRecording(){this._setting.set(!1)}}class li extends m.SortableDataGridNode{constructor(e,t,i){super(),this._url=e,this._size=t,this._isolateCount=i}updateNode(e,t){this._size===e&&this._isolateCount===t||(this._size=e,this._isolateCount=t,this.refresh())}createCell(e){const t=this.createTD(e);switch(e){case"url":t.textContent=this._url;break;case"size":t.textContent=Number.withThousandsSeparator(Math.round(this._size/1e3)),t.createChild("span","size-units").textContent=ls`kB`;break;case"isolates":t.textContent=""+this._isolateCount}return t}}var di=Object.freeze({__proto__:null,LiveHeapProfileView:ai,GridNode:li,ActionDelegate:class{handleAction(e,t){return(async()=>{await V.ViewManager.instance().showView("live_heap_profile");const e=await V.ViewManager.instance().view("live_heap_profile").widget();this._innerHandleAction(e,t)})(),!0}_innerHandleAction(e,t){switch(t){case"live-heap-profile.toggle-recording":e._toggleRecording();break;case"live-heap-profile.start-with-reload":e._startRecording(!0);break;default:console.assert(!1,"Unknown action: "+t)}}}});export{ue as BottomUpProfileDataGrid,Se as CPUProfileFlameChart,Ae as CPUProfileView,_e as ChildrenProvider,ct as HeapProfileView,ni as HeapProfilerPanel,Et as HeapSnapshotDataGrids,Ct as HeapSnapshotGridNodes,Mt as HeapSnapshotProxy,Jt as HeapSnapshotView,it as HeapTimelineOverview,qe as IsolateSelector,di as LiveHeapProfileView,he as ProfileDataGrid,ye as ProfileHeader,Ke as ProfileLauncherView,Ne as ProfileSidebarTreeElement,Xt as ProfileTypeRegistry,Be as ProfileView,ri as ProfilesPanel,Le as TopDownProfileDataGrid};
