import"../cm/cm.js";import{TextDictionary as e,Settings as t}from"../common/common.js";import{Platform as r}from"../host/host.js";import{Multimap as o,NumberUtilities as i}from"../platform/platform.js";import{Runtime as n}from"../root/root.js";import{TextRange as a,TextUtils as s}from"../text_utils/text_utils.js";import{GlassPane as l,Utils as c,SuggestBox as d,TextEditor as u,KeyboardShortcut as h,Widget as m}from"../ui/ui.js";var p;function g(e){return{start:new CodeMirror.Pos(e.startLine,e.startColumn),end:new CodeMirror.Pos(e.endLine,e.endColumn)}}function f(e,t){return new a.TextRange(e.line,e.ch,t.line,t.ch)}function b(e){const t=f(e.from,e.to),r=t.clone(),o=e.text.length;return 0===o?(r.endLine=r.startLine,r.endColumn=r.startColumn):1===o?(r.endLine=r.startLine,r.endColumn=r.startColumn+e.text[0].length):(r.endLine=r.startLine+o-1,r.endColumn=e.text[o-1].length),{oldRange:t,newRange:r}}p=function(e){function t(e){for(var t={},r=0;r<e.length;++r)t[e[r].toLowerCase()]=!0;return t}e.defineMode("css",(function(t,r){var o=r.inline;r.propertyKeywords||(r=e.resolveMode("text/css"));var i,n,a=t.indentUnit,s=r.tokenHooks,l=r.documentTypes||{},c=r.mediaTypes||{},d=r.mediaFeatures||{},u=r.mediaValueKeywords||{},h=r.propertyKeywords||{},m=r.nonStandardPropertyKeywords||{},p=r.fontProperties||{},g=r.counterDescriptors||{},f=r.colorKeywords||{},b=r.valueKeywords||{},_=r.allowNested,x=r.lineComment,y=!0===r.supportsAtComponent;function k(e,t){return i=t,e}function v(e,t){var r=e.next();if(s[r]){var o=s[r](e,t);if(!1!==o)return o}return"@"==r?(e.eatWhile(/[\w\\\-]/),k("def",e.current())):"="==r||("~"==r||"|"==r)&&e.eat("=")?k(null,"compare"):'"'==r||"'"==r?(t.tokenize=w(r),t.tokenize(e,t)):"#"==r?(e.eatWhile(/[\w\\\-]/),k("atom","hash")):"!"==r?(e.match(/^\s*\w*/),k("keyword","important")):/\d/.test(r)||"."==r&&e.eat(/\d/)?(e.eatWhile(/[\w.%]/),k("number","unit")):"-"!==r?/[,+>*\/]/.test(r)?k(null,"select-op"):"."==r&&e.match(/^-?[_a-z][_a-z0-9-]*/i)?k("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(r)?k(null,r):e.match(/[\w-.]+(?=\()/)?(/^(url(-prefix)?|domain|regexp)$/.test(e.current().toLowerCase())&&(t.tokenize=C),k("variable callee","variable")):/[\w\\\-]/.test(r)?(e.eatWhile(/[\w\\\-]/),k("property","word")):k(null,null):/[\d.]/.test(e.peek())?(e.eatWhile(/[\w.%]/),k("number","unit")):e.match(/^-[\w\\\-]*/)?(e.eatWhile(/[\w\\\-]/),e.match(/^\s*:/,!1)?k("variable-2","variable-definition"):k("variable-2","variable")):e.match(/^\w+-/)?k("meta","meta"):void 0}function w(e){return function(t,r){for(var o,i=!1;null!=(o=t.next());){if(o==e&&!i){")"==e&&t.backUp(1);break}i=!i&&"\\"==o}return(o==e||!i&&")"!=e)&&(r.tokenize=null),k("string","string")}}function C(e,t){return e.next(),e.match(/\s*[\"\')]/,!1)?t.tokenize=null:t.tokenize=w(")"),k(null,"(")}function M(e,t,r){this.type=e,this.indent=t,this.prev=r}function S(e,t,r,o){return e.context=new M(r,t.indentation()+(!1===o?0:a),e.context),r}function L(e){return e.context.prev&&(e.context=e.context.prev),e.context.type}function T(e,t,r){return A[r.context.type](e,t,r)}function E(e,t,r,o){for(var i=o||1;i>0;i--)r.context=r.context.prev;return T(e,t,r)}function P(e){var t=e.current().toLowerCase();n=b.hasOwnProperty(t)?"atom":f.hasOwnProperty(t)?"keyword":"variable"}var A={top:function(e,t,r){if("{"==e)return S(r,t,"block");if("}"==e&&r.context.prev)return L(r);if(y&&/@component/i.test(e))return S(r,t,"atComponentBlock");if(/^@(-moz-)?document$/i.test(e))return S(r,t,"documentTypes");if(/^@(media|supports|(-moz-)?document|import)$/i.test(e))return S(r,t,"atBlock");if(/^@(font-face|counter-style)/i.test(e))return r.stateArg=e,"restricted_atBlock_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/i.test(e))return"keyframes";if(e&&"@"==e.charAt(0))return S(r,t,"at");if("hash"==e)n="builtin";else if("word"==e)n="tag";else{if("variable-definition"==e)return"maybeprop";if("interpolation"==e)return S(r,t,"interpolation");if(":"==e)return"pseudo";if(_&&"("==e)return S(r,t,"parens")}return r.context.type},block:function(e,t,r){if("word"==e){var o=t.current().toLowerCase();return h.hasOwnProperty(o)?(n="property","maybeprop"):m.hasOwnProperty(o)?(n="string-2","maybeprop"):_?(n=t.match(/^\s*:(?:\s|$)/,!1)?"property":"tag","block"):(n+=" error","maybeprop")}return"meta"==e?"block":_||"hash"!=e&&"qualifier"!=e?A.top(e,t,r):(n="error","block")},maybeprop:function(e,t,r){return":"==e?S(r,t,"prop"):T(e,t,r)},prop:function(e,t,r){if(";"==e)return L(r);if("{"==e&&_)return S(r,t,"propBlock");if("}"==e||"{"==e)return E(e,t,r);if("("==e)return S(r,t,"parens");if("hash"!=e||/^#([0-9a-fA-f]{3,4}|[0-9a-fA-f]{6}|[0-9a-fA-f]{8})$/.test(t.current())){if("word"==e)P(t);else if("interpolation"==e)return S(r,t,"interpolation")}else n+=" error";return"prop"},propBlock:function(e,t,r){return"}"==e?L(r):"word"==e?(n="property","maybeprop"):r.context.type},parens:function(e,t,r){return"{"==e||"}"==e?E(e,t,r):")"==e?L(r):"("==e?S(r,t,"parens"):"interpolation"==e?S(r,t,"interpolation"):("word"==e&&P(t),"parens")},pseudo:function(e,t,r){return"meta"==e?"pseudo":"word"==e?(n="variable-3",r.context.type):T(e,t,r)},documentTypes:function(e,t,r){return"word"==e&&l.hasOwnProperty(t.current())?(n="tag",r.context.type):A.atBlock(e,t,r)},atBlock:function(e,t,r){if("("==e)return S(r,t,"atBlock_parens");if("}"==e||";"==e)return E(e,t,r);if("{"==e)return L(r)&&S(r,t,_?"block":"top");if("interpolation"==e)return S(r,t,"interpolation");if("word"==e){var o=t.current().toLowerCase();n="only"==o||"not"==o||"and"==o||"or"==o?"keyword":c.hasOwnProperty(o)?"attribute":d.hasOwnProperty(o)?"property":u.hasOwnProperty(o)?"keyword":h.hasOwnProperty(o)?"property":m.hasOwnProperty(o)?"string-2":b.hasOwnProperty(o)?"atom":f.hasOwnProperty(o)?"keyword":"error"}return r.context.type},atComponentBlock:function(e,t,r){return"}"==e?E(e,t,r):"{"==e?L(r)&&S(r,t,_?"block":"top",!1):("word"==e&&(n="error"),r.context.type)},atBlock_parens:function(e,t,r){return")"==e?L(r):"{"==e||"}"==e?E(e,t,r,2):A.atBlock(e,t,r)},restricted_atBlock_before:function(e,t,r){return"{"==e?S(r,t,"restricted_atBlock"):"word"==e&&"@counter-style"==r.stateArg?(n="variable","restricted_atBlock_before"):T(e,t,r)},restricted_atBlock:function(e,t,r){return"}"==e?(r.stateArg=null,L(r)):"word"==e?(n="@font-face"==r.stateArg&&!p.hasOwnProperty(t.current().toLowerCase())||"@counter-style"==r.stateArg&&!g.hasOwnProperty(t.current().toLowerCase())?"error":"property","maybeprop"):"restricted_atBlock"},keyframes:function(e,t,r){return"word"==e?(n="variable","keyframes"):"{"==e?S(r,t,"top"):T(e,t,r)},at:function(e,t,r){return";"==e?L(r):"{"==e||"}"==e?E(e,t,r):("word"==e?n="tag":"hash"==e&&(n="builtin"),"at")},interpolation:function(e,t,r){return"}"==e?L(r):"{"==e||";"==e?E(e,t,r):("word"==e?n="variable":"variable"!=e&&"("!=e&&")"!=e&&(n="error"),"interpolation")}};return{startState:function(e){return{tokenize:null,state:o?"block":"top",stateArg:null,context:new M(o?"block":"top",e||0,null)}},token:function(e,t){if(!t.tokenize&&e.eatSpace())return null;var r=(t.tokenize||v)(e,t);return r&&"object"==typeof r&&(i=r[1],r=r[0]),n=r,"comment"!=i&&(t.state=A[t.state](i,e,t)),n},indent:function(e,t){var r=e.context,o=t&&t.charAt(0),i=r.indent;return"prop"!=r.type||"}"!=o&&")"!=o||(r=r.prev),r.prev&&("}"!=o||"block"!=r.type&&"top"!=r.type&&"interpolation"!=r.type&&"restricted_atBlock"!=r.type?(")"!=o||"parens"!=r.type&&"atBlock_parens"!=r.type)&&("{"!=o||"at"!=r.type&&"atBlock"!=r.type)||(i=Math.max(0,r.indent-a)):i=(r=r.prev).indent),i},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:x,fold:"brace"}}));var r=["domain","regexp","url","url-prefix"],o=t(r),i=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],n=t(i),a=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid","orientation","device-pixel-ratio","min-device-pixel-ratio","max-device-pixel-ratio","pointer","any-pointer","hover","any-hover","prefers-color-scheme"],s=t(a),l=["landscape","portrait","none","coarse","fine","on-demand","hover","interlace","progressive","dark","light"],c=t(l),d=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","all","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backdrop-filter","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size","baseline-shift","binding","bleed","block-size","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-family","font-feature-settings","font-kerning","font-language-override","font-optical-sizing","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-gap","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-gap","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","inset","inset-block","inset-block-end","inset-block-start","inset-inline","inset-inline-end","inset-inline-start","isolation","justify-content","justify-items","justify-self","left","letter-spacing","line-break","line-height","line-height-step","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","offset","offset-anchor","offset-distance","offset-path","offset-position","offset-rotate","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","place-content","place-items","place-self","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotate","rotation","rotation-point","row-gap","ruby-align","ruby-overhang","ruby-position","ruby-span","scale","scroll-behavior","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-type","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-orientation","text-outline","text-overflow","text-rendering","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","touch-action","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","translate","unicode-bidi","user-select","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","paint-order","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],u=t(d),h=["border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","margin-block","margin-block-end","margin-block-start","margin-inline","margin-inline-end","margin-inline-start","padding-block","padding-block-end","padding-block-start","padding-inline","padding-inline-end","padding-inline-start","scroll-snap-stop","scrollbar-3d-light-color","scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-track-color","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","shape-inside","zoom"],m=t(h),p=t(["font-display","font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"]),g=t(["additive-symbols","fallback","negative","pad","prefix","range","speak-as","suffix","symbols","system"]),f=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],b=t(f),_=["above","absolute","activeborder","additive","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","axis-pan","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","devanagari","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ethiopic-numeric","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fill-box","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","georgian","graytext","grid","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hard-light","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","japanese-formal","japanese-informal","justify","kannada","katakana","katakana-iroha","keep-all","khmer","korean-hangul-formal","korean-hanja-formal","korean-hanja-informal","landscape","lao","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","luminosity","malayalam","manipulation","match","matrix","matrix3d","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","multiple_mask_images","multiply","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","octal","opacity","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","perspective","pinch-zoom","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","sidama","simp-chinese-formal","simp-chinese-informal","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","somali","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","square-button","start","static","status-bar","stretch","stroke","stroke-box","sub","subpixel-antialiased","svg_masks","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","tamil","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","trad-chinese-formal","trad-chinese-informal","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unidirectional-pan","unset","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","var","vertical","vertical-text","view-box","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"],x=t(_),y=r.concat(i).concat(a).concat(l).concat(d).concat(h).concat(f).concat(_);function k(e,t){for(var r,o=!1;null!=(r=e.next());){if(o&&"/"==r){t.tokenize=null;break}o="*"==r}return["comment","comment"]}e.registerHelper("hintWords","css",y),e.defineMIME("text/css",{documentTypes:o,mediaTypes:n,mediaFeatures:s,mediaValueKeywords:c,propertyKeywords:u,nonStandardPropertyKeywords:m,fontProperties:p,counterDescriptors:g,colorKeywords:b,valueKeywords:x,tokenHooks:{"/":function(e,t){return!!e.eat("*")&&(t.tokenize=k,k(e,t))}},name:"css"}),e.defineMIME("text/x-scss",{mediaTypes:n,mediaFeatures:s,mediaValueKeywords:c,propertyKeywords:u,nonStandardPropertyKeywords:m,colorKeywords:b,valueKeywords:x,fontProperties:p,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=k,k(e,t)):["operator","operator"]},":":function(e){return!!e.match(/\s*\{/,!1)&&[null,null]},$:function(e){return e.match(/^[\w-]+/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(e){return!!e.eat("{")&&[null,"interpolation"]}},name:"css",helperType:"scss"}),e.defineMIME("text/x-less",{mediaTypes:n,mediaFeatures:s,mediaValueKeywords:c,propertyKeywords:u,nonStandardPropertyKeywords:m,colorKeywords:b,valueKeywords:x,fontProperties:p,allowNested:!0,lineComment:"//",tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=k,k(e,t)):["operator","operator"]},"@":function(e){return e.eat("{")?[null,"interpolation"]:!e.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/i,!1)&&(e.eatWhile(/[\w\\\-]/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"])},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"}),e.defineMIME("text/x-gss",{documentTypes:o,mediaTypes:n,mediaFeatures:s,propertyKeywords:u,nonStandardPropertyKeywords:m,fontProperties:p,counterDescriptors:g,colorKeywords:b,valueKeywords:x,supportsAtComponent:!0,tokenHooks:{"/":function(e,t){return!!e.eat("*")&&(t.tokenize=k,k(e,t))}},name:"css",helperType:"gss"})},"object"==typeof exports&&"object"==typeof module?p(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],p):p(CodeMirror),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){e.defineMode("javascript",(function(t,r){var o,i,n=t.indentUnit,a=r.statementIndent,s=r.jsonld,l=r.json||s,c=r.typescript,d=r.wordCharacters||/[\w$\xa1-\uffff]/,u=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),r=e("keyword b"),o=e("keyword c"),i=e("keyword d"),n=e("operator"),a={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:r,do:r,try:r,finally:r,return:i,break:i,continue:i,new:e("new"),delete:o,void:o,throw:o,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:n,typeof:n,instanceof:n,true:a,false:a,null:a,undefined:a,NaN:a,Infinity:a,this:e("this"),class:e("class"),super:e("atom"),yield:o,export:e("export"),import:e("import"),extends:o,await:o}}(),h=/[+\-*&%=<>!?|~^@]/,m=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function p(e,t,r){return o=e,i=r,t}function g(e,t){var r,o=e.next();if('"'==o||"'"==o)return t.tokenize=(r=o,function(e,t){var o,i=!1;if(s&&"@"==e.peek()&&e.match(m))return t.tokenize=g,p("jsonld-keyword","meta");for(;null!=(o=e.next())&&(o!=r||i);)i=!i&&"\\"==o;return i||(t.tokenize=g),p("string","string")}),t.tokenize(e,t);if("."==o&&e.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return p("number","number");if("."==o&&e.match(".."))return p("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(o))return p(o);if("="==o&&e.eat(">"))return p("=>","operator");if("0"==o&&e.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return p("number","number");if(/\d/.test(o))return e.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),p("number","number");if("/"==o)return e.eat("*")?(t.tokenize=f,f(e,t)):e.eat("/")?(e.skipToEnd(),p("comment","comment")):Ve(e,t,1)?(function(e){for(var t,r=!1,o=!1;null!=(t=e.next());){if(!r){if("/"==t&&!o)return;"["==t?o=!0:o&&"]"==t&&(o=!1)}r=!r&&"\\"==t}}(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),p("regexp","string-2")):(e.eat("="),p("operator","operator",e.current()));if("`"==o)return t.tokenize=b,b(e,t);if("#"==o&&"!"==e.peek())return e.skipToEnd(),p("meta","meta");if("#"==o&&e.eatWhile(d))return p("variable","property");if("<"==o&&e.match("!--")||"-"==o&&e.match("->")&&!/\S/.test(e.string.slice(0,e.start)))return e.skipToEnd(),p("comment","comment");if(h.test(o))return">"==o&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=o&&"="!=o||e.eat("="):/[<>*+\-]/.test(o)&&(e.eat(o),">"==o&&e.eat(o))),"?"==o&&e.eat(".")?p("."):p("operator","operator",e.current());if(d.test(o)){e.eatWhile(d);var i=e.current();if("."!=t.lastType){if(u.propertyIsEnumerable(i)){var n=u[i];return p(n.type,n.style,i)}if("async"==i&&e.match(/^(\s|\/\*.*?\*\/)*[\[\(\w]/,!1))return p("async","keyword",i)}return p("variable","variable",i)}}function f(e,t){for(var r,o=!1;r=e.next();){if("/"==r&&o){t.tokenize=g;break}o="*"==r}return p("comment","comment")}function b(e,t){for(var r,o=!1;null!=(r=e.next());){if(!o&&("`"==r||"$"==r&&e.eat("{"))){t.tokenize=g;break}o=!o&&"\\"==r}return p("quasi","string-2",e.current())}function _(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var r=e.string.indexOf("=>",e.start);if(!(r<0)){if(c){var o=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,r));o&&(r=o.index)}for(var i=0,n=!1,a=r-1;a>=0;--a){var s=e.string.charAt(a),l="([{}])".indexOf(s);if(l>=0&&l<3){if(!i){++a;break}if(0==--i){"("==s&&(n=!0);break}}else if(l>=3&&l<6)++i;else if(d.test(s))n=!0;else if(/["'\/`]/.test(s))for(;;--a){if(0==a)return;if(e.string.charAt(a-1)==s&&"\\"!=e.string.charAt(a-2)){a--;break}}else if(n&&!i){++a;break}}n&&!i&&(t.fatArrowAt=a)}}var x={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,"jsonld-keyword":!0};function y(e,t,r,o,i,n){this.indented=e,this.column=t,this.type=r,this.prev=i,this.info=n,null!=o&&(this.align=o)}function k(e,t){for(var r=e.localVars;r;r=r.next)if(r.name==t)return!0;for(var o=e.context;o;o=o.prev)for(r=o.vars;r;r=r.next)if(r.name==t)return!0}var v={state:null,column:null,marked:null,cc:null};function w(){for(var e=arguments.length-1;e>=0;e--)v.cc.push(arguments[e])}function C(){return w.apply(null,arguments),!0}function M(e,t){for(var r=t;r;r=r.next)if(r.name==e)return!0;return!1}function S(e){var t=v.state;if(v.marked="def",t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var o=function e(t,r){if(r){if(r.block){var o=e(t,r.prev);return o?o==r.prev?r:new T(o,r.vars,!0):null}return M(t,r.vars)?r:new T(r.prev,new E(t,r.vars),!1)}return null}(e,t.context);if(null!=o)return void(t.context=o)}else if(!M(e,t.localVars))return void(t.localVars=new E(e,t.localVars));r.globalVars&&!M(e,t.globalVars)&&(t.globalVars=new E(e,t.globalVars))}function L(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function T(e,t,r){this.prev=e,this.vars=t,this.block=r}function E(e,t){this.name=e,this.next=t}var P=new E("this",new E("arguments",null));function A(){v.state.context=new T(v.state.context,v.state.localVars,!1),v.state.localVars=P}function z(){v.state.context=new T(v.state.context,v.state.localVars,!0),v.state.localVars=null}function R(){v.state.localVars=v.state.context.vars,v.state.context=v.state.context.prev}function B(e,t){var r=function(){var r=v.state,o=r.indented;if("stat"==r.lexical.type)o=r.lexical.indented;else for(var i=r.lexical;i&&")"==i.type&&i.align;i=i.prev)o=i.indented;r.lexical=new y(o,v.stream.column(),e,null,r.lexical,t)};return r.lex=!0,r}function I(){var e=v.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function j(e){return function t(r){return r==e?C():";"==e||"}"==r||")"==r||"]"==r?w():C(t)}}function O(e,t){return"var"==e?C(B("vardef",t),_e,j(";"),I):"keyword a"==e?C(B("form"),H,O,I):"keyword b"==e?C(B("form"),O,I):"keyword d"==e?v.stream.match(/^\s*$/,!1)?C():C(B("stat"),D,j(";"),I):"debugger"==e?C(j(";")):"{"==e?C(B("}"),z,ne,I,R):";"==e?C():"if"==e?("else"==v.state.lexical.info&&v.state.cc[v.state.cc.length-1]==I&&v.state.cc.pop()(),C(B("form"),H,O,I,Ce)):"function"==e?C(Te):"for"==e?C(B("form"),Me,O,I):"class"==e||c&&"interface"==t?(v.marked="keyword",C(B("form","class"==e?e:t),Re,I)):"variable"==e?c&&"declare"==t?(v.marked="keyword",C(O)):c&&("module"==t||"enum"==t||"type"==t)&&v.stream.match(/^\s*\w/,!1)?(v.marked="keyword","enum"==t?C(Ke):"type"==t?C(Pe,j("operator"),de,j(";")):C(B("form"),xe,j("{"),B("}"),ne,I,I)):c&&"namespace"==t?(v.marked="keyword",C(B("form"),N,O,I)):c&&"abstract"==t?(v.marked="keyword",C(O)):C(B("stat"),Q):"switch"==e?C(B("form"),H,j("{"),B("}","switch"),z,ne,I,I,R):"case"==e?C(N,j(":")):"default"==e?C(j(":")):"catch"==e?C(B("form"),A,q,O,I,R):"export"==e?C(B("stat"),Oe,I):"import"==e?C(B("stat"),Ne,I):"async"==e?C(O):"@"==t?C(N,O):w(B("stat"),N,j(";"),I)}function q(e){if("("==e)return C(Ae,j(")"))}function N(e,t){return F(e,t,!1)}function W(e,t){return F(e,t,!0)}function H(e){return"("!=e?w():C(B(")"),D,j(")"),I)}function F(e,t,r){if(v.state.fatArrowAt==v.stream.start){var o=r?Z:$;if("("==e)return C(A,B(")"),oe(Ae,")"),I,j("=>"),o,R);if("variable"==e)return w(A,xe,j("=>"),o,R)}var i=r?K:U;return x.hasOwnProperty(e)?C(i):"function"==e?C(Te,i):"class"==e||c&&"interface"==t?(v.marked="keyword",C(B("form"),ze,I)):"keyword c"==e||"async"==e?C(r?W:N):"("==e?C(B(")"),D,j(")"),I,i):"operator"==e||"spread"==e?C(r?W:N):"["==e?C(B("]"),Ue,I,i):"{"==e?ie(ee,"}",null,i):"quasi"==e?w(G,i):"new"==e?C(function(e){return function(t){return"."==t?C(e?X:Y):"variable"==t&&c?C(ge,e?K:U):w(e?W:N)}}(r)):"import"==e?C(N):C()}function D(e){return e.match(/[;\}\)\],]/)?w():w(N)}function U(e,t){return","==e?C(D):K(e,t,!1)}function K(e,t,r){var o=0==r?U:K,i=0==r?N:W;return"=>"==e?C(A,r?Z:$,R):"operator"==e?/\+\+|--/.test(t)||c&&"!"==t?C(o):c&&"<"==t&&v.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?C(B(">"),oe(de,">"),I,o):"?"==t?C(N,j(":"),i):C(i):"quasi"==e?w(G,o):";"!=e?"("==e?ie(W,")","call",o):"."==e?C(J,o):"["==e?C(B("]"),D,j("]"),I,o):c&&"as"==t?(v.marked="keyword",C(de,o)):"regexp"==e?(v.state.lastType=v.marked="operator",v.stream.backUp(v.stream.pos-v.stream.start-1),C(i)):void 0:void 0}function G(e,t){return"quasi"!=e?w():"${"!=t.slice(t.length-2)?C(G):C(N,V)}function V(e){if("}"==e)return v.marked="string-2",v.state.tokenize=b,C(G)}function $(e){return _(v.stream,v.state),w("{"==e?O:N)}function Z(e){return _(v.stream,v.state),w("{"==e?O:W)}function Y(e,t){if("target"==t)return v.marked="keyword",C(U)}function X(e,t){if("target"==t)return v.marked="keyword",C(K)}function Q(e){return":"==e?C(I,O):w(U,j(";"),I)}function J(e){if("variable"==e)return v.marked="property",C()}function ee(e,t){return"async"==e?(v.marked="property",C(ee)):"variable"==e||"keyword"==v.style?(v.marked="property","get"==t||"set"==t?C(te):(c&&v.state.fatArrowAt==v.stream.start&&(r=v.stream.match(/^\s*:\s*/,!1))&&(v.state.fatArrowAt=v.stream.pos+r[0].length),C(re))):"number"==e||"string"==e?(v.marked=s?"property":v.style+" property",C(re)):"jsonld-keyword"==e?C(re):c&&L(t)?(v.marked="keyword",C(ee)):"["==e?C(N,ae,j("]"),re):"spread"==e?C(W,re):"*"==t?(v.marked="keyword",C(ee)):":"==e?w(re):void 0;var r}function te(e){return"variable"!=e?w(re):(v.marked="property",C(Te))}function re(e){return":"==e?C(W):"("==e?w(Te):void 0}function oe(e,t,r){function o(i,n){if(r?r.indexOf(i)>-1:","==i){var a=v.state.lexical;return"call"==a.info&&(a.pos=(a.pos||0)+1),C((function(r,o){return r==t||o==t?w():w(e)}),o)}return i==t||n==t?C():r&&r.indexOf(";")>-1?w(e):C(j(t))}return function(r,i){return r==t||i==t?C():w(e,o)}}function ie(e,t,r){for(var o=3;o<arguments.length;o++)v.cc.push(arguments[o]);return C(B(t,r),oe(e,t),I)}function ne(e){return"}"==e?C():w(O,ne)}function ae(e,t){if(c){if(":"==e)return C(de);if("?"==t)return C(ae)}}function se(e,t){if(c&&(":"==e||"in"==t))return C(de)}function le(e){if(c&&":"==e)return v.stream.match(/^\s*\w+\s+is\b/,!1)?C(N,ce,de):C(de)}function ce(e,t){if("is"==t)return v.marked="keyword",C()}function de(e,t){return"keyof"==t||"typeof"==t||"infer"==t?(v.marked="keyword",C("typeof"==t?W:de)):"variable"==e||"void"==t?(v.marked="type",C(pe)):"|"==t||"&"==t?C(de):"string"==e||"number"==e||"atom"==e?C(pe):"["==e?C(B("]"),oe(de,"]",","),I,pe):"{"==e?C(B("}"),oe(he,"}",",;"),I,pe):"("==e?C(oe(me,")"),ue,pe):"<"==e?C(oe(de,">"),de):void 0}function ue(e){if("=>"==e)return C(de)}function he(e,t){return"variable"==e||"keyword"==v.style?(v.marked="property",C(he)):"?"==t||"number"==e||"string"==e?C(he):":"==e?C(de):"["==e?C(j("variable"),se,j("]"),he):"("==e?w(Ee,he):void 0}function me(e,t){return"variable"==e&&v.stream.match(/^\s*[?:]/,!1)||"?"==t?C(me):":"==e?C(de):"spread"==e?C(me):w(de)}function pe(e,t){return"<"==t?C(B(">"),oe(de,">"),I,pe):"|"==t||"."==e||"&"==t?C(de):"["==e?C(de,j("]"),pe):"extends"==t||"implements"==t?(v.marked="keyword",C(de)):"?"==t?C(de,j(":"),de):void 0}function ge(e,t){if("<"==t)return C(B(">"),oe(de,">"),I,pe)}function fe(){return w(de,be)}function be(e,t){if("="==t)return C(de)}function _e(e,t){return"enum"==t?(v.marked="keyword",C(Ke)):w(xe,ae,ve,we)}function xe(e,t){return c&&L(t)?(v.marked="keyword",C(xe)):"variable"==e?(S(t),C()):"spread"==e?C(xe):"["==e?ie(ke,"]"):"{"==e?ie(ye,"}"):void 0}function ye(e,t){return"variable"!=e||v.stream.match(/^\s*:/,!1)?("variable"==e&&(v.marked="property"),"spread"==e?C(xe):"}"==e?w():"["==e?C(N,j("]"),j(":"),ye):C(j(":"),xe,ve)):(S(t),C(ve))}function ke(){return w(xe,ve)}function ve(e,t){if("="==t)return C(W)}function we(e){if(","==e)return C(_e)}function Ce(e,t){if("keyword b"==e&&"else"==t)return C(B("form","else"),O,I)}function Me(e,t){return"await"==t?C(Me):"("==e?C(B(")"),Se,I):void 0}function Se(e){return"var"==e?C(_e,Le):"variable"==e?C(Le):w(Le)}function Le(e,t){return")"==e?C():";"==e?C(Le):"in"==t||"of"==t?(v.marked="keyword",C(N,Le)):w(N,Le)}function Te(e,t){return"*"==t?(v.marked="keyword",C(Te)):"variable"==e?(S(t),C(Te)):"("==e?C(A,B(")"),oe(Ae,")"),I,le,O,R):c&&"<"==t?C(B(">"),oe(fe,">"),I,Te):void 0}function Ee(e,t){return"*"==t?(v.marked="keyword",C(Ee)):"variable"==e?(S(t),C(Ee)):"("==e?C(A,B(")"),oe(Ae,")"),I,le,R):c&&"<"==t?C(B(">"),oe(fe,">"),I,Ee):void 0}function Pe(e,t){return"keyword"==e||"variable"==e?(v.marked="type",C(Pe)):"<"==t?C(B(">"),oe(fe,">"),I):void 0}function Ae(e,t){return"@"==t&&C(N,Ae),"spread"==e?C(Ae):c&&L(t)?(v.marked="keyword",C(Ae)):c&&"this"==e?C(ae,ve):w(xe,ae,ve)}function ze(e,t){return"variable"==e?Re(e,t):Be(e,t)}function Re(e,t){if("variable"==e)return S(t),C(Be)}function Be(e,t){return"<"==t?C(B(">"),oe(fe,">"),I,Be):"extends"==t||"implements"==t||c&&","==e?("implements"==t&&(v.marked="keyword"),C(c?de:N,Be)):"{"==e?C(B("}"),Ie,I):void 0}function Ie(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||c&&L(t))&&v.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(v.marked="keyword",C(Ie)):"variable"==e||"keyword"==v.style?(v.marked="property",C(je,Ie)):"number"==e||"string"==e?C(je,Ie):"["==e?C(N,ae,j("]"),je,Ie):"*"==t?(v.marked="keyword",C(Ie)):c&&"("==e?w(Ee,Ie):";"==e||","==e?C(Ie):"}"==e?C():"@"==t?C(N,Ie):void 0}function je(e,t){if("?"==t)return C(je);if(":"==e)return C(de,ve);if("="==t)return C(W);var r=v.state.lexical.prev;return w(r&&"interface"==r.info?Ee:Te)}function Oe(e,t){return"*"==t?(v.marked="keyword",C(De,j(";"))):"default"==t?(v.marked="keyword",C(N,j(";"))):"{"==e?C(oe(qe,"}"),De,j(";")):w(O)}function qe(e,t){return"as"==t?(v.marked="keyword",C(j("variable"))):"variable"==e?w(W,qe):void 0}function Ne(e){return"string"==e?C():"("==e?w(N):w(We,He,De)}function We(e,t){return"{"==e?ie(We,"}"):("variable"==e&&S(t),"*"==t&&(v.marked="keyword"),C(Fe))}function He(e){if(","==e)return C(We,He)}function Fe(e,t){if("as"==t)return v.marked="keyword",C(We)}function De(e,t){if("from"==t)return v.marked="keyword",C(N)}function Ue(e){return"]"==e?C():w(oe(W,"]"))}function Ke(){return w(B("form"),xe,j("{"),B("}"),oe(Ge,"}"),I,I)}function Ge(){return w(xe,ve)}function Ve(e,t,r){return t.tokenize==g&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(r||0)))}return R.lex=!0,I.lex=!0,{startState:function(e){var t={tokenize:g,lastType:"sof",cc:[],lexical:new y((e||0)-n,0,"block",!1),localVars:r.localVars,context:r.localVars&&new T(null,null,!1),indented:e||0};return r.globalVars&&"object"==typeof r.globalVars&&(t.globalVars=r.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),_(e,t)),t.tokenize!=f&&e.eatSpace())return null;var r=t.tokenize(e,t);return"comment"==o?r:(t.lastType="operator"!=o||"++"!=i&&"--"!=i?o:"incdec",function(e,t,r,o,i){var n=e.cc;for(v.state=e,v.stream=i,v.marked=null,v.cc=n,v.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;){if((n.length?n.pop():l?N:O)(r,o)){for(;n.length&&n[n.length-1].lex;)n.pop()();return v.marked?v.marked:"variable"==r&&k(e,o)?"variable-2":t}}}(t,r,o,i,e))},indent:function(t,o){if(t.tokenize==f)return e.Pass;if(t.tokenize!=g)return 0;var i,s=o&&o.charAt(0),l=t.lexical;if(!/^\s*else\b/.test(o))for(var c=t.cc.length-1;c>=0;--c){var d=t.cc[c];if(d==I)l=l.prev;else if(d!=Ce)break}for(;("stat"==l.type||"form"==l.type)&&("}"==s||(i=t.cc[t.cc.length-1])&&(i==U||i==K)&&!/^[,\.=+\-*:?[\(]/.test(o));)l=l.prev;a&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var u=l.type,m=s==u;return"vardef"==u?l.indented+("operator"==t.lastType||","==t.lastType?l.info.length+1:0):"form"==u&&"{"==s?l.indented:"form"==u?l.indented+n:"stat"==u?l.indented+(function(e,t){return"operator"==e.lastType||","==e.lastType||h.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}(t,o)?a||n:0):"switch"!=l.info||m||0==r.doubleIndentSwitch?l.align?l.column+(m?0:1):l.indented+(m?0:n):l.indented+(/^(?:case|default)\b/.test(o)?n:2*n)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:s,jsonMode:l,expressionAllowed:Ve,skipExpression:function(e){var t=e.cc[e.cc.length-1];t!=N&&t!=W||e.cc.pop()}}})),e.registerHelper("wordChars","javascript",/[\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){var t={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},r={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};e.defineMode("xml",(function(o,i){var n,a,s=o.indentUnit,l={},c=i.htmlMode?t:r;for(var d in c)l[d]=c[d];for(var d in i)l[d]=i[d];function u(e,t){function r(r){return t.tokenize=r,r(e,t)}var o=e.next();return"<"==o?e.eat("!")?e.eat("[")?e.match("CDATA[")?r(m("atom","]]>")):null:e.match("--")?r(m("comment","--\x3e")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),r(function e(t){return function(r,o){for(var i;null!=(i=r.next());){if("<"==i)return o.tokenize=e(t+1),o.tokenize(r,o);if(">"==i){if(1==t){o.tokenize=u;break}return o.tokenize=e(t-1),o.tokenize(r,o)}}return"meta"}}(1))):null:e.eat("?")?(e.eatWhile(/[\w\._\-]/),t.tokenize=m("meta","?>"),"meta"):(n=e.eat("/")?"closeTag":"openTag",t.tokenize=h,"tag bracket"):"&"==o?(e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"))?"atom":"error":(e.eatWhile(/[^&<]/),null)}function h(e,t){var r,o,i=e.next();if(">"==i||"/"==i&&e.eat(">"))return t.tokenize=u,n=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return n="equals",null;if("<"==i){t.tokenize=u,t.state=b,t.tagName=t.tagStart=null;var a=t.tokenize(e,t);return a?a+" tag error":"tag error"}return/[\'\"]/.test(i)?(t.tokenize=(r=i,(o=function(e,t){for(;!e.eol();)if(e.next()==r){t.tokenize=h;break}return"string"}).isInAttribute=!0,o),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function m(e,t){return function(r,o){for(;!r.eol();){if(r.match(t)){o.tokenize=u;break}r.next()}return e}}function p(e,t,r){this.prev=e.context,this.tagName=t,this.indent=e.indented,this.startOfLine=r,(l.doNotIndent.hasOwnProperty(t)||e.context&&e.context.noIndent)&&(this.noIndent=!0)}function g(e){e.context&&(e.context=e.context.prev)}function f(e,t){for(var r;;){if(!e.context)return;if(r=e.context.tagName,!l.contextGrabbers.hasOwnProperty(r)||!l.contextGrabbers[r].hasOwnProperty(t))return;g(e)}}function b(e,t,r){return"openTag"==e?(r.tagStart=t.column(),_):"closeTag"==e?x:b}function _(e,t,r){return"word"==e?(r.tagName=t.current(),a="tag",v):l.allowMissingTagName&&"endTag"==e?(a="tag bracket",v(e,t,r)):(a="error",_)}function x(e,t,r){if("word"==e){var o=t.current();return r.context&&r.context.tagName!=o&&l.implicitlyClosed.hasOwnProperty(r.context.tagName)&&g(r),r.context&&r.context.tagName==o||!1===l.matchClosing?(a="tag",y):(a="tag error",k)}return l.allowMissingTagName&&"endTag"==e?(a="tag bracket",y(e,t,r)):(a="error",k)}function y(e,t,r){return"endTag"!=e?(a="error",y):(g(r),b)}function k(e,t,r){return a="error",y(e,0,r)}function v(e,t,r){if("word"==e)return a="attribute",w;if("endTag"==e||"selfcloseTag"==e){var o=r.tagName,i=r.tagStart;return r.tagName=r.tagStart=null,"selfcloseTag"==e||l.autoSelfClosers.hasOwnProperty(o)?f(r,o):(f(r,o),r.context=new p(r,o,i==r.indented)),b}return a="error",v}function w(e,t,r){return"equals"==e?C:(l.allowMissing||(a="error"),v(e,0,r))}function C(e,t,r){return"string"==e?M:"word"==e&&l.allowUnquoted?(a="string",v):(a="error",v(e,0,r))}function M(e,t,r){return"string"==e?M:v(e,0,r)}return u.isInText=!0,{startState:function(e){var t={tokenize:u,state:b,indented:e||0,tagName:null,tagStart:null,context:null};return null!=e&&(t.baseIndent=e),t},token:function(e,t){if(!t.tagName&&e.sol()&&(t.indented=e.indentation()),e.eatSpace())return null;n=null;var r=t.tokenize(e,t);return(r||n)&&"comment"!=r&&(a=null,t.state=t.state(n||r,e,t),a&&(r="error"==a?r+" error":a)),r},indent:function(t,r,o){var i=t.context;if(t.tokenize.isInAttribute)return t.tagStart==t.indented?t.stringStartCol+1:t.indented+s;if(i&&i.noIndent)return e.Pass;if(t.tokenize!=h&&t.tokenize!=u)return o?o.match(/^(\s*)/)[0].length:0;if(t.tagName)return!1!==l.multilineTagIndentPastTag?t.tagStart+t.tagName.length+2:t.tagStart+s*(l.multilineTagIndentFactor||1);if(l.alignCDATA&&/<!\[CDATA\[/.test(r))return 0;var n=r&&/^<(\/)?([\w_:\.-]*)/.exec(r);if(n&&n[1])for(;i;){if(i.tagName==n[2]){i=i.prev;break}if(!l.implicitlyClosed.hasOwnProperty(i.tagName))break;i=i.prev}else if(n)for(;i;){var a=l.contextGrabbers[i.tagName];if(!a||!a.hasOwnProperty(n[2]))break;i=i.prev}for(;i&&i.prev&&!i.startOfLine;)i=i.prev;return i?i.indent+s:t.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:l.htmlMode?"html":"xml",helperType:l.htmlMode?"html":"xml",skipAttribute:function(e){e.state==C&&(e.state=v)},xmlCurrentTag:function(e){return e.tagName?{name:e.tagName,close:"closeTag"==e.type}:null},xmlCurrentContext:function(e){for(var t=[],r=e.context;r;r=r.prev)r.tagName&&t.push(r.tagName);return t.reverse()}}})),e.defineMIME("text/xml","xml"),e.defineMIME("application/xml","xml"),e.mimeModes.hasOwnProperty("text/html")||e.defineMIME("text/html",{name:"xml",htmlMode:!0})})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],e):e(CodeMirror)}((function(e){var t={script:[["lang",/(javascript|babel)/i,"javascript"],["type",/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i,"javascript"],["type",/./,"text/plain"],[null,null,"javascript"]],style:[["lang",/^css$/i,"css"],["type",/^(text\/)?(x-)?(stylesheet|css)$/i,"css"],["type",/./,"text/plain"],[null,null,"css"]]};var r={};function o(e,t){var o=e.match(function(e){var t=r[e];return t||(r[e]=new RegExp("\\s+"+e+"\\s*=\\s*('|\")?([^'\"]+)('|\")?\\s*"))}(t));return o?/^\s*(.*?)\s*$/.exec(o[2])[1]:""}function i(e,t){return new RegExp((t?"^":"")+"</s*"+e+"s*>","i")}function n(e,t){for(var r in e)for(var o=t[r]||(t[r]=[]),i=e[r],n=i.length-1;n>=0;n--)o.unshift(i[n])}e.defineMode("htmlmixed",(function(r,a){var s=e.getMode(r,{name:"xml",htmlMode:!0,multilineTagIndentFactor:a.multilineTagIndentFactor,multilineTagIndentPastTag:a.multilineTagIndentPastTag}),l={},c=a&&a.tags,d=a&&a.scriptTypes;if(n(t,l),c&&n(c,l),d)for(var u=d.length-1;u>=0;u--)l.script.unshift(["type",d[u].matches,d[u].mode]);function h(t,n){var a,c=s.token(t,n.htmlState),d=/\btag\b/.test(c);if(d&&!/[<>\s\/]/.test(t.current())&&(a=n.htmlState.tagName&&n.htmlState.tagName.toLowerCase())&&l.hasOwnProperty(a))n.inTag=a+" ";else if(n.inTag&&d&&/>$/.test(t.current())){var u=/^([\S]+) (.*)/.exec(n.inTag);n.inTag=null;var m=">"==t.current()&&function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(!i[0]||i[1].test(o(t,i[0])))return i[2]}}(l[u[1]],u[2]),p=e.getMode(r,m),g=i(u[1],!0),f=i(u[1],!1);n.token=function(e,t){return e.match(g,!1)?(t.token=h,t.localState=t.localMode=null,null):function(e,t,r){var o=e.current(),i=o.search(t);return i>-1?e.backUp(o.length-i):o.match(/<\/?$/)&&(e.backUp(o.length),e.match(t,!1)||e.match(o)),r}(e,f,t.localMode.token(e,t.localState))},n.localMode=p,n.localState=e.startState(p,s.indent(n.htmlState,"",""))}else n.inTag&&(n.inTag+=t.current(),t.eol()&&(n.inTag+=" "));return c}return{startState:function(){return{token:h,inTag:null,localMode:null,localState:null,htmlState:e.startState(s)}},copyState:function(t){var r;return t.localState&&(r=e.copyState(t.localMode,t.localState)),{token:t.token,inTag:t.inTag,localMode:t.localMode,localState:r,htmlState:e.copyState(s,t.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(t,r,o){return!t.localMode||/^\s*<\//.test(r)?s.indent(t.htmlState,r,o):t.localMode.indent?t.localMode.indent(t.localState,r,o):e.Pass},innerMode:function(e){return{state:e.localState||e.htmlState,mode:e.localMode||s}}}}),"xml","javascript","css"),e.defineMIME("text/html","htmlmixed")})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/multiplex")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/multiplex"],e):e(CodeMirror)}((function(e){e.defineMode("htmlembedded",(function(t,r){var o=r.closeComment||"--%>";return e.multiplexingMode(e.getMode(t,"htmlmixed"),{open:r.openComment||"<%--",close:o,delimStyle:"comment",mode:{token:function(e){return e.skipTo(o)||e.skipToEnd(),"comment"}}},{open:r.open||r.scriptStartRegex||"<%",close:r.close||r.scriptEndRegex||"%>",mode:e.getMode(t,r.scriptingModeSpec)})}),"htmlmixed"),e.defineMIME("application/x-ejs",{name:"htmlembedded",scriptingModeSpec:"javascript"}),e.defineMIME("application/x-aspx",{name:"htmlembedded",scriptingModeSpec:"text/x-csharp"}),e.defineMIME("application/x-jsp",{name:"htmlembedded",scriptingModeSpec:"text/x-java"}),e.defineMIME("application/x-erb",{name:"htmlembedded",scriptingModeSpec:"ruby"})})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../../addon/mode/simple")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../addon/mode/simple"],e):e(CodeMirror)}((function(e){e.defineSimpleMode("wast",{start:[{regex:/[+\-]?(?:nan(?::0x[0-9a-fA-F]+)?|infinity|inf|0x[0-9a-fA-F]+\.?[0-9a-fA-F]*p[+\/-]?\d+|\d+(?:\.\d*)?[eE][+\-]?\d*|\d+\.\d*|0x[0-9a-fA-F]+|\d+)/,token:"number"},{regex:/mut|nop|block|if|then|else|loop|br_if|br_table|br|call(_indirect)?|drop|end|return(_call(_indirect)?)?|local\.(get|set|tee)|global\.(get|set)|i(32|64)\.(store(8|16)|(load(8|16)_[su]))|i64\.(load32_[su]|store32)|[fi](32|64)\.(const|load|store)|f(32|64)\.(abs|add|ceil|copysign|div|eq|floor|[gl][et]|max|min|mul|nearest|neg?|sqrt|sub|trunc)|i(32|64)\.(a[dn]d|c[lt]z|(div|rem)_[su]|eqz?|[gl][te]_[su]|mul|ne|popcnt|rot[lr]|sh(l|r_[su])|sub|x?or)|i64\.extend_[su]_i32|i32\.wrap_i64|i(32|64)\.trunc_f(32|64)_[su]|f(32|64)\.convert_i(32|64)_[su]|f64\.promote_f32|f32\.demote_f64|f32\.reinterpret_i32|i32\.reinterpret_f32|f64\.reinterpret_i64|i64\.reinterpret_f64|select|unreachable|current_memory|memory(\.((atomic\.(notify|wait(32|64)))|grow|size))?|type|func|param|result|local|global|module|table|start|elem|data|align|offset|import|export|i64\.atomic\.(load32_u|store32|rmw32\.(a[dn]d|sub|x?or|(cmp)?xchg)_u)|i(32|64)\.atomic\.(load((8|16)_u)?|store(8|16)?|rmw(\.(a[dn]d|sub|x?or|(cmp)?xchg)|(8|16)\.(a[dn]d|sub|x?or|(cmp)?xchg)_u))|v128\.(load|store|const|not|andnot|and|or|xor|bitselect)|i(8x16|16x8|32x4|64x2)\.(shl|shr_[su])|i(8x16|16x8)\.(extract_lane_[su]|((add|sub)_saturate_[su])|avgr_u)|(i(8x16|16x8|32x4|64x2)|f(32x4|64x2))\.(splat|replace_lane|neg|add|sub)|i(8x16|16x8|32x4)\.(eq|ne|([lg][te]_[su])|abs|any_true|all_true|bitmask|((min|max)_[su]))|f(32x4|64x2)\.(eq|ne|[lg][te]|abs|sqrt|mul|div|min|max)|[fi](32x4|64x2)\.extract_lane|v8x16\.(shuffle|swizzle)|i16x8\.(load8x8_[su]|narrow_i32x4_[su]|widen_(low|high)_i8x16_[su]|mul)|i32x4\.(load16x4_[su]|widen_(low|high)_i16x8_[su]|mul|trunc_sat_f32x4_[su])|i64x2\.(load32x2_[su]|mul)|(v(8x16|16x8|32x4|64x2)\.load_splat)|i8x16\.narrow_i16x8_[su]|f32x4\.convert_i32x4_[su]/,token:"keyword"},{regex:/\b(anyfunc|[fi](32|64))\b/,token:"atom"},{regex:/\$([a-zA-Z0-9_`\+\-\*\/\\\^~=<>!\?@#$%&|:\.]+)/,token:"variable-2"},{regex:/"(?:[^"\\\x00-\x1f\x7f]|\\[nt\\'"]|\\[0-9a-fA-F][0-9a-fA-F])*"/,token:"string"},{regex:/\(;.*?/,token:"comment",next:"comment"},{regex:/;;.*$/,token:"comment"},{regex:/\(/,indent:!0},{regex:/\)/,dedent:!0}],comment:[{regex:/.*?;\)/,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"]}}),e.defineMIME("text/webassembly","wast")}));var _=Object.freeze({__proto__:null,toPos:g,toRange:f,changeObjectToEditOperation:b,pullLines:function(e,t){const r=[];return e.eachLine(0,t,(function(e){r.push(e.text)})),r},TokenizerFactory:class{createTokenizer(e){const t=CodeMirror.getMode({indentUnit:2},e),r=CodeMirror.startState(t);return function(e,o){const i=new CodeMirror.StringStream(e);for(;!i.eol();){const e=t.token(i,r),n=i.current();o(n,e,i.start,i.start+n.length),i.start=i.pos}}}}});class x{constructor(e,t,r){this._textEditor=e,this._codeMirror=t,this._config=r,this._initialized=!1,this._onScroll=this._onScroll.bind(this),this._onCursorActivity=this._onCursorActivity.bind(this),this._changes=this._changes.bind(this),this._blur=this._blur.bind(this),this._beforeChange=this._beforeChange.bind(this),this._mouseDown=()=>{this.clearAutocomplete(),this._tooltipGlassPane.hide()},this._codeMirror.on("changes",this._changes),this._lastHintText="",this._suggestBox=null,this._currentSuggestion=null,this._hintElement=document.createElement("span"),this._hintElement.classList.add("auto-complete-text"),this._tooltipGlassPane=new l.GlassPane,this._tooltipGlassPane.setSizeBehavior(l.SizeBehavior.MeasureContent),this._tooltipGlassPane.setOutsideClickCallback(this._tooltipGlassPane.hide.bind(this._tooltipGlassPane)),this._tooltipElement=document.createElement("div"),this._tooltipElement.classList.add("autocomplete-tooltip");c.createShadowRootWithCoreStyles(this._tooltipGlassPane.contentElement,{cssFile:"text_editor/autocompleteTooltip.css",enableLegacyPatching:!0,delegatesFocus:void 0}).appendChild(this._tooltipElement)}_initializeIfNeeded(){this._initialized||(this._initialized=!0,this._codeMirror.on("scroll",this._onScroll),this._codeMirror.on("cursorActivity",this._onCursorActivity),this._codeMirror.on("mousedown",this._mouseDown),this._codeMirror.on("blur",this._blur),this._config.isWordChar&&(this._codeMirror.on("beforeChange",this._beforeChange),this._dictionary=new e.TextDictionary,this._addWordsFromText(this._codeMirror.getValue())))}dispose(){this._codeMirror.off("changes",this._changes),this._initialized&&(this._codeMirror.off("scroll",this._onScroll),this._codeMirror.off("cursorActivity",this._onCursorActivity),this._codeMirror.off("mousedown",this._mouseDown),this._codeMirror.off("blur",this._blur)),this._dictionary&&(this._codeMirror.off("beforeChange",this._beforeChange),this._dictionary.reset())}_beforeChange(e,t){this._updatedLines=this._updatedLines||{};for(let e=t.from.line;e<=t.to.line;++e)void 0===this._updatedLines[e]&&(this._updatedLines[e]=this._codeMirror.getLine(e))}_addWordsFromText(e){s.Utils.textToWords(e,this._config.isWordChar,function(e){e.length&&(e[0]<"0"||e[0]>"9")&&this._dictionary.addWord(e)}.bind(this))}_removeWordsFromText(e){s.Utils.textToWords(e,this._config.isWordChar,e=>this._dictionary.removeWord(e))}_substituteRange(e,t){let r=this._config.substituteRangeCallback?this._config.substituteRangeCallback(e,t):null;return!r&&this._config.isWordChar&&(r=this._textEditor.wordRangeForCursorPosition(e,t,this._config.isWordChar)),r}_wordsWithQuery(e,t,r){const o=this._config.suggestionsCallback?this._config.suggestionsCallback(e,t,r):null;if(o)return o;if(!this._dictionary||!r&&e.isEmpty())return Promise.resolve([]);let i=this._dictionary.wordsWithPrefix(this._textEditor.text(e));const n=this._textEditor.text(t);return 1===this._dictionary.wordCount(n)&&(i=i.filter(e=>e!==n)),i.sort((e,t)=>this._dictionary.wordCount(t)-this._dictionary.wordCount(e)||e.length-t.length),Promise.resolve(i.map(e=>({text:e})))}_changes(e,t){if(!t.length)return;if(this._dictionary&&this._updatedLines){for(const e in this._updatedLines)this._removeWordsFromText(this._updatedLines[e]);delete this._updatedLines;const e={};for(let r=0;r<t.length;++r){const o=b(t[r]);for(let t=o.newRange.startLine;t<=o.newRange.endLine;++t)e[t]=this._codeMirror.getLine(t)}for(const t in e)this._addWordsFromText(e[t])}let r=!1,o=!1;const i=this._codeMirror.getCursor("head");for(let e=0;e<t.length;++e){const n=t[e];if("+input"===n.origin&&1===n.text.length&&1===n.text[0].length&&n.to.line===i.line&&n.to.ch+1===i.ch){r=!0;break}if("+delete"===n.origin&&1===n.removed.length&&1===n.removed[0].length&&n.to.line===i.line&&n.to.ch-1===i.ch){o=!0;break}}this._queryRange&&(r?this._queryRange.endColumn++:o&&this._queryRange.endColumn--,(o||r)&&this._setHint(this._lastHintText)),r||o?setImmediate(this.autocomplete.bind(this)):this.clearAutocomplete()}_blur(){this.clearAutocomplete()}_validateSelectionsContexts(e){const t=this._codeMirror.listSelections();if(t.length<=1)return!0;const r=this._textEditor.text(e);for(let e=0;e<t.length;++e){const o=this._substituteRange(t[e].head.line,t[e].head.ch);if(!o)return!1;if(this._textEditor.text(o)!==r)return!1}return!0}autocomplete(e){if(this._initializeIfNeeded(),this._codeMirror.somethingSelected())return void this._hideSuggestBox();const t=this._codeMirror.getCursor("head"),r=this._substituteRange(t.line,t.ch);if(!r||!this._validateSelectionsContexts(r))return void this._hideSuggestBox();const o=r.clone();o.endColumn=t.ch;const i=this._textEditor.text(o);let n=!1;this._suggestBox&&(n=!0),this._wordsWithQuery(o,r,e).then(function(e){if(!e.length||1===e.length&&i===e[0].text||!this._suggestBox&&n)return this._hideSuggestBox(),void this._onSuggestionsShownForTest([]);this._suggestBox||(this._suggestBox=new d.SuggestBox(this,20),this._config.anchorBehavior&&this._suggestBox.setAnchorBehavior(this._config.anchorBehavior));const t=this._queryRange;this._queryRange=o,t&&o.startLine===t.startLine&&o.startColumn===t.startColumn||this._updateAnchorBox();this._suggestBox.updateSuggestions(this._anchorBox,e,!0,!this._isCursorAtEndOfLine(),i),this._suggestBox.visible&&this._tooltipGlassPane.hide();this._onSuggestionsShownForTest(e)}.bind(this))}_setHint(e){const t=this._textEditor.text(this._queryRange);if(!e||!this._isCursorAtEndOfLine()||!e.startsWith(t))return void this._clearHint();const r=e.substring(t.length).split("\n")[0];this._hintElement.textContent=r.trimEndWithMaxLength(1e4);const o=this._codeMirror.getCursor("to");if(this._hintMarker){const e=this._hintMarker.position();e&&e.equal(a.TextRange.createFromLocation(o.line,o.ch))||(this._hintMarker.clear(),this._hintMarker=null)}this._hintMarker?this._lastHintText!==e&&this._hintMarker.refresh():this._hintMarker=this._textEditor.addBookmark(o.line,o.ch,this._hintElement,x.HintBookmark,!0),this._lastHintText=e}_clearHint(){this._hintElement.textContent&&(this._lastHintText="",this._hintElement.textContent="",this._hintMarker&&this._hintMarker.refresh())}_onSuggestionsShownForTest(e){}_onSuggestionsHiddenForTest(){}clearAutocomplete(){this._tooltipGlassPane.hide(),this._hideSuggestBox()}_hideSuggestBox(){this._suggestBox&&(this._suggestBox.hide(),this._suggestBox=null,this._queryRange=null,this._anchorBox=null,this._currentSuggestion=null,this._textEditor.dispatchEventToListeners(u.Events.SuggestionChanged),this._clearHint(),this._onSuggestionsHiddenForTest())}keyDown(e){if(this._tooltipGlassPane.isShowing()&&e.keyCode===h.Keys.Esc.code)return this._tooltipGlassPane.hide(),!0;if(!this._suggestBox)return!1;switch(e.keyCode){case h.Keys.Tab.code:return this._suggestBox.acceptSuggestion(),this.clearAutocomplete(),!0;case h.Keys.End.code:case h.Keys.Right.code:return this._isCursorAtEndOfLine()?(this._suggestBox.acceptSuggestion(),this.clearAutocomplete(),!0):(this.clearAutocomplete(),!1);case h.Keys.Left.code:case h.Keys.Home.code:return this.clearAutocomplete(),!1;case h.Keys.Esc.code:return this.clearAutocomplete(),!0}return this._suggestBox.keyPressed(e)}_isCursorAtEndOfLine(){const e=this._codeMirror.getCursor("to");return e.ch===this._codeMirror.getLine(e.line).length}applySuggestion(e,t){const r=this._currentSuggestion;this._currentSuggestion=e,this._setHint(e?e.text:""),(r?r.text:"")!==(e?e.text:"")&&this._textEditor.dispatchEventToListeners(u.Events.SuggestionChanged)}acceptSuggestion(){const e=this._codeMirror.listSelections().slice(),t=this._queryRange.endColumn-this._queryRange.startColumn,r=this._currentSuggestion.text;this._codeMirror.operation(()=>{for(let o=e.length-1;o>=0;--o){const i=e[o].head,n=new CodeMirror.Pos(i.line,i.ch-t);this._codeMirror.replaceRange(r,i,n,"+autocomplete")}})}textWithCurrentSuggestion(){if(!this._queryRange||null===this._currentSuggestion)return this._codeMirror.getValue();const e=this._codeMirror.listSelections().slice();let t={line:0,column:0},r="";const o=this._queryRange.endColumn-this._queryRange.startColumn;for(const i of e){const e=new a.TextRange(t.line,t.column,i.head.line,i.head.ch-o);r+=this._textEditor.text(e),r+=this._currentSuggestion.text,t={line:i.head.line,column:i.head.ch}}const i=new a.TextRange(t.line,t.column,1/0,1/0);return r+=this._textEditor.text(i),r}_onScroll(){if(this._tooltipGlassPane.hide(),!this._suggestBox)return;const e=this._codeMirror.getCursor(),t=this._codeMirror.getScrollInfo(),r=this._codeMirror.lineAtHeight(t.top,"local"),o=this._codeMirror.lineAtHeight(t.top+t.clientHeight,"local");e.line<r||e.line>o?this.clearAutocomplete():(this._updateAnchorBox(),this._suggestBox.setPosition(this._anchorBox))}async _updateTooltip(){const e=this._codeMirror.getCursor(),t=this._config.tooltipCallback?await this._config.tooltipCallback(e.line,e.ch):null,r=this._codeMirror.getCursor();if(r.line!==e.line&&r.ch!==e.ch)return;if(this._suggestBox&&this._suggestBox.visible)return;if(!t)return void this._tooltipGlassPane.hide();const o=this._textEditor.cursorPositionToCoordinates(e.line,e.ch);o?(this._tooltipGlassPane.setContentAnchorBox(new AnchorBox(o.x,o.y,0,o.height)),this._tooltipElement.removeChildren(),this._tooltipElement.appendChild(t),this._tooltipGlassPane.show(this._textEditor.element.ownerDocument)):this._tooltipGlassPane.hide()}_onCursorActivity(){if(this._updateTooltip(),!this._suggestBox)return;const e=this._codeMirror.getCursor();let t=!(e.line===this._queryRange.startLine&&this._queryRange.startColumn<=e.ch&&e.ch<=this._queryRange.endColumn);if(e.line===this._queryRange.startLine&&e.ch===this._queryRange.endColumn+1){const r=this._codeMirror.getLine(e.line);t=!!this._config.isWordChar&&!this._config.isWordChar(r.charAt(e.ch-1))}t&&this.clearAutocomplete(),this._onCursorActivityHandledForTest()}_onCursorActivityHandledForTest(){}_updateAnchorBox(){const e=this._queryRange.startLine,t=this._queryRange.startColumn,r=this._textEditor.cursorPositionToCoordinates(e,t);this._anchorBox=r?new AnchorBox(r.x,r.y,0,r.height):null}}x.HintBookmark=Symbol("hint");var y=Object.freeze({__proto__:null,TextEditorAutocompleteController:x});class k extends m.VBox{constructor(e){super(),this._options=e,this.registerRequiredCSS("cm/codemirror.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("text_editor/cmdevtools.css",{enableLegacyPatching:!0});const{indentWithTabs:i,indentUnit:n}=k._getIndentation(t.Settings.instance().moduleSetting("textEditorIndent").get());this._codeMirror=new CodeMirror(this.element,{screenReaderLabel:e.devtoolsAccessibleName||ls`Code editor`,lineNumbers:e.lineNumbers,matchBrackets:!0,smartIndent:!0,styleSelectedText:!0,electricChars:!0,styleActiveLine:!0,indentUnit:n,indentWithTabs:i,lineWrapping:e.lineWrapping,lineWiseCopyCut:e.lineWiseCopyCut||!1,tabIndex:0,pollInterval:Math.pow(2,31)-1,inputStyle:e.inputStyle||"devToolsAccessibleTextArea"}),this._codeMirrorElement=this.element.lastElementChild,this._codeMirror._codeMirrorTextEditor=this,t.Settings.instance().moduleSetting("textEditorIndent").addChangeListener(this._updateIndentSize.bind(this)),CodeMirror.keyMap["devtools-common"]={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goSmartPageUp",PageDown:"goSmartPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"UserIndent","Shift-Tab":"indentLessOrPass",Enter:"newlineAndIndent","Ctrl-Space":"autocomplete",Esc:"dismiss","Ctrl-M":"gotoMatchingBracket"},CodeMirror.keyMap["devtools-pc"]={"Ctrl-A":"selectAll","Ctrl-Z":"undoAndReveal","Shift-Ctrl-Z":"redoAndReveal","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"moveCamelLeft","Alt-Right":"moveCamelRight","Shift-Alt-Left":"selectCamelLeft","Shift-Alt-Right":"selectCamelRight","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-/":"toggleComment","Ctrl-D":"selectNextOccurrence","Ctrl-U":"undoLastSelection",fallthrough:"devtools-common"},CodeMirror.keyMap["devtools-mac"]={"Cmd-A":"selectAll","Cmd-Z":"undoAndReveal","Shift-Cmd-Z":"redoAndReveal","Cmd-Up":"goDocStart","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Ctrl-Left":"moveCamelLeft","Ctrl-Right":"moveCamelRight","Ctrl-A":"goLineLeft","Ctrl-E":"goLineRight","Ctrl-B":"goCharLeft","Ctrl-F":"goCharRight","Ctrl-Alt-B":"goGroupLeft","Ctrl-Alt-F":"goGroupRight","Ctrl-H":"delCharBefore","Ctrl-D":"delCharAfter","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Shift-Ctrl-Left":"selectCamelLeft","Shift-Ctrl-Right":"selectCamelRight","Cmd-Left":"goLineStartSmart","Cmd-Right":"goLineEnd","Cmd-Backspace":"delLineLeft","Alt-Backspace":"delGroupBefore","Alt-Delete":"delGroupAfter","Cmd-/":"toggleComment","Cmd-D":"selectNextOccurrence","Cmd-U":"undoLastSelection",fallthrough:"devtools-common"},e.bracketMatchingSetting&&e.bracketMatchingSetting.addChangeListener(this._enableBracketMatchingIfNeeded,this),this._enableBracketMatchingIfNeeded(),this._codeMirror.setOption("keyMap",r.isMac()?"devtools-mac":"devtools-pc"),this._codeMirror.setOption("flattenSpans",!1);let a=e.maxHighlightLength;"number"!=typeof a&&(a=k.maxHighlightLength),this._codeMirror.setOption("maxHighlightLength",a),this._codeMirror.setOption("mode",null),this._codeMirror.setOption("crudeMeasuringFrom",1e3),this._shouldClearHistory=!0,this._lineSeparator="\n",k._fixWordMovement(this._codeMirror),this._selectNextOccurrenceController=new w(this,this._codeMirror),this._codeMirror.on("changes",this._changes.bind(this)),this._codeMirror.on("beforeSelectionChange",this._beforeSelectionChange.bind(this)),this._codeMirror.on("cursorActivity",()=>{this.dispatchEventToListeners(u.Events.CursorChanged)}),this.element.style.overflow="hidden",this._codeMirrorElement.classList.add("source-code"),this._codeMirrorElement.classList.add("fill"),this._decorations=new o,this.element.addEventListener("keydown",this._handleKeyDown.bind(this),!0),this.element.addEventListener("keydown",this._handlePostKeyDown.bind(this),!1),this._needsRefresh=!0,this._readOnly=!1,this._mimeType="",e.mimeType&&this.setMimeType(e.mimeType),e.autoHeight&&this._codeMirror.setSize(null,"auto"),this._placeholderElement=null,e.placeholder&&(this._placeholderElement=createElement("pre"),this._placeholderElement.classList.add("placeholder-text"),this._placeholderElement.classList.add("CodeMirror-line-like"),this._placeholderElement.textContent=e.placeholder,this._updatePlaceholder())}static autocompleteCommand(e){const t=e._codeMirrorTextEditor._autocompleteController;t&&t.autocomplete(!0)}static undoLastSelectionCommand(e){e._codeMirrorTextEditor._selectNextOccurrenceController.undoLastSelection()}static selectNextOccurrenceCommand(e){e._codeMirrorTextEditor._selectNextOccurrenceController.selectNextOccurrence()}static moveCamelLeftCommand(e,t){t._codeMirrorTextEditor._doCamelCaseMovement(-1,e)}static moveCamelRightCommand(e,t){t._codeMirrorTextEditor._doCamelCaseMovement(1,e)}static _getIndentation(e){const t=/\t/.test(e);return{indentWithTabs:t,indentUnit:t?4:e.length}}static _overrideModeWithPrefixedTokens(e,t){const r=e+"-old";function o(e,r,o){const i=e(r,o);return i?t+i.split(/ +/).join(" "+t):i}CodeMirror.modes[r]||(CodeMirror.defineMode(r,CodeMirror.modes[e]),CodeMirror.defineMode(e,(function(t,i){const n={};for(const e in i)n[e]=i[e];n.name=r;const a=CodeMirror.getMode(t,n);return a.name=e,a.token=o.bind(null,a.token),a})))}static _collectUninstalledModes(e){const t=C,r=new Map,o=n.Runtime.instance().extensions(M);for(const e of o)r.set(e.descriptor().fileName,e);const i=new Set;for(const n of o){const o=n.descriptor();if(t.has(n)||-1===o.mimeTypes.indexOf(e))continue;i.add(n);const a=o.dependencies||[];for(let e=0;e<a.length;++e){const o=r.get(a[e]);o&&!t.has(o)&&i.add(o)}}return Array.from(i)}static _installMimeTypeModes(e){const t=e.map(e=>e.instance().then(r.bind(null,e)));return Promise.all(t);function r(e,t){if(C.has(e))return;t.install(e),C.add(e)}}static _fixWordMovement(e){function t(e,t){t.setExtending(e);const r=t.getCursor("head");t.execCommand("goGroupLeft");const o=t.getCursor("head");if(0===o.ch&&0!==o.line)return void t.setExtending(!1);const i=t.getRange(o,r,"#");/^\s+$/.test(i)&&t.execCommand("goGroupLeft"),t.setExtending(!1)}function o(e,t){t.setExtending(e);const r=t.getCursor("head");t.execCommand("goGroupRight");const o=t.getCursor("head");if(0===o.ch&&0!==o.line)return void t.setExtending(!1);const i=t.getRange(r,o,"#");/^\s+$/.test(i)&&t.execCommand("goGroupRight"),t.setExtending(!1)}const i=r.isMac()?"Alt":"Ctrl",n=i+"-Left",a=i+"-Right",s={};s[n]=t.bind(null,!1),s[a]=o.bind(null,!1),s["Shift-"+n]=t.bind(null,!0),s["Shift-"+a]=o.bind(null,!0),e.addKeyMap(s)}codeMirror(){return this._codeMirror}widget(){return this}setPlaceholder(e){this._placeholderElement||(this._placeholderElement=createElement("pre"),this._placeholderElement.classList.add("placeholder-text"),this._placeholderElement.classList.add("CodeMirror-line-like")),this._placeholderElement.textContent=e||"",this._updatePlaceholder()}_normalizePositionForOverlappingColumn(e,t,r){const o=this._codeMirror.lineCount();let n=r;return r<0&&e>0?(--e,n=this.line(e).length):r>=t&&e<o-1?(++e,n=0):n=i.clamp(r,0,t),{lineNumber:e,columnNumber:n}}_camelCaseMoveFromPosition(e,t,r){function o(e,t){return e>=0&&e<t}function n(e,t){const r=t,i=t+1;return o(r,e.length)&&o(i,e.length)&&s.Utils.isWordChar(e[r])&&s.Utils.isWordChar(e[i])&&s.Utils.isUpperCase(e[r])&&s.Utils.isLowerCase(e[i])}function a(e,t){const r=t,i=t-1;return o(r,e.length)&&o(i,e.length)&&s.Utils.isWordChar(e[r])&&s.Utils.isWordChar(e[i])&&s.Utils.isUpperCase(e[r])&&s.Utils.isLowerCase(e[i])}function l(e,t,r){return{lineNumber:e,columnNumber:i.clamp(r,0,t)}}const c=this.line(e),d=c.length;if(t===d&&1===r||0===t&&-1===r)return this._normalizePositionForOverlappingColumn(e,d,t+r);let u=1===r?t:t-1;for(;o(u,d)&&s.Utils.isSpaceChar(c[u]);)u+=r;if(!o(u,d))return l(e,d,u);if(s.Utils.isStopChar(c[u])){for(;o(u,d)&&s.Utils.isStopChar(c[u]);)u+=r;return o(u,d)?{lineNumber:e,columnNumber:-1===r?u+1:u}:l(e,d,u)}for(u+=r;o(u,d)&&!n(c,u)&&!a(c,u)&&s.Utils.isWordChar(c[u]);)u+=r;return o(u,d)?n(c,u)||a(c,u)?{lineNumber:e,columnNumber:u}:{lineNumber:e,columnNumber:-1===r?u+1:u}:l(e,d,u)}_doCamelCaseMovement(e,t){const r=this.selections();for(let o=0;o<r.length;++o){const i=r[o],n=this._camelCaseMoveFromPosition(i.endLine,i.endColumn,e);i.endLine=n.lineNumber,i.endColumn=n.columnNumber,t||(r[o]=i.collapseToEnd())}this.setSelections(r)}dispose(){this._options.bracketMatchingSetting&&this._options.bracketMatchingSetting.removeChangeListener(this._enableBracketMatchingIfNeeded,this)}_enableBracketMatchingIfNeeded(){this._codeMirror.setOption("autoCloseBrackets",!(!this._options.bracketMatchingSetting||!this._options.bracketMatchingSetting.get())&&{explode:!1})}wasShown(){this._needsRefresh&&this.refresh()}refresh(){if(this.isShowing())return this._codeMirror.refresh(),void(this._needsRefresh=!1);this._needsRefresh=!0}willHide(){delete this._editorSizeInSync}undo(){this._codeMirror.undo()}redo(){this._codeMirror.redo()}_handleKeyDown(e){"Tab"===e.key&&t.Settings.instance().moduleSetting("textEditorTabMovesFocus").get()?e.consume(!1):this._autocompleteController&&this._autocompleteController.keyDown(e)&&e.consume(!0)}_handlePostKeyDown(e){e.defaultPrevented&&e.consume(!0)}configureAutocomplete(e){this._autocompleteController&&(this._autocompleteController.dispose(),delete this._autocompleteController),e&&(this._autocompleteController=new x(this,this._codeMirror,e))}cursorPositionToCoordinates(e,t){if(e>=this._codeMirror.lineCount()||e<0||t<0||t>this._codeMirror.getLine(e).length)return null;const r=this._codeMirror.cursorCoords(new CodeMirror.Pos(e,t));return{x:r.left,y:r.top,height:r.bottom-r.top}}coordinatesToCursorPosition(e,t){const r=this.element.ownerDocument.elementFromPoint(e,t);if(!r||!r.isSelfOrDescendant(this._codeMirror.getWrapperElement()))return null;const o=this._codeMirror.getGutterElement().boxInWindow();if(e>=o.x&&e<=o.x+o.width&&t>=o.y&&t<=o.y+o.height)return null;const i=this._codeMirror.coordsChar({left:e,top:t});return f(i,i)}visualCoordinates(e,t){const r=this._codeMirror.cursorCoords(new CodeMirror.Pos(e,t));return{x:r.left,y:r.top}}tokenAtTextPosition(e,t){if(e<0||e>=this._codeMirror.lineCount())return null;const r=this._codeMirror.getTokenAt(new CodeMirror.Pos(e,(t||0)+1));return r?{startColumn:r.start,endColumn:r.end,type:r.type}:null}isClean(e){return this._codeMirror.isClean(e)}markClean(){return this._codeMirror.changeGeneration(!0)}_hasLongLines(){let e=!1;return this._codeMirror.eachLine((function(t){return t.text.length>k.LongLineModeLineLengthThreshold&&(e=!0),e})),e}_enableLongLinesMode(){this._codeMirror.setOption("styleSelectedText",!1)}_disableLongLinesMode(){this._codeMirror.setOption("styleSelectedText",!0)}_updateIndentSize(e){const{indentWithTabs:t,indentUnit:r}=k._getIndentation(e.data);this._codeMirror.setOption("indentUnit",r),this._codeMirror.setOption("indentWithTabs",t)}setMimeType(e){this._mimeType=e;const t=k._collectUninstalledModes(e);function r(){const t=this.rewriteMimeType(e);this._codeMirror.options.mode!==t&&this._codeMirror.setOption("mode",t)}t.length?k._installMimeTypeModes(t).then(r.bind(this)):r.call(this)}setHighlightMode(e){this._mimeType="",this._codeMirror.setOption("mode",e)}rewriteMimeType(e){return e}mimeType(){return this._mimeType}setReadOnly(e){this._readOnly!==e&&(this.clearPositionHighlight(),this._readOnly=e,this.element.classList.toggle("CodeMirror-readonly",e),this._codeMirror.setOption("readOnly",e))}readOnly(){return!!this._codeMirror.getOption("readOnly")}setLineNumberFormatter(e){this._codeMirror.setOption("lineNumberFormatter",e)}addKeyDownHandler(e){this._codeMirror.on("keydown",(t,r)=>e(r))}addBookmark(e,t,r,o,i){const n=new S(this._codeMirror.setBookmark(new CodeMirror.Pos(e,t),{widget:r,insertLeft:i}),o,this);return this._updateDecorations(e),n}bookmarks(e,t){const r=g(e);let o=this._codeMirror.findMarksAt(r.start);if(!e.isEmpty()){const e=this._codeMirror.findMarks(r.start,r.end),t=this._codeMirror.findMarksAt(r.end);o=o.concat(e,t)}const i=[];for(let e=0;e<o.length;e++){const r=o[e][S._symbol];!r||t&&r.type()!==t||i.push(r)}return i}focus(){this._codeMirror.focus()}hasFocus(){return this._codeMirror.hasFocus()}operation(e){this._codeMirror.operation(e)}scrollLineIntoView(e){this._innerRevealLine(e,this._codeMirror.getScrollInfo())}_innerRevealLine(e,t){const r=this._codeMirror.lineAtHeight(t.top,"local"),o=this._codeMirror.lineAtHeight(t.top+t.clientHeight,"local"),i=o-r+1;if(e<r){const t=0|Math.max(e-i/2+1,0);this._codeMirror.scrollIntoView(new CodeMirror.Pos(t,0))}else if(e>o){const t=0|Math.min(e+i/2-1,this.linesCount-1);this._codeMirror.scrollIntoView(new CodeMirror.Pos(t,0))}}addDecoration(e,t,r,o){const i=this._codeMirror.addLineWidget(t,e);let n=null;void 0!==r&&(void 0===o&&(o=1/0),n=this._updateFloatingDecoration.bind(this,e,t,r,o),n()),this._decorations.set(t,{element:e,update:n,widget:i})}_updateFloatingDecoration(e,t,r,o){const i=this._codeMirror.cursorCoords(new CodeMirror.Pos(t,0),"page"),n=this._codeMirror.cursorCoords(new CodeMirror.Pos(t,r),"page"),a=this._codeMirror.charCoords(new CodeMirror.Pos(t,o),"page");e.style.width=a.right-n.left+"px",e.style.left=n.left-i.left+"px"}_updateDecorations(e){this._decorations.get(e).forEach((function(e){e.update&&e.update()}))}removeDecoration(e,t){this._decorations.get(t).forEach(function(r){if(r.element!==e)return;this._codeMirror.removeLineWidget(r.widget),this._decorations.delete(t,r)}.bind(this))}revealPosition(e,t,r){e=i.clamp(e,0,this._codeMirror.lineCount()-1),"number"!=typeof t&&(t=0),t=i.clamp(t,0,this._codeMirror.getLine(e).length),this.clearPositionHighlight(),this._highlightedLine=this._codeMirror.getLineHandle(e),this._highlightedLine&&(this.scrollLineIntoView(e),r&&(this._codeMirror.addLineClass(this._highlightedLine,null,this._readOnly?"cm-readonly-highlight":"cm-highlight"),this._readOnly||(this._clearHighlightTimeout=setTimeout(this.clearPositionHighlight.bind(this),2e3))),this.setSelection(a.TextRange.createFromLocation(e,t)))}clearPositionHighlight(){this._clearHighlightTimeout&&clearTimeout(this._clearHighlightTimeout),delete this._clearHighlightTimeout,this._highlightedLine&&this._codeMirror.removeLineClass(this._highlightedLine,null,this._readOnly?"cm-readonly-highlight":"cm-highlight"),delete this._highlightedLine}elementsToRestoreScrollPositionsFor(){return[]}_updatePaddingBottom(e,t){let r=0;const o=this._codeMirrorElement.getElementsByClassName("CodeMirror-lines")[0];if(this._options.padBottom){const e=this._codeMirror.getScrollInfo();this._codeMirror.lineCount()>1&&(r=Math.max(e.clientHeight-this._codeMirror.getLineHandle(this._codeMirror.lastLine()).height,0))}r+="px",o.style.paddingBottom!==r&&(o.style.paddingBottom=r,this._codeMirror.setSize(e,t))}toggleScrollPastEof(e){this._options.padBottom!==e&&(this._options.padBottom=e,this._resizeEditor())}_resizeEditor(){const e=this.element.parentElement;e&&this.isShowing()&&this._codeMirror.operation(()=>{const t=this._codeMirror.doc.scrollLeft,r=this._codeMirror.doc.scrollTop,o=e.offsetWidth,i=e.offsetHeight-this.element.offsetTop;this._options.autoHeight?this._codeMirror.setSize(o,"auto"):(this._codeMirror.setSize(o,i),this._updatePaddingBottom(o,i)),this._codeMirror.scrollTo(t,r)})}onResize(){this._autocompleteController&&this._autocompleteController.clearAutocomplete(),this._resizeEditor(),this._editorSizeInSync=!0,this._selectionSetScheduled&&(delete this._selectionSetScheduled,this.setSelection(this._lastSelection))}editRange(e,t,r){const o=g(e);this._codeMirror.replaceRange(t,o.start,o.end,r);const i=f(o.start,this._codeMirror.posFromIndex(this._codeMirror.indexFromPos(o.start)+t.length));return this.dispatchEventToListeners(u.Events.TextChanged,{oldRange:e,newRange:i}),i}clearAutocomplete(){this._autocompleteController&&this._autocompleteController.clearAutocomplete()}wordRangeForCursorPosition(e,t,r){const o=this.line(e);let i=t;if(0!==t&&r(o.charAt(t-1)))for(i=t-1;i>0&&r(o.charAt(i-1));)--i;let n=t;for(;n<o.length&&r(o.charAt(n));)++n;return new a.TextRange(e,i,e,n)}_changes(e,t){if(!t.length)return;this._updatePlaceholder();const r=1===this._codeMirror.lineCount();r!==this._hasOneLine&&this._resizeEditor(),this._hasOneLine=r,this._decorations.valuesArray().forEach(e=>this._codeMirror.removeLineWidget(e.widget)),this._decorations.clear();const o=[];let i;for(let e=0;e<t.length;++e){const r=b(t[e]);i&&r.oldRange.equal(i.newRange)?i.newRange=r.newRange:(i=r,o.push(i))}for(let e=0;e<o.length;e++)this.dispatchEventToListeners(u.Events.TextChanged,{oldRange:o[e].oldRange,newRange:o[e].newRange})}_beforeSelectionChange(e,t){this._selectNextOccurrenceController.selectionWillChange()}scrollToLine(e){const t=new CodeMirror.Pos(e,0),r=this._codeMirror.charCoords(t,"local");this._codeMirror.scrollTo(0,r.top)}firstVisibleLine(){return this._codeMirror.lineAtHeight(this._codeMirror.getScrollInfo().top,"local")}scrollTop(){return this._codeMirror.getScrollInfo().top}setScrollTop(e){this._codeMirror.scrollTo(0,e)}lastVisibleLine(){const e=this._codeMirror.getScrollInfo();return this._codeMirror.lineAtHeight(e.top+e.clientHeight,"local")}selection(){return f(this._codeMirror.getCursor("anchor"),this._codeMirror.getCursor("head"))}selections(){const e=this._codeMirror.listSelections(),t=[];for(let r=0;r<e.length;++r){const o=e[r];t.push(f(o.anchor,o.head))}return t}lastSelection(){return this._lastSelection}setSelection(e,t){if(this._lastSelection=e,!this._editorSizeInSync)return void(this._selectionSetScheduled=!0);const r=g(e);this._codeMirror.setSelection(r.start,r.end,{scroll:!t})}setSelections(e,t){const r=[];for(let t=0;t<e.length;++t){const o=g(e[t]);r.push({anchor:o.start,head:o.end})}t=t||0,this._codeMirror.setSelections(r,t,{scroll:!1})}_detectLineSeparator(e){this._lineSeparator=e.indexOf("\r\n")>=0?"\r\n":"\n"}setText(e){e.length>k.MaxEditableTextSize&&(this.configureAutocomplete(null),this.setReadOnly(!0)),this._codeMirror.setValue(e),this._shouldClearHistory&&(this._codeMirror.clearHistory(),this._shouldClearHistory=!1),this._detectLineSeparator(e),this._hasLongLines()?this._enableLongLinesMode():this._disableLongLinesMode(),this.isShowing()||this.refresh()}text(e){if(!e)return this._codeMirror.getValue(this._lineSeparator);const t=g(e.normalize());return this._codeMirror.getRange(t.start,t.end,this._lineSeparator)}textWithCurrentSuggestion(){return this._autocompleteController?this._autocompleteController.textWithCurrentSuggestion():this.text()}fullRange(){const e=this.linesCount,t=this._codeMirror.getLine(e-1);return f(new CodeMirror.Pos(0,0),new CodeMirror.Pos(e-1,t.length))}currentLineNumber(){return this._codeMirror.getCursor().line}line(e){return this._codeMirror.getLine(e)}get linesCount(){return this._codeMirror.lineCount()}newlineAndIndent(){this._codeMirror.execCommand("newlineAndIndent")}textEditorPositionHandle(e,t){return new v(this._codeMirror,new CodeMirror.Pos(e,t))}_updatePlaceholder(){this._placeholderElement&&(this._placeholderElement.remove(),1!==this.linesCount||this.line(0)||this._codeMirror.display.lineSpace.insertBefore(this._placeholderElement,this._codeMirror.display.lineSpace.firstChild))}}k.maxHighlightLength=1e3,k.LongLineModeLineLengthThreshold=2e3,k.MaxEditableTextSize=10485760,k._overrideModeWithPrefixedTokens("css","css-"),k._overrideModeWithPrefixedTokens("javascript","js-"),k._overrideModeWithPrefixedTokens("xml","xml-"),CodeMirror.commands.autocomplete=k.autocompleteCommand,CodeMirror.commands.undoLastSelection=k.undoLastSelectionCommand,CodeMirror.commands.selectNextOccurrence=k.selectNextOccurrenceCommand,CodeMirror.commands.moveCamelLeft=k.moveCamelLeftCommand.bind(null,!1),CodeMirror.commands.selectCamelLeft=k.moveCamelLeftCommand.bind(null,!0),CodeMirror.commands.moveCamelRight=k.moveCamelRightCommand.bind(null,!1),CodeMirror.commands.selectCamelRight=k.moveCamelRightCommand.bind(null,!0),CodeMirror.commands.UserIndent=function(e){if(0===e.listSelections().length)return;if(e.somethingSelected())return void e.indentSelection("add");const r=t.Settings.instance().moduleSetting("textEditorIndent").get();e.replaceSelection(r)},CodeMirror.commands.indentLessOrPass=function(e){const t=e.listSelections();if(1===t.length){const r=f(t[0].anchor,t[0].head);if(r.isEmpty()&&!/^\s/.test(e.getLine(r.startLine)))return CodeMirror.Pass}e.execCommand("indentLess")},CodeMirror.commands.gotoMatchingBracket=function(e){const t=[],r=e.listSelections();for(let o=0;o<r.length;++o){const i=r[o].head,n=e.findMatchingBracket(i,!1,{maxScanLines:1e4});let a=i;if(n&&n.match){const e=0===CodeMirror.cmpPos(n.from,i)?1:0;a=new CodeMirror.Pos(n.to.line,n.to.ch+e)}t.push({anchor:a,head:a})}e.setSelections(t)},CodeMirror.commands.undoAndReveal=function(e){const t=e.getScrollInfo();e.execCommand("undo");const r=e.getCursor("start");e._codeMirrorTextEditor._innerRevealLine(r.line,t);const o=e._codeMirrorTextEditor._autocompleteController;o&&o.clearAutocomplete()},CodeMirror.commands.redoAndReveal=function(e){const t=e.getScrollInfo();e.execCommand("redo");const r=e.getCursor("start");e._codeMirrorTextEditor._innerRevealLine(r.line,t);const o=e._codeMirrorTextEditor._autocompleteController;o&&o.clearAutocomplete()},CodeMirror.commands.dismiss=function(e){const t=e.listSelections(),r=t[0];if(1===t.length)return f(r.anchor,r.head).isEmpty()?CodeMirror.Pass:(e.setSelection(r.anchor,r.anchor,{scroll:!1}),void e._codeMirrorTextEditor.scrollLineIntoView(r.anchor.line));e.setSelection(r.anchor,r.head,{scroll:!1}),e._codeMirrorTextEditor.scrollLineIntoView(r.anchor.line)},CodeMirror.commands.goSmartPageUp=function(e){if(e._codeMirrorTextEditor.selection().equal(a.TextRange.createFromLocation(0,0)))return CodeMirror.Pass;e.execCommand("goPageUp")},CodeMirror.commands.goSmartPageDown=function(e){if(e._codeMirrorTextEditor.selection().equal(e._codeMirrorTextEditor.fullRange().collapseToEnd()))return CodeMirror.Pass;e.execCommand("goPageDown")};class v{constructor(e,t){this._codeMirror=e,this._lineHandle=e.getLineHandle(t.line),this._columnNumber=t.ch}resolve(){const e=this._lineHandle?this._codeMirror.getLineNumber(this._lineHandle):null;return"number"!=typeof e?null:{lineNumber:e,columnNumber:this._columnNumber}}equal(e){const t=e;return t._lineHandle===this._lineHandle&&t._columnNumber===this._columnNumber&&t._codeMirror===this._codeMirror}}class w{constructor(e,t){this._textEditor=e,this._codeMirror=t}selectionWillChange(){this._muteSelectionListener||delete this._fullWordSelection}_findRange(e,t){for(let r=0;r<e.length;++r)if(t.equal(e[r]))return!0;return!1}undoLastSelection(){this._muteSelectionListener=!0,this._codeMirror.execCommand("undoSelection"),this._muteSelectionListener=!1}selectNextOccurrence(){const e=this._textEditor.selections();let t=!1;for(let r=0;r<e.length;++r){const o=e[r];if(t=t||o.isEmpty(),o.startLine!==o.endLine)return}if(t)return void this._expandSelectionsToWords(e);const r=e[e.length-1];let o=r;do{o=this._findNextOccurrence(o,!!this._fullWordSelection)}while(o&&this._findRange(e,o)&&!o.equal(r));o&&(e.push(o),this._muteSelectionListener=!0,this._textEditor.setSelections(e,e.length-1),delete this._muteSelectionListener,this._textEditor.scrollLineIntoView(o.startLine))}_expandSelectionsToWords(e){const t=[];for(let r=0;r<e.length;++r){const o=e[r],i=this._textEditor.wordRangeForCursorPosition(o.startLine,o.startColumn,s.Utils.isWordChar)||a.TextRange.createFromLocation(o.startLine,o.startColumn),n=this._textEditor.wordRangeForCursorPosition(o.endLine,o.endColumn,s.Utils.isWordChar)||a.TextRange.createFromLocation(o.endLine,o.endColumn),l=new a.TextRange(i.startLine,i.startColumn,n.endLine,n.endColumn);t.push(l)}this._textEditor.setSelections(t,t.length-1),this._fullWordSelection=!0}_findNextOccurrence(e,t){let r,o;e=e.normalize();const i=this._textEditor.text(e);function n(e,t,n,a,s){if("number"==typeof r)return!0;e.lastIndex=a;const l=e.exec(n);return!(!l||l.index+i.length>s)&&(r=t,o=l.index,!0)}let s;function l(e,t){if(n(e,s++,t.text,0,t.text.length))return!0}let c=i.escapeForRegExp();t&&(c="\\b"+c+"\\b");const d=new RegExp(c,"g"),u=this._codeMirror.getLine(e.startLine);return n(d,e.startLine,u,e.endColumn,u.length),s=e.startLine+1,this._codeMirror.eachLine(e.startLine+1,this._codeMirror.lineCount(),l.bind(null,d)),s=0,this._codeMirror.eachLine(0,e.startLine,l.bind(null,d)),n(d,e.startLine,u,0,e.startColumn),"number"!=typeof r?null:new a.TextRange(r,o,r,o+i.length)}}const C=new Set;class M{async install(e){}}class S{constructor(e,t,r){e[S._symbol]=this,this._marker=e,this._type=t,this._editor=r}clear(){const e=this._marker.find();this._marker.clear(),e&&this._editor._updateDecorations(e.line)}refresh(){this._marker.changed();const e=this._marker.find();e&&this._editor._updateDecorations(e.line)}type(){return this._type}position(){const e=this._marker.find();return e?a.TextRange.createFromLocation(e.line,e.ch):null}}S._symbol=Symbol("TextEditorBookMark");CodeMirror.inputStyles.devToolsAccessibleTextArea=class extends CodeMirror.inputStyles.textarea{init(e){super.init(e),this.textarea.addEventListener("compositionstart",this._onCompositionStart.bind(this))}_onCompositionStart(){this.textarea.selectionEnd!==this.textarea.value.length&&(this.textarea.value=this.textarea.value.substring(0,this.textarea.selectionEnd),this.textarea.setSelectionRange(this.textarea.value.length,this.textarea.value.length),this.prevInput=this.textarea.value)}reset(e){if(this.textAreaBusy(!!e))return void super.reset(e);const t=this.cm.getCursor();let r,o;if(this.cm.options.lineWrapping){const e=this.cm.charCoords(t,"page").top;r=this.cm.coordsChar({left:-1/0,top:e}),o=this.cm.coordsChar({left:1/0,top:e})}else{const e=1e3*Math.floor(t.ch/1e3);r={ch:e,line:t.line},o={ch:e+1e3,line:t.line}}this.textarea.value=this.cm.getRange(r,o);const i=t.ch-r.ch;this.textarea.setSelectionRange(i,i),this.prevInput=this.textarea.value}textAreaBusy(e){return e||this.contextMenuPending||this.composing||this.cm.somethingSelected()}poll(){if(this.contextMenuPending||this.composing)return super.poll();const e=this.textarea.value;let t=0;const r=Math.min(this.prevInput.length,e.length);for(;t<r&&this.prevInput[t]===e[t];)++t;let o=0;for(;o<r-t&&this.prevInput[this.prevInput.length-o-1]===e[e.length-o-1];)++o;const i=this.textarea;this.textarea=createElement("textarea"),this.textarea.value=e.substring(t,e.length-o),this.textarea.setSelectionRange(i.selectionStart-t,i.selectionEnd-t),this.prevInput="";const n=super.poll();return this.prevInput=e,this.textarea=i,n}};var L=Object.freeze({__proto__:null,Token:void 0,Coordinates:void 0,CodeMirrorTextEditor:k,CodeMirrorPositionHandle:v,SelectNextOccurrenceController:w,TextEditorPositionHandle:class{resolve(){}equal(e){}},loadedMimeModeExtensions:C,CodeMirrorMimeMode:M,TextEditorBookMark:S,CodeMirrorTextEditorFactory:class{createEditor(e){return new k(e)}},Decoration:void 0});export{L as CodeMirrorTextEditor,_ as CodeMirrorUtils,y as TextEditorAutocompleteController};
