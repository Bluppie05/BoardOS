import{UIString as e,ParsedURL as t,Settings as s,ObjectWrapper as i,Revealer as n,Throttler as o,Console as r}from"../common/common.js";import{SDKModel as a,RuntimeModel as l,ResourceTreeModel as h,DebuggerModel as c,OverlayModel as d,FrameManager as u,ConsoleModel as m,RemoteObject as _,NetworkLog as g,DOMModel as p,NetworkManager as f}from"../sdk/sdk.js";import{ListModel as v,SoftDropDown as C,Toolbar as b,Context as x,Utils as S,UIUtils as w,ThrottledWidget as E,ContextMenu as M,Fragment as y,KeyboardShortcut as T,TextEditor as I,Widget as L,TreeOutline as k,Icon as F,ARIAUtils as P,ShortcutRegistry as R,SyntaxHighlighter as A,ViewManager as B,Infobar as V,SearchableView as H,SplitWidget as N,ActionRegistry as O,ProgressIndicator as G,FilterSuggestionBuilder as D,Panel as U,InspectorView as j,GlassPane as W}from"../ui/ui.js";import{TextUtils as z,TextRange as K}from"../text_utils/text_utils.js";import{JavaScriptAutocomplete as q,JavaScriptREPL as $,RemoteObjectPreviewFormatter as J,CustomPreviewComponent as X,ObjectPropertiesSection as Q}from"../object_ui/object_ui.js";import{Runtime as Z}from"../root/root.js";import{StringUtilities as Y,SetUtilities as ee,NumberUtilities as te}from"../platform/platform.js";import{Linkifier as se,JSPresentationUtils as ie}from"../components/components.js";import{SortableDataGrid as ne}from"../data_grid/data_grid.js";import{ThemeSupport as oe}from"../theme_support/theme_support.js";import{userMetrics as re,UserMetrics as ae,InspectorFrontendHost as le,Platform as he}from"../host/host.js";import{FileUtils as ce}from"../bindings/bindings.js";import{IssuesManager as de}from"../browser_sdk/browser_sdk.js";class ue{constructor(){this._items=new v.ListModel,this._dropDown=new C.SoftDropDown(this._items,this),this._dropDown.setRowHeight(36),this._toolbarItem=new b.ToolbarItem(this._dropDown.element),this._toolbarItem.setEnabled(!1),this._toolbarItem.setTitle(ls`JavaScript context: Not selected`),this._items.addEventListener(v.Events.ItemsReplaced,()=>this._toolbarItem.setEnabled(!!this._items.length)),this._toolbarItem.element.classList.add("toolbar-has-dropdown"),a.TargetManager.instance().addModelListener(l.RuntimeModel,l.Events.ExecutionContextCreated,this._onExecutionContextCreated,this),a.TargetManager.instance().addModelListener(l.RuntimeModel,l.Events.ExecutionContextChanged,this._onExecutionContextChanged,this),a.TargetManager.instance().addModelListener(l.RuntimeModel,l.Events.ExecutionContextDestroyed,this._onExecutionContextDestroyed,this),a.TargetManager.instance().addModelListener(h.ResourceTreeModel,h.Events.FrameNavigated,this._frameNavigated,this),x.Context.instance().addFlavorChangeListener(l.ExecutionContext,this._executionContextChangedExternally,this),x.Context.instance().addFlavorChangeListener(c.CallFrame,this._callFrameSelectedInUI,this),a.TargetManager.instance().observeModels(l.RuntimeModel,this),a.TargetManager.instance().addModelListener(c.DebuggerModel,c.Events.CallFrameSelected,this._callFrameSelectedInModel,this)}toolbarItem(){return this._toolbarItem}highlightedItemChanged(e,t,s,i){if(d.OverlayModel.hideDOMNodeHighlight(),t&&t.frameId){const e=u.FrameManager.instance().getFrame(t.frameId);e&&!e.isTopFrame()&&e.highlight()}s&&s.classList.remove("highlighted"),i&&i.classList.add("highlighted")}titleFor(e){const t=e.target(),s=e.label();let i=s?t.decorateLabel(s):"";if(e.frameId){const s=t.model(h.ResourceTreeModel),n=s&&s.frameForId(e.frameId);n&&(i=i||n.displayName())}return i=i||e.origin,i}_depthFor(e){let t=e.target(),s=0;if(e.isDefault||s++,e.frameId){let i=u.FrameManager.instance().getFrame(e.frameId);for(;i;)i=i.parentFrame(),i&&(s++,t=i.resourceTreeModel().target())}let i=0,n=t.parentTarget();for(;n&&t.type()!==a.Type.ServiceWorker;)i++,t=n,n=t.parentTarget();return s+=i,s}_executionContextCreated(e){this._items.insertWithComparator(e,e.runtimeModel.executionContextComparator()),e===x.Context.instance().flavor(l.ExecutionContext)&&this._dropDown.selectItem(e)}_onExecutionContextCreated(e){const t=e.data;this._executionContextCreated(t)}_onExecutionContextChanged(e){const t=e.data;-1!==this._items.indexOf(t)&&(this._executionContextDestroyed(t),this._executionContextCreated(t))}_executionContextDestroyed(e){const t=this._items.indexOf(e);-1!==t&&this._items.remove(t)}_onExecutionContextDestroyed(e){const t=e.data;this._executionContextDestroyed(t)}_executionContextChangedExternally(e){const t=e.data;this._dropDown.selectItem(t)}_isTopContext(e){if(!e||!e.isDefault)return!1;const t=e.target().model(h.ResourceTreeModel),s=e.frameId&&t&&t.frameForId(e.frameId);return!!s&&s.isTopFrame()}_hasTopContext(){return this._items.some(e=>this._isTopContext(e))}modelAdded(e){e.executionContexts().forEach(this._executionContextCreated,this)}modelRemoved(e){for(let t=this._items.length-1;t>=0;t--)this._items.at(t).runtimeModel===e&&this._executionContextDestroyed(this._items.at(t))}createElementForItem(e){const t=document.createElement("div"),s=S.createShadowRootWithCoreStyles(t,{cssFile:"console/consoleContextSelector.css",enableLegacyPatching:!0,delegatesFocus:void 0}),i=s.createChild("div","title");w.createTextChild(i,this.titleFor(e).trimEndWithMaxLength(100));const n=s.createChild("div","subtitle");return w.createTextChild(n,this._subtitleFor(e)),t.style.paddingLeft=8+15*this._depthFor(e)+"px",t}_subtitleFor(s){const i=s.target();let n=null;if(s.frameId){const e=i.model(h.ResourceTreeModel);n=e&&e.frameForId(s.frameId)}if(s.origin.startsWith("chrome-extension://"))return e.UIString("Extension");const o=n&&n.sameTargetParentFrame();if(!n||!o||o.securityOrigin!==s.origin){const e=t.ParsedURL.fromString(s.origin);if(e)return e.domain()}if(n){const s=n.findCreationCallFrame(e=>!!e.url);return s?new t.ParsedURL(s.url).domain():e.UIString("IFrame")}return""}isItemSelectable(e){const t=e.debuggerModel.selectedCallFrame(),s=t&&t.script.executionContext();return!s||e===s}itemSelected(e){this._toolbarItem.element.classList.toggle("warning",!this._isTopContext(e)&&this._hasTopContext());const t=e?ls`JavaScript context: ${this.titleFor(e)}`:ls`JavaScript context: Not selected`;this._toolbarItem.setTitle(t),x.Context.instance().setFlavor(l.ExecutionContext,e)}_callFrameSelectedInUI(){const e=x.Context.instance().flavor(c.CallFrame),t=e&&e.script.executionContext();t&&x.Context.instance().setFlavor(l.ExecutionContext,t)}_callFrameSelectedInModel(e){const t=e.data;for(const e of this._items)e.debuggerModel===t&&this._dropDown.refreshItem(e)}_frameNavigated(e){const t=e.data,s=t.resourceTreeModel().target().model(l.RuntimeModel);if(s)for(const e of s.executionContexts())t.id===e.frameId&&this._dropDown.refreshItem(e)}}var me=Object.freeze({__proto__:null,ConsoleContextSelector:ue});class _e{constructor(e,t,s,i){this.name=e,this.parsedFilters=t,this.executionContext=s,this.levelsMask=i||_e.defaultLevelsFilterValue()}static allLevelsFilterValue(){const e={};for(const t of Object.values(m.MessageLevel))e[t]=!0;return e}static defaultLevelsFilterValue(){const e=_e.allLevelsFilterValue();return e[m.MessageLevel.Verbose]=!1,e}static singleLevelMask(e){const t={};return t[e]=!0,t}clone(){const e=this.parsedFilters.map(z.FilterParser.cloneFilter),t=Object.assign({},this.levelsMask);return new _e(this.name,e,this.executionContext,t)}shouldBeVisible(e){const t=e.consoleMessage();if(this.executionContext&&(this.executionContext.runtimeModel!==t.runtimeModel()||this.executionContext.id!==t.executionContextId))return!1;if(t.type===m.MessageType.Command||t.type===m.MessageType.Result||t.isGroupMessage())return!0;if(t.level&&!this.levelsMask[t.level])return!1;for(const i of this.parsedFilters)if(i.key)switch(i.key){case ge.Context:if(!s(i,t.context,!1))return!1;break;case ge.Source:if(!s(i,t.source?m.MessageSourceDisplayName.get(t.source):t.source,!0))return!1;break;case ge.Url:if(!s(i,t.url,!1))return!1}else{if(i.regex&&e.matchesFilterRegex(i.regex)===i.negative)return!1;if(i.text&&e.matchesFilterText(i.text)===i.negative)return!1}return!0;function s(e,t,s){if(!e.text)return!!t===e.negative;if(!t)return!e.text==!e.negative;const i=e.text.toLowerCase(),n=t.toLowerCase();return(!s||n===i!==e.negative)&&!(!s&&n.includes(i)===e.negative)}}}const ge={Context:"context",Source:"source",Url:"url"};var pe=Object.freeze({__proto__:null,ConsoleFilter:_e,FilterType:ge});const fe=new WeakMap;class ve extends E.ThrottledWidget{constructor(e){super(!0,250),this._liveExpressionButton=e,this.registerRequiredCSS("console/consolePinPane.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("object_ui/objectValue.css",{enableLegacyPatching:!0}),this.contentElement.classList.add("console-pins","monospace"),this.contentElement.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),!1),this._pins=new Set,this._pinsSetting=s.Settings.instance().createLocalSetting("consolePins",[]);for(const e of this._pinsSetting.get())this.addPin(e)}willHide(){for(const e of this._pins)e.setHovered(!1)}_savePins(){const e=Array.from(this._pins).map(e=>e.expression());this._pinsSetting.set(e)}_contextMenuEventFired(e){const t=new M.ContextMenu(e),s=e.deepElementFromPoint();if(s){const e=s.enclosingNodeOrSelfWithClass("console-pin");if(e){const s=fe.get(e);s&&(t.editSection().appendItem(ls`Remove expression`,this._removePin.bind(this,s)),s.appendToContextMenu(t))}}t.editSection().appendItem(ls`Remove all expressions`,this._removeAllPins.bind(this)),t.show()}_removeAllPins(){for(const e of this._pins)this._removePin(e)}_removePin(e){e.element().remove();const t=this._focusedPinAfterDeletion(e);this._pins.delete(e),this._savePins(),t?t.focus():this._liveExpressionButton.focus()}addPin(e,t){const s=new Ce(e,this);this.contentElement.appendChild(s.element()),this._pins.add(s),this._savePins(),t&&s.focus(),this.update()}_focusedPinAfterDeletion(e){const t=Array.from(this._pins);for(let s=0;s<t.length;s++)if(t[s]===e)return 1===t.length?null:s===t.length-1?t[s-1]:t[s+1];return null}doUpdate(){if(!this._pins.size||!this.isShowing())return Promise.resolve();this.isShowing()&&this.update();const e=Array.from(this._pins,e=>e.updatePreview());return Promise.all(e).then(this._updatedForTest.bind(this))}_updatedForTest(){}}class Ce extends i.ObjectWrapper{constructor(e,t){super();const s=document.createElement("div",{is:"dt-close-button"});s.gray=!0,s.classList.add("close-button"),s.setTabbable(!0),e.length?s.setAccessibleName(ls`Remove expression: ${e}`):s.setAccessibleName(ls`Remove blank expression`),self.onInvokeElement(s,e=>{t._removePin(this),e.consume(!0)});const i=y.Fragment.build`
    <div class='console-pin'>
      ${s}
      <div class='console-pin-name' $='name'></div>
      <div class='console-pin-preview' $='preview'></div>
    </div>`;this._pinElement=i.element(),this._pinPreview=i.$("preview");const o=i.$("name");o.title=e,fe.set(this._pinElement,this),this._lastResult=null,this._lastExecutionContext=null,this._editor=null,this._committedExpression=e,this._hovered=!1,this._lastNode=null,this._pinPreview.addEventListener("mouseenter",this.setHovered.bind(this,!0),!1),this._pinPreview.addEventListener("mouseleave",this.setHovered.bind(this,!1),!1),this._pinPreview.addEventListener("click",e=>{this._lastNode&&(n.reveal(this._lastNode),e.consume())},!1);const r=i=>(this._editor=i.createEditor({devtoolsAccessibleName:ls`Live expression editor`,lineNumbers:!1,lineWrapping:!0,mimeType:"javascript",autoHeight:!0,placeholder:ls`Expression`,bracketMatchingSetting:void 0,lineWiseCopyCut:void 0,maxHighlightLength:void 0,padBottom:void 0}),this._editor.configureAutocomplete(q.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor)),this._editor.widget().show(o),this._editor.widget().element.classList.add("console-pin-editor"),this._editor.widget().element.tabIndex=-1,this._editor.setText(e),this._editor.widget().element.addEventListener("keydown",e=>{this._editor&&("Tab"!==e.key||this._editor.text()?e.keyCode===T.Keys.Esc.code&&this._editor.setText(this._committedExpression):e.consume())},!0),this._editor.widget().element.addEventListener("focusout",e=>{if(!this._editor)return;const i=this._editor.text(),n=i.trim();i.length!==n.length&&this._editor.setText(n),this._committedExpression=n,t._savePins(),this._committedExpression.length?s.setAccessibleName(ls`Remove expression: ${this._committedExpression}`):s.setAccessibleName(ls`Remove blank expression`),this._editor.setSelection(K.TextRange.createFromLocation(1/0,1/0))}),this._editor),a=Z.Runtime.instance().extension(I.TextEditorFactory);this._editorPromise=a.instance().then(e=>r(e))}setHovered(e){this._hovered!==e&&(this._hovered=e,!e&&this._lastNode&&d.OverlayModel.hideDOMNodeHighlight())}expression(){return this._committedExpression}element(){return this._pinElement}async focus(){const e=await this._editorPromise;e.widget().focus(),e.setSelection(K.TextRange.createFromLocation(1/0,1/0))}appendToContextMenu(e){this._lastResult&&!("error"in this._lastResult)&&this._lastResult.object&&(e.appendApplicableItems(this._lastResult.object),this._lastResult=null)}async updatePreview(){if(!this._editor)return;const e=this._editor.textWithCurrentSuggestion().trim(),t=this._pinElement.hasFocus(),s=t&&e!==this._committedExpression,i=s?250:void 0,n=x.Context.instance().flavor(l.ExecutionContext),{preview:o,result:r}=await $.JavaScriptREPL.evaluateAndBuildPreview(e,s,i,!t,"console");this._lastResult&&this._lastExecutionContext&&this._lastExecutionContext.runtimeModel.releaseEvaluationResult(this._lastResult),this._lastResult=r||null,this._lastExecutionContext=n||null;const a=o.deepTextContent();if(!a||a!==this._pinPreview.deepTextContent()){if(this._pinPreview.removeChildren(),r&&l.RuntimeModel.isSideEffectFailure(r)){const e=this._pinPreview.createChild("span","object-value-calculate-value-button");e.textContent="(…)",e.title=ls`Evaluate, allowing side effects`}else a?this._pinPreview.appendChild(o):t||w.createTextChild(this._pinPreview,ls`not available`);this._pinPreview.title=a}let h=null;r&&!("error"in r)&&"object"===r.object.type&&"node"===r.object.subtype&&(h=r.object),this._hovered&&(h?d.OverlayModel.highlightObjectAsDOMNode(h):this._lastNode&&d.OverlayModel.hideDOMNodeHighlight()),this._lastNode=h||null;const c=r&&!("error"in r)&&r.exceptionDetails&&!l.RuntimeModel.isSideEffectFailure(r);this._pinElement.classList.toggle("error-level",!!c)}}var be=Object.freeze({__proto__:null,ConsolePinPane:ve,ConsolePin:Ce});class xe extends L.VBox{constructor(){super(!0),this.setMinimumSize(125,0),this._tree=new k.TreeOutlineInShadow,this._tree.registerRequiredCSS("console/consoleSidebar.css",{enableLegacyPatching:!0}),this._tree.addEventListener(k.Events.ElementSelected,this._selectionChanged.bind(this)),this.contentElement.appendChild(this._tree.element),this._selectedTreeElement=null,this._treeElements=[];const e=s.Settings.instance().createSetting("console.sidebarSelectedFilter",null),t=m.MessageLevel,i=[{key:ge.Source,text:m.MessageSource.ConsoleAPI,negative:!1,regex:void 0}];this._appendGroup(ye.All,[],_e.allLevelsFilterValue(),F.Icon.create("mediumicon-list"),e),this._appendGroup(ye.ConsoleAPI,i,_e.allLevelsFilterValue(),F.Icon.create("mediumicon-account-circle"),e),this._appendGroup(ye.Error,[],_e.singleLevelMask(t.Error),F.Icon.create("mediumicon-error-circle"),e),this._appendGroup(ye.Warning,[],_e.singleLevelMask(t.Warning),F.Icon.create("mediumicon-warning-triangle"),e),this._appendGroup(ye.Info,[],_e.singleLevelMask(t.Info),F.Icon.create("mediumicon-info-circle"),e),this._appendGroup(ye.Verbose,[],_e.singleLevelMask(t.Verbose),F.Icon.create("mediumicon-bug"),e);const n=e.get();(this._treeElements.find(e=>e.name()===n)||this._treeElements[0]).select()}_appendGroup(e,t,s,i,n){const o=new _e(e,t,null,s),r=new Me(o,i,n);this._tree.appendChild(r),this._treeElements.push(r)}clear(){for(const e of this._treeElements)e.clear()}onMessageAdded(e){for(const t of this._treeElements)t.onMessageAdded(e)}shouldBeVisible(e){return!(this._selectedTreeElement instanceof we)||this._selectedTreeElement.filter().shouldBeVisible(e)}_selectionChanged(e){this._selectedTreeElement=e.data,this.dispatchEventToListeners(Se.FilterSelected)}}const Se={FilterSelected:Symbol("FilterSelected")};class we extends k.TreeElement{constructor(e,t){super(e),this._filter=t}filter(){return this._filter}}class Ee extends we{constructor(e){super(e.name,e),this._countElement=this.listItemElement.createChild("span","count");const t=[F.Icon.create("largeicon-navigator-file")];this.setLeadingIcons(t),this._messageCount=0}incrementAndUpdateCounter(){this._messageCount++,this._countElement.textContent=""+this._messageCount}}class Me extends we{constructor(e,t,s){super(e.name,e),this._selectedFilterSetting=s,this._urlTreeElements=new Map,this.setLeadingIcons([t]),this._messageCount=0,this._updateCounter()}clear(){this._urlTreeElements.clear(),this.removeChildren(),this._messageCount=0,this._updateCounter()}name(){return this._filter.name}onselect(e){return this._selectedFilterSetting.set(this._filter.name),super.onselect(e)}_updateCounter(){this._messageCount?1===this._messageCount?this.title=Te.get(this._filter.name)||"":this.title=Y.sprintf(Ie.get(this._filter.name)||"",this._messageCount):this.title=Le.get(this._filter.name)||"",this.setExpandable(!!this.childCount())}onMessageAdded(e){const t=e.consoleMessage(),s=t.type!==m.MessageType.Command&&t.type!==m.MessageType.Result&&!t.isGroupMessage();if(!this._filter.shouldBeVisible(e)||!s)return;this._childElement(t.url).incrementAndUpdateCounter(),this._messageCount++,this._updateCounter()}_childElement(s){const i=s||null;let n=this._urlTreeElements.get(i);if(n)return n;const o=this._filter.clone(),r=i?t.ParsedURL.fromString(i):null;return o.name=i?r?r.displayName:i:e.UIString("<other>"),o.parsedFilters.push({key:ge.Url,text:i,negative:!1,regex:void 0}),n=new Ee(o),i&&(n.tooltip=i),this._urlTreeElements.set(i,n),this.appendChild(n),n}}const ye={ConsoleAPI:"user message",All:"message",Error:"error",Warning:"warning",Info:"info",Verbose:"verbose"},Te=new Map([[ye.ConsoleAPI,ls`1 user message`],[ye.All,ls`1 message`],[ye.Error,ls`1 error`],[ye.Warning,ls`1 warning`],[ye.Info,ls`1 info`],[ye.Verbose,ls`1 verbose`]]),Ie=new Map([[ye.ConsoleAPI,ls`%d user messages`],[ye.All,ls`%d messages`],[ye.Error,ls`%d errors`],[ye.Warning,ls`%d warnings`],[ye.Info,ls`%d info`],[ye.Verbose,ls`%d verbose`]]),Le=new Map([[ye.ConsoleAPI,ls`No user messages`],[ye.All,ls`No messages`],[ye.Error,ls`No errors`],[ye.Warning,ls`No warnings`],[ye.Info,ls`No info`],[ye.Verbose,ls`No verbose`]]);var ke=Object.freeze({__proto__:null,ConsoleSidebar:xe,Events:Se,URLGroupTreeElement:Ee,FilterTreeElement:Me});class Fe{constructor(e){this.element=document.createElement("div"),this.element.style.overflow="auto",this._topGapElement=this.element.createChild("div"),this._topGapElement.style.height="0px",this._topGapElement.style.color="transparent",this._topGapElementActive=!1,this._contentElement=this.element.createChild("div"),this._bottomGapElement=this.element.createChild("div"),this._bottomGapElement.style.height="0px",this._bottomGapElement.style.color="transparent",this._bottomGapElementActive=!1,this._topGapElement.textContent="\ufeff",this._bottomGapElement.textContent="\ufeff",P.markAsHidden(this._topGapElement),P.markAsHidden(this._bottomGapElement),this._provider=e,this.element.addEventListener("scroll",this._onScroll.bind(this),!1),this.element.addEventListener("copy",this._onCopy.bind(this),!1),this.element.addEventListener("dragstart",this._onDragStart.bind(this),!1),this._contentElement.addEventListener("focusin",this._onFocusIn.bind(this),!1),this._contentElement.addEventListener("focusout",this._onFocusOut.bind(this),!1),this._contentElement.addEventListener("keydown",this._onKeyDown.bind(this),!1),this._virtualSelectedIndex=-1,this._contentElement.tabIndex=-1,this._firstActiveIndex=-1,this._lastActiveIndex=-1,this._renderedItems=[],this._anchorSelection=null,this._headSelection=null,this._itemCount=0,this._cumulativeHeights=new Int32Array(0),this._muteCopyHandler=!1,this._observer=new MutationObserver(this.refresh.bind(this)),this._observerConfig={childList:!0,subtree:!0},this._stickToBottom=!1,this._selectionIsBackward=!1}stickToBottom(){return this._stickToBottom}setStickToBottom(e){this._stickToBottom=e,this._stickToBottom?this._observer.observe(this._contentElement,this._observerConfig):this._observer.disconnect()}hasVirtualSelection(){return-1!==this._virtualSelectedIndex}copyWithStyles(){this._muteCopyHandler=!0,this.element.ownerDocument.execCommand("copy"),this._muteCopyHandler=!1}_onCopy(e){if(this._muteCopyHandler)return;const t=this._selectedText();t&&(e.preventDefault(),this._selectionContainsTable()?this.copyWithStyles():e.clipboardData&&e.clipboardData.setData("text/plain",t))}_onFocusIn(e){const t=this._renderedItems.findIndex(t=>t.element().isSelfOrAncestor(e.target));-1!==t&&(this._virtualSelectedIndex=this._firstActiveIndex+t);let s=!1;-1===this._virtualSelectedIndex&&this._isOutsideViewport(e.relatedTarget)&&e.target===this._contentElement&&this._itemCount&&(s=!0,this._virtualSelectedIndex=this._itemCount-1,this.refresh(),this.scrollItemIntoView(this._virtualSelectedIndex)),this._updateFocusedItem(s)}_onFocusOut(e){this._isOutsideViewport(e.relatedTarget)&&(this._virtualSelectedIndex=-1),this._updateFocusedItem()}_isOutsideViewport(e){return!!e&&!e.isSelfOrDescendant(this._contentElement)}_onDragStart(e){const t=this._selectedText();return!!t&&(e.dataTransfer&&(e.dataTransfer.clearData(),e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="copy"),!0)}_onKeyDown(e){if(w.isEditing()||!this._itemCount||e.shiftKey)return;let t=!1;switch(e.key){case"ArrowUp":if(!(this._virtualSelectedIndex>0))return;t=!0,this._virtualSelectedIndex--;break;case"ArrowDown":if(!(this._virtualSelectedIndex<this._itemCount-1))return;this._virtualSelectedIndex++;break;case"Home":this._virtualSelectedIndex=0;break;case"End":this._virtualSelectedIndex=this._itemCount-1;break;default:return}e.consume(!0),this.scrollItemIntoView(this._virtualSelectedIndex),this._updateFocusedItem(t)}_updateFocusedItem(e){const t=this.renderedElementAt(this._virtualSelectedIndex),s=this._lastSelectedElement!==t,i=this._contentElement===this.element.ownerDocument.deepActiveElement();this._lastSelectedElement&&s&&this._lastSelectedElement.classList.remove("console-selected"),t&&(e||s||i)&&this.element.hasFocus()&&(t.classList.add("console-selected"),e?(this.setStickToBottom(!1),this._renderedItems[this._virtualSelectedIndex-this._firstActiveIndex].focusLastChildOrSelf()):t.hasFocus()||t.focus({preventScroll:!0})),this._itemCount&&!this._contentElement.hasFocus()?this._contentElement.tabIndex=0:this._contentElement.tabIndex=-1,this._lastSelectedElement=t}contentElement(){return this._contentElement}invalidate(){delete this._cachedProviderElements,this._itemCount=this._provider.itemCount(),this._virtualSelectedIndex>this._itemCount-1&&(this._virtualSelectedIndex=this._itemCount-1),this._rebuildCumulativeHeights(),this.refresh()}_providerElement(e){this._cachedProviderElements||(this._cachedProviderElements=new Array(this._itemCount));let t=this._cachedProviderElements[e];return t||(t=this._provider.itemElement(e),this._cachedProviderElements[e]=t),t}_rebuildCumulativeHeights(){const e=this._firstActiveIndex,t=this._lastActiveIndex;let s=0;this._cumulativeHeights=new Int32Array(this._itemCount);for(let i=0;i<this._itemCount;++i)e<=i&&i-e<this._renderedItems.length&&i<=t?s+=this._renderedItems[i-e].element().offsetHeight:s+=this._provider.fastHeight(i),this._cumulativeHeights[i]=s}_rebuildCumulativeHeightsIfNeeded(){let e=0,t=0;for(let s=0;s<this._renderedItems.length;++s){const i=this._cachedItemHeight(this._firstActiveIndex+s),n=this._renderedItems[s].element().offsetHeight;if(Math.abs(i-n)>1)return void this._rebuildCumulativeHeights();if(t+=n,e+=i,Math.abs(e-t)>1)return void this._rebuildCumulativeHeights()}}_cachedItemHeight(e){return 0===e?this._cumulativeHeights[0]:this._cumulativeHeights[e]-this._cumulativeHeights[e-1]}_isSelectionBackwards(e){if(!(e&&e.rangeCount&&e.anchorNode&&e.focusNode))return!1;const t=document.createRange();return t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.collapsed}_createSelectionModel(e,t,s){return{item:e,node:t,offset:s}}_updateSelectionModel(e){const t=e&&e.rangeCount?e.getRangeAt(0):null;if(!t||!e||e.isCollapsed||!this.element.hasSelection())return this._headSelection=null,this._anchorSelection=null,!1;let s=Number.MAX_VALUE,i=-1,n=!1;for(let e=0;e<this._renderedItems.length;++e)if(t.intersectsNode(this._renderedItems[e].element())){const t=e+this._firstActiveIndex;s=Math.min(s,t),i=Math.max(i,t),n=!0}const o=t.intersectsNode(this._topGapElement)&&this._topGapElementActive,r=t.intersectsNode(this._bottomGapElement)&&this._bottomGapElementActive;if(!o&&!r&&!n)return this._headSelection=null,this._anchorSelection=null,!1;this._anchorSelection&&this._headSelection||(this._anchorSelection=this._createSelectionModel(0,this.element,0),this._headSelection=this._createSelectionModel(this._itemCount-1,this.element,this.element.children.length),this._selectionIsBackward=!1);const a=this._isSelectionBackwards(e),l=this._selectionIsBackward?this._headSelection:this._anchorSelection,h=this._selectionIsBackward?this._anchorSelection:this._headSelection;let c=null,d=null;return n&&(c=this._createSelectionModel(s,t.startContainer,t.startOffset),d=this._createSelectionModel(i,t.endContainer,t.endOffset)),o&&r&&n?(c=c&&c.item<l.item?c:l,d=d&&d.item>h.item?d:h):n?o?c=a?this._headSelection:this._anchorSelection:r&&(d=a?this._anchorSelection:this._headSelection):(c=l,d=h),a?(this._anchorSelection=d,this._headSelection=c):(this._anchorSelection=c,this._headSelection=d),this._selectionIsBackward=a,!0}_restoreSelection(e){if(!e||!this._anchorSelection||!this._headSelection)return;const t=(e,t)=>{if(this._firstActiveIndex<=e.item&&e.item<=this._lastActiveIndex)return{element:e.node,offset:e.offset};return{element:e.item<this._firstActiveIndex?this._topGapElement:this._bottomGapElement,offset:t?1:0}},{element:s,offset:i}=t(this._anchorSelection,!!this._selectionIsBackward),{element:n,offset:o}=t(this._headSelection,!this._selectionIsBackward);e.setBaseAndExtent(s,i,n,o)}_selectionContainsTable(){if(!this._anchorSelection||!this._headSelection)return!1;const e=this._selectionIsBackward?this._headSelection.item:this._anchorSelection.item,t=this._selectionIsBackward?this._anchorSelection.item:this._headSelection.item;for(let s=e;s<=t;s++){const e=this._providerElement(s);if(e&&"table"===e.consoleMessage().type)return!0}return!1}refresh(){this._observer.disconnect(),this._innerRefresh(),this._stickToBottom&&this._observer.observe(this._contentElement,this._observerConfig)}_innerRefresh(){if(!this._visibleHeight())return;if(!this._itemCount){for(let e=0;e<this._renderedItems.length;++e)this._renderedItems[e].willHide();return this._renderedItems=[],this._contentElement.removeChildren(),this._topGapElement.style.height="0px",this._bottomGapElement.style.height="0px",this._firstActiveIndex=-1,this._lastActiveIndex=-1,void this._updateFocusedItem()}const e=this.element.getComponentSelection(),t=this._updateSelectionModel(e),s=this.element.scrollTop,i=this._visibleHeight(),n=2*i;this._rebuildCumulativeHeightsIfNeeded(),this._stickToBottom?(this._firstActiveIndex=Math.max(this._itemCount-Math.ceil(n/this._provider.minimumRowHeight()),0),this._lastActiveIndex=this._itemCount-1):(this._firstActiveIndex=Math.max(this._cumulativeHeights.lowerBound(s+1-(n-i)/2),0),this._lastActiveIndex=this._firstActiveIndex+Math.ceil(n/this._provider.minimumRowHeight())-1,this._lastActiveIndex=Math.min(this._lastActiveIndex,this._itemCount-1));const o=this._cumulativeHeights[this._firstActiveIndex-1]||0,r=this._cumulativeHeights[this._cumulativeHeights.length-1]-this._cumulativeHeights[this._lastActiveIndex];this._partialViewportUpdate(function(){this._topGapElement.style.height=o+"px",this._bottomGapElement.style.height=r+"px",this._topGapElementActive=!!o,this._bottomGapElementActive=!!r,this._contentElement.style.setProperty("height","10000000px")}.bind(this)),this._contentElement.style.removeProperty("height"),t&&this._restoreSelection(e),this._stickToBottom&&(this.element.scrollTop=1e7)}_partialViewportUpdate(e){const t=new Set;for(let e=this._firstActiveIndex;e<=this._lastActiveIndex;++e){const s=this._providerElement(e);console.assert(!!s,"Expected provider element to be defined"),s&&t.add(s)}const s=this._renderedItems.filter(e=>!t.has(e));for(let e=0;e<s.length;++e)s[e].willHide();e();let i=!1;for(let e=0;e<s.length;++e)i=i||s[e].element().hasFocus(),s[e].element().remove();const n=[];let o=this._contentElement.firstChild;for(const e of t){const t=e.element();if(t!==o){!t.parentElement&&n.push(e),this._contentElement.insertBefore(t,o)}else o=o.nextSibling}for(let e=0;e<n.length;++e)n[e].wasShown();this._renderedItems=Array.from(t),i&&this._contentElement.focus(),this._updateFocusedItem()}_selectedText(){if(this._updateSelectionModel(this.element.getComponentSelection()),!this._headSelection||!this._anchorSelection)return null;let e=null,t=null;this._selectionIsBackward?(e=this._headSelection,t=this._anchorSelection):(e=this._anchorSelection,t=this._headSelection);const s=[];for(let i=e.item;i<=t.item;++i){const e=this._providerElement(i);if(console.assert(!!e),!e)continue;const t=e.element().childTextNodes().map(se.Linkifier.untruncatedNodeText).join("");s.push(t)}const i=this._providerElement(t.item),n=i&&i.element();if(n&&t.node&&t.node.isSelfOrDescendant(n)){const e=this._textOffsetInNode(n,t.node,t.offset);s.length>0&&(s[s.length-1]=s[s.length-1].substring(0,e))}const o=this._providerElement(e.item),r=o&&o.element();if(r&&e.node&&e.node.isSelfOrDescendant(r)){const t=this._textOffsetInNode(r,e.node,e.offset);s[0]=s[0].substring(t)}return s.join("\n")}_textOffsetInNode(e,t,s){const i=t.textContent?t.textContent.length:0;t.nodeType!==Node.TEXT_NODE&&(s<t.childNodes.length?(t=t.childNodes.item(s),s=0):s=i);let n=0,o=e;for(;(o=o.traverseNextNode(e))&&o!==t;)o.nodeType!==Node.TEXT_NODE||o.parentElement&&("STYLE"===o.parentElement.nodeName||"SCRIPT"===o.parentElement.nodeName)||(n+=se.Linkifier.untruncatedNodeText(o).length);const r=se.Linkifier.untruncatedNodeText(t).length;return s>0&&r!==i&&(s=r),n+s}_onScroll(e){this.refresh()}firstVisibleIndex(){return this._cumulativeHeights.length?(this._rebuildCumulativeHeightsIfNeeded(),this._cumulativeHeights.lowerBound(this.element.scrollTop+1)):-1}lastVisibleIndex(){if(!this._cumulativeHeights.length)return-1;this._rebuildCumulativeHeightsIfNeeded();const e=this.element.scrollTop+this.element.clientHeight,t=this._itemCount-1;return this._cumulativeHeights.lowerBound(e,void 0,void 0,t)}renderedElementAt(e){return-1===e||e<this._firstActiveIndex||e>this._lastActiveIndex?null:this._renderedItems[e-this._firstActiveIndex].element()}scrollItemIntoView(e,t){const s=this.firstVisibleIndex(),i=this.lastVisibleIndex();e>s&&e<i||e===i&&this._cumulativeHeights[e]<=this.element.scrollTop+this._visibleHeight()||(t?this.forceScrollItemToBeLast(e):e<=s?this.forceScrollItemToBeFirst(e):e>=i&&this.forceScrollItemToBeLast(e))}forceScrollItemToBeFirst(e){console.assert(e>=0&&e<this._itemCount,"Cannot scroll item at invalid index"),this.setStickToBottom(!1),this._rebuildCumulativeHeightsIfNeeded(),this.element.scrollTop=e>0?this._cumulativeHeights[e-1]:0,w.isScrolledToBottom(this.element)&&this.setStickToBottom(!0),this.refresh();const t=this.renderedElementAt(e);t&&t.scrollIntoView(!0)}forceScrollItemToBeLast(e){console.assert(e>=0&&e<this._itemCount,"Cannot scroll item at invalid index"),this.setStickToBottom(!1),this._rebuildCumulativeHeightsIfNeeded(),this.element.scrollTop=this._cumulativeHeights[e]-this._visibleHeight(),w.isScrolledToBottom(this.element)&&this.setStickToBottom(!0),this.refresh();const t=this.renderedElementAt(e);t&&t.scrollIntoView(!1)}_visibleHeight(){return this.element.offsetHeight}}var Pe=Object.freeze({__proto__:null,ConsoleViewport:Fe,ConsoleViewportProvider:class{fastHeight(e){return 0}itemCount(){return 0}minimumRowHeight(){return 0}itemElement(e){return null}},ConsoleViewportElement:class{willHide(){}wasShown(){}element(){throw new Error("Unimplemented method")}focusLastChildOrSelf(){}}});const Re=new WeakMap,Ae=e=>Re.get(e),Be=e=>t=>t instanceof _.RemoteObject?t:e?"object"==typeof t?e.createRemoteObject(t):e.createRemoteObjectFromPrimitiveValue(t):_.RemoteObject.fromLocalObject(t);class Ve{constructor(e,t,s,i){this._message=e,this._linkifier=t,this._repeatCount=1,this._closeGroupDecorationCount=0,this._nestingLevel=s,this._selectableChildren=[],this._messageResized=i,this._element=null,this._previewFormatter=new J.RemoteObjectPreviewFormatter,this._searchRegex=null,this._messageLevelIcon=null,this._traceExpanded=!1,this._expandTrace=null,this._anchorElement=null,this._contentElement=null,this._nestingLevelMarkers=null,this._searchHighlightNodes=[],this._searchHighlightNodeChanges=[],this._isVisible=!1,this._cachedHeight=0,this._messagePrefix="",this._timestampElement=null,this._inSimilarGroup=!1,this._similarGroupMarker=null,this._lastInSimilarGroup=!1,this._groupKey="",this._repeatCountElement=null}element(){return this.toMessageElement()}wasShown(){this._isVisible=!0}onResize(){}willHide(){this._isVisible=!1,this._cachedHeight=this.element().offsetHeight}isVisible(){return this._isVisible}fastHeight(){return this._cachedHeight?this._cachedHeight:this.approximateFastHeight()}approximateFastHeight(){return 19}consoleMessage(){return this._message}_buildMessage(){let t,i=this._message.messageText;if(this._message.source===m.MessageSource.ConsoleAPI)switch(this._message.type){case m.MessageType.Trace:t=this._format(this._message.parameters||["console.trace"]);break;case m.MessageType.Clear:t=document.createElement("span"),t.classList.add("console-info"),s.Settings.instance().moduleSetting("preserveConsoleLog").get()?t.textContent=e.UIString("console.clear() was prevented due to 'Preserve log'"):t.textContent=e.UIString("Console was cleared"),t.title=ls`Clear all messages with ${R.ShortcutRegistry.instance().shortcutTitleForAction("console.clear")}`;break;case m.MessageType.Dir:{const e=["%O",this._message.parameters?this._message.parameters[0]:void 0];t=this._format(e);break}case m.MessageType.Profile:case m.MessageType.ProfileEnd:t=this._format([i]);break;default:{if(this._message.type===m.MessageType.Assert&&(this._messagePrefix=ls`Assertion failed: `),this._message.parameters&&1===this._message.parameters.length){const e=this._message.parameters[0];"string"!=typeof e&&"string"===e.type&&(t=this._tryFormatAsError(e.value))}const e=this._message.parameters||[i];t=t||this._format(e)}}else if(this._message.source===m.MessageSource.Network)t=this._formatAsNetworkRequest()||this._format([i]);else{const s=this._message.parameters&&i===this._message.parameters[0];this._message.source===m.MessageSource.Violation?i=e.UIString("[Violation] %s",i):this._message.source===m.MessageSource.Intervention?i=e.UIString("[Intervention] %s",i):this._message.source===m.MessageSource.Deprecation&&(i=e.UIString("[Deprecation] %s",i));const n=this._message.parameters||[i];s&&(n[0]=i),t=this._format(n)}t.classList.add("console-message-text");const n=document.createElement("span");return n.classList.add("source-code"),this._anchorElement=this._buildMessageAnchor(),this._anchorElement&&n.appendChild(this._anchorElement),n.appendChild(t),n}_formatAsNetworkRequest(){const e=g.NetworkLog.requestForConsoleMessage(this._message);if(!e)return null;const t=document.createElement("span");if(this._message.level===m.MessageLevel.Error){w.createTextChild(t,e.requestMethod+" ");const s=se.Linkifier.linkifyRevealable(e,e.url(),e.url());s.tabIndex=-1,this._selectableChildren.push({element:s,forceSelect:()=>s.focus()}),t.appendChild(s),e.failed&&w.createTextChildren(t," ",e.localizedFailDescription||""),0!==e.statusCode&&w.createTextChildren(t," ",String(e.statusCode)),e.statusText&&w.createTextChildren(t," (",e.statusText,")")}else{const s=this._message.messageText,i=this._linkifyWithCustomLinkifier(s,(t,s,i,n)=>{const o=s===e.url()?se.Linkifier.linkifyRevealable(e,s,e.url()):se.Linkifier.linkifyURL(s,{text:t,lineNumber:i,columnNumber:n});return o.tabIndex=-1,this._selectableChildren.push({element:o,forceSelect:()=>o.focus()}),o});t.appendChild(i)}return t}_buildMessageAnchor(){const e=(e=>e.scriptId?this._linkifyScriptId(e.scriptId,e.url||"",e.line,e.column):e.stackTrace&&e.stackTrace.callFrames.length?this._linkifyStackTraceTopFrame(e.stackTrace):e.url&&"undefined"!==e.url?this._linkifyLocation(e.url,e.line,e.column):null)(this._message);if(e){e.tabIndex=-1,this._selectableChildren.push({element:e,forceSelect:()=>e.focus()});const t=document.createElement("span");return t.classList.add("console-message-anchor"),t.appendChild(e),w.createTextChild(t," "),t}return null}_buildMessageWithStackTrace(e){const t=document.createElement("div");t.classList.add("console-message-stack-trace-toggle");const s=t.createChild("div","console-message-stack-trace-wrapper"),i=this._buildMessage(),n=F.Icon.create("smallicon-triangle-right","console-message-expand-icon"),o=s.createChild("div");o.appendChild(n),o.tabIndex=-1,o.appendChild(i);const r=s.createChild("div"),a=ie.buildStackTracePreviewContents(e.target(),this._linkifier,{stackTrace:this._message.stackTrace,contentUpdated:void 0,tabStops:void 0});r.appendChild(a.element);for(const e of a.links)this._selectableChildren.push({element:e,forceSelect:()=>e.focus()});r.classList.add("hidden"),P.markAsTreeitem(this.element()),P.setExpanded(this.element(),!1),this._expandTrace=e=>{n.setIconType(e?"smallicon-triangle-down":"smallicon-triangle-right"),r.classList.toggle("hidden",!e),P.setExpanded(this.element(),e),this._traceExpanded=e};return o.addEventListener("click",e=>{w.isEditing()||s.hasSelection()||(this._expandTrace&&this._expandTrace(r.classList.contains("hidden")),e.consume())},!1),this._message.type===m.MessageType.Trace&&this._expandTrace(!0),t._expandStackTraceForTest=this._expandTrace.bind(this,!0),t}_linkifyLocation(e,t,s){const i=this._message.runtimeModel();return i?this._linkifier.linkifyScriptLocation(i.target(),null,e,t,{columnNumber:s,className:void 0,tabStop:void 0}):null}_linkifyStackTraceTopFrame(e){const t=this._message.runtimeModel();return t?this._linkifier.linkifyStackTraceTopFrame(t.target(),e):null}_linkifyScriptId(e,t,s,i){const n=this._message.runtimeModel();return n?this._linkifier.linkifyScriptLocation(n.target(),e,t,s,{columnNumber:i,className:void 0,tabStop:void 0}):null}_format(e){const t=document.createElement("span");if(this._messagePrefix&&(t.createChild("span").textContent=this._messagePrefix),!e.length)return t;let s=e.map(Be(this._message.runtimeModel()));const i="string"===_.RemoteObject.type(s[0])&&(this._message.type!==m.MessageType.Result||this._message.level===m.MessageLevel.Error);if(i){const e=this._formatWithSubstitutionString(s[0].description,s.slice(1),t);s=Array.from(e.unusedSubstitutions||[]),s.length&&w.createTextChild(t," ")}for(let e=0;e<s.length;++e)i&&"string"===s[e].type?t.appendChild(this._linkifyStringAsFragment(s[e].description||"")):t.appendChild(this._formatParameter(s[e],!1,!0)),e<s.length-1&&w.createTextChild(t," ");return t}_formatParameter(e,t,s){if(e.customPreview())return new X.CustomPreviewComponent(e).element;const i=t?"object":e.subtype||e.type;let n;switch(i){case"error":n=this._formatParameterAsError(e);break;case"function":n=this._formatParameterAsFunction(e,s);break;case"array":case"arraybuffer":case"blob":case"dataview":case"generator":case"iterator":case"map":case"object":case"promise":case"proxy":case"set":case"typedarray":case"weakmap":case"weakset":n=this._formatParameterAsObject(e,s);break;case"node":n=e.isNode()?this._formatParameterAsNode(e):this._formatParameterAsObject(e,!1);break;case"trustedtype":n=this._formatParameterAsObject(e,!1);break;case"string":n=this._formatParameterAsString(e);break;case"boolean":case"date":case"null":case"number":case"regexp":case"symbol":case"undefined":case"bigint":n=this._formatParameterAsValue(e);break;default:n=this._formatParameterAsValue(e),console.error(`Tried to format remote object of unknown type ${i}.`)}return n.classList.add("object-value-"+i),n.classList.add("source-code"),n}_formatParameterAsValue(e){const t=document.createElement("span"),s=e.description||"";if(s.length>qe()){const e=new Q.ExpandableTextPropertyValue(document.createElement("span"),s,$e());t.appendChild(e.element)}else w.createTextChild(t,s);return e.objectId&&t.addEventListener("contextmenu",this._contextMenuEventFired.bind(this,e),!1),t}_formatParameterAsTrustedType(e){const t=document.createElement("span"),s=document.createElement("span");return s.appendChild(this._formatParameterAsString(e)),s.classList.add("object-value-string"),w.createTextChild(t,e.className+" "),t.appendChild(s),t}_formatParameterAsObject(e,t){const s=document.createElement("span");if(s.classList.add("console-object"),t&&e.preview)s.classList.add("console-object-preview"),this._previewFormatter.appendObjectPreview(s,e.preview,!1);else if("function"===e.type){const t=s.createChild("span");Q.ObjectPropertiesSection.formatObjectAsFunction(e,t,!1),s.classList.add("object-value-function")}else"trustedtype"===e.subtype?s.appendChild(this._formatParameterAsTrustedType(e)):w.createTextChild(s,e.description||"");if(!e.hasChildren||e.customPreview())return s;const i=s.createChild("span","object-state-note info-note");this._message.type===m.MessageType.QueryObjectResult?i.title=ls`This value will not be collected until console is cleared.`:i.title=ls`This value was evaluated upon first expanding. It may have changed since then.`;const n=new Q.ObjectPropertiesSection(e,s,this._linkifier);return n.element.classList.add("console-view-object-properties-section"),n.enableContextMenu(),n.setShowSelectionOnKeyboardFocus(!0,!0),this._selectableChildren.push(n),n.addEventListener(k.Events.ElementAttached,this._messageResized),n.addEventListener(k.Events.ElementExpanded,this._messageResized),n.addEventListener(k.Events.ElementCollapsed,this._messageResized),n.element}_formatParameterAsFunction(t,s){const i=document.createElement("span");return _.RemoteFunction.objectAsFunction(t).targetFunction().then(function(n){const o=document.createElement("span"),r=Q.ObjectPropertiesSection.formatObjectAsFunction(n,o,!0,s);if(i.appendChild(o),n!==t){i.createChild("span","object-info-state-note").title=e.UIString("Function was resolved from bound function.")}i.addEventListener("contextmenu",this._contextMenuEventFired.bind(this,n),!1),r.then(()=>this._formattedParameterAsFunctionForTest())}.bind(this)),i}_formattedParameterAsFunctionForTest(){}_contextMenuEventFired(e,t){const s=new M.ContextMenu(t);s.appendApplicableItems(e),s.show()}_renderPropertyPreviewOrAccessor(e,t,s){return"accessor"===t.type?this._formatAsAccessorProperty(e,s.map(e=>e.name.toString()),!1):this._previewFormatter.renderPropertyPreview(t.type,"subtype"in t?t.subtype:void 0,null,t.value)}_formatParameterAsNode(e){const t=document.createElement("span"),s=e.runtimeModel().target().model(p.DOMModel);return s?(s.pushObjectAsNodeToFrontend(e).then(async s=>{if(!s)return void t.appendChild(this._formatParameterAsObject(e,!1));const i=await w.Renderer.render(s);i?(i.tree&&(this._selectableChildren.push(i.tree),i.tree.addEventListener(k.Events.ElementAttached,this._messageResized),i.tree.addEventListener(k.Events.ElementExpanded,this._messageResized),i.tree.addEventListener(k.Events.ElementCollapsed,this._messageResized)),t.appendChild(i.node)):t.appendChild(this._formatParameterAsObject(e,!1)),this._formattedParameterAsNodeForTest()}),t):t}_formattedParameterAsNodeForTest(){}_formatParameterAsString(e){const t=document.createElement("span");t.appendChild(this._linkifyStringAsFragment(e.description||""));const s=document.createElement("span");return s.createChild("span","object-value-string-quote").textContent='"',s.appendChild(t),s.createChild("span","object-value-string-quote").textContent='"',s}_formatParameterAsError(e){const t=document.createElement("span"),s=this._tryFormatAsError(e.description||"");return t.appendChild(s||this._linkifyStringAsFragment(e.description||"")),t}_formatAsArrayEntry(e){return this._previewFormatter.renderPropertyPreview(e.type,e.subtype,e.className,e.description)}_formatAsAccessorProperty(t,s,i){const n=Q.ObjectPropertyTreeElement.createRemoteObjectAccessorPropertySpan(t,s,function(t){const s=t.wasThrown,o=t.object;if(!o)return;if(n.removeChildren(),s){const t=n.createChild("span");t.textContent=e.UIString("<exception>"),t.title=o.description}else if(i)n.appendChild(this._formatAsArrayEntry(o));else{const e=100,t=o.type,s=o.subtype;let i="";"function"!==t&&o.description&&(i="string"===t||"regexp"===s||"trustedtype"===s?o.description.trimMiddle(e):o.description.trimEndWithMaxLength(e)),n.appendChild(this._previewFormatter.renderPropertyPreview(t,s,o.className,i))}}.bind(this));return n}_formatWithSubstitutionString(e,t,s){function i(e,t,s){return s instanceof _.RemoteObject?this._formatParameter(s,e,t):n(s)}function n(e){if(void 0!==e)return"string"==typeof e?e:e.description}function o(e){if(e instanceof _.RemoteObject)return"bigint"===e.type?e.description:"number"!=typeof e.value?"NaN":Math.floor(e.value)}let r=null;function a(e){const t=["background","border","color","font","line","margin","padding","text","-webkit-background","-webkit-border","-webkit-font","-webkit-margin","-webkit-padding","-webkit-text"];for(const s of t)if(e.startsWith(s))return!0;return!1}const l={};function h(e){if(r)for(const[t,{value:s,priority:i}]of r.entries())e.style.setProperty(t,s,i)}return l.o=i.bind(this,!1,!0),l.s=n,l.f=function(e){if(e instanceof _.RemoteObject)return"number"!=typeof e.value?"NaN":e.value},l.i=o,l.d=o,l.c=function(e){r=new Map;const t=document.createElement("span");if(void 0!==e&&"string"!=typeof e&&e.description){t.setAttribute("style",e.description);for(const e of t.style)if(a(e)){const s={value:t.style.getPropertyValue(e),priority:t.style.getPropertyPriority(e)};r.set(e,s)}}},l.O=i.bind(this,!0,!1),l._=function(e){return e instanceof Node?e:""},Y.format(e,t,l,s,function(e,t){if(t instanceof Node)return e.appendChild(t),e;if(void 0===t)return e;if(!r)return e.appendChild(this._linkifyStringAsFragment(String(t))),e;const s=String(t).split("\n");for(let t=0;t<s.length;t++){const i=s[t],n=this._linkifyStringAsFragment(i),o=document.createElement("span");o.style.setProperty("contain","paint"),o.style.setProperty("display","inline-block"),o.style.setProperty("max-width","100%"),o.appendChild(n),h(o);for(const e of o.children)e.classList.contains("devtools-link")&&e instanceof HTMLElement&&this._applyForcedVisibleStyle(e);e.appendChild(o),t<s.length-1&&e.appendChild(document.createElement("br"))}return e}.bind(this))}_applyForcedVisibleStyle(e){e.style.setProperty("-webkit-text-stroke","0","important"),e.style.setProperty("text-decoration","underline","important");const t=oe.instance().patchColorText("rgb(33%, 33%, 33%)",oe.ColorUsage.Foreground);e.style.setProperty("color",t,"important");let s="hsl(0, 0%, 100%)";this._message.level===m.MessageLevel.Error?s="hsl(0, 100%, 97%)":(this._message.level===m.MessageLevel.Warning||this._shouldRenderAsWarning())&&(s="hsl(50, 100%, 95%)");const i=oe.instance().patchColorText(s,oe.ColorUsage.Background);e.style.setProperty("background-color",i,"important")}matchesFilterRegex(e){e.lastIndex=0;const t=this.contentElement(),s=this._anchorElement?this._anchorElement.deepTextContent():"";return!!s&&e.test(s.trim())||e.test(t.deepTextContent().slice(s.length))}matchesFilterText(e){return this.contentElement().deepTextContent().toLowerCase().includes(e.toLowerCase())}updateTimestamp(){this._contentElement&&(s.Settings.instance().moduleSetting("consoleTimestampsEnabled").get()?(this._timestampElement||(this._timestampElement=document.createElement("span"),this._timestampElement.classList.add("console-timestamp")),this._timestampElement.textContent=w.formatTimestamp(this._message.timestamp,!1)+" ",this._timestampElement.title=w.formatTimestamp(this._message.timestamp,!0),this._contentElement.insertBefore(this._timestampElement,this._contentElement.firstChild)):this._timestampElement&&(this._timestampElement.remove(),this._timestampElement=null))}nestingLevel(){return this._nestingLevel}setInSimilarGroup(e,t){this._inSimilarGroup=e,this._lastInSimilarGroup=e&&!!t,this._similarGroupMarker&&!e?(this._similarGroupMarker.remove(),this._similarGroupMarker=null):this._element&&!this._similarGroupMarker&&e&&(this._similarGroupMarker=document.createElement("div"),this._similarGroupMarker.classList.add("nesting-level-marker"),this._element.insertBefore(this._similarGroupMarker,this._element.firstChild),this._similarGroupMarker.classList.toggle("group-closed",this._lastInSimilarGroup))}isLastInSimilarGroup(){return!!this._inSimilarGroup&&!!this._lastInSimilarGroup}resetCloseGroupDecorationCount(){this._closeGroupDecorationCount&&(this._closeGroupDecorationCount=0,this._updateCloseGroupDecorations())}incrementCloseGroupDecorationCount(){++this._closeGroupDecorationCount,this._updateCloseGroupDecorations()}_updateCloseGroupDecorations(){if(this._nestingLevelMarkers)for(let e=0,t=this._nestingLevelMarkers.length;e<t;++e){this._nestingLevelMarkers[e].classList.toggle("group-closed",t-e<=this._closeGroupDecorationCount)}}_focusedChildIndex(){return this._selectableChildren.length?this._selectableChildren.findIndex(e=>e.element.hasFocus()):-1}_onKeyDown(e){!w.isEditing()&&this._element&&this._element.hasFocus()&&!this._element.hasSelection()&&this.maybeHandleOnKeyDown(e)&&e.consume(!0)}maybeHandleOnKeyDown(e){const t=this._focusedChildIndex(),s=-1===t;if(this._expandTrace&&s&&("ArrowLeft"===e.key&&this._traceExpanded||"ArrowRight"===e.key&&!this._traceExpanded))return this._expandTrace(!this._traceExpanded),!0;if(!this._selectableChildren.length)return!1;if("ArrowLeft"===e.key)return this._element&&this._element.focus(),!0;if("ArrowRight"===e.key&&s&&this._selectNearestVisibleChild(0))return!0;if("ArrowUp"===e.key){const e=this._nearestVisibleChild(0);if(this._selectableChildren[t]===e&&e)return this._element&&this._element.focus(),!0;if(this._selectNearestVisibleChild(t-1,!0))return!0}if("ArrowDown"===e.key){if(s&&this._selectNearestVisibleChild(0))return!0;if(!s&&this._selectNearestVisibleChild(t+1))return!0}return!1}_selectNearestVisibleChild(e,t){const s=this._nearestVisibleChild(e,t);return!!s&&(s.forceSelect(),!0)}_nearestVisibleChild(e,t){const s=this._selectableChildren.length;if(e<0||e>=s)return null;const i=t?-1:1;let n=e;for(;!this._selectableChildren[n].element.offsetParent;)if(n+=i,n<0||n>=s)return null;return this._selectableChildren[n]}focusLastChildOrSelf(){this._element&&!this._selectNearestVisibleChild(this._selectableChildren.length-1,!0)&&this._element.focus()}setContentElement(e){console.assert(!this._contentElement,"Cannot set content element twice"),this._contentElement=e}getContentElement(){return this._contentElement}contentElement(){if(this._contentElement)return this._contentElement;const e=document.createElement("div");e.classList.add("console-message"),this._messageLevelIcon&&e.appendChild(this._messageLevelIcon),this._contentElement=e;const t=this._message.runtimeModel();let s;const i=!!this._message.stackTrace&&(this._message.source===m.MessageSource.Network||this._message.source===m.MessageSource.Violation||this._message.level===m.MessageLevel.Error||this._message.level===m.MessageLevel.Warning||this._message.type===m.MessageType.Trace);return s=t&&i?this._buildMessageWithStackTrace(t):this._buildMessage(),e.appendChild(s),this.updateTimestamp(),this._contentElement}toMessageElement(){return this._element||(this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.addEventListener("keydown",this._onKeyDown.bind(this)),this.updateMessageElement()),this._element}updateMessageElement(){if(this._element){this._element.className="console-message-wrapper",this._element.removeChildren(),this._message.isGroupStartMessage()&&this._element.classList.add("console-group-title"),this._message.source===m.MessageSource.ConsoleAPI&&this._element.classList.add("console-from-api"),this._inSimilarGroup&&(this._similarGroupMarker=this._element.createChild("div","nesting-level-marker"),this._similarGroupMarker.classList.toggle("group-closed",this._lastInSimilarGroup)),this._nestingLevelMarkers=[];for(let e=0;e<this._nestingLevel;++e)this._nestingLevelMarkers.push(this._element.createChild("div","nesting-level-marker"));switch(this._updateCloseGroupDecorations(),Re.set(this._element,this),this._message.level){case m.MessageLevel.Verbose:this._element.classList.add("console-verbose-level");break;case m.MessageLevel.Info:this._element.classList.add("console-info-level"),this._message.type===m.MessageType.System&&this._element.classList.add("console-system-type");break;case m.MessageLevel.Warning:this._element.classList.add("console-warning-level");break;case m.MessageLevel.Error:this._element.classList.add("console-error-level")}this._updateMessageLevelIcon(),this._shouldRenderAsWarning()&&this._element.classList.add("console-warning-level"),this._element.appendChild(this.contentElement()),this._repeatCount>1&&this._showRepeatCountElement()}}_shouldRenderAsWarning(){return!(this._message.level!==m.MessageLevel.Verbose&&this._message.level!==m.MessageLevel.Info||this._message.source!==m.MessageSource.Violation&&this._message.source!==m.MessageSource.Deprecation&&this._message.source!==m.MessageSource.Intervention&&this._message.source!==m.MessageSource.Recommendation)}_updateMessageLevelIcon(){let e="",t="";if(this._message.level===m.MessageLevel.Warning?(e="smallicon-warning",t=ls`Warning`):this._message.level===m.MessageLevel.Error&&(e="smallicon-error",t=ls`Error`),!this._messageLevelIcon){if(!e)return;this._messageLevelIcon=F.Icon.create("","message-level-icon"),this._contentElement&&this._contentElement.insertBefore(this._messageLevelIcon,this._contentElement.firstChild)}this._messageLevelIcon.setIconType(e),P.setAccessibleName(this._messageLevelIcon,t)}repeatCount(){return this._repeatCount||1}resetIncrementRepeatCount(){this._repeatCount=1,this._repeatCountElement&&(this._repeatCountElement.remove(),this._contentElement&&this._contentElement.classList.remove("repeated-message"),this._repeatCountElement=null)}incrementRepeatCount(){this._repeatCount++,this._showRepeatCountElement()}setRepeatCount(e){this._repeatCount=e,this._showRepeatCountElement()}_showRepeatCountElement(){if(!this._element)return;if(!this._repeatCountElement){switch(this._repeatCountElement=document.createElement("span",{is:"dt-small-bubble"}),this._repeatCountElement.classList.add("console-message-repeat-count"),this._message.level){case m.MessageLevel.Warning:this._repeatCountElement.type="warning";break;case m.MessageLevel.Error:this._repeatCountElement.type="error";break;case m.MessageLevel.Verbose:this._repeatCountElement.type="verbose";break;default:this._repeatCountElement.type="info"}this._shouldRenderAsWarning()&&(this._repeatCountElement.type="warning"),this._element.insertBefore(this._repeatCountElement,this._contentElement),this.contentElement().classList.add("repeated-message")}this._repeatCountElement.textContent=""+this._repeatCount;let e=ls`Repeat ${this._repeatCount}`;this._message.level===m.MessageLevel.Warning?e=ls`Warning ${e}`:this._message.level===m.MessageLevel.Error&&(e=ls`Error ${e}`),P.setAccessibleName(this._repeatCountElement,e)}get text(){return this._message.messageText}toExportString(){const e=[],t=this.contentElement().childTextNodes().map(se.Linkifier.untruncatedNodeText).join("");for(let s=0;s<this.repeatCount();++s)e.push(t);return e.join("\n")}setSearchRegex(e){if(this._searchHighlightNodeChanges&&this._searchHighlightNodeChanges.length&&w.revertDomChanges(this._searchHighlightNodeChanges),this._searchRegex=e,this._searchHighlightNodes=[],this._searchHighlightNodeChanges=[],!this._searchRegex)return;const t=this.contentElement().deepTextContent();let s;this._searchRegex.lastIndex=0;const i=[];for(;(s=this._searchRegex.exec(t))&&s[0];)i.push(new K.SourceRange(s.index,s[0].length));i.length&&(this._searchHighlightNodes=w.highlightSearchResults(this.contentElement(),i,this._searchHighlightNodeChanges))}searchRegex(){return this._searchRegex}searchCount(){return this._searchHighlightNodes.length}searchHighlightNode(e){return this._searchHighlightNodes[e]}_tryFormatAsError(e){const s=this._message.runtimeModel();if(!s||!["EvalError","ReferenceError","SyntaxError","TypeError","RangeError","Error","URIError"].some((function(t){return e.startsWith(t)})))return null;const i=s.debuggerModel(),n=s.target().inspectedURL(),o=e.split("\n"),r=[];let a=0;for(let e=0;e<o.length;++e){a+=e>0?o[e-1].length+1:0;const s=/^\s*at\s/.test(o[e]);if(!s&&r.length)return null;if(!s)continue;let i=-1,l=-1;const h=/\([^\)\(]+:\d+:\d+\)/g,d=/\([^\)\(]+\)/g;let u,m=null;for(;u=h.exec(o[e]);)m=u;if(!m)for(;u=d.exec(o[e]);)m=u;m&&(i=m.index,l=m.index+m[0].length-1);const _=-1!==i,g=_?i+1:o[e].indexOf("at")+3,p=_?l:o[e].length,f=o[e].substring(g,p),v=t.ParsedURL.splitLineAndColumn(f);if(!v)return null;if("<anonymous>"===v.url)continue;let C=c(v.url);if(!C&&t.ParsedURL.isRelativeURL(v.url)&&(C=c(t.ParsedURL.completeURL(n,v.url))),!C)return null;r.push({url:C,positionLeft:a+g,positionRight:a+p,lineNumber:v.lineNumber,columnNumber:v.columnNumber})}if(!r.length)return null;const l=document.createElement("span");let h=0;for(let t=0;t<r.length;++t){l.appendChild(this._linkifyStringAsFragment(e.substring(h,r[t].positionLeft)));const s=this._linkifier.linkifyScriptLocation(i.target(),null,r[t].url,r[t].lineNumber,{columnNumber:r[t].columnNumber,className:void 0,tabStop:void 0});s.tabIndex=-1,this._selectableChildren.push({element:s,forceSelect:()=>s.focus()}),l.appendChild(s),h=r[t].positionRight}return h!==e.length&&l.appendChild(this._linkifyStringAsFragment(e.substring(h))),l;function c(e){if(!e)return null;const s=t.ParsedURL.fromString(e);return s?s.url:i.scriptsForSourceURL(e).length?e:null}}_linkifyWithCustomLinkifier(e,s){if(e.length>qe()){const t=new Q.ExpandableTextPropertyValue(document.createElement("span"),e,$e()),s=document.createDocumentFragment();return s.appendChild(t.element),s}const i=document.createDocumentFragment(),n=Ve._tokenizeMessageText(e);for(const e of n)if(e.text)switch(e.type){case"url":{const n=e.text.startsWith("www.")?"http://"+e.text:e.text,o=t.ParsedURL.splitLineAndColumn(n),r=t.ParsedURL.removeWasmFunctionInfoFromURL(o.url);let a;a=o?s(e.text,r,o.lineNumber,o.columnNumber):s(e.text,""),i.appendChild(a);break}default:i.appendChild(document.createTextNode(e.text))}return i}_linkifyStringAsFragment(e){return this._linkifyWithCustomLinkifier(e,(e,t,s,i)=>{const n={text:e,lineNumber:s,columnNumber:i},o=se.Linkifier.linkifyURL(t,n);return o.tabIndex=-1,this._selectableChildren.push({element:o,forceSelect:()=>o.focus()}),o})}static _tokenizeMessageText(e){const{tokenizerRegexes:t,tokenizerTypes:s}=Oe();if(e.length>qe())return[{text:e,type:void 0}];return z.Utils.splitStringByRegexes(e,t).map(e=>({text:e.value,type:s[e.regexIndex]}))}groupKey(){return this._groupKey||(this._groupKey=this._message.groupCategoryKey()+":"+this.groupTitle()),this._groupKey}groupTitle(){return Ve._tokenizeMessageText(this._message.messageText).reduce((t,s)=>{let i=s.text;return"url"===s.type?i=e.UIString("<URL>"):"time"===s.type?i=e.UIString("took <N>ms"):"event"===s.type?i=e.UIString("<some> event"):"milestone"===s.type?i=e.UIString(" M<XX>"):"autofill"===s.type&&(i=e.UIString("<attribute>")),t+i},"").replace(/[%]o/g,"")}}let He=null,Ne=null;function Oe(){if(!He||!Ne){const e="\\u0000-\\u0020\\u007f-\\u009f",t=new RegExp("(?:[a-zA-Z][a-zA-Z0-9+.-]{2,}:\\/\\/|data:|www\\.)[^\\s"+e+'"]{2,}[^\\s'+e+"\"')}\\],:;.!?]","u"),s=/(?:\/[\w\.-]*)+\:[\d]+/,i=/took [\d]+ms/,n=/'\w+' event/,o=/\sM[6-7]\d/,r=/\(suggested: \"[\w-]+\"\)/,a=new Map;return a.set(t,"url"),a.set(s,"url"),a.set(i,"time"),a.set(n,"event"),a.set(o,"milestone"),a.set(r,"autofill"),He=Array.from(a.keys()),Ne=Array.from(a.values()),{tokenizerRegexes:He,tokenizerTypes:Ne}}return{tokenizerRegexes:He,tokenizerTypes:Ne}}class Ge extends Ve{constructor(e,t,s,i,n){console.assert(e.isGroupStartMessage()),super(e,t,s,n),this._collapsed=e.type===m.MessageType.StartGroupCollapsed,this._expandGroupIcon=null,this._onToggle=i}_setCollapsed(e){this._collapsed=e,this._expandGroupIcon&&this._expandGroupIcon.setIconType(this._collapsed?"smallicon-triangle-right":"smallicon-triangle-down"),this._onToggle.call(null)}collapsed(){return this._collapsed}maybeHandleOnKeyDown(e){return-1===this._focusedChildIndex()&&("ArrowLeft"===e.key&&!this._collapsed||"ArrowRight"===e.key&&this._collapsed)?(this._setCollapsed(!this._collapsed),!0):super.maybeHandleOnKeyDown(e)}toMessageElement(){let e=this._element||null;if(!e){e=super.toMessageElement();const t=this._collapsed?"smallicon-triangle-right":"smallicon-triangle-down";this._expandGroupIcon=F.Icon.create(t,"expand-group-icon"),this.contentElement().tabIndex=-1,this._repeatCountElement?this._repeatCountElement.insertBefore(this._expandGroupIcon,this._repeatCountElement.firstChild):e.insertBefore(this._expandGroupIcon,this._contentElement),e.addEventListener("click",()=>this._setCollapsed(!this._collapsed))}return e}_showRepeatCountElement(){super._showRepeatCountElement(),this._repeatCountElement&&this._expandGroupIcon&&this._repeatCountElement.insertBefore(this._expandGroupIcon,this._repeatCountElement.firstChild)}}class De extends Ve{constructor(e,t,s,i){super(e,t,s,i),this._formattedCommand=null}contentElement(){const e=this.getContentElement();if(e)return e;const t=document.createElement("div");this.setContentElement(t),t.classList.add("console-user-command");const s=F.Icon.create("smallicon-user-command","command-result-icon");if(t.appendChild(s),Re.set(t,this),this._formattedCommand=document.createElement("span"),this._formattedCommand.classList.add("source-code"),this._formattedCommand.textContent=Y.replaceControlCharacters(this.text),t.appendChild(this._formattedCommand),this._formattedCommand.textContent.length<We){new A.SyntaxHighlighter("text/javascript",!0).syntaxHighlightNode(this._formattedCommand).then(this._updateSearch.bind(this))}else this._updateSearch();return this.updateTimestamp(),t}_updateSearch(){this.setSearchRegex(this.searchRegex())}}class Ue extends Ve{contentElement(){const e=super.contentElement();if(!e.classList.contains("console-user-command-result")&&(e.classList.add("console-user-command-result"),this.consoleMessage().level===m.MessageLevel.Info)){const t=F.Icon.create("smallicon-command-result","command-result-icon");e.insertBefore(t,e.firstChild)}return e}}class je extends Ve{constructor(e,t,s,i){super(e,t,s,i),console.assert(e.type===m.MessageType.Table),this._dataGrid=null}wasShown(){this._dataGrid&&this._dataGrid.updateWidths(),super.wasShown()}onResize(){this.isVisible()&&this._dataGrid&&this._dataGrid.onResize()}contentElement(){const e=this.getContentElement();if(e)return e;const t=document.createElement("div");return t.classList.add("console-message"),this._messageLevelIcon&&t.appendChild(this._messageLevelIcon),this.setContentElement(t),t.appendChild(this._buildTableMessage()),this.updateTimestamp(),t}_buildTableMessage(){const t=document.createElement("span");t.classList.add("source-code"),this._anchorElement=this._buildMessageAnchor(),this._anchorElement&&t.appendChild(this._anchorElement);const s=this._message.parameters&&this._message.parameters.length?this._message.parameters[0]:null;if(!s)return this._buildMessage();const i=Be(this._message.runtimeModel())(s);if(!i||!i.preview)return this._buildMessage();const n=Symbol("rawValueColumn"),o=[],r=i.preview,a=[];for(let e=0;e<r.properties.length;++e){const t=r.properties[e];let s;if(t.valuePreview)s=t.valuePreview.properties;else{if(!t.value)continue;s=[{name:n,type:t.type,value:t.value}]}const l=new Map,h=20;for(let e=0;e<s.length;++e){const n=s[e];let r=-1!==o.indexOf(n.name);if(!r){if(o.length===h)continue;r=!0,o.push(n.name)}if(r){const e=this._renderPropertyPreviewOrAccessor(i,n,[t,n]);e.classList.add("console-message-nowrap-below"),l.set(n.name,e)}}a.push({rowName:t.name,rowValue:l})}const l=[];for(const{rowName:e,rowValue:t}of a){l.push(e);for(let e=0;e<o.length;++e)l.push(t.get(o[e]))}o.unshift(e.UIString("(index)"));const h=o.map(t=>t===n?e.UIString("Value"):t.toString());if(l.length&&(this._dataGrid=ne.SortableDataGrid.create(h,l,ls`Console`),this._dataGrid)){this._dataGrid.setStriped(!0),this._dataGrid.setFocusable(!1);const e=document.createElement("span");e.classList.add("console-message-text");const s=e.createChild("div","console-message-formatted-table"),n=s.createChild("span");s.appendChild(this._formatParameter(i,!0,!1)),n.appendChild(this._dataGrid.element),t.appendChild(e),this._dataGrid.renderInline()}return t}approximateFastHeight(){const e=this._message.parameters&&this._message.parameters[0];return e&&"string"!=typeof e&&e.preview?19*e.preview.properties.length:19}}const We=1e4;let ze=1e4,Ke=5e3;const qe=()=>ze,$e=()=>Ke;var Je=Object.freeze({__proto__:null,getMessageForElement:Ae,ConsoleViewMessage:Ve,ConsoleGroupViewMessage:Ge,ConsoleCommand:De,ConsoleCommandResult:Ue,ConsoleTableMessageView:je,MaxLengthForLinks:40,getMaxTokenizableStringLength:qe,setMaxTokenizableStringLength:e=>{ze=e},getLongStringVisibleLength:$e,setLongStringVisibleLength:e=>{Ke=e}});let Xe;class Qe{constructor(){this._cachedIssueBarHeight=0,this._issueBar=null}willHide(){this._cachedIssueBarHeight=this._issueBar&&this._issueBar.element.offsetHeight||0}wasShown(){}element(){if(!this._issueBar){const e={text:ls`View issues`,highlight:!1,delegate:()=>{re.issuesPanelOpenedFrom(ae.IssueOpener.ConsoleInfoBar),B.ViewManager.instance().showView("issues-pane")},dismiss:!1};this._issueBar=new V.Infobar(V.Type.Issue,ls`Some messages have been moved to the Issues panel.`,[e]),this._issueBar.element.tabIndex=-1,this._issueBar.element.classList.add("console-message-wrapper")}return this._issueBar.element}focusLastChildOrSelf(){this._issueBar&&this._issueBar.element.focus()}fastHeight(){return this._cachedIssueBarHeight||37}toExportString(){return ls`Some messages have been moved to the Issues panel.`}}class Ze extends L.VBox{constructor(){super(),this.setMinimumSize(0,35),this.registerRequiredCSS("console/consoleView.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("object_ui/objectValue.css",{enableLegacyPatching:!0}),this._searchableView=new H.SearchableView(this),this._searchableView.element.classList.add("console-searchable-view"),this._searchableView.setPlaceholder(e.UIString("Find string in logs")),this._searchableView.setMinimalSearchQuerySize(0),this._sidebar=new xe,this._sidebar.addEventListener(Se.FilterSelected,this._onFilterChanged.bind(this)),this._isSidebarOpen=!1,this._filter=new et(this._onFilterChanged.bind(this)),this._consoleToolbarContainer=this.element.createChild("div","console-toolbar-container"),this._splitWidget=new N.SplitWidget(!0,!1,"console.sidebar.width",100),this._splitWidget.setMainWidget(this._searchableView),this._splitWidget.setSidebarWidget(this._sidebar),this._splitWidget.show(this.element),this._splitWidget.hideSidebar(),this._splitWidget.enableShowModeSaving(),this._isSidebarOpen=this._splitWidget.showMode()===N.ShowMode.Both,this._isSidebarOpen&&this._filter._levelMenuButton.setEnabled(!1),this._splitWidget.addEventListener(N.Events.ShowModeChanged,e=>{this._isSidebarOpen=e.data===N.ShowMode.Both,this._filter._levelMenuButton.setEnabled(!this._isSidebarOpen),this._onFilterChanged()}),this._contentsElement=this._searchableView.element,this.element.classList.add("console-view"),this._visibleViewMessages=[],this._hiddenByFilterCount=0,this._shouldBeHiddenCache=new Set,this._lastShownHiddenByFilterCount,this._currentMatchRangeIndex,this._searchRegex,this._groupableMessages=new Map,this._groupableMessageTitle=new Map,this._shortcuts=new Map,this._regexMatchRanges=[],this._consoleContextSelector=new ue,this._filterStatusText=new b.ToolbarText,this._filterStatusText.element.classList.add("dimmed"),this._showSettingsPaneSetting=s.Settings.instance().createSetting("consoleShowSettingsToolbar",!1),this._showSettingsPaneButton=new b.ToolbarSettingToggle(this._showSettingsPaneSetting,"largeicon-settings-gear",e.UIString("Console settings")),this._progressToolbarItem=new b.ToolbarItem(document.createElement("div")),this._groupSimilarSetting=s.Settings.instance().moduleSetting("consoleGroupSimilar"),this._groupSimilarSetting.addChangeListener(()=>this._updateMessageList());const t=new b.ToolbarSettingCheckbox(this._groupSimilarSetting,e.UIString("Group similar messages in console")),i=new b.Toolbar("console-main-toolbar",this._consoleToolbarContainer),n=new b.Toolbar("",this._consoleToolbarContainer);i.appendToolbarItem(this._splitWidget.createShowHideSidebarButton(ls`console sidebar`)),i.appendToolbarItem(b.Toolbar.createActionButton(O.ActionRegistry.instance().action("console.clear"))),i.appendSeparator(),i.appendToolbarItem(this._consoleContextSelector.toolbarItem()),i.appendSeparator();const r=b.Toolbar.createActionButton(O.ActionRegistry.instance().action("console.create-pin"));i.appendToolbarItem(r),i.appendSeparator(),i.appendToolbarItem(this._filter._textFilterUI),i.appendToolbarItem(this._filter._levelMenuButton),i.appendToolbarItem(this._progressToolbarItem),n.appendSeparator(),n.appendToolbarItem(this._filterStatusText),n.appendToolbarItem(this._showSettingsPaneButton),this._preserveLogCheckbox=new b.ToolbarSettingCheckbox(s.Settings.instance().moduleSetting("preserveConsoleLog"),e.UIString("Do not clear log on page reload / navigation"),e.UIString("Preserve log")),this._hideNetworkMessagesCheckbox=new b.ToolbarSettingCheckbox(this._filter._hideNetworkMessagesSetting,this._filter._hideNetworkMessagesSetting.title(),e.UIString("Hide network"));const h=new b.ToolbarSettingCheckbox(this._filter._filterByExecutionContextSetting,e.UIString("Only show messages from the current context (top, iframe, worker, extension)"),e.UIString("Selected context only")),c=s.Settings.instance().moduleSetting("monitoringXHREnabled");this._timestampsSetting=s.Settings.instance().moduleSetting("consoleTimestampsEnabled"),this._consoleHistoryAutocompleteSetting=s.Settings.instance().moduleSetting("consoleHistoryAutocomplete");const d=new L.HBox;d.show(this._contentsElement),d.element.classList.add("console-settings-pane"),P.setAccessibleName(d.element,ls`Console settings`),P.markAsGroup(d.element);const u=new b.Toolbar("",d.element);u.makeVertical(),u.appendToolbarItem(this._hideNetworkMessagesCheckbox),u.appendToolbarItem(this._preserveLogCheckbox),u.appendToolbarItem(h),u.appendToolbarItem(t);const _=new b.Toolbar("",d.element);_.makeVertical(),_.appendToolbarItem(new b.ToolbarSettingCheckbox(c));const g=new b.ToolbarSettingCheckbox(s.Settings.instance().moduleSetting("consoleEagerEval"),ls`Eagerly evaluate text in the prompt`);_.appendToolbarItem(g),_.appendToolbarItem(new b.ToolbarSettingCheckbox(this._consoleHistoryAutocompleteSetting));const p=new b.ToolbarSettingCheckbox(s.Settings.instance().moduleSetting("consoleUserActivationEval"));_.appendToolbarItem(p),this._showSettingsPaneSetting.get()||d.element.classList.add("hidden"),this._showSettingsPaneSetting.addChangeListener(()=>d.element.classList.toggle("hidden",!this._showSettingsPaneSetting.get())),this._pinPane=new ve(r),this._pinPane.element.classList.add("console-view-pinpane"),this._pinPane.show(this._contentsElement),this._pinPane.element.addEventListener("keydown",e=>{("Enter"===e.key&&T.KeyboardShortcut.eventHasCtrlOrMeta(e)||e.keyCode===T.Keys.Esc.code)&&(this._prompt.focus(),e.consume())}),this._viewport=new Fe(this),this._viewport.setStickToBottom(!0),this._viewport.contentElement().classList.add("console-group","console-group-messages"),this._contentsElement.appendChild(this._viewport.element),this._messagesElement=this._viewport.element,this._messagesElement.id="console-messages",this._messagesElement.classList.add("monospace"),this._messagesElement.addEventListener("click",this._messagesClicked.bind(this),!1),this._messagesElement.addEventListener("paste",this._messagesPasted.bind(this),!0),this._messagesElement.addEventListener("clipboard-paste",this._messagesPasted.bind(this),!0),P.markAsGroup(this._messagesElement),this._viewportThrottler=new o.Throttler(50),this._pendingBatchResize=!1,this._onMessageResizedBound=e=>{this._onMessageResized(e)},this._topGroup=tt.createTopGroup(),this._currentGroup=this._topGroup,this._promptElement=this._messagesElement.createChild("div","source-code"),this._promptElement.id="console-prompt";const f=this._messagesElement.createChild("div","console-view-fix-select-all");f.textContent=".",P.markAsHidden(f),this._registerShortcuts(),this._messagesElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!1),this._linkifier=new se.Linkifier(40),this._consoleMessages=[],this._viewMessageSymbol=Symbol("viewMessage"),this._consoleHistorySetting=s.Settings.instance().createLocalSetting("consoleHistory",[]),this._prompt=new ct,this._prompt.show(this._promptElement),this._prompt.element.addEventListener("keydown",this._promptKeyDown.bind(this),!0),this._prompt.addEventListener(ut.TextChanged,this._promptTextChanged,this),this._messagesElement.addEventListener("keydown",this._messagesKeyDown.bind(this),!1),this._prompt.element.addEventListener("focusin",()=>{this._isScrolledToBottom()&&this._viewport.setStickToBottom(!0)}),this._consoleHistoryAutocompleteSetting.addChangeListener(this._consoleHistoryAutocompleteChanged,this);const v=this._consoleHistorySetting.get();this._prompt.history().setHistoryData(v),this._consoleHistoryAutocompleteChanged(),this._updateFilterStatus(),this._timestampsSetting.addChangeListener(this._consoleTimestampsSettingChanged,this),this._registerWithMessageSink(),x.Context.instance().addFlavorChangeListener(l.ExecutionContext,this._executionContextChanged,this),this._messagesElement.addEventListener("mousedown",e=>this._updateStickToBottomOnPointerDown(2===e.button),!1),this._messagesElement.addEventListener("mouseup",this._updateStickToBottomOnPointerUp.bind(this),!1),this._messagesElement.addEventListener("mouseleave",this._updateStickToBottomOnPointerUp.bind(this),!1),this._messagesElement.addEventListener("wheel",this._updateStickToBottomOnWheel.bind(this),!1),this._messagesElement.addEventListener("touchstart",this._updateStickToBottomOnPointerDown.bind(this,!1),!1),this._messagesElement.addEventListener("touchend",this._updateStickToBottomOnPointerUp.bind(this),!1),this._messagesElement.addEventListener("touchcancel",this._updateStickToBottomOnPointerUp.bind(this),!1),m.ConsoleModel.instance().addEventListener(m.Events.ConsoleCleared,this._consoleCleared,this),m.ConsoleModel.instance().addEventListener(m.Events.MessageAdded,this._onConsoleMessageAdded,this),m.ConsoleModel.instance().addEventListener(m.Events.MessageUpdated,this._onConsoleMessageUpdated,this),m.ConsoleModel.instance().addEventListener(m.Events.CommandEvaluated,this._commandEvaluated,this),m.ConsoleModel.instance().messages().forEach(this._addConsoleMessage,this),a.TargetManager.instance().addModelListener(l.RuntimeModel,l.Events.ExecutionContextCreated,this._executionContextCreated,this),this._issueMessage=void 0;const C=de.IssuesManager.instance();C.addEventListener(de.Events.IssuesCountUpdated,this._onIssuesCountChanged.bind(this)),C.numberOfIssues()&&this._onIssuesCountChanged()}_onIssuesCountChanged(){0===de.IssuesManager.instance().numberOfIssues()?this._issueMessage&&(this._issueMessage.element().remove(),this._issueMessage=void 0,this._scheduleViewportRefresh()):this._issueMessage||(this._issueMessage=new Qe,this._scheduleViewportRefresh())}static instance(){return Xe||(Xe=new Ze),Xe}static clearConsole(){const e=Ze.instance();e._issueMessage&&(e._issueMessage.element().remove(),e._issueMessage=void 0,e._scheduleViewportRefresh()),m.ConsoleModel.instance().requestClearMessages()}_onFilterChanged(){if(this._filter._currentFilter.levelsMask=this._isSidebarOpen?_e.allLevelsFilterValue():this._filter._messageLevelFiltersSetting.get(),this._cancelBuildHiddenCache(),this._immediatelyFilterMessagesForTest){for(const e of this._consoleMessages)this._computeShouldMessageBeVisible(e);this._updateMessageList()}else this._buildHiddenCache(0,this._consoleMessages.slice())}_setImmediatelyFilterMessagesForTest(){this._immediatelyFilterMessagesForTest=!0}searchableView(){return this._searchableView}_clearHistory(){this._consoleHistorySetting.set([]),this._prompt.history().setHistoryData([])}_consoleHistoryAutocompleteChanged(){this._prompt.setAddCompletionsFromHistory(this._consoleHistoryAutocompleteSetting.get())}itemCount(){return this._issueMessage?this._visibleViewMessages.length+1:this._visibleViewMessages.length}itemElement(e){const t=this._issueMessage;return t?0===e?t:this._visibleViewMessages[e-1]:this._visibleViewMessages[e]}fastHeight(e){const t=this._issueMessage;return t?0===e?t.fastHeight()||37:this._visibleViewMessages[e-1].fastHeight():this._visibleViewMessages[e].fastHeight()}minimumRowHeight(){return 16}_registerWithMessageSink(){r.Console.instance().messages().forEach(this._addSinkMessage,this),r.Console.instance().addEventListener(r.Events.MessageAdded,(function(e){this._addSinkMessage(e.data)}),this)}_addSinkMessage(e){let t=m.MessageLevel.Verbose;switch(e.level){case r.MessageLevel.Info:t=m.MessageLevel.Info;break;case r.MessageLevel.Error:t=m.MessageLevel.Error;break;case r.MessageLevel.Warning:t=m.MessageLevel.Warning}const s=new m.ConsoleMessage(null,m.MessageSource.Other,t,e.text,m.MessageType.System,void 0,void 0,void 0,void 0,void 0,e.timestamp);this._addConsoleMessage(s)}_consoleTimestampsSettingChanged(){this._updateMessageList(),this._consoleMessages.forEach(e=>e.updateTimestamp()),this._groupableMessageTitle.forEach(e=>e.updateTimestamp())}_executionContextChanged(){this._prompt.clearAutocomplete()}_executionContextCreated(e){const t=e.data;if(!t.frameId)return;const s=this._consoleMessages.length;this._consoleMessages=this._consoleMessages.filter(e=>{const s=e.consoleMessage();return!s.frameId||!s.executionContextId||s.executionContextId!==t.id||s.frameId!==t.frameId});this._consoleMessages.length<s&&this._updateMessageList()}willHide(){this._hidePromptSuggestBox()}wasShown(){this._viewport.refresh()}focus(){this._viewport.hasVirtualSelection()?this._viewport.contentElement().focus():this._focusPrompt()}_focusPrompt(){if(!this._prompt.hasFocus()){const e=this._viewport.stickToBottom(),t=this._viewport.element.scrollTop;this._prompt.focus(),this._viewport.setStickToBottom(e),this._viewport.element.scrollTop=t}}restoreScrollPositions(){this._viewport.stickToBottom()?this._immediatelyScrollToBottom():super.restoreScrollPositions()}onResize(){this._scheduleViewportRefresh(),this._hidePromptSuggestBox(),this._viewport.stickToBottom()&&this._immediatelyScrollToBottom();for(let e=0;e<this._visibleViewMessages.length;++e)this._visibleViewMessages[e].onResize()}_hidePromptSuggestBox(){this._prompt.clearAutocomplete()}_invalidateViewport(){return this._muteViewportUpdates?(this._maybeDirtyWhileMuted=!0,Promise.resolve()):(this._needsFullUpdate?(this._updateMessageList(),delete this._needsFullUpdate):this._viewport.invalidate(),Promise.resolve())}_scheduleViewportRefresh(){if(this._muteViewportUpdates)return this._maybeDirtyWhileMuted=!0,void this._scheduleViewportRefreshForTest(!0);this._scheduleViewportRefreshForTest(!1),this._scheduledRefreshPromiseForTest=this._viewportThrottler.schedule(this._invalidateViewport.bind(this))}_scheduleViewportRefreshForTest(e){}_immediatelyScrollToBottom(){this._viewport.setStickToBottom(!0),this._promptElement.scrollIntoView(!0)}_updateFilterStatus(){this._hiddenByFilterCount!==this._lastShownHiddenByFilterCount&&(this._filterStatusText.setText(ls`${this._hiddenByFilterCount} hidden`),this._filterStatusText.setVisible(!!this._hiddenByFilterCount),this._lastShownHiddenByFilterCount=this._hiddenByFilterCount)}_onConsoleMessageAdded(e){const t=e.data;this._addConsoleMessage(t)}_addConsoleMessage(e){const t=this._createViewMessage(e);if(it.set(e,t),e.type===m.MessageType.Command||e.type===m.MessageType.Result){const e=this._consoleMessages.peekLast(),s=e&&st.get(e)||0;st.set(t,s)}else st.set(t,t.consoleMessage().timestamp);let s;s=!this._consoleMessages.length||r(t,this._consoleMessages[this._consoleMessages.length-1])>0?this._consoleMessages.length:this._consoleMessages.upperBound(t,r);const i=s<this._consoleMessages.length;this._consoleMessages.splice(s,0,t),this._filter.onMessageAdded(e),this._sidebar.onMessageAdded(t);let n=!1;const o=this._groupSimilarSetting.get();if(e.isGroupable()){const e=t.groupKey();n=o&&this._groupableMessages.has(e);let s=this._groupableMessages.get(e);s||(s=[],this._groupableMessages.set(e,s)),s.push(t)}function r(e,t){return(st.get(e)||0)-(st.get(t)||0)}this._computeShouldMessageBeVisible(t),n||i?this._needsFullUpdate=!0:(this._appendMessageToEnd(t,!o),this._updateFilterStatus(),this._searchableView.updateSearchMatchesCount(this._regexMatchRanges.length)),this._scheduleViewportRefresh(),this._consoleMessageAddedForTest(t)}_onConsoleMessageUpdated(e){const t=e.data,s=it.get(t);s&&(s.updateMessageElement(),this._computeShouldMessageBeVisible(s),this._updateMessageList())}_consoleMessageAddedForTest(e){}_shouldMessageBeVisible(e){return!this._shouldBeHiddenCache.has(e)}_computeShouldMessageBeVisible(e){!this._filter.shouldBeVisible(e)||this._isSidebarOpen&&!this._sidebar.shouldBeVisible(e)?this._shouldBeHiddenCache.add(e):this._shouldBeHiddenCache.delete(e)}_appendMessageToEnd(e,t){if(!this._shouldMessageBeVisible(e))return void this._hiddenByFilterCount++;if(!t&&this._tryToCollapseMessages(e,this._visibleViewMessages.peekLast()))return;const s=this._visibleViewMessages.peekLast();if(e.consoleMessage().type===m.MessageType.EndGroup)return s&&!this._currentGroup.messagesHidden()&&s.incrementCloseGroupDecorationCount(),void(this._currentGroup=this._currentGroup.parentGroup()||this._currentGroup);if(!this._currentGroup.messagesHidden()){const t=e.consoleMessage().originatingMessage();s&&t&&s.consoleMessage()===t&&e.toMessageElement().classList.add("console-adjacent-user-command-result"),this._visibleViewMessages.push(e),this._searchMessage(this._visibleViewMessages.length-1)}e.consoleMessage().isGroupStartMessage()&&(this._currentGroup=new tt(this._currentGroup,e)),this._messageAppendedForTests()}_messageAppendedForTests(){}_createViewMessage(e){const t=this._currentGroup.nestingLevel();switch(e.type){case m.MessageType.Command:return new De(e,this._linkifier,t,this._onMessageResizedBound);case m.MessageType.Result:return new Ue(e,this._linkifier,t,this._onMessageResizedBound);case m.MessageType.StartGroupCollapsed:case m.MessageType.StartGroup:return new Ge(e,this._linkifier,t,this._updateMessageList.bind(this),this._onMessageResizedBound);case m.MessageType.Table:return new je(e,this._linkifier,t,this._onMessageResizedBound);default:return new Ve(e,this._linkifier,t,this._onMessageResizedBound)}}async _onMessageResized(e){const t=e.data;if(this._pendingBatchResize||!t.treeOutline)return;this._pendingBatchResize=!0,await Promise.resolve();const s=t.treeOutline.element;this._viewport.setStickToBottom(this._isScrolledToBottom()),s.offsetHeight<=this._messagesElement.offsetHeight&&s.scrollIntoViewIfNeeded(),this._pendingBatchResize=!1}_consoleCleared(){const e=this._viewport.element.hasFocus();this._cancelBuildHiddenCache(),this._currentMatchRangeIndex=-1,this._consoleMessages=[],this._groupableMessages.clear(),this._groupableMessageTitle.clear(),this._sidebar.clear(),this._updateMessageList(),this._hidePromptSuggestBox(),this._viewport.setStickToBottom(!0),this._linkifier.reset(),this._filter.clear(),e&&this._prompt.focus(),P.alert(ls`Console cleared`,this._viewport.element)}_handleContextMenuEvent(s){const i=new M.ContextMenu(s),n=s.target;if(n.isSelfOrDescendant(this._promptElement))return void i.show();const o=n.enclosingNodeOrSelfWithClass("console-message-wrapper"),r=o&&Ae(o),a=r?r.consoleMessage():null;if(a&&a.url){const e=ls`Hide messages from ${new t.ParsedURL(a.url).displayName}`;i.headerSection().appendItem(e,this._filter.addMessageURLFilter.bind(this._filter,a.url))}if(i.defaultSection().appendAction("console.clear"),i.defaultSection().appendAction("console.clear.history"),i.saveSection().appendItem(e.UIString("Save as..."),this._saveConsole.bind(this)),this.element.hasSelection()&&i.clipboardSection().appendItem(e.UIString("Copy visible styled selection"),this._viewport.copyWithStyles.bind(this._viewport)),a){const e=g.NetworkLog.requestForConsoleMessage(a);e&&f.NetworkManager.canReplayRequest(e)&&i.debugSection().appendItem(ls`Replay XHR`,f.NetworkManager.replayRequest.bind(null,e))}i.show()}async _saveConsole(){const s=a.TargetManager.instance().mainTarget().inspectedURL(),i=t.ParsedURL.fromString(s),n=Y.sprintf("%s-%d.log",i?i.host:"console",Date.now()),o=new ce.FileOutputStream,r=new G.ProgressIndicator;r.setTitle(e.UIString("Writing file…")),r.setTotalWork(this.itemCount());if(!await o.open(n))return;this._progressToolbarItem.element.appendChild(r.element);let l=0;for(;l<this.itemCount()&&!r.isCanceled();){const e=[];let t;for(t=0;t<350&&t+l<this.itemCount();++t){const s=this.itemElement(l+t);e.push(s.toExportString())}l+=t,await o.write(e.join("\n")+"\n"),r.setWorked(l)}o.close(),r.done()}_tryToCollapseMessages(e,t){return!(this._timestampsSetting.get()||!t||e.consoleMessage().isGroupMessage()||e.consoleMessage().type===m.MessageType.Command||e.consoleMessage().type===m.MessageType.Result||!e.consoleMessage().isEqual(t.consoleMessage()))&&(t.incrementRepeatCount(),e.isLastInSimilarGroup()&&t.setInSimilarGroup(!0,!0),!0)}_buildHiddenCache(e,t){const s=Date.now();let i;for(i=e;i<t.length&&(this._computeShouldMessageBeVisible(t[i]),!(i%10==0&&Date.now()-s>12));++i);i!==t.length?this._buildHiddenCacheTimeout=this.element.window().requestAnimationFrame(this._buildHiddenCache.bind(this,i,t)):this._updateMessageList()}_cancelBuildHiddenCache(){this._shouldBeHiddenCache.clear(),this._buildHiddenCacheTimeout&&(this.element.window().cancelAnimationFrame(this._buildHiddenCacheTimeout),delete this._buildHiddenCacheTimeout)}_updateMessageList(){this._topGroup=tt.createTopGroup(),this._currentGroup=this._topGroup,this._regexMatchRanges=[],this._hiddenByFilterCount=0;for(let e=0;e<this._visibleViewMessages.length;++e)this._visibleViewMessages[e].resetCloseGroupDecorationCount(),this._visibleViewMessages[e].resetIncrementRepeatCount();if(this._visibleViewMessages=[],this._groupSimilarSetting.get())this._addGroupableMessagesToEnd();else for(let e=0;e<this._consoleMessages.length;++e)this._consoleMessages[e].setInSimilarGroup(!1),this._appendMessageToEnd(this._consoleMessages[e],!0);this._updateFilterStatus(),this._searchableView.updateSearchMatchesCount(this._regexMatchRanges.length),this._viewport.invalidate()}_addGroupableMessagesToEnd(){const e=new Set,t=new Set;for(let s=0;s<this._consoleMessages.length;++s){const i=this._consoleMessages[s],n=i.consoleMessage();if(e.has(n))continue;if(!n.isGroupable()){this._appendMessageToEnd(i),e.add(n);continue}const o=i.groupKey(),r=this._groupableMessages.get(o);if(!r||r.length<5){i.setInSimilarGroup(!1),this._appendMessageToEnd(i),e.add(n);continue}if(t.has(o))continue;if(!r.find(e=>this._shouldMessageBeVisible(e))){ee.addAll(e,r),t.add(o);continue}let a=this._groupableMessageTitle.get(o);if(!a){const e=new m.ConsoleMessage(null,n.source,n.level,i.groupTitle(),m.MessageType.StartGroupCollapsed);a=this._createViewMessage(e),this._groupableMessageTitle.set(o,a)}a.setRepeatCount(r.length),this._appendMessageToEnd(a);for(const t of r)t.setInSimilarGroup(!0,r.peekLast()===t),this._appendMessageToEnd(t,!0),e.add(t.consoleMessage());const l=new m.ConsoleMessage(null,n.source,n.level,n.messageText,m.MessageType.EndGroup);this._appendMessageToEnd(this._createViewMessage(l))}}_messagesClicked(e){const t=e.target;if(!this._messagesElement.hasSelection()){(t===this._messagesElement||this._prompt.belowEditorElement().isSelfOrAncestor(t))&&(this._prompt.moveCaretToEndOfPrompt(),this._focusPrompt())}}_messagesKeyDown(e){const t=e;t.ctrlKey||t.altKey||t.metaKey||1!==t.key.length||w.isEditing()||this._messagesElement.hasSelection()||(this._prompt.moveCaretToEndOfPrompt(),this._focusPrompt())}_messagesPasted(e){w.isEditing()||this._prompt.focus()}_registerShortcuts(){this._shortcuts.set(T.KeyboardShortcut.makeKey("u",T.Modifiers.Ctrl),this._clearPromptBackwards.bind(this))}_clearPromptBackwards(){this._prompt.setText("")}_promptKeyDown(e){const t=e;if("PageUp"===t.key)return void this._updateStickToBottomOnWheel();const s=T.KeyboardShortcut.makeKeyFromEvent(t),i=this._shortcuts.get(s);i&&(i(),t.preventDefault())}_printResult(e,t,s){if(!e)return;const i=s?m.MessageLevel.Error:m.MessageLevel.Info;let n;n=s?m.ConsoleMessage.fromException(e.runtimeModel(),s,m.MessageType.Result,void 0,void 0):new m.ConsoleMessage(e.runtimeModel(),m.MessageSource.JS,i,"",m.MessageType.Result,void 0,void 0,void 0,[e]),n.setOriginatingMessage(t),m.ConsoleModel.instance().addMessage(n)}_commandEvaluated(e){const t=e.data;this._prompt.history().pushHistoryItem(t.commandMessage.messageText),this._consoleHistorySetting.set(this._prompt.history().historyData().slice(-Ye)),this._printResult(t.result,t.commandMessage,t.exceptionDetails)}elementsToRestoreScrollPositionsFor(){return[this._messagesElement]}searchCanceled(){this._cleanupAfterSearch();for(let e=0;e<this._visibleViewMessages.length;++e){this._visibleViewMessages[e].setSearchRegex(null)}this._currentMatchRangeIndex=-1,this._regexMatchRanges=[],this._searchRegex=null,this._viewport.refresh()}performSearch(t,s,i){this.searchCanceled(),this._searchableView.updateSearchMatchesCount(0),this._searchRegex=t.toSearchRegex(!0),this._regexMatchRanges=[],this._currentMatchRangeIndex=-1,s&&(this._searchShouldJumpBackwards=!!i),this._searchProgressIndicator=new G.ProgressIndicator,this._searchProgressIndicator.setTitle(e.UIString("Searching…")),this._searchProgressIndicator.setTotalWork(this._visibleViewMessages.length),this._progressToolbarItem.element.appendChild(this._searchProgressIndicator.element),this._innerSearch(0)}_cleanupAfterSearch(){delete this._searchShouldJumpBackwards,this._innerSearchTimeoutId&&(clearTimeout(this._innerSearchTimeoutId),delete this._innerSearchTimeoutId),this._searchProgressIndicator&&(this._searchProgressIndicator.done(),delete this._searchProgressIndicator)}_searchFinishedForTests(){}_innerSearch(e){if(delete this._innerSearchTimeoutId,this._searchProgressIndicator&&this._searchProgressIndicator.isCanceled())return void this._cleanupAfterSearch();const t=Date.now();for(;e<this._visibleViewMessages.length&&Date.now()-t<100;++e)this._searchMessage(e);if(this._searchableView.updateSearchMatchesCount(this._regexMatchRanges.length),void 0!==this._searchShouldJumpBackwards&&this._regexMatchRanges.length&&(this._jumpToMatch(this._searchShouldJumpBackwards?-1:0),delete this._searchShouldJumpBackwards),e===this._visibleViewMessages.length)return this._cleanupAfterSearch(),void setTimeout(this._searchFinishedForTests.bind(this),0);this._innerSearchTimeoutId=setTimeout(this._innerSearch.bind(this,e),100),this._searchProgressIndicator&&this._searchProgressIndicator.setWorked(e)}_searchMessage(e){const t=this._visibleViewMessages[e];t.setSearchRegex(this._searchRegex);for(let s=0;s<t.searchCount();++s)this._regexMatchRanges.push({messageIndex:e,matchIndex:s})}jumpToNextSearchResult(){this._jumpToMatch(this._currentMatchRangeIndex+1)}jumpToPreviousSearchResult(){this._jumpToMatch(this._currentMatchRangeIndex-1)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}_jumpToMatch(e){if(!this._regexMatchRanges.length)return;let t;if(this._currentMatchRangeIndex>=0){t=this._regexMatchRanges[this._currentMatchRangeIndex];this._visibleViewMessages[t.messageIndex].searchHighlightNode(t.matchIndex).classList.remove(w.highlightedCurrentSearchResultClassName)}e=te.mod(e,this._regexMatchRanges.length),this._currentMatchRangeIndex=e,this._searchableView.updateCurrentMatchIndex(e),t=this._regexMatchRanges[e];const s=this._visibleViewMessages[t.messageIndex].searchHighlightNode(t.matchIndex);s.classList.add(w.highlightedCurrentSearchResultClassName);const i=this._issueMessage?1:0;this._viewport.scrollItemIntoView(t.messageIndex+i),s.scrollIntoViewIfNeeded()}_updateStickToBottomOnPointerDown(e){this._muteViewportUpdates=!e,this._viewport.setStickToBottom(!1),this._waitForScrollTimeout&&(clearTimeout(this._waitForScrollTimeout),delete this._waitForScrollTimeout)}_updateStickToBottomOnPointerUp(){this._muteViewportUpdates&&(this._waitForScrollTimeout=setTimeout(function(){this._muteViewportUpdates=!1,this.isShowing()&&this._viewport.setStickToBottom(this._isScrolledToBottom());this._maybeDirtyWhileMuted&&(this._scheduleViewportRefresh(),delete this._maybeDirtyWhileMuted);delete this._waitForScrollTimeout,this._updateViewportStickinessForTest()}.bind(this),200))}_updateViewportStickinessForTest(){}_updateStickToBottomOnWheel(){this._updateStickToBottomOnPointerDown(),this._updateStickToBottomOnPointerUp()}_promptTextChanged(){const e=this._viewport.stickToBottom(),t=this._isScrolledToBottom();this._viewport.setStickToBottom(t),t&&!e&&this._scheduleViewportRefresh(),this._promptTextChangedForTest()}_promptTextChangedForTest(){}_isScrolledToBottom(){return this._messagesElement.scrollHeight-this._messagesElement.scrollTop-this._messagesElement.clientHeight-this._prompt.belowEditorElement().offsetHeight<=2}}const Ye=300;class et{constructor(t){this._filterChanged=t,this._messageLevelFiltersSetting=et.levelFilterSetting(),this._hideNetworkMessagesSetting=s.Settings.instance().moduleSetting("hideNetworkMessages"),this._filterByExecutionContextSetting=s.Settings.instance().moduleSetting("selectedContextFilterEnabled"),this._messageLevelFiltersSetting.addChangeListener(this._onFilterChanged.bind(this)),this._hideNetworkMessagesSetting.addChangeListener(this._onFilterChanged.bind(this)),this._filterByExecutionContextSetting.addChangeListener(this._onFilterChanged.bind(this)),x.Context.instance().addFlavorChangeListener(l.ExecutionContext,this._onFilterChanged,this);const i=Object.values(ge);this._suggestionBuilder=new D.FilterSuggestionBuilder(i),this._textFilterUI=new b.ToolbarInput(e.UIString("Filter"),"",.2,1,e.UIString("e.g. /event\\d/ -cdn url:a.com"),this._suggestionBuilder.completions.bind(this._suggestionBuilder)),this._textFilterSetting=s.Settings.instance().createSetting("console.textFilter",""),this._textFilterSetting.get()&&this._textFilterUI.setValue(this._textFilterSetting.get()),this._textFilterUI.addEventListener(b.ToolbarInput.Event.TextChanged,()=>{this._textFilterSetting.set(this._textFilterUI.value()),this._onFilterChanged()}),this._filterParser=new z.FilterParser(i),this._currentFilter=new _e("",[],null,this._messageLevelFiltersSetting.get()),this._updateCurrentFilter(),this._levelLabels=new Map([[m.MessageLevel.Verbose,e.UIString("Verbose")],[m.MessageLevel.Info,e.UIString("Info")],[m.MessageLevel.Warning,e.UIString("Warnings")],[m.MessageLevel.Error,e.UIString("Errors")]]),this._levelMenuButton=new b.ToolbarButton(ls`Log levels`),this._levelMenuButton.turnIntoSelect(),this._levelMenuButton.addEventListener(b.ToolbarButton.Events.Click,this._showLevelContextMenu.bind(this)),P.markAsMenuButton(this._levelMenuButton.element),this._updateLevelMenuButtonText(),this._messageLevelFiltersSetting.addChangeListener(this._updateLevelMenuButtonText.bind(this))}onMessageAdded(e){e.type===m.MessageType.Command||e.type===m.MessageType.Result||e.isGroupMessage()||(e.context&&this._suggestionBuilder.addItem(ge.Context,e.context),e.source&&this._suggestionBuilder.addItem(ge.Source,e.source),e.url&&this._suggestionBuilder.addItem(ge.Url,e.url))}static levelFilterSetting(){return s.Settings.instance().createSetting("messageLevelFilters",_e.defaultLevelsFilterValue())}_updateCurrentFilter(){const e=this._filterParser.parse(this._textFilterUI.value());this._hideNetworkMessagesSetting.get()&&e.push({key:ge.Source,text:m.MessageSource.Network,negative:!0,regex:void 0}),this._currentFilter.executionContext=this._filterByExecutionContextSetting.get()?x.Context.instance().flavor(l.ExecutionContext):null,this._currentFilter.parsedFilters=e,this._currentFilter.levelsMask=this._messageLevelFiltersSetting.get()}_onFilterChanged(){this._updateCurrentFilter(),this._filterChanged()}_updateLevelMenuButtonText(){let t=!0,s=!0;const i=_e.allLevelsFilterValue(),n=_e.defaultLevelsFilterValue();let o=null;const r=this._messageLevelFiltersSetting.get();for(const a of Object.values(m.MessageLevel))t=t&&r[a]===i[a],s=s&&r[a]===n[a],r[a]&&(o=o?e.UIString("Custom levels"):e.UIString("%s only",this._levelLabels.get(a)));o=t?e.UIString("All levels"):s?e.UIString("Default levels"):o||e.UIString("Hide all"),this._levelMenuButton.element.classList.toggle("warning",!t&&!s),this._levelMenuButton.setText(o),this._levelMenuButton.setTitle(ls`Log level: ${o}`)}_showLevelContextMenu(t){const s=t.data,i=this._messageLevelFiltersSetting,n=i.get(),o=new M.ContextMenu(s,!0,this._levelMenuButton.element.totalOffsetLeft(),this._levelMenuButton.element.totalOffsetTop()+this._levelMenuButton.element.offsetHeight);o.headerSection().appendItem(e.UIString("Default"),()=>i.set(_e.defaultLevelsFilterValue()));for(const[e,t]of this._levelLabels.entries())o.defaultSection().appendCheckboxItem(t,r.bind(null,e),n[e]);function r(e){n[e]=!n[e],i.set(n)}o.show()}addMessageURLFilter(e){if(!e)return;const t=this._textFilterUI.value()?" "+this._textFilterUI.value():"";this._textFilterUI.setValue(`-url:${e}${t}`),this._textFilterSetting.set(this._textFilterUI.value()),this._onFilterChanged()}shouldBeVisible(e){return this._currentFilter.shouldBeVisible(e)}clear(){this._suggestionBuilder.clear()}reset(){this._messageLevelFiltersSetting.set(_e.defaultLevelsFilterValue()),this._filterByExecutionContextSetting.set(!1),this._hideNetworkMessagesSetting.set(!1),this._textFilterUI.setValue(""),this._onFilterChanged()}}class tt{constructor(e,t){this._parentGroup=e,this._nestingLevel=e?e.nestingLevel()+1:0,this._messagesHidden=t&&t.collapsed()||this._parentGroup&&this._parentGroup.messagesHidden()||!1}static createTopGroup(){return new tt(null,null)}messagesHidden(){return this._messagesHidden}nestingLevel(){return this._nestingLevel}parentGroup(){return this._parentGroup}}const st=new WeakMap,it=new WeakMap;var nt=Object.freeze({__proto__:null,ConsoleView:Ze,ConsoleViewFilter:et,ConsoleGroup:tt,ActionDelegate:class{handleAction(e,t){switch(t){case"console.show":return le.InspectorFrontendHostInstance.bringToFront(),r.Console.instance().show(),Ze.instance()._focusPrompt(),!0;case"console.clear":return Ze.clearConsole(),!0;case"console.clear.history":return Ze.instance()._clearHistory(),!0;case"console.create-pin":return Ze.instance()._pinPane.addPin("",!0),!0}return!1}},RegexMatchRange:void 0});let ot;class rt extends U.Panel{constructor(){super("console"),this._view=Ze.instance()}static instance(e={forceNew:null}){const{forceNew:t}=e;return ot&&!t||(ot=new rt),ot}static _updateContextFlavor(){const e=rt.instance()._view;x.Context.instance().setFlavor(Ze,e.isShowing()?e:null)}wasShown(){super.wasShown();at&&at.isShowing()&&j.InspectorView.instance().setDrawerMinimized(!0),this._view.show(this.element),rt._updateContextFlavor()}willHide(){super.willHide(),j.InspectorView.instance().setDrawerMinimized(!1),at&&at._showViewInWrapper(),rt._updateContextFlavor()}searchableView(){return Ze.instance().searchableView()}}let at=null;class lt extends L.VBox{constructor(){super(),this.element.classList.add("console-view-wrapper"),at=this,this._view=Ze.instance()}wasShown(){rt.instance().isShowing()?j.InspectorView.instance().setDrawerMinimized(!0):this._showViewInWrapper(),rt._updateContextFlavor()}willHide(){j.InspectorView.instance().setDrawerMinimized(!1),rt._updateContextFlavor()}_showViewInWrapper(){this._view.show(this.element)}}var ht=Object.freeze({__proto__:null,ConsolePanel:rt,WrapperView:lt,ConsoleRevealer:class{async reveal(e){const t=Ze.instance();t.isShowing()?t.focus():await B.ViewManager.instance().showView("console-view")}}});class ct extends L.Widget{constructor(){super(),this.registerRequiredCSS("console/consolePrompt.css",{enableLegacyPatching:!0}),this._addCompletionsFromHistory=!0,this._history=new dt,this._initialText="",this._editor=null,this._eagerPreviewElement=document.createElement("div"),this._eagerPreviewElement.classList.add("console-eager-preview"),this._textChangeThrottler=new o.Throttler(150),this._formatter=new J.RemoteObjectPreviewFormatter,this._requestPreviewBound=this._requestPreview.bind(this),this._innerPreviewElement=this._eagerPreviewElement.createChild("div","console-eager-inner-preview"),this._eagerPreviewElement.appendChild(F.Icon.create("smallicon-command-result","preview-result-icon"));const e=this.element.createChild("div","console-prompt-editor-container");this.element.appendChild(this._eagerPreviewElement),this._promptIcon=F.Icon.create("smallicon-text-prompt","console-prompt-icon"),this.element.appendChild(this._promptIcon),this._iconThrottler=new o.Throttler(0),this._eagerEvalSetting=s.Settings.instance().moduleSetting("consoleEagerEval"),this._eagerEvalSetting.addChangeListener(this._eagerSettingChanged.bind(this)),this._eagerPreviewElement.classList.toggle("hidden",!this._eagerEvalSetting.get()),this.element.tabIndex=0,this._previewRequestForTest=null,this._defaultAutocompleteConfig=null,this._highlightingNode=!1;function t(t){const s={devtoolsAccessibleName:ls`Console prompt`,lineNumbers:!1,lineWrapping:!0,mimeType:"javascript",autoHeight:!0};this._editor=t.createEditor(s),this._defaultAutocompleteConfig=q.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor),this._editor.configureAutocomplete(Object.assign({},this._defaultAutocompleteConfig,{suggestionsCallback:this._wordsWithQuery.bind(this),anchorBehavior:W.AnchorBehavior.PreferTop})),this._editor.widget().element.addEventListener("keydown",this._editorKeyDown.bind(this),!0),this._editor.widget().show(e),this._editor.addEventListener(I.Events.CursorChanged,this._updatePromptIcon,this),this._editor.addEventListener(I.Events.TextChanged,this._onTextChanged,this),this._editor.addEventListener(I.Events.SuggestionChanged,this._onTextChanged,this),this.setText(this._initialText),this._initialText="",this.hasFocus()&&this.focus(),this.element.removeAttribute("tabindex"),this._editor.widget().element.tabIndex=-1,this._editorSetForTest(),re.panelLoaded("console","DevTools.Launch.Console")}Z.Runtime.instance().extension(I.TextEditorFactory).instance().then(e=>{t.call(this,e)})}_eagerSettingChanged(){const e=this._eagerEvalSetting.get();this._eagerPreviewElement.classList.toggle("hidden",!e),e&&this._requestPreview()}belowEditorElement(){return this._eagerPreviewElement}_onTextChanged(){if(this._eagerEvalSetting.get()){const e=!this._editor||!this._editor.textWithCurrentSuggestion();this._previewRequestForTest=this._textChangeThrottler.schedule(this._requestPreviewBound,e)}this._updatePromptIcon(),this.dispatchEventToListeners(ut.TextChanged)}async _requestPreview(){if(!this._editor)return;const e=this._editor.textWithCurrentSuggestion().trim(),t=x.Context.instance().flavor(l.ExecutionContext),{preview:s,result:i}=await $.JavaScriptREPL.evaluateAndBuildPreview(e,!0,500);this._innerPreviewElement.removeChildren(),s.deepTextContent()!==this._editor.textWithCurrentSuggestion().trim()&&this._innerPreviewElement.appendChild(s),i&&"object"in i&&i.object&&"node"===i.object.subtype?(this._highlightingNode=!0,d.OverlayModel.highlightObjectAsDOMNode(i.object)):this._highlightingNode&&(this._highlightingNode=!1,d.OverlayModel.hideDOMNodeHighlight()),i&&t&&t.runtimeModel.releaseEvaluationResult(i)}willHide(){this._highlightingNode&&(this._highlightingNode=!1,d.OverlayModel.hideDOMNodeHighlight())}history(){return this._history}clearAutocomplete(){this._editor&&this._editor.clearAutocomplete()}_isCaretAtEndOfPrompt(){return!!this._editor&&this._editor.selection().collapseToEnd().equal(this._editor.fullRange().collapseToEnd())}moveCaretToEndOfPrompt(){this._editor&&this._editor.setSelection(K.TextRange.createFromLocation(1/0,1/0))}setText(e){this._editor?this._editor.setText(e):this._initialText=e,this.dispatchEventToListeners(ut.TextChanged)}text(){return this._editor?this._editor.text():this._initialText}setAddCompletionsFromHistory(e){this._addCompletionsFromHistory=e}_editorKeyDown(e){if(!this._editor)return;const t=e;let s,i;const n=this._editor.selection(),o=this._editor.visualCoordinates(n.endLine,n.endColumn).y;switch(t.keyCode){case T.Keys.Up.code:{const e=this._editor.visualCoordinates(0,0).y;if(t.shiftKey||!n.isEmpty()||o!==e)break;s=this._history.previous(this.text()),i=!0;break}case T.Keys.Down.code:{const e=this._editor.fullRange(),i=this._editor.visualCoordinates(e.endLine,e.endColumn).y;if(t.shiftKey||!n.isEmpty()||o!==i)break;s=this._history.next();break}case T.Keys.P.code:!he.isMac()||!t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||(s=this._history.previous(this.text()),i=!0);break;case T.Keys.N.code:!he.isMac()||!t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||(s=this._history.next());break;case T.Keys.Enter.code:this._enterKeyPressed(t);break;case T.Keys.Tab.code:this.text()||t.consume()}void 0!==s&&(t.consume(!0),this.setText(s),i?this._editor.setSelection(K.TextRange.createFromLocation(0,1/0)):this.moveCaretToEndOfPrompt())}async _enterWillEvaluate(){return!this._isCaretAtEndOfPrompt()||await q.JavaScriptAutocomplete.isExpressionComplete(this.text())}_updatePromptIcon(){this._iconThrottler.schedule(async()=>{const e=await this._enterWillEvaluate();this._promptIcon.classList.toggle("console-prompt-incomplete",!e)})}async _enterKeyPressed(e){if(e.altKey||e.ctrlKey||e.shiftKey)return;e.consume(!0),this.element.scrollIntoView(),this.clearAutocomplete();const t=this.text();t.length&&(await this._enterWillEvaluate()?await this._appendCommand(t,!0):this._editor&&this._editor.newlineAndIndent(),this._enterProcessedForTest())}async _appendCommand(e,t){this.setText("");const s=x.Context.instance().flavor(l.ExecutionContext);if(s){const i=s,n=m.ConsoleModel.instance().addCommandMessage(i,e),o=$.JavaScriptREPL.preprocessExpression(e);m.ConsoleModel.instance().evaluateCommandInConsole(i,n,o,t),rt.instance().isShowing()&&re.actionTaken(ae.Action.CommandEvaluatedInConsolePanel)}}_enterProcessedForTest(){}_historyCompletions(e,t){const s=this.text();if(!this._addCompletionsFromHistory||!this._isCaretAtEndOfPrompt()||!s&&!t)return[];const i=[],n=new Set,o=this._history.historyData();for(let t=o.length-1;t>=0&&i.length<50;--t){const r=o[t];r.startsWith(s)&&(n.has(r)||(n.add(r),i.push({text:r.substring(s.length-e.length),iconType:"smallicon-text-prompt",isSecondary:!0})))}return i}focus(){this._editor?this._editor.widget().focus():this.element.focus()}async _wordsWithQuery(e,t,s){if(!this._editor||!this._defaultAutocompleteConfig||!this._defaultAutocompleteConfig.suggestionsCallback)return[];const i=this._editor.text(e),n=await this._defaultAutocompleteConfig.suggestionsCallback(e,t,s),o=this._historyCompletions(i,s);return n?n.concat(o):o}_editorSetForTest(){}}class dt{constructor(){this._data=[],this._historyOffset=1}historyData(){return this._data}setHistoryData(e){this._data=e.slice(),this._historyOffset=1}pushHistoryItem(e){this._uncommittedIsTop&&(this._data.pop(),delete this._uncommittedIsTop),this._historyOffset=1,e!==this._currentHistoryItem()&&this._data.push(e)}_pushCurrentText(e){this._uncommittedIsTop&&this._data.pop(),this._uncommittedIsTop=!0,this._data.push(e)}previous(e){if(!(this._historyOffset>this._data.length))return 1===this._historyOffset&&this._pushCurrentText(e),++this._historyOffset,this._currentHistoryItem()}next(){if(1!==this._historyOffset)return--this._historyOffset,this._currentHistoryItem()}_currentHistoryItem(){return this._data[this._data.length-this._historyOffset]}}const ut={TextChanged:Symbol("TextChanged")};var mt=Object.freeze({__proto__:null,ConsolePrompt:ct,ConsoleHistoryManager:dt,Events:ut});export{me as ConsoleContextSelector,pe as ConsoleFilter,ht as ConsolePanel,be as ConsolePinPane,mt as ConsolePrompt,ke as ConsoleSidebar,nt as ConsoleView,Je as ConsoleViewMessage,Pe as ConsoleViewport};
