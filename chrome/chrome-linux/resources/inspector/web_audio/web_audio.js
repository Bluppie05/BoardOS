import{ObjectWrapper as e}from"../common/common.js";import{Multimap as t}from"../platform/platform.js";import{UIUtils as o,ListModel as n,SoftDropDown as d,Toolbar as a,Utils as s,Fragment as i,ThrottledWidget as r,Widget as h}from"../ui/ui.js";import{SDKModel as c,ResourceTreeModel as l}from"../sdk/sdk.js";const u={In:Symbol("In"),Out:Symbol("Out"),Param:Symbol("Param")};var p=Object.freeze({__proto__:null,PortPadding:4,InputPortRadius:10,AudioParamRadius:5,LeftMarginOfText:12,RightMarginOfText:30,LeftSideTopPadding:5,BottomPaddingWithoutParam:6,BottomPaddingWithParam:8,ArrowHeadSize:12,GraphPadding:20,GraphMargin:20,TotalInputPortHeight:24,TotalOutputPortHeight:24,TotalParamPortHeight:14,NodeLabelFontStyle:"14px Segoe UI, Arial",ParamLabelFontStyle:"12px Segoe UI, Arial",PortTypes:u,Size:void 0,Point:void 0,NodeLayout:void 0,Port:void 0,NodeCreationData:void 0,ParamCreationData:void 0,NodesConnectionData:void 0,NodesDisconnectionData:void 0,NodesDisconnectionDataWithDestination:void 0,NodeParamConnectionData:void 0,NodeParamDisconnectionData:void 0});const m=e=>({x:0,y:15+24*e}),_=(e,t,o)=>{const{width:n,height:d}=t;return{x:n,y:d/2+24*(2*e-o+1)/2}},g=(e,t)=>({x:0,y:t+14*(e+1)-5});var I=Object.freeze({__proto__:null,calculateInputPortXY:m,calculateOutputPortXY:_,calculateParamPortXY:g});class x{constructor(e,t){this.id=e.nodeId,this.type=e.nodeType,this.numberOfInputs=e.numberOfInputs,this.numberOfOutputs=e.numberOfOutputs,this.label=t,this.size={width:0,height:0},this.position=null,this._layout={inputPortSectionHeight:0,outputPortSectionHeight:0,maxTextLength:0,totalHeight:0},this.ports=new Map,this._initialize(e)}_initialize(e){this._updateNodeLayoutAfterAddingNode(e),this._setupInputPorts(),this._setupOutputPorts()}addParamPort(e,t){const o=this.getPortsByType(u.Param).length,{x:n,y:d}=g(o,this._layout.inputPortSectionHeight);this._addPort({id:v(this.id,e),type:u.Param,label:t,x:n,y:d}),this._updateNodeLayoutAfterAddingParam(o+1,t),this._setupOutputPorts()}getPortsByType(e){const t=[];return this.ports.forEach(o=>{o.type===e&&t.push(o)}),t}_updateNodeLayoutAfterAddingNode(e){const t=24*Math.max(1,e.numberOfInputs)+5;this._layout.inputPortSectionHeight=t,this._layout.outputPortSectionHeight=24*e.numberOfOutputs,this._layout.totalHeight=Math.max(t+6,this._layout.outputPortSectionHeight);const o=E(this.label,"14px Segoe UI, Arial");this._layout.maxTextLength=Math.max(this._layout.maxTextLength,o),this._updateNodeSize()}_updateNodeLayoutAfterAddingParam(e,t){const o=this._layout.inputPortSectionHeight+14*e+8;this._layout.totalHeight=Math.max(o,this._layout.outputPortSectionHeight);const n=E(t,"12px Segoe UI, Arial");this._layout.maxTextLength=Math.max(this._layout.maxTextLength,n),this._updateNodeSize()}_updateNodeSize(){this.size={width:Math.ceil(12+this._layout.maxTextLength+30),height:this._layout.totalHeight}}_setupInputPorts(){for(let e=0;e<this.numberOfInputs;e++){const{x:t,y:o}=m(e);this._addPort({id:C(this.id,e),type:u.In,x:t,y:o,label:void 0})}}_setupOutputPorts(){for(let e=0;e<this.numberOfOutputs;e++){const t=y(this.id,e),{x:o,y:n}=_(e,this.size,this.numberOfOutputs);if(this.ports.has(t)){const e=this.ports.get(t);if(!e)throw new Error("Unable to find port with id "+t);e.x=o,e.y=n}else this._addPort({id:t,type:u.Out,x:o,y:n,label:void 0})}}_addPort(e){this.ports.set(e.id,e)}}const C=(e,t)=>`${e}-input-${t||0}`,y=(e,t)=>`${e}-output-${t||0}`,v=(e,t)=>`${e}-param-${t}`;class b{constructor(){this._totalNumberOfNodes=0}generateLabel(e){e.endsWith("Node")&&(e=e.slice(0,e.length-4)),this._totalNumberOfNodes+=1;return`${e} ${this._totalNumberOfNodes}`}}let P;const E=(e,t)=>{if(!P){const e=document.createElement("canvas").getContext("2d");if(!e)throw new Error("Unable to create canvas context.");P=e}const n=P;n.save(),t&&(n.font=t);const d=o.measureTextWidth(n,e);return n.restore(),d};var N=Object.freeze({__proto__:null,NodeView:x,generateInputPortId:C,generateOutputPortId:y,generateParamPortId:v,NodeLabelGenerator:b,measureTextWidth:E});class L{constructor(e,t){const o=f(e,t);if(!o)throw new Error("Unable to generate edge port IDs");const{edgeId:n,sourcePortId:d,destinationPortId:a}=o;this.id=n,this.type=t,this.sourceId=e.sourceId,this.destinationId=e.destinationId,this.sourcePortId=d,this.destinationPortId=a}}const f=(e,t)=>{if(!e.sourceId||!e.destinationId)return console.error("Undefined node message: "+JSON.stringify(e)),null;const o=y(e.sourceId,e.sourceOutputIndex),n=function(e,t){if(t===w.NodeToNode){const t=e;return C(e.destinationId,t.destinationInputIndex)}if(t===w.NodeToParam){const t=e;return v(e.destinationId,t.destinationParamId)}return console.error("Unknown edge type: "+t.toString()),""}(e,t);return{edgeId:`${o}->${n}`,sourcePortId:o,destinationPortId:n}},w={NodeToNode:Symbol("NodeToNode"),NodeToParam:Symbol("NodeToParam")};var S=Object.freeze({__proto__:null,EdgeView:L,generateEdgePortIdsByData:f,EdgeTypes:w});class T extends e.ObjectWrapper{constructor(e){super(),this.contextId=e,this._nodes=new Map,this._edges=new Map,this._outboundEdgeMap=new t,this._inboundEdgeMap=new t,this._nodeLabelGenerator=new b,this._paramIdToNodeIdMap=new Map}addNode(e){const t=this._nodeLabelGenerator.generateLabel(e.nodeType),o=new x(e,t);this._nodes.set(e.nodeId,o),this._notifyShouldRedraw()}removeNode(e){this._outboundEdgeMap.get(e).forEach(e=>this._removeEdge(e)),this._inboundEdgeMap.get(e).forEach(e=>this._removeEdge(e)),this._nodes.delete(e),this._notifyShouldRedraw()}addParam(e){const t=this.getNodeById(e.nodeId);t?(t.addParamPort(e.paramId,e.paramType),this._paramIdToNodeIdMap.set(e.paramId,e.nodeId),this._notifyShouldRedraw()):console.error("AudioNode should be added before AudioParam")}removeParam(e){this._paramIdToNodeIdMap.delete(e)}addNodeToNodeConnection(e){const t=new L(e,w.NodeToNode);this._addEdge(t)}removeNodeToNodeConnection(e){if(e.destinationId){const t=f(e,w.NodeToNode);if(!t)throw new Error("Unable to generate edge port IDs");const{edgeId:o}=t;this._removeEdge(o)}else this._outboundEdgeMap.get(e.sourceId).forEach(e=>this._removeEdge(e))}addNodeToParamConnection(e){const t=new L(e,w.NodeToParam);this._addEdge(t)}removeNodeToParamConnection(e){const t=f(e,w.NodeToParam);if(!t)throw new Error("Unable to generate edge port IDs");const{edgeId:o}=t;this._removeEdge(o)}getNodeById(e){return this._nodes.get(e)||null}getNodes(){return this._nodes}getEdges(){return this._edges}getNodeIdByParamId(e){return this._paramIdToNodeIdMap.get(e)||null}_addEdge(e){const t=e.sourceId;this._outboundEdgeMap.hasValue(t,e.id)||(this._edges.set(e.id,e),this._outboundEdgeMap.set(t,e.id),this._inboundEdgeMap.set(e.destinationId,e.id),this._notifyShouldRedraw())}_removeEdge(e){const t=this._edges.get(e);t&&(this._outboundEdgeMap.delete(t.sourceId,e),this._inboundEdgeMap.delete(t.destinationId,e),this._edges.delete(e),this._notifyShouldRedraw())}_notifyShouldRedraw(){this.dispatchEventToListeners(D.ShouldRedraw,this)}}const D={ShouldRedraw:Symbol("ShouldRedraw")};var M=Object.freeze({__proto__:null,GraphView:T,Events:D});class O extends e.ObjectWrapper{constructor(){super(),this._graphMapByContextId=new Map}createContext(e){const t=new T(e);t.addEventListener(D.ShouldRedraw,this._notifyShouldRedraw,this),this._graphMapByContextId.set(e,t)}destroyContext(e){if(!this._graphMapByContextId.has(e))return;const t=this._graphMapByContextId.get(e);t&&(t.removeEventListener(D.ShouldRedraw,this._notifyShouldRedraw,this),this._graphMapByContextId.delete(e))}hasContext(e){return this._graphMapByContextId.has(e)}clearGraphs(){this._graphMapByContextId.clear()}getGraph(e){return this._graphMapByContextId.get(e)||null}_notifyShouldRedraw(e){const t=e.data;this.dispatchEventToListeners(D.ShouldRedraw,t)}}var A=Object.freeze({__proto__:null,GraphManager:O});class B extends c.SDKModel{constructor(e){super(e),this._enabled=!1,this._agent=e.webAudioAgent(),e.registerWebAudioDispatcher(this),c.TargetManager.instance().addModelListener(l.ResourceTreeModel,l.Events.FrameNavigated,this._flushContexts,this)}_flushContexts(){this.dispatchEventToListeners(W.ModelReset)}async suspendModel(){this.dispatchEventToListeners(W.ModelSuspend),await this._agent.invoke_disable()}async resumeModel(){if(!this._enabled)return Promise.resolve();await this._agent.invoke_enable()}ensureEnabled(){this._enabled||(this._agent.invoke_enable(),this._enabled=!0)}contextCreated({context:e}){this.dispatchEventToListeners(W.ContextCreated,e)}contextWillBeDestroyed({contextId:e}){this.dispatchEventToListeners(W.ContextDestroyed,e)}contextChanged({context:e}){this.dispatchEventToListeners(W.ContextChanged,e)}audioListenerCreated({listener:e}){this.dispatchEventToListeners(W.AudioListenerCreated,e)}audioListenerWillBeDestroyed({listenerId:e,contextId:t}){this.dispatchEventToListeners(W.AudioListenerWillBeDestroyed,{listenerId:e,contextId:t})}audioNodeCreated({node:e}){this.dispatchEventToListeners(W.AudioNodeCreated,e)}audioNodeWillBeDestroyed({contextId:e,nodeId:t}){this.dispatchEventToListeners(W.AudioNodeWillBeDestroyed,{contextId:e,nodeId:t})}audioParamCreated({param:e}){this.dispatchEventToListeners(W.AudioParamCreated,e)}audioParamWillBeDestroyed({contextId:e,nodeId:t,paramId:o}){this.dispatchEventToListeners(W.AudioParamWillBeDestroyed,{contextId:e,nodeId:t,paramId:o})}nodesConnected({contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n,destinationInputIndex:d}){this.dispatchEventToListeners(W.NodesConnected,{contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n,destinationInputIndex:d})}nodesDisconnected({contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n,destinationInputIndex:d}){this.dispatchEventToListeners(W.NodesDisconnected,{contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n,destinationInputIndex:d})}nodeParamConnected({contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n}){this.dispatchEventToListeners(W.NodeParamConnected,{contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n})}nodeParamDisconnected({contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n}){this.dispatchEventToListeners(W.NodeParamDisconnected,{contextId:e,sourceId:t,destinationId:o,sourceOutputIndex:n})}async requestRealtimeData(e){return(await this._agent.invoke_getRealtimeData({contextId:e})).realtimeData}}c.SDKModel.register(B,c.Capability.DOM,!1);const W={ContextCreated:Symbol("ContextCreated"),ContextDestroyed:Symbol("ContextDestroyed"),ContextChanged:Symbol("ContextChanged"),ModelReset:Symbol("ModelReset"),ModelSuspend:Symbol("ModelSuspend"),AudioListenerCreated:Symbol("AudioListenerCreated"),AudioListenerWillBeDestroyed:Symbol("AudioListenerWillBeDestroyed"),AudioNodeCreated:Symbol("AudioNodeCreated"),AudioNodeWillBeDestroyed:Symbol("AudioNodeWillBeDestroyed"),AudioParamCreated:Symbol("AudioParamCreated"),AudioParamWillBeDestroyed:Symbol("AudioParamWillBeDestroyed"),NodesConnected:Symbol("NodesConnected"),NodesDisconnected:Symbol("NodesDisconnected"),NodeParamConnected:Symbol("NodeParamConnected"),NodeParamDisconnected:Symbol("NodeParamDisconnected")};var R=Object.freeze({__proto__:null,WebAudioModel:B,Events:W});class $ extends e.ObjectWrapper{constructor(){super(),this._placeholderText=ls`(no recordings)`,this._items=new n.ListModel,this._dropDown=new d.SoftDropDown(this._items,this),this._dropDown.setPlaceholderText(this._placeholderText),this._toolbarItem=new a.ToolbarItem(this._dropDown.element),this._toolbarItem.setEnabled(!1),this._toolbarItem.setTitle(ls`Audio context: ${this._placeholderText}`),this._items.addEventListener(n.Events.ItemsReplaced,this._onListItemReplaced,this),this._toolbarItem.element.classList.add("toolbar-has-dropdown"),this._selectedContext=null}_onListItemReplaced(){const e=!!this._items.length;this._toolbarItem.setEnabled(e),e||this._toolbarItem.setTitle(ls`Audio context: ${this._placeholderText}`)}contextCreated(e){const t=e.data;this._items.insert(this._items.length,t),1===this._items.length&&this._dropDown.selectItem(t)}contextDestroyed(e){const t=e.data,o=this._items.findIndex(e=>e.contextId===t);o>-1&&this._items.remove(o)}contextChanged(e){const t=e.data,o=this._items.findIndex(e=>e.contextId===t.contextId);o>-1&&(this._items.replace(o,t),this._selectedContext&&this._selectedContext.contextId===t.contextId&&this._dropDown.selectItem(t))}createElementForItem(e){const t=document.createElement("div"),n=s.createShadowRootWithCoreStyles(t,{cssFile:"web_audio/audioContextSelector.css",enableLegacyPatching:!0,delegatesFocus:void 0}).createChild("div","title");return o.createTextChild(n,this.titleFor(e).trimEndWithMaxLength(100)),t}selectedContext(){return this._selectedContext?this._selectedContext:null}highlightedItemChanged(e,t,o,n){o&&o.classList.remove("highlighted"),n&&n.classList.add("highlighted")}isItemSelectable(e){return!0}itemSelected(e){e&&(this._selectedContext&&this._selectedContext.contextId===e.contextId||(this._selectedContext=e,this._toolbarItem.setTitle(ls`Audio context: ${this.titleFor(e)}`)),this.dispatchEventToListeners(z.ContextSelected,e))}reset(){this._items.replaceAll([])}titleFor(e){return`${e.contextType} (${e.contextId.substr(-6)})`}toolbarItem(){return this._toolbarItem}}const z={ContextSelected:Symbol("ContextSelected")};var G=Object.freeze({__proto__:null,AudioContextSelector:$,Events:z});class F{constructor(e){this._fragment=document.createDocumentFragment(),this._container=document.createElement("div"),this._container.classList.add("context-detail-container"),this._fragment.appendChild(this._container),this._build(e)}_build(e){const t="realtime"===e.contextType?ls`AudioContext`:ls`OfflineAudioContext`;this._addTitle(t,e.contextId),this._addEntry(ls`State`,e.contextState),this._addEntry(ls`Sample Rate`,e.sampleRate,"Hz"),"realtime"===e.contextType&&this._addEntry(ls`Callback Buffer Size`,e.callbackBufferSize,"frames"),this._addEntry(ls`Max Output Channels`,e.maxOutputChannelCount,"ch")}_addTitle(e,t){this._container.appendChild(i.html`
      <div class="context-detail-header">
        <div class="context-detail-title">${e}</div>
        <div class="context-detail-subtitle">${t}</div>
      </div>
    `)}_addEntry(e,t,o){const n=t+(o?" "+o:"");this._container.appendChild(i.html`
      <div class="context-detail-row">
        <div class="context-detail-row-entry">${e}</div>
        <div class="context-detail-row-value">${n}</div>
      </div>
    `)}getFragment(){return this._fragment}}class V{constructor(e,t){const o=t.currentTime.toFixed(3),n=(1e3*t.callbackIntervalMean).toFixed(3),d=(1e3*Math.sqrt(t.callbackIntervalVariance)).toFixed(3),a=(100*t.renderCapacity).toFixed(3);this._fragment=document.createDocumentFragment(),this._fragment.appendChild(i.html`
      <div class="context-summary-container">
        <span>${ls`Current Time`}: ${o} s</span>
        <span>\u2758</span>
        <span>${ls`Callback Interval`}: μ = ${n} ms, σ = ${d} ms</span>
        <span>\u2758</span>
        <span>${ls`Render Capacity`}: ${a} %</span>
      </div>
    `)}getFragment(){return this._fragment}}var H=Object.freeze({__proto__:null,ContextDetailBuilder:F,ContextSummaryBuilder:V});class j extends r.ThrottledWidget{constructor(){super(!0,1e3),this.element.classList.add("web-audio-drawer"),this.registerRequiredCSS("web_audio/webAudio.css",{enableLegacyPatching:!0});const e=this.contentElement.createChild("div","web-audio-toolbar-container vbox");this._contextSelector=new $;const t=new a.Toolbar("web-audio-toolbar",e);t.appendToolbarItem(a.Toolbar.createActionButtonForId("components.collect-garbage")),t.appendSeparator(),t.appendToolbarItem(this._contextSelector.toolbarItem()),this._contentContainer=this.contentElement.createChild("div","web-audio-content-container vbox flex-auto"),this._detailViewContainer=this._contentContainer.createChild("div","web-audio-details-container vbox flex-auto"),this._graphManager=new O,this._landingPage=new h.VBox,this._landingPage.contentElement.classList.add("web-audio-landing-page","fill"),this._landingPage.contentElement.appendChild(i.html`
      <div>
        <p>${ls`Open a page that uses Web Audio API to start monitoring.`}</p>
      </div>
    `),this._landingPage.show(this._detailViewContainer),this._summaryBarContainer=this._contentContainer.createChild("div","web-audio-summary-container"),this._contextSelector.addEventListener(z.ContextSelected,e=>{const t=e.data;this._updateDetailView(t),this.doUpdate()}),c.TargetManager.instance().observeModels(B,this)}wasShown(){super.wasShown();for(const e of c.TargetManager.instance().models(B))this._addEventListeners(e)}willHide(){for(const e of c.TargetManager.instance().models(B))this._removeEventListeners(e)}modelAdded(e){this.isShowing()&&this._addEventListeners(e)}modelRemoved(e){this._removeEventListeners(e)}async doUpdate(){await this._pollRealtimeData(),this.update()}_addEventListeners(e){e.ensureEnabled(),e.addEventListener(W.ContextCreated,this._contextCreated,this),e.addEventListener(W.ContextDestroyed,this._contextDestroyed,this),e.addEventListener(W.ContextChanged,this._contextChanged,this),e.addEventListener(W.ModelReset,this._reset,this),e.addEventListener(W.ModelSuspend,this._suspendModel,this),e.addEventListener(W.AudioListenerCreated,this._audioListenerCreated,this),e.addEventListener(W.AudioListenerWillBeDestroyed,this._audioListenerWillBeDestroyed,this),e.addEventListener(W.AudioNodeCreated,this._audioNodeCreated,this),e.addEventListener(W.AudioNodeWillBeDestroyed,this._audioNodeWillBeDestroyed,this),e.addEventListener(W.AudioParamCreated,this._audioParamCreated,this),e.addEventListener(W.AudioParamWillBeDestroyed,this._audioParamWillBeDestroyed,this),e.addEventListener(W.NodesConnected,this._nodesConnected,this),e.addEventListener(W.NodesDisconnected,this._nodesDisconnected,this),e.addEventListener(W.NodeParamConnected,this._nodeParamConnected,this),e.addEventListener(W.NodeParamDisconnected,this._nodeParamDisconnected,this)}_removeEventListeners(e){e.removeEventListener(W.ContextCreated,this._contextCreated,this),e.removeEventListener(W.ContextDestroyed,this._contextDestroyed,this),e.removeEventListener(W.ContextChanged,this._contextChanged,this),e.removeEventListener(W.ModelReset,this._reset,this),e.removeEventListener(W.ModelSuspend,this._suspendModel,this),e.removeEventListener(W.AudioListenerCreated,this._audioListenerCreated,this),e.removeEventListener(W.AudioListenerWillBeDestroyed,this._audioListenerWillBeDestroyed,this),e.removeEventListener(W.AudioNodeCreated,this._audioNodeCreated,this),e.removeEventListener(W.AudioNodeWillBeDestroyed,this._audioNodeWillBeDestroyed,this),e.removeEventListener(W.AudioParamCreated,this._audioParamCreated,this),e.removeEventListener(W.AudioParamWillBeDestroyed,this._audioParamWillBeDestroyed,this),e.removeEventListener(W.NodesConnected,this._nodesConnected,this),e.removeEventListener(W.NodesDisconnected,this._nodesDisconnected,this),e.removeEventListener(W.NodeParamConnected,this._nodeParamConnected,this),e.removeEventListener(W.NodeParamDisconnected,this._nodeParamDisconnected,this)}_contextCreated(e){const t=e.data;this._graphManager.createContext(t.contextId),this._contextSelector.contextCreated(e)}_contextDestroyed(e){const t=e.data;this._graphManager.destroyContext(t),this._contextSelector.contextDestroyed(e)}_contextChanged(e){const t=e.data;this._graphManager.hasContext(t.contextId)&&this._contextSelector.contextChanged(e)}_reset(){this._landingPage.isShowing()&&this._landingPage.detach(),this._contextSelector.reset(),this._detailViewContainer.removeChildren(),this._landingPage.show(this._detailViewContainer),this._graphManager.clearGraphs()}_suspendModel(){this._graphManager.clearGraphs()}_audioListenerCreated(e){const t=e.data,o=this._graphManager.getGraph(t.contextId);o&&o.addNode({nodeId:t.listenerId,nodeType:"Listener",numberOfInputs:0,numberOfOutputs:0})}_audioListenerWillBeDestroyed(e){const{contextId:t,listenerId:o}=e.data,n=this._graphManager.getGraph(t);n&&n.removeNode(o)}_audioNodeCreated(e){const t=e.data,o=this._graphManager.getGraph(t.contextId);o&&o.addNode({nodeId:t.nodeId,nodeType:t.nodeType,numberOfInputs:t.numberOfInputs,numberOfOutputs:t.numberOfOutputs})}_audioNodeWillBeDestroyed(e){const{contextId:t,nodeId:o}=e.data,n=this._graphManager.getGraph(t);n&&n.removeNode(o)}_audioParamCreated(e){const t=e.data,o=this._graphManager.getGraph(t.contextId);o&&o.addParam({paramId:t.paramId,paramType:t.paramType,nodeId:t.nodeId})}_audioParamWillBeDestroyed(e){const{contextId:t,paramId:o}=e.data,n=this._graphManager.getGraph(t);n&&n.removeParam(o)}_nodesConnected(e){const{contextId:t,sourceId:o,destinationId:n,sourceOutputIndex:d,destinationInputIndex:a}=e.data,s=this._graphManager.getGraph(t);s&&s.addNodeToNodeConnection({sourceId:o,destinationId:n,sourceOutputIndex:d,destinationInputIndex:a})}_nodesDisconnected(e){const{contextId:t,sourceId:o,destinationId:n,sourceOutputIndex:d,destinationInputIndex:a}=e.data,s=this._graphManager.getGraph(t);s&&s.removeNodeToNodeConnection({sourceId:o,destinationId:n,sourceOutputIndex:d,destinationInputIndex:a})}_nodeParamConnected(e){const{contextId:t,sourceId:o,destinationId:n,sourceOutputIndex:d}=e.data,a=this._graphManager.getGraph(t);if(!a)return;const s=a.getNodeIdByParamId(n);s&&a.addNodeToParamConnection({sourceId:o,destinationId:s,sourceOutputIndex:d,destinationParamId:n})}_nodeParamDisconnected(e){const{contextId:t,sourceId:o,destinationId:n,sourceOutputIndex:d}=e.data,a=this._graphManager.getGraph(t);if(!a)return;const s=a.getNodeIdByParamId(n);s&&a.removeNodeToParamConnection({sourceId:o,destinationId:s,sourceOutputIndex:d,destinationParamId:n})}_updateDetailView(e){this._landingPage.isShowing()&&this._landingPage.detach();const t=new F(e);this._detailViewContainer.removeChildren(),this._detailViewContainer.appendChild(t.getFragment())}_updateSummaryBar(e,t){const o=new V(e,t);this._summaryBarContainer.removeChildren(),this._summaryBarContainer.appendChild(o.getFragment())}_clearSummaryBar(){this._summaryBarContainer.removeChildren()}async _pollRealtimeData(){const e=this._contextSelector.selectedContext();if(e)for(const t of c.TargetManager.instance().models(B))if("realtime"===e.contextType){if(!this._graphManager.hasContext(e.contextId))continue;const o=await t.requestRealtimeData(e.contextId);o&&this._updateSummaryBar(e.contextId,o)}else this._clearSummaryBar();else this._clearSummaryBar()}}var U=Object.freeze({__proto__:null,WebAudioView:j});export{H as AudioContextContentBuilder,G as AudioContextSelector,S as EdgeView,A as GraphManager,p as GraphStyle,M as GraphView,I as NodeRendererUtility,N as NodeView,R as WebAudioModel,U as WebAudioView};
